<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Linux安装JDK以及配置</title>
    <url>/jdk-install/</url>
    <content><![CDATA[<h3 id="1-安装包安装"><a class="markdownIt-Anchor" href="#1-安装包安装"></a> 1. 安装包安装</h3>
<ol>
<li>
<p>下载jdk安装包（<a href="https://www.oracle.com/cn/java/technologies/javase/downloads/#java8%EF%BC%89">https://www.oracle.com/cn/java/technologies/javase/downloads/#java8）</a><br>
<img src="/jdk-install/1.png" alt></p>
</li>
<li>
<p>上传并解压</p>
</li>
</ol>
<ul>
<li>在/usr/local/目录下新建文件夹：java</li>
<li>上传介质到/usr/local/java/</li>
<li>解压：tar -zxvf jdk-8u311-linux-x64.tar.gz</li>
</ul>
<ol start="3">
<li>配置环境变量 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 编辑配置文件</span></span><br><span class="line">vim /etc/profile</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在末尾追加</span></span><br><span class="line">export JAVA_HOME=/usr/local/java/jdk1.8.0_311</span><br><span class="line">export JRE_HOME=/usr/local/java/jdk1.8.0_311/jre</span><br><span class="line">export CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar:$JRE_HOME/lib:$CLASSPATH</span><br><span class="line">export PATH=$JAVA_HOME/bin:$PATH</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 使配置文件生效</span></span><br><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure>
</li>
<li>测试 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 测试版本号</span></span><br><span class="line">java -version</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 返回</span></span><br><span class="line">java version &quot;1.8.0_311&quot;</span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_311-b10)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.291-b10, mixed mode)</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查询JAVA_HOME</span></span><br><span class="line">echo $JAVA_HOME</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 返回</span></span><br><span class="line">/usr/local/java/jdk1.8.0_311</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="2-yum源安装"><a class="markdownIt-Anchor" href="#2-yum源安装"></a> 2. yum源安装</h2>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 检查是否已经存在java相关命令</span></span><br><span class="line">rpm -qa|grep java</span><br><span class="line">rpm -qa|grep jdk</span><br><span class="line">rpm -qa|grep gcj</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 如果需要卸载</span></span><br><span class="line">rpm -qa | grep java | xargs rpm -e --nodeps</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 检索Java1.8源列表</span></span><br><span class="line">yum list java-1.8*</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装Java1.8</span></span><br><span class="line">yum install java-1.8.0-openjdk* -y</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查询JAVA_HOME</span></span><br><span class="line">which java</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 返回</span></span><br><span class="line">/usr/bin/java</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ls -l命令</span></span><br><span class="line">ls -l /usr/bin/java</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 返回</span></span><br><span class="line">lrwxrwxrwx 1 root root 22 Nov 13 14:37 /usr/bin/java -&gt; /etc/alternatives/java</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ls -l命令</span></span><br><span class="line">ls -l /etc/alternatives/java</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 返回</span></span><br><span class="line">lrwxrwxrwx 1 root root 73 Nov 13 14:37 /etc/alternatives/java -&gt; /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.272.b10-1.el7_9.x86_64/jre/bin/java</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 则JAVA_HOME路径为：/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.272.b10-1.el7_9.x86_64</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>jdk</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux安装mysql8</title>
    <url>/mysql-install/</url>
    <content><![CDATA[<h3 id="1-下载"><a class="markdownIt-Anchor" href="#1-下载"></a> 1. 下载</h3>
<ul>
<li>下载地址：<a href="https://downloads.mysql.com/archives/community/">https://downloads.mysql.com/archives/community/</a></li>
<li>百度网盘链接: <a href="https://pan.baidu.com/s/1BkOuYlz2Ef7KRe9gikDUCg">https://pan.baidu.com/s/1BkOuYlz2Ef7KRe9gikDUCg</a>  密码: 0l15</li>
<li>Linux镜像下载  <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /usr/local/src/</span><br><span class="line">wget https://dev.mysql.com/get/Downloads/MySQL-8.0/mysql-8.0.27-linux-glibc2.12-x86_64.tar.gz</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="2卸载mariadb"><a class="markdownIt-Anchor" href="#2卸载mariadb"></a> 2.卸载mariadb</h3>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">查看mariadb 的安装包</span></span><br><span class="line">rpm -qa | grep mariadb</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">卸载 mariadb</span></span><br><span class="line">rpm -e mariadb-libs-5.5.68-1.el7.x86_64 --nodeps</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">卸载验证</span></span><br><span class="line">rpm -qa | grep mariadb</span><br></pre></td></tr></table></figure>
<h3 id="3安装"><a class="markdownIt-Anchor" href="#3安装"></a> 3.安装</h3>
<ol>
<li>
<p>解压安装包</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"> #</span><span class="bash"> 进入下载目录</span></span><br><span class="line"> cd /usr/local/src/</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">解压， 如果是.tar则用 tar -zxvf解压， 我下载的是.tar.xz包，使用的是tar -xvJf</span></span><br><span class="line"> tar -xvJf mysql-8.0.28-linux-glibc2.17-x86_64-minimal.tar.xz</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 移动解压后的文件夹至/usr/<span class="built_in">local</span></span></span><br><span class="line"> mv /usr/local/src/mysql-8.0.28-linux-glibc2.17-x86_64-minimal /usr/local/</span><br><span class="line"> cd /usr/local/</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"> #</span><span class="bash"> 重命名</span></span><br><span class="line"> mv ./mysql-8.0.28-linux-glibc2.17-x86_64-minimal mysql8.0</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"> #</span><span class="bash"> 创建文件夹data,存储文件;</span></span><br><span class="line"> cd /usr/local/mysql8.0/</span><br><span class="line"> mkdir ./data</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>创建用户以及用户组</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 用户组</span></span><br><span class="line">groupadd mysql</span><br><span class="line"><span class="meta">#</span><span class="bash"> 用户 （用户名/密码）</span></span><br><span class="line">useradd -g mysql mysql</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>授权</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">chown -R mysql.mysql /usr/local/mysql8.0/ </span><br><span class="line"><span class="meta">#</span><span class="bash">或</span></span><br><span class="line">chown -R mysql .</span><br><span class="line">chgrp -R mysql .</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>初始化数据库</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看当前所在目录</span></span><br><span class="line">pwd # 若显示/usr/local/mysql-8.0,请继续执行，否则请先进入此目录/usr/local/mysql-8.0</span><br><span class="line"><span class="meta">#</span><span class="bash"> 初始化 注意查看是否存在相关目录,若不存在,请新建</span></span><br><span class="line">./bin/mysqld --user=mysql --basedir=/usr/local/mysql8.0/ --datadir=/usr/local/mysql8.0/data/ --initialize ; # 亲测</span><br><span class="line"><span class="meta">#</span><span class="bash">或</span></span><br><span class="line">./bin/mysql --user=mysql --basedir=/usr/local/mysql8.0/ --datadir=/usr/local/mysql8.0/data/ --initialize ;</span><br><span class="line">   </span><br><span class="line"><span class="meta">#</span><span class="bash">如果出现错误：./bin/mysqld: error <span class="keyword">while</span> loading shared libraries: libaio.so.1: cannot open shared object file: No such file or directory</span></span><br><span class="line">yum install -y libaio  #安装后在初始化就OK了</span><br></pre></td></tr></table></figure>
<p><img src="/mysql-install/3.png" alt><br>
注意：后面白色高亮选中的是初始密码！！！！</p>
</li>
<li>
<p>配置my.cnf</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cp /usr/local/mysql8.0/support-files/mysql.server /etc/init.d/mysqld</span><br><span class="line">vim /etc/my.cnf</span><br></pre></td></tr></table></figure>
<p>在配置中键入如下内容：</p>
 <figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"> <span class="attr">[mysqld]</span></span><br><span class="line"><span class="attr">port</span>=<span class="string">3306</span></span><br><span class="line"><span class="comment"># 设置mysql的安装目录</span></span><br><span class="line"><span class="attr">basedir</span>=<span class="string">/usr/local/mysql8</span></span><br><span class="line"><span class="comment"># 设置mysql数据库的数据的存放目录</span></span><br><span class="line"><span class="attr">datadir</span>=<span class="string">/usr/local/mysql8/mysqldb</span></span><br><span class="line"><span class="comment"># 允许最大连接数</span></span><br><span class="line"><span class="attr">max_connections</span>=<span class="string">1000</span></span><br><span class="line"><span class="comment"># 允许连接失败的次数。这是为了防止有人从该主机试图攻击数据库系统</span></span><br><span class="line"><span class="attr">max_connect_errors</span>=<span class="string">100</span></span><br><span class="line"><span class="comment"># 服务端使用的字符集默认为UTF8</span></span><br><span class="line"><span class="meta">character-set-server</span>=<span class="string">utf8mb4</span></span><br><span class="line"><span class="comment"># 创建新表时将使用的默认存储引擎</span></span><br><span class="line"><span class="meta">default-storage-engine</span>=<span class="string">INNODB</span></span><br><span class="line"><span class="comment"># 默认使用“mysql_native_password”插件认证</span></span><br><span class="line"><span class="attr">default_authentication_plugin</span>=<span class="string">mysql_native_password</span></span><br><span class="line"><span class="comment">#是否对sql语句大小写敏感，1表示不敏感</span></span><br><span class="line"><span class="attr">lower_case_table_names</span> = <span class="string">1</span></span><br><span class="line"><span class="comment">#MySQL连接闲置超过一定时间后(单位：秒)将会被强行关闭</span></span><br><span class="line"><span class="comment">#MySQL默认的wait_timeout  值为8个小时, interactive_timeout参数需要同时配置才能生效</span></span><br><span class="line"><span class="attr">interactive_timeout</span> = <span class="string">1800</span></span><br><span class="line"><span class="attr">wait_timeout</span> = <span class="string">1800</span></span><br><span class="line"><span class="comment">#Metadata Lock最大时长（秒）， 一般用于控制 alter操作的最大时长sine mysql5.6</span></span><br><span class="line"><span class="comment">#执行 DML操作时除了增加innodb事务锁外还增加Metadata Lock，其他alter（DDL）session将阻塞</span></span><br><span class="line"><span class="attr">lock_wait_timeout</span> = <span class="string">3600</span></span><br><span class="line"><span class="comment">#内部内存临时表的最大值。</span></span><br><span class="line"><span class="comment">#比如大数据量的group by ,order by时可能用到临时表，</span></span><br><span class="line"><span class="comment">#超过了这个值将写入磁盘，系统IO压力增大</span></span><br><span class="line"><span class="attr">tmp_table_size</span> = <span class="string">64M</span></span><br><span class="line"><span class="attr">max_heap_table_size</span> = <span class="string">64M</span></span><br><span class="line"><span class="attr">[mysql]</span></span><br><span class="line"><span class="comment"># 设置mysql客户端默认字符集</span></span><br><span class="line"><span class="meta">default-character-set</span>=<span class="string">utf8mb4</span></span><br><span class="line"><span class="attr">[client]</span></span><br><span class="line"><span class="comment"># 设置mysql客户端连接服务端时默认使用的端口</span></span><br><span class="line"><span class="attr">port</span>=<span class="string">3306</span></span><br><span class="line"><span class="meta">default-character-set</span>=<span class="string">utf8mb4</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>建立Mysql服务</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cp -a ./support-files/mysql.server /etc/init.d/mysql</span><br><span class="line">chmod +x /etc/init.d/mysql</span><br><span class="line">chkconfig --add mysql</span><br><span class="line">chkconfig --list mysql</span><br></pre></td></tr></table></figure>
<p><img src="/mysql-install/4.png" alt></p>
</li>
<li>
<p>启动Mysql服务</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 启动</span></span><br><span class="line">service mysql start;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看启动状态</span></span><br><span class="line">service mysql status;</span><br></pre></td></tr></table></figure>
<p>如果提示： -bash: mysql: command not found</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ln -s /usr/local/mysql8.0/bin/mysql /usr/bin</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>登录Mysql</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mysql -uroot -p</span><br><span class="line"><span class="meta">#</span><span class="bash"> 输入<span class="string">&quot;初始化数据库&quot;</span>操作时的<span class="string">&quot;临时密码&quot;</span></span></span><br></pre></td></tr></table></figure>
<p><img src="/mysql-install/5.png" alt></p>
<p>修改密码：</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ALTER USER &#x27;root&#x27;@&#x27;localhost&#x27; IDENTIFIED WITH mysql_native_password BY &#x27;新密码&#x27;;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>远程连接</p>
<ol>
<li>在my.cnf的mysqld下增加 <figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">default_authentication_plugin</span>=<span class="string">mysql_native_password</span></span><br></pre></td></tr></table></figure>
</li>
<li>进入mysql命令行 <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">use mysql</span><br><span class="line">update user set host =&#x27;%&#x27; where user=&#x27;root&#x27;;</span><br><span class="line">ALTER USER &#x27;root&#x27;@&#x27;%&#x27; IDENTIFIED WITH mysql_native_password BY &#x27;root&#x27;;</span><br><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure>
<img src="/mysql-install/7.png" alt></li>
</ol>
</li>
<li>
<p>检查端口</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">检查3306端口是否开放</span></span><br><span class="line">netstat -nupl|grep 3306</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">开放3306端口</span></span><br><span class="line">firewall -cmd --permanent --add-prot=3306/tcp</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">重启防火墙</span></span><br><span class="line">firewall -cmd --reload</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="4-常见问题"><a class="markdownIt-Anchor" href="#4-常见问题"></a> 4. 常见问题</h3>
<ol>
<li>
<p>The server quit without updating PID file</p>
<ul>
<li>第一，权限的问题，在出这个错误的时候，我所说的权限是mysq.cnf和所定义的mysql数据库存放目录的权限，要保证是mysql用户的权限，如果启动mysql还有问题，那么需要考虑提高权限了。<br>
说人话， 数据库存放目录必须是mysql这个用户的属组(通常的，安装MySQL的时候建立的用户为mysql，不建议使用别的用户），mysql的启动脚本必须有执行权限。赋予权限的命令为：chown -R mysql. /usr/local/mysql,假设我的mysql是安装在  /usr/local/mysql目录，数据库存放目录为 /usr/local/mysql/data/</li>
<li>第二，进程中有mysql的进程，上次的退出并没有自动结束该pid，导致新的进程无法启动，毕竟，mysql每次启动系统只会给分配一个pid号，再启动，系统也不可能给你分配pid号了。运行命令 ps -ef |grep mysql  找到mysql的进程结束它，然后在启动mysql。</li>
<li>第三，进入mysql数据库的存放目录，如果有mysql-bin.index这样的文件，删除它，在启动mysql，该文件产生的原因不详，不过删除必定没影响，或者另一个binlog.index也删除，两个index后缀的都删除也可以。</li>
<li>第四，my.cnf 这个配置文件内容不对，检查有没有skip-federated这个字段，如果有注释或者删除。<br>
检查是否定义了数据库存放目录，如果没有定义，请立刻定义。</li>
<li>第五，错误日志目录不存在解决方法：使用“chown” “chmod”命令赋予mysql目录所有者及权限。</li>
<li>第六，my.cnf文件内存在lower_case_table_names=1 字段，注释掉它。（这个选项是1表示不区分大小写）。具体原因不详。</li>
</ul>
<p>总结：mysql说好安装也好安装，说难也难，难点在于权限的配置，给高了不安全，给低了有可能启动出问题，如果启动出问题了，首先第一件事就是检查目录权限，第二就是检查my.cnf这个配置文件，skip-federated，lower_case_table_names=1 ，这样的字段注释掉，第三，清除旧的mysql进程，如果有就清除掉，旧的不去新的不来，就这么一个道理。第四，进入mysql数据库存放目录删除index后缀的文件。下面，给张图，详细的权限慢慢体会</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ls -al /etc/init.d/mysql</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>Can 't connect to local MySQL server through socket '/tmp/mysql.sock</p>
<p>连接localhost通常通过一个Unix域套接字文件进行，一般是/tmp/mysql.sock。如果套接字文件被删除了，本地客户就不能连接。这可能发生在你的系统运行一个cron任务删除了/tmp下的临时文件。<br>
如果你因为丢失套接字文件而不能连接，你可以简单地通过重启服务器重新创建得到它。因为服务器在启动时重新创建它。<br>
如果和我一样，重启服务器还是没有任何变化，你可以先执行下面的语句</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mysql -uroot -h 127.0.0.1 -p</span><br></pre></td></tr></table></figure>
<p>解决方式：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo mkdir /var/run/mysqld/</span><br><span class="line">sudo ln -s /tmp/mysql.sock /var/run/mysqld/mysqld.sock</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>however file don’t exists. Create writable for user ‘mysql’<br>
问题描述：</p>
 <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@test2 my57_3307]# /usr/local/mysql57/bin/mysqld_safe  --defaults-file=/dbdata/mysql/my57_3307/my57_3307.cnf  --ledir=/usr/local/mysql57/bin</span><br><span class="line">2018-08-26T14:12:45.459798Z mysqld_safe error: log-error set to &#x27;/var/log/mysqld/my57_3307.log&#x27;, however file don&#x27;t exists. Create writable for user &#x27;mysql&#x27;.</span><br></pre></td></tr></table></figure>
<p>解决方式：</p>
 <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">touch /usr/local/mysql8.0/log/error.log</span><br><span class="line">chown mysql /usr/local/mysql8.0/log/error.log</span><br><span class="line">/usr/local/mysql8.0/bin/mysqld_safe  --defaults-file=/etc/my.cnf  --ledir=/usr/local/mysql8.0/bin</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>cannot open shared object file: No such file or directory</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">需要安装 libnuma</span></span><br><span class="line">yum install libnuma</span><br><span class="line">yum -y install  numactl</span><br><span class="line">yum install libaio1 libaio-dev</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>mysqld启动报错Failed to find valid data directory</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"> vim /etc/my.cnf #查看datadir配置项的路径，然后一般是/var/lib/mysql，将这个文件夹删掉，然后重新初始化</span><br><span class="line"> </span><br><span class="line"> /usr/local/mysql8/bin/mysqld --initialize --user=mysql</span><br><span class="line"><span class="meta"> </span></span><br><span class="line"><span class="meta"> #</span><span class="bash">如果mysqld启动服务时提示不能用root启动，则在/var/lib/mysql中加入这行 user=mysql</span></span><br><span class="line"> </span><br><span class="line"><span class="meta"> </span></span><br><span class="line"><span class="meta"> #</span><span class="bash">重启</span></span><br><span class="line">service mysql restart</span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title>ConcurrentHashMap线程安全</title>
    <url>/ConcurrentHashMap/</url>
    <content><![CDATA[<p>##1. jdk1.7 ConcurrentHashMap<br>
jdk1.7 ConcurrentHashMap是由一个Segment数组和多个HashEntry数组组成<br>
<img src="/ConcurrentHashMap/01.png" alt="image-20201210103251475"><br>
其实就是将HashMap分为多个小HashMap,每个Segment元素维护一个小HashMap,目的是锁分离，本来实现同步，直接可以是对整个HashMap加锁，但是加锁粒度太大，影响并发性能，所以变换成此结构，仅仅对Segment元素加锁，降低锁粒度，提高并发性能</p>
<p>###1.1 初始化过程<br>
由于变换成<strong>Segment数组+HashEntry数组</strong>，所以初始化时，需要依次对Segment数组和HashEntry数组初始化</p>
<ol>
<li>
<p>Segment数组初始化</p>
<p>初始化时，使用右移一位，乘以2的计算方式，保证ssize是2的幂次方，小于指定参数concurrencyLevel的最大2的幂次方</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> sshift = <span class="number">0</span>;</span><br><span class="line"><span class="comment">//记录Segment数组大小</span></span><br><span class="line"><span class="keyword">int</span> ssize = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">while</span> (ssize &lt; concurrencyLevel) &#123;</span><br><span class="line">    ++sshift;</span><br><span class="line">    ssize &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>HashEntry数组初始化</p>
<p>跟Segment数组初始化方式相同</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> cap = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">while</span>(cap &lt; c)&#123;</span><br><span class="line">    cap &lt;&lt;=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="12-put操作"><a class="markdownIt-Anchor" href="#12-put操作"></a> 1.2 put操作</h3>
<p>对于插入操作，需要两次Hash映射去定位数据存储位置</p>
<ol>
<li>首先通过第一次hash过程，定位Segment位置</li>
<li>然后通过第二次hash过程定位HashEntry位置</li>
</ol>
<p>Segment继承ReentrantLock,在数据插入指定HashEntry过程的时候会尝试调用ReentrantLock的tryLock方法获取锁，如果获取成功就直接插入相应位置，如果有线程获取该Segment的锁，当前线程就会以自旋方式去继续调用tryLock方法去获取锁，超过指定次数就挂起，等待唤醒。</p>
<h3 id="13-get操作"><a class="markdownIt-Anchor" href="#13-get操作"></a> 1.3 get操作</h3>
<p>也是两次Hash映射，相对于put操作，少了加锁过程</p>
<h3 id="14-size操作"><a class="markdownIt-Anchor" href="#14-size操作"></a> 1.4 size操作</h3>
<p>size操作就是计算ConcurrentHashMap的大小，有两种方案</p>
<ul>
<li>给每个Segment都加上锁(相当于给整个Map加上锁)，然后计算size返回</li>
<li>不加锁的模式，尝试多次计算ConcurrentHashMap的size,最多三次，比较前后计算的结果，结果一致就认为当前没有元素加入，计算结果是准确的。(查看计算出size的前后modCount的数值有没有发生变化，modCount的值用于记录元素变化的操作。如put，remove，clear)</li>
</ul>
<h2 id="2-jdk18-concurrenthashmap"><a class="markdownIt-Anchor" href="#2-jdk18-concurrenthashmap"></a> 2. jdk1.8 ConcurrentHashMap</h2>
<p>jdk1.8ConcurrentHashMap是数组+链表，或者数组+红黑树结构,并发控制使用Synchronized关键字和CAS操作<br>
<img src="/ConcurrentHashMap/02.png" alt="jdk1.8 ConcurrentHashMap"></p>
<h3 id="21关键概念点"><a class="markdownIt-Anchor" href="#21关键概念点"></a> 2.1关键概念点</h3>
<ul>
<li>sizeCtl变量(volatile修饰)<br>
通过CAS操作+volatile, 控制数组初始化和扩容操作
<ul>
<li>-1 代表正在初始化</li>
<li>-N 前16位记录数组容量，后16位记录扩容线程大小+1，是个负数</li>
<li>正数0，表示未初始化</li>
<li>正数，0.75*当前数组大小</li>
</ul>
</li>
<li>&lt;key,value&gt;键值对，封装为Node对象</li>
<li>table变量(volatile)：也就是所说的数组，默认为null，默认大小为16的数组，每次扩容时大小总是2的幂次方</li>
<li>nextTable(volatile):扩容时新生成的数组，大小为table的两倍</li>
</ul>
<h3 id="22put函数"><a class="markdownIt-Anchor" href="#22put函数"></a> 2.2put函数</h3>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> putVal(key, value, <span class="keyword">false</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>1.putValue函数</strong><br>
首先调用spread函数，计算hash值，之后进入一个自旋循环过程，直到插入或替换成功，才会返回。如果table未被初始化，则调用initTable进行初始化。之后判断hash映射的位置是否为null,如果为null,直接通过CAS自旋操作，插入元素成功，则直接返回，如果映射的位置值为MOVED(-1),则直接去协助扩容，排除以上条件后，尝试对链头Node节点f加锁，加锁成功后，链表通过尾插遍历，进行插入或替换。红黑树通过查询遍历，进行插入或替换。之后如果当前链表节点数量大于阈值，则调用treeifyBin函数，转换为红黑树最后通过调用addCount,执行CAS操作，更新数组大小，并且判断是否需要进行扩容</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> V <span class="title">putVal</span><span class="params">(K key, V value, <span class="keyword">boolean</span> onlyIfAbsent)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (key == <span class="keyword">null</span> || value == <span class="keyword">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">    <span class="comment">//spread函数计算hash值</span></span><br><span class="line">    <span class="keyword">int</span> hash = spread(key.hashCode());</span><br><span class="line">    <span class="keyword">int</span> binCount = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//自旋过程</span></span><br><span class="line">    <span class="keyword">for</span> (Node&lt;K,V&gt;[] tab = table;;) &#123;</span><br><span class="line">        Node&lt;K,V&gt; f; <span class="keyword">int</span> n, i, fh;</span><br><span class="line">        <span class="keyword">if</span> (tab == <span class="keyword">null</span> || (n = tab.length) == <span class="number">0</span>)</span><br><span class="line">            tab = initTable();</span><br><span class="line">        <span class="comment">//判断映射位置节点是否为空</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((f = tabAt(tab, i = (n - <span class="number">1</span>) &amp; hash)) == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (casTabAt(tab, i, <span class="keyword">null</span>,</span><br><span class="line">                         <span class="keyword">new</span> Node&lt;K,V&gt;(hash, key, value, <span class="keyword">null</span>)))</span><br><span class="line">                <span class="keyword">break</span>;                  </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//如果映射位置节点value==MOVED，说明正在进行扩容操作</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((fh = f.hash) == MOVED)</span><br><span class="line">            tab = helpTransfer(tab, f);</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            V oldVal = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">synchronized</span> (f) &#123;</span><br><span class="line">                <span class="keyword">if</span> (tabAt(tab, i) == f) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (fh &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                        binCount = <span class="number">1</span>;</span><br><span class="line">                        <span class="keyword">for</span> (Node&lt;K,V&gt; e = f;; ++binCount) &#123;</span><br><span class="line">                            K ek;</span><br><span class="line">                            <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                                ((ek = e.key) == key ||</span><br><span class="line">                                 (ek != <span class="keyword">null</span> &amp;&amp; key.equals(ek)))) &#123;</span><br><span class="line">                                oldVal = e.val;</span><br><span class="line">                                <span class="keyword">if</span> (!onlyIfAbsent)</span><br><span class="line">                                    e.val = value;</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                            Node&lt;K,V&gt; pred = e;</span><br><span class="line">                            <span class="keyword">if</span> ((e = e.next) == <span class="keyword">null</span>) &#123;</span><br><span class="line">                                pred.next = <span class="keyword">new</span> Node&lt;K,V&gt;(hash, key,</span><br><span class="line">                                                          value, <span class="keyword">null</span>);</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">//红黑树结构</span></span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span> (f <span class="keyword">instanceof</span> TreeBin) &#123;</span><br><span class="line">                        Node&lt;K,V&gt; p;</span><br><span class="line">                        binCount = <span class="number">2</span>;</span><br><span class="line">                        <span class="keyword">if</span> ((p = ((TreeBin&lt;K,V&gt;)f).putTreeVal(hash, key,</span><br><span class="line">                                                       value)) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                            oldVal = p.val;</span><br><span class="line">                            <span class="keyword">if</span> (!onlyIfAbsent)</span><br><span class="line">                                p.val = value;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//链表节点数量超过阈值，转为红黑树</span></span><br><span class="line">            <span class="keyword">if</span> (binCount != <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD)</span><br><span class="line">                    treeifyBin(tab, i);</span><br><span class="line">                <span class="keyword">if</span> (oldVal != <span class="keyword">null</span>)</span><br><span class="line">                    <span class="keyword">return</span> oldVal;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    addCount(<span class="number">1L</span>, binCount);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>2. spread函数</strong><br>
spread函数，计算hash值。key的hash值与其高16位相异或，然后与HASH_BITS将最高位置0</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">spread</span><span class="params">(<span class="keyword">int</span> h)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (h ^ (h &gt;&gt;&gt; <span class="number">16</span>)) &amp; HASH_BITS;</span><br><span class="line">    <span class="comment">//HASH_BITS=0x7fffffff</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>3. tableAt函数</strong><br>
获取最新的tab[i]</p>
<p><strong>4. casTabAt函数</strong><br>
通过CAS操作，将值赋值进tab中对应位置</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> &lt;K,V&gt; <span class="function">Node&lt;K,V&gt; <span class="title">tabAt</span><span class="params">(Node&lt;K,V&gt;[] tab, <span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (Node&lt;K,V&gt;)U.getObjectVolatile(tab, ((<span class="keyword">long</span>)i &lt;&lt; ASHIFT) + ABASE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> &lt;K,V&gt; <span class="function"><span class="keyword">boolean</span> <span class="title">casTabAt</span><span class="params">(Node&lt;K,V&gt;[] tab, <span class="keyword">int</span> i,</span></span></span><br><span class="line"><span class="params"><span class="function">                                        Node&lt;K,V&gt; c, Node&lt;K,V&gt; v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> U.compareAndSwapObject(tab, ((<span class="keyword">long</span>)i &lt;&lt; ASHIFT) + ABASE, c, v);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>5. addCount函数</strong><br>
尝试使用CAS操作，将BASECOUNT加1，操作失败，则说明有其他线程在进行加一操作,发生冲突。之后判断是否需要扩容</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">addCount</span><span class="params">(<span class="keyword">long</span> x, <span class="keyword">int</span> check)</span> </span>&#123;</span><br><span class="line">    CounterCell[] as; <span class="keyword">long</span> b, s;</span><br><span class="line">    <span class="comment">//使用CAS操作，将BASECOUNT加1</span></span><br><span class="line">    <span class="keyword">if</span> ((as = counterCells) != <span class="keyword">null</span> ||</span><br><span class="line">        !U.compareAndSwapLong(<span class="keyword">this</span>, BASECOUNT, b = baseCount, s = b + x)) &#123;</span><br><span class="line">        CounterCell a; <span class="keyword">long</span> v; <span class="keyword">int</span> m;</span><br><span class="line">        <span class="comment">//发生冲突</span></span><br><span class="line">        <span class="keyword">boolean</span> uncontended = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (as == <span class="keyword">null</span> || (m = as.length - <span class="number">1</span>) &lt; <span class="number">0</span> ||</span><br><span class="line">            (a = as[ThreadLocalRandom.getProbe() &amp; m]) == <span class="keyword">null</span> ||</span><br><span class="line">            !(uncontended =</span><br><span class="line">              U.compareAndSwapLong(a, CELLVALUE, v = a.value, v + x))) &#123;</span><br><span class="line">            <span class="comment">//多线程冲突执行</span></span><br><span class="line">            fullAddCount(x, uncontended);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (check &lt;= <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        s = sumCount();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (check &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">        Node&lt;K,V&gt;[] tab, nt; <span class="keyword">int</span> n, sc;</span><br><span class="line">        <span class="comment">//判断是否需要扩容  大于0.75当前数组大小</span></span><br><span class="line">        <span class="keyword">while</span> (s &gt;= (<span class="keyword">long</span>)(sc = sizeCtl) &amp;&amp; (tab = table) != <span class="keyword">null</span> &amp;&amp;</span><br><span class="line">               (n = tab.length) &lt; MAXIMUM_CAPACITY) &#123;</span><br><span class="line">            <span class="keyword">int</span> rs = resizeStamp(n);</span><br><span class="line">            <span class="keyword">if</span> (sc &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">//判断是否需要帮助扩容</span></span><br><span class="line">                <span class="comment">//扩容完成，或者扩容线程达到阈值不需要进行扩容，直接break</span></span><br><span class="line">                <span class="keyword">if</span> ((sc &gt;&gt;&gt; RESIZE_STAMP_SHIFT) != rs || sc == rs + <span class="number">1</span> ||</span><br><span class="line">                    sc == rs + MAX_RESIZERS || (nt = nextTable) == <span class="keyword">null</span> ||</span><br><span class="line">                    transferIndex &lt;= <span class="number">0</span>)</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="comment">//帮助扩容，扩容线程数+1</span></span><br><span class="line">                <span class="keyword">if</span> (U.compareAndSwapInt(<span class="keyword">this</span>, SIZECTL, sc, sc + <span class="number">1</span>))</span><br><span class="line">                    transfer(tab, nt);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//进行扩容操作</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (U.compareAndSwapInt(<span class="keyword">this</span>, SIZECTL, sc,</span><br><span class="line">                                         (rs &lt;&lt; RESIZE_STAMP_SHIFT) + <span class="number">2</span>))</span><br><span class="line">                transfer(tab, <span class="keyword">null</span>);</span><br><span class="line">            s = sumCount();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="23-inittable函数"><a class="markdownIt-Anchor" href="#23-inittable函数"></a> 2.3 initTable函数</h3>
<p>进入一个自旋过程，一旦有线程扩容成功，才break</p>
<ul>
<li>如果sizeCtl &lt; 0,说明已经有线程正在扩容，所以直接让出线程。</li>
<li>如果sizeCtl&gt;=0,说明当前没有线程扩容，尝试CAS操作，设置sizeCtl为-1</li>
<li>设置sizeCtl为-1成功的线程，进行扩容操作，并且将sc更新为数组负载阈值0.75*n</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Node&lt;K,V&gt;[] initTable() &#123;</span><br><span class="line">    Node&lt;K,V&gt;[] tab; <span class="keyword">int</span> sc;</span><br><span class="line">    <span class="comment">//自旋过程</span></span><br><span class="line">    <span class="keyword">while</span> ((tab = table) == <span class="keyword">null</span> || tab.length == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((sc = sizeCtl) &lt; <span class="number">0</span>)</span><br><span class="line">            Thread.yield(); </span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (U.compareAndSwapInt(<span class="keyword">this</span>, SIZECTL, sc, -<span class="number">1</span>)) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> ((tab = table) == <span class="keyword">null</span> || tab.length == <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">int</span> n = (sc &gt; <span class="number">0</span>) ? sc : DEFAULT_CAPACITY;</span><br><span class="line">                    <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">                    Node&lt;K,V&gt;[] nt = (Node&lt;K,V&gt;[])<span class="keyword">new</span> Node&lt;?,?&gt;[n];</span><br><span class="line">                    table = tab = nt;</span><br><span class="line">                    <span class="comment">//0.75*n</span></span><br><span class="line">                    sc = n - (n &gt;&gt;&gt; <span class="number">2</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                sizeCtl = sc;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> tab;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="24-统计concurrenthashmap中的元素个数"><a class="markdownIt-Anchor" href="#24-统计concurrenthashmap中的元素个数"></a> 2.4 统计ConCurrentHashMap中的元素个数</h3>
<p><strong>1. mappingCount函数</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//调用sumCount,获得元素数量</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">mappingCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">long</span> n = sumCount();</span><br><span class="line"><span class="keyword">return</span> (n &lt; <span class="number">0L</span>) ? <span class="number">0L</span> : n; <span class="comment">// ignore transient negative values</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>2. sumCount函数</strong></p>
<p>baseCount+ counterCells各个元素值，就是元素数量<br>
其实baseCount就是记录容器数量的，直接放回baseCount不就可以了吗？为什么sumCount()方法中还要遍历counterCells数组，累加对象的值呢？<br>
其中：counterCells是个全局的变量，表示的是CounterCell类数组。CounterCell是ConcurrentHashmap的内部类，它就是存储一个值。<br>
JDK1.8中使用一个volatile类型的变量baseCount记录元素的个数，当插入新数据put()或则删除数据remove()时，会通过addCount()方法更新baseCount<br>
初始化时counterCells为空，在并发量很高时，如果存在两个线程同时执行CAS修改baseCount值，则失败的线程会继续执行方法体中的逻辑，执行fullAddCount(x, uncontended)方法，这个方法其实就是初始化counterCells，并将x的值插入到counterCell类中，而x值一般也就是1或-1，这可以从put()方法中得知。<br>
这些对象是因为在CAS更新baseCount值时，由于高并发而导致失败，最终将值保存到CounterCell中，放到counterCells里。这也就是为什么sumCount()中需要遍历counterCells数组，sum累加CounterCell.value值了。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">long</span> <span class="title">sumCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    CounterCell[] as = counterCells; CounterCell a;</span><br><span class="line">    <span class="keyword">long</span> sum = baseCount;</span><br><span class="line">        <span class="keyword">if</span> (as != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; as.length; ++i) &#123;</span><br><span class="line">                <span class="keyword">if</span> ((a = as[i]) != <span class="keyword">null</span>)</span><br><span class="line">                sum += a.value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>3. CounterCell类</strong><br>
只存储一个值</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">CounterCell</span></span>&#123;</span><br><span class="line">   <span class="keyword">volatile</span> <span class="keyword">long</span> value;</span><br><span class="line">   CountCell(<span class="keyword">long</span> x) &#123;value = x;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>原文链接：<a href="https://blog.csdn.net/zycxnanwang/article/details/105424734">https://blog.csdn.net/zycxnanwang/article/details/105424734</a></p>
]]></content>
      <categories>
        <category>知识整理</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>ElasticSearch安装</title>
    <url>/ElasticSearch/</url>
    <content><![CDATA[<h2 id="1-jdk14安装"><a class="markdownIt-Anchor" href="#1-jdk14安装"></a> 1. JDK14安装</h2>
<ol>
<li>
<p>下载jdk14：  <a href="https://jdk.java.net/14/">https://jdk.java.net/14/</a></p>
</li>
<li>
<p>将文件存放在linux系统某文件夹内</p>
</li>
<li>
<p>解压</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">tar -zxvf openjdk-14.0.2_linux-x64_bin.tar.gz</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>配置环境变量</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /etc/profile</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#在文件最末尾添加，其中JAVA_HOME是jdk解压后的文件路径</span></span></span><br><span class="line">JAVA_HOME=/usr/lib/tools/jdk-14.0.2</span><br><span class="line">PATH=$JAVA_HOME/bin:$PATH</span><br><span class="line">CLASSPATH=$JAVA_HOME/jre/lib/ext:$JAVA_HOME/lib/tools.jar</span><br><span class="line">export PATH JAVA_HOME CLASSPATH</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>保存后，更新配置文件</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>查看JDK是否配置完成</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">java -version</span><br></pre></td></tr></table></figure>
<p>出现下图表示安装成功！</p>
<p><img src="/ElasticSearch/image-20200806170145844.png" alt="image-20200806170145844"></p>
</li>
</ol>
<h2 id="2-elasticsearch安装"><a class="markdownIt-Anchor" href="#2-elasticsearch安装"></a> 2. ElasticSearch安装</h2>
<ol>
<li>
<p>解压tar.gz包</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">tar -zxvf elasticsearch-7.8.0-linux-x86_64.tar.gz</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>添加elasticsearch用户</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">useradd elastic</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>赋予elastic search操作文件夹的权限</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">chown -R elastic:elastic /usr/lib/tools/elasticsearch-7.8.0/*</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>查看本机的hostname</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hostname</span><br><span class="line"><span class="meta">#</span><span class="bash">localhost.localdomain</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>修改elastic search配置</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"> cd ./elasticsearch-7.8.0/config</span><br><span class="line">vim elasticsearch.yml</span><br></pre></td></tr></table></figure>
<p><strong>elasticsearch.yml</strong></p>
 <figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ======================== Elasticsearch Configuration =========================</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># <span class="doctag">NOTE:</span> Elasticsearch comes with reasonable defaults for most settings.</span></span><br><span class="line"><span class="comment">#       Before you set out to tweak and tune the configuration, make sure you</span></span><br><span class="line"><span class="comment">#       understand what are you trying to accomplish and the consequences.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The primary way of configuring a node is via this file. This template lists</span></span><br><span class="line"><span class="comment"># the most important settings you may want to configure for a production cluster.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Please consult the documentation for further information on configuration options:</span></span><br><span class="line"><span class="comment"># https://www.elastic.co/guide/en/elasticsearch/reference/index.html</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># ---------------------------------- Cluster -----------------------------------</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Use a descriptive name for your cluster:</span></span><br><span class="line"><span class="comment">#集群名称，默认可以不修改，此处 xiaoyuge</span></span><br><span class="line"><span class="attr">cluster.name:</span> <span class="string">xiaoyuge</span></span><br><span class="line"><span class="comment"># ------------------------------------ Node ------------------------------------</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Use a descriptive name for the node:</span></span><br><span class="line"><span class="comment">#节点名称，必须修改 ，默认修改为当前机器名称，若是多实例则需要区分</span></span><br><span class="line"><span class="attr">node.name:</span> <span class="string">xiaoyuge-local1</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Add custom attributes to the node:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#node.attr.rack: r1</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># ----------------------------------- Paths ------------------------------------</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Path to directory where to store the data (separate multiple locations by comma):</span></span><br><span class="line"><span class="comment">##数据目录与日志目录，默认在当前运行程序下，生产环境需要指定</span></span><br><span class="line"><span class="comment">#path.data: /path/to/data</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Path to log files:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#path.logs: /path/to/logs</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># ----------------------------------- Memory -----------------------------------</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Lock the memory on startup:</span></span><br><span class="line"><span class="comment">#内存交换锁定，此处需要操作系统设置才生效</span></span><br><span class="line"><span class="comment">#bootstrap.memory_lock: true</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Make sure that the heap size is set to about half the memory available</span></span><br><span class="line"><span class="comment"># on the system and that the owner of the process is allowed to use this</span></span><br><span class="line"><span class="comment"># limit.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Elasticsearch performs poorly when the system is swapping the memory.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># ---------------------------------- Network -----------------------------------</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Set the bind address to a specific IP (IPv4 or IPv6):</span></span><br><span class="line"><span class="comment">#IP 地址，默认是 local，仅限本机访问，外网不可访问，设置 0.0.0.0 通用做法</span></span><br><span class="line"><span class="attr">network.host:</span> <span class="number">192.168</span><span class="number">.135</span><span class="number">.111</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Set a custom port for HTTP:</span></span><br><span class="line"><span class="comment">#访问端口，默认 9200，9300，建议明确指定</span></span><br><span class="line"><span class="attr">http.port:</span> <span class="number">9200</span></span><br><span class="line"><span class="attr">transport.port:</span> <span class="number">9300</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># For more information, consult the network module documentation.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># --------------------------------- Discovery ----------------------------------</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Pass an initial list of hosts to perform discovery when this node is started:</span></span><br><span class="line"><span class="comment"># The default list of hosts is [&quot;127.0.0.1&quot;, &quot;[::1]&quot;]</span></span><br><span class="line"><span class="comment">## 集群发现配置</span></span><br><span class="line"><span class="attr">discovery.seed_hosts:</span> [<span class="string">&quot;192.168.135.111:9300&quot;</span>]</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Bootstrap the cluster using an initial set of master-eligible nodes:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="attr">cluster.initial_master_nodes:</span> [<span class="string">&quot;192.168.135.111:9300&quot;</span>]</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># For more information, consult the discovery and cluster formation module documentation.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># ---------------------------------- Gateway -----------------------------------</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Block initial recovery after a full cluster restart until N nodes are started:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#gateway.recover_after_nodes: 3</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># For more information, consult the gateway module documentation.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># ---------------------------------- Various -----------------------------------</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Require explicit names when deleting indices:</span></span><br><span class="line"><span class="comment">##防止批量删除索引</span></span><br><span class="line"><span class="attr">action.destructive_requires_name:</span> <span class="literal">true</span></span><br><span class="line"><span class="comment">#设置密码</span></span><br><span class="line"><span class="attr">xpack.security.enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">xpack.license.self_generated.type:</span> <span class="string">trial</span></span><br><span class="line"><span class="attr">xpack.security.transport.ssl.enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">http.cors.enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">http.cors.allow-origin:</span> <span class="string">&quot;*&quot;</span></span><br><span class="line"><span class="attr">http.cors.allow-headers:</span> <span class="string">Authorization</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>切换为elastic search用户，然后启动elastic search</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">su elastic			#切换用户</span><br><span class="line">./bin/elasticsearch -d      #后台启动</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>设置密码</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./bin/elasticsearch-setup-passwords interactive</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">执行设置用户名和密码的命令,这里需要为4个用户分别设置密码，elastic, kibana, logstash_system,beats_system</span></span><br><span class="line">Initiating the setup of passwords for reserved users elastic,kibana,logstash_system,beats_system.</span><br><span class="line">You will be prompted to enter passwords as the process progresses.</span><br><span class="line">Please confirm that you would like to continue [y/N]y</span><br><span class="line">Enter password for [elastic]:</span><br><span class="line">passwords must be at least [6] characters long</span><br><span class="line">Try again.</span><br><span class="line">Enter password for [elastic]:</span><br><span class="line">Reenter password for [elastic]:</span><br><span class="line">Passwords do not match.</span><br><span class="line">Try again.</span><br><span class="line">Enter password for [elastic]:</span><br><span class="line">Reenter password for [elastic]:</span><br><span class="line">Enter password for [kibana]:</span><br><span class="line">Reenter password for [kibana]:</span><br><span class="line">Enter password for [logstash_system]:</span><br><span class="line">Reenter password for [logstash_system]:</span><br><span class="line">Enter password for [beats_system]:</span><br><span class="line">Reenter password for [beats_system]:</span><br><span class="line">Changed password for user [kibana]</span><br><span class="line">Changed password for user [logstash_system]</span><br><span class="line">Changed password for user [beats_system]</span><br><span class="line">Changed password for user [elastic]</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p><strong>常见异常：</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"> #</span><span class="bash">java.lang.RuntimeException: can not run elasticsearch as root</span></span><br><span class="line"><span class="meta"> #</span><span class="bash">切换为elastic search用户，不能用root项目启动</span></span><br><span class="line">  </span><br><span class="line">su elastic</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">Exception <span class="keyword">in</span> thread <span class="string">&quot;main&quot;</span> java.nio.file.AccessDeniedException: /usr/lib/tools/elasticsearch-7.8.0/config/elasticsearch.keystore</span></span><br><span class="line"><span class="meta">#</span><span class="bash">elastic search用户没有操作该文件夹的权限</span></span><br><span class="line">  </span><br><span class="line">su root</span><br><span class="line">chown -R elastic:elastic /usr/lib/tools/elasticsearch-7.8.0/*</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ERROR: [2] bootstrap checks failed</span><br><span class="line">[1]: max file descriptors [4096] for elasticsearch process is too low, increase to at least [65535]</span><br><span class="line">[2]: max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]</span><br><span class="line">   </span><br><span class="line"><span class="meta">#</span><span class="bash">分配内存不够</span></span><br><span class="line"><span class="meta">#</span><span class="bash">1. 修改 /etc/security/limits.conf</span></span><br><span class="line">sudo vi /etc/security/limits.conf</span><br><span class="line"><span class="meta">#</span><span class="bash">在文件末尾加上</span></span><br><span class="line">* soft nofile 65536</span><br><span class="line">* hard nofile 65536</span><br><span class="line">* soft nproc 4096</span><br><span class="line">* hard nproc 4096</span><br><span class="line"><span class="meta">#</span><span class="bash">2. 修改 /etc/sysctl.conf</span></span><br><span class="line">sudo vi /etc/sysctl.conf</span><br><span class="line"><span class="meta">#</span><span class="bash">在文件末尾增加</span></span><br><span class="line">vm.max_map_count=262144</span><br><span class="line"><span class="meta">#</span><span class="bash">3. 配置重新生效</span></span><br><span class="line">sysctl -p</span><br></pre></td></tr></table></figure>
<p><strong>效果如下：</strong></p>
<p><img src="/ElasticSearch/image-20200807093208470.png" alt="image-20200807093208470"></p>
<h2 id="3-kibana安装"><a class="markdownIt-Anchor" href="#3-kibana安装"></a> 3. Kibana安装</h2>
<ol>
<li>
<p>解压文件</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">tar -zxvf kibana-7.8.0-linux-x86_64.tar.gz</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>修改配置文件</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim ./config/kibana.yml</span><br></pre></td></tr></table></figure>
<p><strong>kibana.yml:</strong></p>
 <figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Kibana is served by a back end server. This setting specifies the port to use.</span></span><br><span class="line"><span class="comment">##访问端口，默认无需修改</span></span><br><span class="line"><span class="attr">server.port:</span> <span class="number">5601</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Specifies the address to which the Kibana server will bind. IP addresses and host names are both valid values.</span></span><br><span class="line"><span class="comment"># The default is &#x27;localhost&#x27;, which usually means remote machines will not be able to connect.</span></span><br><span class="line"><span class="comment"># To allow connections from remote users, set this parameter to a non-loopback address.</span></span><br><span class="line"><span class="comment">#访问地址 IP，默认本地 ;如果需要外网访问，则配置0.0.0.0</span></span><br><span class="line"><span class="attr">server.host:</span> <span class="string">&quot;0.0.0.0&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Enables you to specify a path to mount Kibana at if you are running behind a proxy.</span></span><br><span class="line"><span class="comment"># Use the `server.rewriteBasePath` setting to tell Kibana if it should remove the basePath</span></span><br><span class="line"><span class="comment"># from requests it receives, and to prevent a deprecation warning at startup.</span></span><br><span class="line"><span class="comment"># This setting cannot end in a slash.</span></span><br><span class="line"><span class="comment">#server.basePath: &quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Specifies whether Kibana should rewrite requests that are prefixed with</span></span><br><span class="line"><span class="comment"># `server.basePath` or require that they are rewritten by your reverse proxy.</span></span><br><span class="line"><span class="comment"># This setting was effectively always `false` before Kibana 6.3 and will</span></span><br><span class="line"><span class="comment"># default to `true` starting in Kibana 7.0.</span></span><br><span class="line"><span class="comment">#server.rewriteBasePath: false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The maximum payload size in bytes for incoming server requests.</span></span><br><span class="line"><span class="comment">#server.maxPayloadBytes: 1048576</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The Kibana server&#x27;s name.  This is used for display purposes.</span></span><br><span class="line"><span class="comment">#server.name: &quot;your-hostname&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The URLs of the Elasticsearch instances to use for all your queries.</span></span><br><span class="line"><span class="comment"># ES 服务指向，集群下配置多个</span></span><br><span class="line"><span class="attr">elasticsearch.hosts:</span> [<span class="string">&quot;http://192.168.135.111:9200&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># When this setting&#x27;s value is true Kibana uses the hostname specified in the server.host</span></span><br><span class="line"><span class="comment"># setting. When the value of this setting is false, Kibana uses the hostname of the host</span></span><br><span class="line"><span class="comment"># that connects to this Kibana instance.</span></span><br><span class="line"><span class="comment">#elasticsearch.preserveHost: true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Kibana uses an index in Elasticsearch to store saved searches, visualizations and</span></span><br><span class="line"><span class="comment"># dashboards. Kibana creates a new index if the index doesn&#x27;t already exist.</span></span><br><span class="line"><span class="comment"># Kibana 元数据存储索引名字，默认.kibana 无需修改</span></span><br><span class="line"><span class="comment">#kibana.index: &quot;.kibana&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The default application to load.</span></span><br><span class="line"><span class="comment">#kibana.defaultAppId: &quot;home&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># If your Elasticsearch is protected with basic authentication, these settings provide</span></span><br><span class="line"><span class="comment"># the username and password that the Kibana server uses to perform maintenance on the Kibana</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>启动</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"> #</span><span class="bash"> 当前窗口内启动</span></span><br><span class="line"> ./bin/kibana# </span><br><span class="line"><span class="meta">#</span><span class="bash">后台进程启动</span></span><br><span class="line">nohup ./bin/kibana &amp;</span><br></pre></td></tr></table></figure>
<p><strong>效果如下</strong></p>
<p><img src="/ElasticSearch/image-20200807093309761.png" alt="image-20200807093309761"></p>
</li>
</ol>
<p><strong>遇见问题：</strong></p>
<ul>
<li>
<p>root启动报错<img src="/ElasticSearch/image-20201211095101816.png" alt="image-20201211095101816"></p>
  <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">切换到elastic账户</span></span><br><span class="line">su xiaoyuge</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>elastic用户权限不足 <strong>Babel could not write cache to file: /usr/share/kibana/optimize/.babel_register_cache.json</strong><img src="/ElasticSearch/image-20201211095258901.png" alt="image-20201211095258901"></p>
  <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">切换到root用户</span></span><br><span class="line">su root </span><br><span class="line"><span class="meta">#</span><span class="bash">赋予elastic账户 xiaoyuge操作权限</span></span><br><span class="line">chown -R xiaoyuge /usr/local/kibana-7.7.1-linux-x86_64</span><br><span class="line"><span class="meta">#</span><span class="bash">切换为elastic账户</span></span><br><span class="line">su xiaoyuge</span><br><span class="line"><span class="meta">#</span><span class="bash">再次启动即可</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>ELK</tag>
      </tags>
  </entry>
  <entry>
    <title>二分查找</title>
    <url>/algorithm/</url>
    <content><![CDATA[<p>二分法查找是一种基于比较目标值和数组中间元素的算法</p>
<ul>
<li>如果目标值 = 中间值，则找到目标值</li>
<li>如果目标值 &lt; 中间值，则在左侧继续搜索</li>
<li>如果目标值 &gt; 中间值，则在右侧继续搜索<br>
<img src="/algorithm/01.png" alt="二分查找"></li>
</ul>
<p><strong>解题思路：</strong></p>
<ul>
<li>初始化指针left = 0, right=n-1;</li>
<li>当left &lt;= right：
<ul>
<li>比较中间元素nums[pivot]和目标值target<br>
1.target = nums[pivot], 返回pivot<br>
2.target &gt; nums[pivot], 则在右侧继续搜索left = pivot+1<br>
3.target &lt; nums[pivot], 则在左侧继续搜索right = pivot+1<br>
<img src="/algorithm/02.png" alt><br>
<img src="/algorithm/03.png" alt></li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 给定一个 n 个元素有序的（升序）整型数组 nums 和一个目标值 target  ，</span></span><br><span class="line"><span class="comment"> * 写一个函数搜索 nums 中的 target，如果目标值存在返回下标，否则返回 -1。</span></span><br><span class="line"><span class="comment"> * 输入: nums = [-1,0,3,5,9,12], target = 9</span></span><br><span class="line"><span class="comment"> * 输出: 4</span></span><br><span class="line"><span class="comment"> * 解释: 9 出现在 nums 中并且下标为 4</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">search</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> target)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> pivot, left =<span class="number">0</span>, right = nums.length - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (left &lt;= right)&#123;</span><br><span class="line">        pivot = left + (right - left) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (nums[pivot] == target)&#123;</span><br><span class="line">            <span class="keyword">return</span> pivot;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (nums[pivot] &lt; target)&#123;</span><br><span class="line">            left = pivot + <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            right = pivot - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>复杂度分析：</strong></p>
<ul>
<li>时间复杂度：O(logN)</li>
<li>空间复杂度：O(1)</li>
</ul>
]]></content>
      <categories>
        <category>算法</category>
      </categories>
      <tags>
        <tag>algorithm</tag>
      </tags>
  </entry>
  <entry>
    <title>JAVA类加载过程</title>
    <url>/classLoad/</url>
    <content><![CDATA[<h2 id="1类加载机制"><a class="markdownIt-Anchor" href="#1类加载机制"></a> 1.类加载机制</h2>
<p>JVM将类描述数据从.class文件中加载到内存，并对数据进行解析、初始化，最终形成被JVM直接使用的Java类型；类从被加载到JVM中开始，到卸载为止，<br>
整个生命周期包括：<strong>加载、验证、准备、解析、初始化、使用和卸载</strong>7个阶段<br>
<img src="/classLoad/01.png" alt="完整的类加载过程"></p>
<ol>
<li>
<p>加载</p>
<p>加载时jvm做了三件事</p>
<ul>
<li>1)通过一个类的全限定名获取该类的二进制流</li>
<li>2)将这个字节流的静态存储结构转化为方法区运行时数据结构</li>
<li>3)在内存堆中生成一个代表该类的java.lang.class对象，最为该类数据的访问入口</li>
</ul>
</li>
<li>
<p>验证</p>
<p>验证、准备、解析这三步可以看作是一个连接的过程，将类的字节码连接到JVM的运行黄台之中;  验证是为了确保class文件的字节流中包含的信息符合当前虚拟机的要求，不会威胁到jvm的安全。<br>
验证内容如下：</p>
<ul>
<li>文件格式的验证： 验证字节流是否符合class文件袋额规范，是否能被当前版本的虚拟机处理</li>
<li>元数据验证： 对字节码描述的信息进行语义分析，确保符合Java语言规范</li>
<li>字节码验证：通过数据流和控制流分析，确定寓意是否合法，符合逻辑的</li>
<li>符号引用验证：这个娇艳在解析阶段发生</li>
</ul>
</li>
<li>
<p>准备</p>
<p>为类的静态变量分配内存，设置初始值，对于final static修饰的变量，直接赋值为用户的定义值。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//准备阶段过后的初始值为0， 而不是7</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> a = <span class="number">7</span>;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>解析</p>
<p>解析是将常量池内的符号引用转化为直接引用（如物理内存地址指针）</p>
</li>
<li>
<p>初始化</p>
<p>初始化阶段，jvm才开始真正执行类中定义的Java代码</p>
<ul>
<li>执行类构造器<clinit>()方法的过程，类构造器方法是有编译器自动手机类中所有类变量的赋值动作和静态语句块（static块）中的语句合并产生的</clinit></li>
<li>当初始化一个类的时候，如果发现其父类还没有进行过初始化，需有限触发其父类的初始化</li>
<li>虚拟机会保证一个类的<clinit>()方法在多线程环境被正确加锁和同步<br>
<img src="/classLoad/02.png" alt="完整的类加载过程2"></clinit></li>
</ul>
</li>
</ol>
<h2 id="2类加载器"><a class="markdownIt-Anchor" href="#2类加载器"></a> 2.类加载器</h2>
<p>类加载器的主要任务：对类加载过程中的加载操作（根据一个类的全限定名读取该类的二进制字节流到JVM内部，然后转换为一个对应的java.lang.Class对象实例）</p>
<p>类加载器的分类</p>
<ul>
<li>启动类加载器Bootstrap ClassLoader:<br>
在HotSpot虚拟机中，Bootstrap ClassLoader用C++语言编写并嵌入JVM内部，主要负载加载JAVA_HOME/lib目录中的所有类，或者加载由选项-Xbootcalsspath指定的路径下的类</li>
<li>拓展类加载器/ExtClassLoader：<br>
ExtClassLoader继承ClassLoader类，负载加载JAVA_HOME/lib/ext目录中的所有类型，或者由参数-Xbootclasspath指定路径中的所有类型</li>
<li>应用程序类加载器/AppClassLoader:<br>
ExtClassLoader继承ClassLoader类，负责加载用户类路径ClassPath下的所有类型，一般情况下为程序的默认类加载器</li>
<li>自定义加载器:<br>
Java虚拟机规范将所有继承抽象类java.lang.ClassLoader的类加载器，定义为自定义类加载器</li>
</ul>
<h2 id="3-双亲委派模型"><a class="markdownIt-Anchor" href="#3-双亲委派模型"></a> 3. 双亲委派模型</h2>
<p><img src="/classLoad/03.png" alt="双亲委派模型"><br>
如果一个类加载器收到了类加载请求，它并不会自己先去加载，而是把这个请求委托给父类的加载器去执行，如果父类加载器还存在其父类加载器，则进一步向上委托，依次递归，请求最终将到达顶层的启动类加载器，如果父类加载器可以完成类加载任务，就成功返回，倘若父类加载器无法完成此加载任务，子加载器才会尝试自己去加载，这就是双亲委派模式 。</p>
<ul>
<li>除了启动类加载器以外，每个类加载器拥有一个父类加载器，用户的自定义类加载器的父类加载器是AppClassLoader；</li>
<li>双亲委派模型可以保证全限名指定的类，只被加载一次；</li>
<li>双亲委派模型不具有强制性约束，是Java设计者推荐的类加载器实现方式；</li>
</ul>
<h3 id="31-双亲委派模式优势"><a class="markdownIt-Anchor" href="#31-双亲委派模式优势"></a> 3.1 双亲委派模式优势</h3>
<ol>
<li>采用双亲委派模式的是好处是Java类随着它的类加载器一起具备了一种带有优先级的层次关系，通过这种层级关可以避免类的重复加载，当父亲已经加载了该类时，就没有必要子ClassLoader再加载一次</li>
<li>java核心api中定义类型不会被随意替换，假设通过网络传递一个名为java.lang.Integer的类，通过双亲委托模式传递到启动类加载器，而启动类加载器在核心Java API发现这个名字的类，发现该类已被加载，并不会重新加载网络传递的过来的java.lang.Integer，而直接返回已加载过的Integer.class，这样便可以防止核心API库被随意篡改</li>
<li>如果我们在classpath路径下自定义一个名为java.lang.SingleInterge类(该类是胡编的)呢？该类并不存在java.lang中，经过双亲委托模式，传递到启动类加载器中，由于父类加载器路径下并没有该类，所以不会加载，将反向委托给子类加载器加载，最终会通过系统类加载器加载该类。但是这样做是不允许，因为java.lang是核心API包，需要访问权限，强制加载将会报出如下异常</li>
</ol>
<h3 id="32-双庆委派模型实现源码"><a class="markdownIt-Anchor" href="#32-双庆委派模型实现源码"></a> 3.2 双庆委派模型实现源码</h3>
<p>可以打开 java.lang.ClassLoader 类，其 loadClass方法如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> Class&lt;?&gt; loadClass(String name, <span class="keyword">boolean</span> resolve)</span><br><span class="line">        <span class="keyword">throws</span> ClassNotFoundException</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (getClassLoadingLock(name)) &#123;</span><br><span class="line">            <span class="comment">// First, check if the class has already been loaded</span></span><br><span class="line">            Class&lt;?&gt; c = findLoadedClass(name);</span><br><span class="line">            <span class="keyword">if</span> (c == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">long</span> t0 = System.nanoTime();</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (parent != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        c = parent.loadClass(name, <span class="keyword">false</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        c = findBootstrapClassOrNull(name);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">                    <span class="comment">// ClassNotFoundException thrown if class not found</span></span><br><span class="line">                    <span class="comment">// from the non-null parent class loader</span></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (c == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="comment">// If still not found, then invoke findClass in order</span></span><br><span class="line">                    <span class="comment">// to find the class.</span></span><br><span class="line">                    <span class="keyword">long</span> t1 = System.nanoTime();</span><br><span class="line">                    c = findClass(name);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// this is the defining class loader; record the stats</span></span><br><span class="line">                    sun.misc.PerfCounter.getParentDelegationTime().addTime(t1 - t0);</span><br><span class="line">                    sun.misc.PerfCounter.getFindClassTime().addElapsedTimeFrom(t1);</span><br><span class="line">                    sun.misc.PerfCounter.getFindClasses().increment();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (resolve) &#123;</span><br><span class="line">                resolveClass(c);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> c;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>实现方式很简单，首先会检查该类是否已经被加载过了，若加载过了直接返回（默认resolve取false）；若没有被加载，则调用父类加载器的 loadClass方法，若父类加载器为空则默认使用启动类加载器作为父加载器。如果父类加载失败，则在抛出 ClassNotFoundException 异常后，在调用自己的 findClass 方法进行加载</p>
<h2 id="4自定义类加载器"><a class="markdownIt-Anchor" href="#4自定义类加载器"></a> 4.自定义类加载器</h2>
<ol>
<li>
<p>加密</p>
<p>我们知道Java字节码是可以进行反编译的，在某些安全性高的场景，是不允许这种情况发生的。那么我们可以将编译后的代码用某种加密算法进行加密，加密后的文件就不能再用常规的类加载器去加载类了。而我们自己可以自定义类加载器在加载的时候先解密，然后在加载</p>
</li>
<li>
<p>动态创建</p>
<p>比如很有名的动态代理。</p>
</li>
<li>
<p>从非标准的来源加载代码<br>
我们不用非要从class文件中获取定义此类的二进制流，还可以从数据库，从网络中，或者从zip包等。</p>
</li>
</ol>
<h3 id="41-自定义类加载器方法"><a class="markdownIt-Anchor" href="#41-自定义类加载器方法"></a> 4.1 自定义类加载器方法</h3>
<p>类加载时根据双亲委派模型会先一层层找到父加载器，如果加载失败，则会调用当前加载器的 findClass() 方法来完成加载。因此我们自定义类加载器，有两个步骤：<br>
1、继承 ClassLoader</p>
<p>2、覆写 findClass() 方法</p>
]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>ClassLoader</tag>
      </tags>
  </entry>
  <entry>
    <title>springCloud之FeignClient访问微服务接口缓慢</title>
    <url>/bug-sprigCloud/</url>
    <content><![CDATA[<h3 id="问题描述"><a class="markdownIt-Anchor" href="#问题描述"></a> 问题描述</h3>
<p>逻辑是A服务调用B服务(AB在同一个局域网内)。 经过反复测试，有一个访问缓慢的现象，具体表现为：<br>
程序启动第一次访问初始化1.2秒左右，还可以理解。<br>
但后面访问还是要1.1秒左右（格式化到SSS毫秒打印日志监控的）。<br>
但如果连续访问几次，后面几次又是几十毫秒。过一会再访问，或者换浏览器换post工具请求，又会1.2秒左右。</p>
<h3 id="原因排查1"><a class="markdownIt-Anchor" href="#原因排查1"></a> 原因排查1</h3>
<p>查看连接查实的接口<br>
<img src="/bug-sprigCloud/02.png" alt="请求缓慢2"><br>
发现接口调用的是这个地址，其实是别人启动项目的时候吧自己的ip注册到了eureka注册中心，导致接口有时候走的是getway，有时候又是走的别人的接口</p>
<p>解决方法：eureka.client.register-with-eureka 为false  这样就不会注册到eureka注册中心了</p>
<h3 id="原因排查2"><a class="markdownIt-Anchor" href="#原因排查2"></a> 原因排查2</h3>
<ol>
<li>查看日志<br>
<img src="/bug-sprigCloud/01.png" alt="请求缓慢"><br>
查看是否是hystrix 配置的时间小于了ribbon的时间</li>
</ol>
]]></content>
      <categories>
        <category>踩坑记录</category>
      </categories>
      <tags>
        <tag>SpringCloud</tag>
      </tags>
  </entry>
  <entry>
    <title>java缓存一致性问题</title>
    <url>/cache-consistency/</url>
    <content><![CDATA[]]></content>
      <categories>
        <category>中间件</category>
      </categories>
      <tags>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo博客加密</title>
    <url>/hexo-encrypt/</url>
    <content><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="Oh, these decrypted content cannot be verified, but you can still have a look.">
  <script id="hbeData" type="hbeData" data-hmacdigest="3bb37800eaacf08354c4244e097b485a513dda4939b2ccc20f23b85c7fd3c402">1b693c4938223286468132b2f7068bf637405b87610f2a46e8332fe08c20af449439e145dcd62cf43f3f47afb25bfb5f6ef9662a750b1c4d0a79b6034fcdf5152f3906ef8b7ef20f1f7fc5eb94679bda8eb6bdb3fe6b4a6e66b9b2abf0a0c7acefca23567ebe95600f4e281f31f2bdca1ba4091060f2a333798ac021b4c4a71a94a8e3f4687845adc734aad2731efed59e38dd455204af1eb3c21ab6dae3cae4c77fabdc4b256efcb174cb20a0cc67d8bb3b9f25cbb73a585d39f622a047aa2096b4bf0d1dc761093265c3ae89dedcd6939b351e84add15cf246be9448fe060ee7eb1dd55cd5b09491e9ca0eb17acb43ff717c5561b3283ec4eec2b040c54812ee647e580559a2993a48e6eb423b04bb8f24783eac66966a0994e4e57d7c0f42286c74cd9a5f417e4e63d4308e9eeff3aa0071afd26e83a7bf27370b247dfb4c5906b2fe6b12415806871fd2ce001367e3318df9094ff720fbd6ed0ac7abf0b799fddd106c19492edc7567c2f6576d99c7235af5984faac98383efe5f340f0a4bb6843c131cfb15cafa5985a0ebb2b912b1d3fd2e28bd78787880477dcf4157fff1a440510c9c838cfb8808a2b53cea1220435c116d44dbe0a704109ca8de1321f03637102fe1d19fc791eb197b21cb242eb57c6d5bd1515901451c27e92c62138a807d502d540ffa65557c5aa83f75ce75d432edc5a8c8f781c64efa8ed56f04c303e1d36d2d3efd06435a2f6dbf776de6409a6b25df754edb24314e86bd3e6878d6870f9818c33d60cd4d7841351df1bd64af926abd047f33cb0153a3140ba093bb72636e764e62e06025eb0974241d4ce71b700949e21ec8bee135081e08ae92b3952b16f49508f7474da6fd4329f551518651c956c5896fcd526cf602d0890f3ac0abc3347a615374567b53059a26fd0d8106b141ab976eb5f0c1e85936e5f212a395720392675d5273cd286d1dc991c2a171e3df7e3ddaf27ae9fb1e47e18a0be7dfdf14941c0b90981697f8fe94120629107b075dd2eb4388b92a8bfe5ca680f0a1de6cfec56cb78f3bb6d455689e6857f1ae712cb6452678cc110e2ca344d050252d652e76369859081d8dfaf9954998a92a674606186f7f19e8be38d2dca8d679f4ab964b80787f6d0bd512475cb20231335d7103ae87e63256d6e9ee396edf163a7717674bc57938d3ff30b1710e888dc3d7c7c214e3a078a2763c34737a96d91bba2b12bfa26a5dcc6554c8d604340b257998e9b9621757250e22dea9bbe00aac15b8f8e12e0e6586dbd1bdbcf6cbe4f62eda5ca1c59517825851da230b1aacdfa0283fcdd04cfa3d4f7fd1120533cf24569ca7938978435a0a8a5fea6c3b5b2851f5894a07c87c462f7828635791efdf21f8cd06fc8554183cb526df1dedd15ed8919284b91d4220aa9c62844778c07fdcf858b63247b8f2048d0953f271e3bb58eda71e7872d14a20d07fc498bbdf425895999ab6ed81a64ef0d868378e8f1be7df71cd7c98b5ea32df6b15a346c7b9e25eb1f8ab583b7e7123caa56376ccb3205db3999778ab915a6bc017028d75065c3c06b2739d1fa92d2fb5bd6a10179f81fa8e56cad5e3dd7292bb1797da367b0554cbbd4541ca44cba49e7363b55ef1d93b448f6b6e99f0a3255be9faf9de76d34d5927993432e1039b13e2e197469570a066662db6e99af7800da57d4d0a8169698b1a4a47804c9c936588025c7bfc0612661ea986fbdf39b94b8457f03c7f78fde1662f9364b64d0956d9e1a0b176f6a9d13394c349f50418e36dda471adabe84d5710e152ff8eab554cb23786e7b5b2bc9911f61b5afd120b460a8b05a140388ff03d8fd4c1ee0ddae806d6cbb9ef11d984bd4a65effca7d978b7d2c120fff111b87c894e49fc25a2fe1ad124d06e257dc5351f6e8338ff35fdff207a2290bf5f30d1c5a9f5c29c094ffad5a0c747ae35b93c046aa61d199fef5e25219be8ffb3afbafee1fb0bb6eb381efcf36931e1ded830134ab266e41c97121bd911f0bcb7271a7505a0b09245600b04bab04686d10536e28bdf200c51002c04d4ad02f3ad9597545f3e79ce22b2360b49c277eb4b99115586788ed73f3a9817e05e007e404adf9add50251869f571f222f42f69b459b757655247d5fc726d5f1d300da7e044a8edd1b730ec485c3cbd3dc4df190b64d23e290c97f97c13e8b712e24d0864b1da0b4739db9505e58eb90dbfc9217bb81afc1bf2cab59792acab0ae194f919c49d09eb98cf4fae6b473f537cab3df8eecc956f584fa0b81c91da66a7a977a921358f90a0e0c73300c823b39b8b96d4bf46c9fa7be61feda89264bee0b6768188e6e976959fdff2542d3d22466bc1bf922f9480631a1109b3ca1577a72568288e810209bf97e2f76361dd2ef53e98ad967ec915bce61338f0b55a7db28bcb30f92d76f71544548c57561c0b0ed12f771692fb95424353c854562123a45967c1e192501a9469cbfe9b066e1d8eb6aaa1d87b6175347c7ef6382fea2898d6c20b1de9afced850b333ae6edc28230d510598c44dfd39c3c0ff2ca2ff416fd6bebfbc51e1a517e34f01580503b490ffdaa00da54e045d2e2a879a4583500cc087f1cbf7d559c21baabf9d72410547364ba5c3542d12788be222aa1fc72a6dba8fae32c2bcc81be412fda043a4bb63e345111b84890f6999c3a372bcf216eadbf664bbc409b9340335f917bcbc5c7161f31a26b634917f3c76299cb147a4b4128b09b1315d03b42a2c398a646f6b703dd9607793988616ae4e5d1b3712ddc8e14fd159b7329b15a6af1f2a1e9bf5e04217b4c0b5a272bece5325f5a47817c2e2f41a731078e8dd9b705dc845d78509b19c89bbf2b4e253885a9953856784981a7fafa7f268ad78cbbee5ca9e60a83b078943a2fa15c3997c1e88f7353bb17ecd0453dfbff5b08996a0b4a12edabdb54fd1145cd6103559de5f00ac7aa623949b25a9b9c9691957a6ba30e2bce2545f3a886cd84dcd0ca3a33205d53842e0b4f1a93778a3f9d306bd8c7b2a7203aefa436c67e84f58be6f10c3b7930d928f8c05474e7bd2c345359adb054058c214b62b1471168d25884f38d1f9ada2d2d4674d1417bf5fdc39b61474593ea40fff5e3544bb4053e105fbb928a5dd8e4ca3b4f4a58818dca9a58ff7eaa2602e78a2ab5464c0fc151fe16e1503ff7e2f345054aa2e3ae39c031c52101dd82ed24f7547fae0e5a87dbdd928c6abb584717db5f448ab17b9cc9061c8ab1d7c45253ed1e7bb8c07abf6b8bf9fac8165e20e23db85da0f9a4373856475a943ee3e6d6e6e04e928f62df823a6b51b7e687702130a26b23d349b843884f9b7d26cc462294d3d6cebac9dd85345d92f9acad62e8de7bb45923d3c3aadf247a8db139e2300c6d37776f591422a912637b22a25aaa80b82956de6f0c0bd92825d90d5b14902274498673473c471171fe42d0418f5926df21627fdf9a5dfd3f247c299a0932809fef07ac5962a51d7a9642ab7843070177b4bd13b31604741d39830964513898f426eddfebcfae44eafec12035251cfc588f11649a28083a1bc52657554319ac689570c2e32b75abe713e58b276fa973a4f284e90e26710f89514cdcd66f7f4abbf673e21ab378a12f62c0c6721934ec84e0b15121d367c6f1a297b0c014a769597248cae105670c1f8c0c0b42589e215aec24dca9296f0eab4731c70f71c5de6db4a797d69462a492da1e1358179905d5cd3b32130ffb53ace7d9ea380f00b5fc67aad347ccffea0f44b4136324c6597264c69dbdf4a5923eb8842b22519bb188191df97d3c82fd968fc3bd3f544f770382823c01ac1c89c3e7e1ba8f870ae768a19f1c90dc67db5a80ecbc76dc0bc1191ba979fdd7b82590995d0aa797dd113233dfeb1ccbaba02178d7c9fdd7fedc73ca3fe1bf59087ae784467465b5fb1f708f009c0819e7f5f886095f3eacae3c915dfe3b79a997598d7b4d3758b34ed42ed981809467c49e279b026ef09c5edc865c9f35e410581efbb1710782f8c08409cdcf2b6c094a0a05bcdc306f0eaaaaabbc70124447b49ce5988713d60c03aec78d94f08fa998e8a441c4a842be0b2ab8bbbdadfb86291a08547c483e8fcaefbbb3d57098450e3450ea8606c3bca3fbbbfbc8409a7a1c4bc4aa2212e5ef868d48c2b7b19ab12e9652aeda09e04cf8c353b9f99266e1573729fd2f71688ec9234c6f9615a6e6f41eaec20ca55c196746ca5021bf7338fe115e97eb2b34a9662544b8c4b5ec02da5bfb09431354503f2186b50517d3e8ca3d8ed4546cdbc6343faa502c1ddf459728716583b68160297c31445192151e3e3ed69dba1242828ddb5c8ea9505526debb6d267a710057e24f775873dd9010bcdebdecbca1a9e7128b57a3827549a6745ea84d63633eb4cbd0e08929de7f73dfa84689b17f35e46abd7985a1bf5ce6cad24c86c4ab7090e8a656fe5993ae7709af501bb17f4c0d985103f59371c4f562edc137abfaa26ae2dd99cad0c07c3dc2c93b9f00f680cc209a1ba9717d84ecb33a483b49deac60837362b90970ef6c26d028939b09286a3fff69f919458f3d40f67666a504c6f5bef92bc008f8a9daf5a09c7f6ff5131d4600462b051e5c31dcc3f40931b8b228d2425e55489a5021e593a7d9ab108ae205b876c78c573fce36073f8dd63e492da78c633f301f85e499b1fc31d51cfebf94f952c143e294e39fe831fcdaf22cd227ef923face94099a4d6cb4fd5fe9c3a3cab41a551bb8b5c0ad804aea1bc4a7d2f39c0ddf33da4b93d1a6df2df59fa50b9c87411f9dc7045347ab40a8ea6739e8af903e1e111e92a6d66fa6ad36d9144523857f22ca69b51036f9c9ad5f9fb056c1a91ecfca8491e5b0a4e8e6bf90c77840b6ddfd146597cd5a5b6b9b58c7ac6aa07ece1a7911ce3ee84bb590984ec9b623aed344e62b5d14089f4f8ad602217ad42321b57f9efff9b0fafbddc1622e3c0f8e7b3e1d71a8d0786657dfa6cd9032d8245580379bfe93d6e97633e7706b5c796b2abb1ca0bf91abde8c3800cf5ee90fb38a201f90cfe77bc854206b4f86b367382382215ed2d9b0e6957c6c32ecd9736cfc1af3c3ff3b4eef24e0dae0909efd618fa68382670b4fe80df2962b4248b66f7b7fff2e732381d0a75fcc37766fe170086ab12feafa4fc1421adaa38e9451dd1cf6b492fe6bc7421c6ca893506968ef4180dcefbc95266567a46145269f39d768ae8f607329c39834357dea53d2af0414bd8f25140ba0248284b77f43fe6dcebd112f2a920b20881d531bdff3797b5b76792f58d80932d17e9ae314b7b16d8fe7162824cecada109cc3c99fa450bcd1fa0967c9053d3497085e8099d1f584c61ceafdb5e35bc4bc50e8ff6ebb93a7abd0a5a3461b305675d2f6b242a759798c9b11d49dca13469edaee29825a136db3249f063e1fc93d11367def17ce12cd0174bec04198ce3d5ff7990d7a557b19d1eae0b0bf01b96e37b2a67cee59b16f5bad8f054027759467acf8f9318b1dc2e85de177b4ea6287c9464030818eab8b0a997382e72cbf2dbc05e626063c1f79a4ee6524e214771122bdee7d85e38f2b4ab47895167964bcce4af818c4b99b8c5d05e3bbd53f0bcb196591f8f3eecc85968452e2d7ee76be40772742f9466df90783e6fdcede5ce677864a3ea8f59bc0f386b8592644a34fc32ce5c206b999916372284955dcafd2d3abd45ce9ff55517cc1bf84164f78d70579dd0570b0b3c5d9007921f758efff6b8255a9be5b68f048a1128978b4e56d51602b3b4b75abdd6724428a5721c8abd7cabcc1fc47c49fa78ab8aca16f31755a6a6c6d43ffc1320b99f7e9411e530db20efde723bd230928bca0a0c825a54ee52ff7e1c6027e5e3cc186388651362a65991ebf2b04465f577ff533d05e34ffacb5bcd744e313aca37a3f9c5d3a37b47830155d8229154498c00ff1c03997ec7a650cca9f8dd160b5725cbf54b55a0e7d3841965eeed18db7fd7da37172d5126dd691a3c0b702f0f0afb8852d0d551b07335fe1573831607abaa06ef5463214761622527f44a9497e6e17b51d1673b6c455d5f330405781b48a72a5a7f9d15fe5ab7f3eb3e1b8538121bb0c399531c423863be0b1c826ea60d1c4a78082a7b21b23f0b580e4a4cd5732e4badeabb921f7a4212f54534b0d2d5e77e5b0708f3aa389339a0a2ff6e1ba0d1885a77ae53a8c03a39ea6755923cac48a42b03e55636885b860d6a763c38efe36230624142d14b56380eb6181527c255ef3dd3187a583d72b0ef2aec8a5426a808d959e159896fe4c8885d5a735f928d5ae47919e1d19e3393260a7a4fee23df278b3e6545e586d6bc131551f015825fac0eb0db8864fbb9a3242f937dd5fe736725606e98872ab1b11cbfa903b98af960ab05794da7d9a5f5bc7b6130daccdf2f096cdfa2272628ad72566be4fff2e9b8e9e5b613f81fe66204ceb0962502b041a40ed922c17e0b798ca2ebd8117562674fdc602298c84a8de5b5b6bdc9cc793610930d9d28d7c17f7374fc25c5ff0b26f30fecfffb0ab4822a69047c67bfef547a66007778ff266beb2e4167f14ff571a6e9c066ca8a6a9541428cdb3a78350f184bbeab06f73c03a0489edcd4ed91aa5233ac5e86b842dc76be054401b2b4a58ffe3283aba4175cf1464a71b15dee29359be6429774e5fff792291a74757ac8a0f5be1faeea2a62b38832702206f22c23fcf69100c3dd8d9f1c465bc8b9e5a84ef0837734eeffdc2730f746b144445362482c1ab18ee87f26279d910bcfedaaf049436b5d8daab89cc833a3a1fccfd046b4c96fd07f2340b802efd295a399a949fac10550e2f742fe5e393514340d54799f841f468b03bc85c55b90f8430ae1f227634db5a1e2981627e322de674f70090df6bd7b7bf76fca10fadef1b77507158e1f6744da159254ca73c60d55e9d1a1633b2ba5bdeb84973bcdaea841d475d78bd5214027d4627637715ddd9c1353a56b12db3e8cdc97ddc651ea381a468f05b3eae771b7ed9c34cf7831ee6392e7ff4fffc1fb49d2694061de2bdee751f8613a0b2b29b3f41c566307808c6da9bade9040170b6dbeb0e5e3fde9f1d36f34b27bf8487fa440c0024b8f2a96e2e8f515a5a4706d3200a4100157d9a7e4ee3e4eed374d4f8632e7278ce034b28294dbdd206c4878892cab1095319f6718112a4d8ac3d72761ef16100163dcdc35ad1a241f12f97b74bca4681717864c6e81d8440bda53e8a0d7338e636f85934473d5ac7ab02563f11b953e838548e0897f81f799d13d92a52d5f80e9885c5d11e5b9cd962103c8c138d2bb9c99f80c29fd2c8c8ab0042d801c0c0ac29ac0a4e72e56dce486ecb99070f4aeec57c8643be3bbc5a8701bb22099134c3e73a854fde205032d6eecd4fcf8d34f50f4560523cca9e5d6298f38d437a172c741e0b3b0481f70a63593ab51dd6ed174a64adc92ce80e979ecc178c0b9e21391af0a765af23d87b8981f8529e6a311956f0ed07f3ec56c87f80edb9ecfbd189a744ce08263ef07239fa4c19979eed74a6ea4cb833b7ef5c58a3bdb7c462f9eacae18fb673f273f1661cc538452da3f56c32fde714914a75180f1182c57cac002e55b6f5b161693365f92e4a7a439bb54eddb448498f5492df1093270eec710ec068c0f4637cca7055d9fca1563c0c4213198866c970483bf18f1118be001d1f7998241fe40656bc05bfc837c71a0307e808b691d927aa01554dcafeeef477deb2e048cd36102b7fcf86314fd11be5437b9ae5542d818d89a82a4bf76a68f536b637a1fd56b4315ece59ed1055785b87704cd1bdbf6c2b416cf54ca411ae40ad236d23c7749e739e840b4b513a1ce684d92eb6e25a09992fc815a92984cc068faa84a2455028c15d622a656aa9a13c61adb328dfbabd62504c4f6135b30636a9be1e48fdfa81037c3e8009ab2828d872902eec54d43b4ea7cd15713f5eaa0949ae01e390fd3fdb150f35382195944b82bf2d9a837963bc5df08bb7e812d09d960638c50741534085b09bac491c2a6d74837186c8e416bc85f440bcabadbfd2e07d6a35b2f82399d5a30138240da3596c62539e800900592ab3de8c1b9ee6e205b6c5c35c60d1cf7dcb3cd17698d152eab3b9a6f8c0cddf5995aa79f063f25b4a614e1f2a6af38f0b3bfb310fc82b2e54de19189e2e0aa205b8840838016d36d3852c7dfe5a0cbcb1379fdc70eba6d0f1ceda1b2d46cfa1e7f4509d6d25c5c9f4da866006a84501a4bbbc7ac414b21a618e9958ca119ada2b9b8266edb7f03a0c753eeda8985ace5b37c380629023c5d2101f1f3ebb640a7bd36c3571d2196b573fef8a8e6aee0bf50c69dcb7c9dcbe1c1a96ab9eb96260662cebc722aa31d7e46bb4273017af8a38026bdb35f0c09a5b53207fa25918c0e02ea6bcdeb3a029a66a80be3c1e0a3d872773dd31d4dd531b3aeee52bc8be616d5f30a0f359447e166d33407dc1f4beac052d3410d9cf6e21fde05198b4aed0c914d329c509b332ba83c629206eccc5b9745ebaf8da6cf9891abafdac7e0965a6b902d271dfb357babbd53b9a01da35ca3c8b6ea7579ea2381be669d9dcc547c860227ab970dd49f10e789e9bee7226af7298910dad1416ae2bae550639ace9cbadbd8113a664c1e760356fa8dc46fdbb0cd692ac6b59cdeacc6b2ecfa173eca26e9a0c402fbee8a4781e9aa46eee79e291b646a28f29e13063ef8228e40e514678ec087f15e525068289e0c89667e669c7dc932ec03d1d4816c292c01e0e78263d871863544d6966a3e74fae6d73a1f928049aa52f7039af4d3d24542dbdadcb44d3f49a0cbec51bbacdbcd075c8d75f78fa06c47065917a01a548430d57414211c8ec68edc2956513d502ece001bf3e344dafc90d67c3405d6e2316c14248f6b631425af1264724fcbcf66a6716f74102c2775955c1bd58f7ab3ae0c3cacef4d2d8bff5efef2ae367656ea263daeb4716e552f4107dd045899a514d11d13b7e62fd80cf3d383c831af50fa8a1c324773d1763504d2fa654a5d91a9be87743427483a361b78587b66e251dfe33277686ba2ccf891924579f5b1d514244717518dc8cca91e6b0bee92843aec98ef19c69fd94f931e12ec1ef186a6d523f8ac7437ef3aca3841ff4b223b87085171f36503b2804e894a00aa3d261a7ab1e161a69ea7a5e6e7dd3b5e053dd833f20f4d2e4319e70f6e577b0204076c69d99a79f56c90056111367c879aa055586b9e81a6fec4f0e02a40a0b9aff983f75bbbeae31859368aa48e32a67d403a23579a94492e42007a2d44a15a3f40d9c4bda6a51d86fffb05966cd1e1d8c4fe62fd4740111d2180f61466d8e98f7806667a0bdb128b8526e944c28a0ea4a458c763fc5ef4391c1315ee999292ef7195208e41666fff4909680bcce9891d8ca0ece575462a266295360f37e7516f8a553c6b7e6411567472ddde8e52b4ffb44ae5c972bfbecefa45eba552ed0a60a5380980451d2d78ab8a848ddde4873d882d4eeff5ae95d91a748d48a1f52548d10c8cdf8a133741351df4da47dc155adae820a9c794c95bddb78c24c9d49286a966310ce1c01950e1a20f163b6b4213a93fb086e3bee212d26b7605d74a837f8997cf2e2a712da0af31fbed40b2f1623a4b5969596fda49e3df8a736f93babed1232c6f620155d11541d7b336592d111ce651d905ab9da404631a4128416f9bb971b0a5c98ad982435211d76bbd0a1b23a35cea2fa0ef91e25e22514f87eb62254a739c802aa1889709fc17d0f3d035f0c83054fe3fb114572f0045347d205bb4c75a7cdb7e2c575a860d871371ac2223532f4c4143b20440aba570d752c5b3041b1445c15ea3c5e9d4405d131904a47d50e5c285a75227c1febd066b9c8764cd2bd51986e25330fd4c502c5c3468f3472a26a1ce5c930ae674019222a2ca2b02146f6040f30364824a5af73f18fc9a07ac0c4227b325607f4dc4576ee2f677240d53655f056425d65cc2e143819baeffc519a90fe04d519b0f8767364fd8437ea52bcd23fbdcf45310ac655a6a68393693148104356065d5ece0e88107187004c6b60e4d7b7dd469d9bee904f0ac8fed1d62d19d362f559caba96688c98da2495908c812873273b6ad51749521782b0803b262d6d3696c26fde379016e16fe8c87ba507f688b68432941892d2695224a9f75e9cc049ce0dde953e4aa2a7654b7da0df7543c93ff6f16416a9a6c9e2ad7d5341429bf15a8beadfc826aaa2483395e2be4ecc6acb98949d4ceeab3d45b4fcbf9a9d855f0b2b5f05eaebd003d91c691bfacdcf367c69188f5028fa42c822ebf0e135d4032d2ec90f1d03b15da699abfe223ac81c672470a2979cae0759844ea7e395aa9309760a3ac399f2fbc6fcafe9d1dd8dcfa1855b94ffdcc63ffa5fabf708a27aeb288734b92a754466bb57b599c2d77cbfe03d0fed2a17be5d345da80835e95e12ca965c3fc2aa59412eace405314ff79d6df9b2016bb44e36dc9de20f59631a6d6123b656001d7f915f9e55ac020ef3a338efde6ee3b60dfe4600e5340f55eea494c9f16e1b9a827c41a13fb252126d21b967fa5fb3704e8510dee1065c8522f422b371133119fafc1e15daff018f5adb23c7ed7e8ea1132f7217a1c7a5e3bed4da0bea2679b7c79e242b0803cb207428e188d968aba961b31c7641bdd86fccbb8eeb7c25cfee9e9f801b9a56aa9998def3262907e117ed21ed82c9888f8c155ec24a6e92ec4c51cba238076bd054139926fecf0bf2aaae17bb2a0006b0f62491882f91b8d45c93e53d18821c9ea46facd767bfc58cbc8500bab33ba3a4db0be87fba100b5b1b8b696bcf7caa373971ffcda83f5ff9f2142f8f4971f8f3d279ab3a1c0873eee54c154a482262ded91373ca89a7c3fcdf45e89d8cbdd4fbacd5045e7d1b9f52a18bef8f9541b6c992ed9838c5ad0b56bdff66062c4b15826a1b178aaf32614db7355d76f0e9193e2337adbeff8c3238209fc13c9d81abd744510025504617bbc05e6876ac3432792cadf5cbf6dd33abecc7526760d9bfea59b379fd6109dadadb21749389d68db7a0a12cd2b7f3feddb68c05a01d96839f3f5907b1dd79c43eec4d1993f511c6a79afd4fb7ac6f123199fc4b33d30efedd4d9499bf65d72c50ffe5b4b7ce435b04c4ccc38bdd5652af7f9260c4fae54e477c8628352b3ab2b9a49017bb3c7bc65ccd298459efa81cd0197463c9c970388d9e6349b38d5b090880852200eb8d605bed841c47848bfb98ed057887add214d5dc8701f49f3dd74d50ce18d375ad2c902a72220248028f5ce016200bc747fdf54a3485e62a2b8f7256d5511b21ae8c4e1cdde1d7b222ecbdf902d9783e002d104a1475c03753c686d8f6deb6d6b22f65651490f35424265f5e0ddd7b4f03b4f3ed5ebb0490c80484762ebc3ca7c872682da4e69312d757bd74e7c7b5c7a31d73c06e4c618496b34ab6f6375fdef90ae6a226233f91f79e8d662f719ae1ff81d23c70fc69dcdd6431edcf04a471ca3b6083d004f226b0669a6ac8ebe46029d1293e898c51967031a3a1356d5c938d6ade58c02b69c23959db33fd04ef9f25978604f439c86878e6bf7a6b5b0be0055e82f0b52c44d82a29fdd76ca33f8b27a72956eb652167ac2c2c934cd45e970c84e641211e5a43448c4b0d0c7f5d24aaf48962ff086ca15673154b1823d6636770e0ce1f439116404296f251d359445ca6b4a185fb4b925535a58dd8481bf0b700d0017ff437b777a8ff7c736c5d38e45864f814af58f01cf10cae406a5f8cf851560fa99df5424ff5f14c2f356ef660b4ff58feb9c8ed2aa283f568041f8be3da54a71de14cf18cc4051ed1b3b51407dcbf09e32b25b8dce90b2302ff51a994ed10f210575402854af43f36b56bbf4654a0830f3d0459d10461199a95e57492986a40488b955ee69428b24e319085728e047d83f4533edc96b322259b11814dc84813a2e62ffbbf52afb07e928ce4dc48cb25630fcc21b6206a8913c2029ac8bca4d814e54ed38bb1f3530e95c3332bd5a28dc0a4744adc66eb1f3b1e21ecb7192c16c1a0646cc1e6c5cc5e78a786edc35e1dc8885f877ee98ab7c3a9f0c371bed786dc6745c8912b8bd2cb1815ae8cef1307d0eff54e986013278c19837d8d6e7b733d6e8ba8eead84776c71f39386a32b2c24d17c6764ac01ae18ca38f57c8269c78f07113640031c6ce68280e21ac6bd32aac432269e8a638dfd11f982f215469b8756d1d7008f919c24c065c99311a38d952db4122e7771b2f1adcadb0e6671ef90dedceb2d50ad8afe7975a1a1df31787de14e9cdfd084326d6f3685a804f571efc82be7225d169b3cbe7126cedfb2f6c3f5c9693bef0213fbd9344cb4b08c659328eb1ec21aaa4d33103e89d3c6b8206eb0fc009d0342e2e3f64e89481e599c3d142b9b7b90729c929086708739c5a8850c7a73ee8b67ce5b9eb48cd5bacfea5b4e3a8d8ef009b354fb4e83a6ee5f44c8ca4812f79feed0e6fc35c1c56bdaff025e9e46642485ae4a82f5016970661f897eeec22b0c050e041efd8836d494503a825c5c029ce01356394dd98fe49e246461b0b7b58434c4d4e99fbfbfb50602577c98658484698bf4fa66ed45438685031b56c3ba966875ec84289bb6c1aa4a854d74bdd1af319d5147ed1e395b208d4e8a9bd3054a79d268f1b06bec2407aeefcc4cadea2e081d2704f417ee5ee4af29f0a0b4604feb1de1d9be9958c6c0857b8dd2007acdbe263bca63742b8e00eb4e5149b7a134d4bb10b9585ef6b28e9a2255b6461ec953e54c8916b645da745fabd05214d85f0604ba6a30bfbd5e06b0208b7400eb28f20acf324af6ca5179908c2d04f772f69a556d821a4d67d53cc417ad7162ef7949abc50c0e33062b5ec5a4297546a581885445ba5ef872bba58c386fe9f147cb5f2634b99c020442524100b27877d8996e010e8d71f3ef2de70301bb523e23f8cedf0732e4932044b58a8698e1eb828089d6164b9f86c2feaca3fb439756c8934955908b2b2967395f531d65c5c2d6526a5af50a4e50f6248244fcd2b1cbb4d8c2330a789e64b46f23c18055d74591c676443b042baeadba8b17cab3747a38e6b3fd21c80a7ee8cd1675bdc88aaf2cbc73c073d2ef3e97b90b6f61179fcf3d2f0c948b3b67d9475bf2b31d1c73b5887ef3e002a1634972ff5c66bcad6824b6878fbc7ebf0cb826c90966ba557f93b97ead246b5ededcec1ff3ab201d590f92dc498eff355aab98adf9d3b72fa3ecc093b626f289dbdd64a886f0ae2ee9d900f252247a1e28923692d0d9bc319526805b574ddef65a2f381ed65a09145a42292e0c5599848da3a191fa2811dbec9678c3f4c02c9d5df517d1edc7d53db05d9ffdc52c098051f574b9c12575daf09be7b60b65c1dd8fd661d55c8e054df3684574e08bf4a45de5d64492bf49556347658ec11d8e60a4ed8c5aa86758b8a87fcf7032e32e55f63a463e452007d8115a072ecd49b19d3618d50518bcfdc6fca8865aebabbbabd863c7365e633aad80556f7ca74453b0f5a824e1e8d0bcb41ba49a2c5ab80e8e6047030829d10b002466e825ae506214e9e9e507434c705d99e3968d7ed0c7a076847133b5e927f6ea94925ddc8be5bca71920e8f79a3a8ec19e3de472b8b24790b813b34d26e7120da3bd090b986c4c7c5fd0ab1c021a7ffb06418fcf45f40f45c3b71af0ae604722dd6a16323c7202642762cd1cb21c7a545d13c3f633d802621aae42cb5df6673575dadb0fcb84edefad28aa5c254f611d082d643ead17abe55282cce38d332c57da10eb927da30f1282765ff9a17128c0853c1c4eff644e4ef7d64018ef1aaf2514fbda698e5b60b8f96d6186afd10d3cbb7160180611b1be7b718bae9ff1b4187d035c6cad6aa9844443edf1630a52e296b583d5e20571a672dca224d9d5d9388014f2b6e912f0f063fc46eb181088d6e4b0c57105b03b3ac994e57b4013cd9ac68eb272321ac9441ad3cf4756b3d19d3f29031a1e62857450c4d5f352d9f69c9779ea893953fd0e9072dcd82f706a15e590d7f22a1dc9724e3bab339e0d22e3f156368c1d4d6763a6fb10ce6fca438e23cb55c1d033daebc966199197a7c224a90c214806ff4b13fe894e09c8cec0fa0a90b6808ef3013f91a37af89f9f1579207a5f1864da50c30b2372a01f888bc0f2482393847ba5c9c37d42fc63ff3a8b47fa15dd162acc8724507192d4dbe7884eb12b93e8efd997b99740a199f9a3c4843abfc5a8062f7279f16b9330a5576748faa5607b82e48e384747054d7231bd6367f62cfa620429aaecc3b0152aa72ae680bc514ced8279ad40f277806defe7ef337ea015b377e73e96a9baf6e24974f48a29a361e75bc95be3333937d9f09ac7734ad9df4dcbd6e15bb6b63b856db2f15030b0d9cb28318f79ae6b41f1afa464d43ca4222a9418515780f344a6d5eb35a9324f4676793db4fd09449ebbd75a34366f08ff66432998a3aa637d2833691c7a586857b98f076dd7e4b6f064512d255530b904693992176f0dfdd02696014f2cdcb4ca1c0fb7f8cf8be2bd55ce07c8a8bf7cd1b4cb4f747d331ec89073104da92cb820a73b6067ffdde4e17080e5012cca7febd5d8b31ebdc94387a99087dee6355247380135d90c98b1511a9d562892a4102f9404b8c96b05bfe69165a3e9d16d9df08772add51501fe2b1d630a3a317b602537ee260f26ef9bdc564900700725c382f63f3f297328337241371560e210aacccbbec4895a46a9b9e4ff8c84031cb1eea4e28734de8a91504e9eaf2ec571a68d98464dd27eeb78aedce331beeb58b7861caf2a8a7044c3867db1266cf74d0b04f565ecd5c1968773ddc594ed19f95ccae9696a437406a58dc219fa7887d3bf0406de573daeb6b376488142d963120d19512b3e9628e61f150da3b41f544dbd7d2d6de87d03fb84d0240ed1214da2fb9ac8f3fc866e5de7f87a3dce42733084ab60ec386574c60f2511f0bc9c7f03ed7ee78195d289074dda52434cf54063cadd85b0015547ef0cfdfacff3f0254ee64a3819903fbaa0aba68840bcd4706af757c92c4a81ab3ee1fc5f78fb4db580ef576fbfa072d74ebddc6932a054eeb4469a9dd5f1ee6cda07ee640d549e1316962c798168bf25b836ffc1823827384ca6ce3e30ef77467ee58ffcd4079b9b031271fc3b45517674da9adee012003a6058fea21238070fd651e20c9d24ddd6effd5257bc60964c96bc0c05f36035c3a0bb523b719306dc28900477c957f7aa0953cf384f9b3f44ea0022debccd208ffe13b995a211bbcfa7c39a1c15f194e896fb0ab09d311732b331da7a0b615843ae4cef71f50da656e303937872b6a20e99585d285e2df1044d74676b3892abdcbdb29df349ce447982a1fe0337815d94d58a979f71ebbcb6dec8a58f6d87a5a5e6d39fa804b21efa4a4eb9b6e85bba1d5e6ebaf4d78029ee180fa648d21390b933e87824a0ec0ec0bf9f6f1d6331ab4e7d195c524026730b4f01a0406537c9ef2b62c01b02292c17d41227c3fe5f5088158a06d754dc203f1a31de9c017eaf0f4a4859e7a25b4af450304dae72c7a09b47e4277133df454ffef9360eaa40cbfd74ea3a39c804aa5ffeddff8f3d01d2ddba71b3211a98d0258c8247d1cacd0ac52048e3a42dc60e321255f62bfc320ebfebcc3d475d4c470e1ae5feaaf6581a538b2547763d0c68b65ee084dd330d235dafa882e775ef9b804521655d4c77299db55ebea1973fce0d09d3bfb2ce93b9217983b0e21c135505afe81a66fc737aa90e2bf452d2c326362b8cdd2f05762f2cffc737b87ce68178014c35ff80188c1e2ccf21329968da9c358274d7ac2bc138d16333f9f459a9e93aeddc52c94127d1d178ec16a53612ebe5b4e40b7a77258176f03ca1957c4608072e95d7661776e90a5d527de703bcce317e630f65f9cf6d1ca7b5fdc099ab409380147e5aeedad8ea64bed3fd38e330e138fdc8b885a2a205b1faf35f8e52f445a5e9826b8c04305aa28996c37bf967b94d62023b1c59640a4c2ce1d15b95b05bad1f9221cf145914526a910c8c9d294e40f17a521caad12b8afdfd7a73bf58729b282749e2616ac69a94ac178a94a2875749509b91fccfee6b2447d5168e0c9ae44888bf7d03433acc10bb523dc03d412e9bbb4412a6653501f9840f8e05522eabf0df0328ab61bc5c088d4cb3490032407363df9fea56f78c95df35dfa9da927d72f0d0aa5d825aed6a4a487916012d0284949be71b4cc5f2618a0a8f0ec65b1cdf057ca6254be5ef374a91bcf90f7b449226c11c62caeb00e6a50b1bf70f89427af5ec8ebf7969b617dacbbd7adad6b3cd69fbdb25dde061478fbc375137737ef36a1466873672b938f305b74afa4be359d556c5b80754bb62bb394b00583f979fa2ee1e88c0fe7b98bb2eabf85a23d918712023fe4758f705c073e779d665179ae22c948afb459c13c7c10d99befd04ef91f49f1bb1acdbc83ae93d151cb0963fb07dc3d88863e605aa6cd505b3a6dfbd175896fca6868bbc30ea6f48a624c11a97018aa57d98fd75d99ee13c0fd8f01147026f5293ee6b00c7897bcb7f0260dd0d82a6a7a54641aa6440c1e00632c8bbfe9bf25066add2a1b044242fd71720e0db6a7faa08fc35ca688a38969c2dc0051210925e58a29c838675f23eeb6f40bf8d4e1a9069f777174e1cf60e7800b04e5a4b2422b3b0b137256e163a39642f38c7ceef2b4d9c4eea59cf7c6160e79e3ecfeda0d7c816ed3ba4cf0f2197a521faefa4e68919c97e9d18193eb6e82b2369776d8a54c50d7926b2f6ec73fe5d91c3913f7243c0a7908487496c3082187f356bf127112d76b5b7cfff4d7fe235869116bef4f609c51672f655e4552a6d1568fa111097171c88a16c6a2034d8cf0573d7cba41445eea3bb2eb88603eafa20628c7d7b0dace82eb9142399bf2dc94a59da8b89b2ec4cba9e8b75dff667a363d0decc6d6e9e15e88f809745bb288ce08aad2de53ee5617ea5070ff18c0ab2b492cf78d9c79ab908080790b7848e94f6eab6d27f2206f39362c9cef420d47f718cd5666a1ea9794f207583fe8cc52e03c754e3905bb5d3cc1025c92cbf0dc3779125e1ebb1928ced767fb8bb60f2a3a6215955d0a99d29488b04dcf5a9645c585bfba741108a979a097b07c7c85866a3cb9a856769b6f9f4562f3292d786dfe950ebad100dcd1a64412935f3cd446cef12ce9b17016f6a95183556c7c523acff1238aec62f28509e3230480d89f40291a55df911680834600f02481f9ff12792c826decad1652757e9837ccf909d41289bdf50a7b2202daa05666fbd4846262807c7b8c28dcdc95dadc315fce4e861558d53baf3de4bfd61a5ee1546bdf9adc364407578bd684858da7859dfce4f5a73463e01f3552e45f9c8e93066be2feef76b28ecc7686ddd39f6da0f220ee898dd1608b7c5de19b8bd437cd9a02abb5d9096fa2d22668be523d01bb7c10be52001960f4cbc7b1ef3eae2b0fa623c37d60733e3e1e0786cb8b7ec6051a9328058ca9bc6c855365fa4eb37cd62df8f7c8c59587e2e27809ae92bf0ef5f7b216455b00e9bf13a2f88dd28eb85a431fdc9808c8ae6996703519d48d0aa2bff6e3d969a3497895c4cd89339da8204172116f98cc38808319d433a077c6104b9ac71f84b4e91d3a8b88e649ae87424040c8b3de4a49eda3f39044e2a7827771c528bd59d12cfda5a032aa842068e6ff74ee21b4ab28d37b6f487d575db103021f163d7701ee1b9b7178176876e98700258126da667f36e5cec03894dee422a0396130af0a5d0436ac2c7bf2e9972c046a7aaa25dc1920c2067db3d68938ec0ad97e31a85bc3b32e0d1a229d427a30d3fa302cabdfd14b6a3b9622b64d60a9d9e7c710f8b512ecfc437c138284340135a73de70a913fb8290312969ce72d7352cf26f15d0aad0b346e09497d5661d022143e8376099a643f7a3ce10dc1863091bf6f1a07543dd868df4de7460114aca135e81f2821d137ef01eaa5ae5ffd5ea3724e72d6ce4d21798cf68f0e3fa8da335ce236f2317147af32027eb9045fbd896cca2c0add7db658eb85b699fa506e9283dd0ff8010df824002ad11797924f475e7444d668ef9ae82402433ffe1cb131d3a2c29447291971d4f00c3f75cd7d9294c52fbeced18daec9d950004a7be2d702e90e65350307b552110288d78b8ce12de1b925528a1b613dd3c33dd99f5176c948095e545e171fc200b68fc82468053009ecd2f787645764e82696955ac2b7e3bb6e574814de2fb19aa6a72ca5d817e1c052a5b654028513111549e27106238e021a3e165071a40d8ddccaef2be5cae8377eb295b6434da8cbe4c00e7393a3d645199eceaa3f3938435973f8303620bb4fc99405844ce1a8b791ecc5d7eb0aab1b43d2a415729b91fc18e18f783c5da1d0763ac4de8c9afa4895fd07345de492fd32579be08bc9bbd9d36f663015de5fca035d330685587e8858ecaf497cce4e2dce947f2d000a0517aae88e3385c997640c7a21e03cc9d2e9234af6a944b6c6e8e70a2f210f8520767ca58fdf60c48808cb07671369109212e023a20e783678f51bf6bd04194b67441d5a7c4a19889316691ded8a496faa896a43bd5a126b8b96a2bf1717b714159ea6a5a40cb0a420cbcaa0c9a0e06eb5ba3282bece992f26b73f388ff38cb1ca1f92d6f3e3e2a7533fa0dc6731acd4fd598af0f27f4ec38f2c7be49b77f3825040e4c7e6691f50c17ce91ff01fe242aa5e76145425072280e21d99656714e1bd06774d064563a2e255a73a58baf15bbe0ef79d3ec7a15fae51961f30f6e084424bb5639c2c2614b1244ad8f670c2df01c3c6518211d2f43e6ace3fb6df82e9b27181b7b4b7513a7833117ae796faeff611473d22042615bb390e1f6ca7b2ea2abcf7de4e669164f6a3f9213b0d0f14f1fc1f4cce16991d2f7bb2e03a4a65f1a18b70d4c4cfd60b57f5e077475a03124e5c21a039829b6dbfbedca83a7ef63043be60e8b7e9316642023fb18e3ae78861d99d34ab982310493e890aa8b3981ddb85bd21817888ba9377f6c9c95c495205863e798bf5997904765dee773043983906a85840bda42f51cb213d46b861155b0cb3af4c0f6c0882ab6a199dd85cd7181e829f1db44b6e913e91d172845b3e266f8cb2c23477eb4ccbacf8d3c6472a68aefb50ad2565f50926cdabaa435dc2e8a678a0a2dd942da14a10720eb5b0171732853e559d3dc1443bae145b781d021c651e459bb4101195c4d9875d9de99907b9852f123c03fca5ab4e6ad3d0b45b5c36f448b33290d30abc24bee8d3330ff65807b3ae6d5c1684a45b64386e40c2c804d2cc87959246a4f6e7edb66ce882015679bf5fc7747795870e3c142c5589d9502bf103ab5d9d086290a764180b7a91c86b2f6e60400ab50b4d33063988e0b22654b3b56fe2c3463eba3a2b70dc2c8e38350d2ed22b4ce7791ec01f58f001b96a521b5e1e5e8bf722e3a96b53067548469669af67ca9d8d00b0b0952534c5b9f8976a46546a0c9fb0b86ac56a983c1e926a343ed6fa4e92ca5ebbad89a022b60cf227ac2d03268b56ce2994b07331fd547ddeec427e020b16aef83f66adb360758c2e50000d3d8b7b1a073b67ddbb313d9c3aa39a34cca87b36822e340cad05d9e31c8f5da712485a1e9277418cf4fb9a6f7ac87b183a0a231e3d9185f14265ad10fbc57ee7abf881a3aeed3646e7a548c13b59232b69b13fa6ac69e37bbef4adf590b855dcf2535d457c3d6ec1278efafb39e1423d3ddfd6135d70e39af8668531107cb1086d3f7853a7bee834058e12d1270e68df0f6a7d80c02f9c613f3c31c3e2aec1bcb4f6de005caea417b0d51ffe043ff2dd0a8a523a5c1da84a1529e6019d0f0f5cb4b</script>
  <div class="hbe hbe-content">
    <div class="hbe hbe-input hbe-input-xray">
      <input class="hbe hbe-input-field hbe-input-field-xray" type="password" id="hbePass">
      <label class="hbe hbe-input-label hbe-input-label-xray" for="hbePass">
        <span class="hbe hbe-input-label-content hbe-input-label-content-xray">Hey, password is required here.</span>
      </label>
      <svg class="hbe hbe-graphic hbe-graphic-xray" width="300%" height="100%" viewBox="0 0 1200 60" preserveAspectRatio="none">
        <path d="M0,56.5c0,0,298.666,0,399.333,0C448.336,56.5,513.994,46,597,46c77.327,0,135,10.5,200.999,10.5c95.996,0,402.001,0,402.001,0"></path>
        <path d="M0,2.5c0,0,298.666,0,399.333,0C448.336,2.5,513.994,13,597,13c77.327,0,135-10.5,200.999-10.5c95.996,0,402.001,0,402.001,0"></path>
      </svg>
    </div>
  </div>
</div>
<script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      <categories>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo部署出现错误Error Spawn failed解决方式</title>
    <url>/hexo-spawn-failed/</url>
    <content><![CDATA[<p>部署过程中可能会出现错误:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">remote: Support for password authentication was removed on August 13, 2021. Please use a personal access token instead.</span><br><span class="line">remote: Please see https://github.blog/2020-12-15-token-authentication-requirements-for-git-operations/ for more information.</span><br><span class="line">fatal: unable to access &#x27;https://github.com/xiaoyuge5201/xiaoyuge5201.github.io.git/&#x27;: The requested URL returned error: 403</span><br><span class="line">FATAL &#123;</span><br><span class="line">  err: Error: Spawn failed</span><br><span class="line">      at ChildProcess.&lt;anonymous&gt; (/Users/xiaoyuge/workspace/mybolg/node_modules/hexo-util/lib/spawn.js:51:21)</span><br><span class="line">      at ChildProcess.emit (events.js:315:20)</span><br><span class="line">      at Process.ChildProcess._handle.onexit (internal/child_process.js:277:12) &#123;</span><br><span class="line">    code: 128</span><br><span class="line">  &#125;</span><br><span class="line">&#125; Something&#x27;s wrong. Maybe you can find the solution here: %s https://hexo.io/docs/troubleshooting.html</span><br><span class="line">xiaoyuge@xiaoyugedeMacBook-Pro mybolg % hexo clean</span><br></pre></td></tr></table></figure>
<p>####解决方式一：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#进入站点根目录</span></span></span><br><span class="line">cd cd /Users/xiaoyuge/workspace/mybolg</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#删除git提交内容文件夹</span></span></span><br><span class="line">rm -rf .deploy_git/</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#执行</span></span></span><br><span class="line">git config --global core.autocrlf false</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#最后</span></span></span><br><span class="line">hexo clean &amp;&amp; hexo g &amp;&amp; hexo d</span><br></pre></td></tr></table></figure>
<p>####解决方式二：<br>
有可能是你的git repo配置地址不正确,可以将http方式变更为ssh方式（我的就是这个问题）<br>
github在2021-08-13正式启用personal access token后，原来的用户名+密码方式部署会报错，需要采用最新的token登录方式进行部署 。<br>
具体方式参考：<a href="https://cloud.tencent.com/developer/article/1861466">https://cloud.tencent.com/developer/article/1861466</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">remote: Support for password authentication was removed on August 13, 2021. Please use a personal access token instead.</span><br></pre></td></tr></table></figure>
<p>查看_config.yml文件，</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">  <span class="comment">#repo:https://github.com/xiaoyuge5201/xiaoyuge5201.github.io.git  这是原来的路径，现在改成了下面这种</span></span><br><span class="line">  <span class="attr">repo:</span> <span class="string">git@github.com:xiaoyuge5201/xiaoyuge5201.github.io.git</span></span><br><span class="line">  <span class="attr">branch:</span> <span class="string">master</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>面试常见的趣味题</title>
    <url>/interest/</url>
    <content><![CDATA[<h3 id="8升-5升-3升水桶各一个如何分成两个4升"><a class="markdownIt-Anchor" href="#8升-5升-3升水桶各一个如何分成两个4升"></a> 8升、5升、3升水桶各一个,如何分成两个4升</h3>
<p><img src="/interest/3_5_8.png" alt="分成两个4升"></p>
<h3 id="以面向对象的思想设计长方形和正方形"><a class="markdownIt-Anchor" href="#以面向对象的思想设计长方形和正方形"></a> 以面向对象的思想设计长方形和正方形</h3>
<ul>
<li>方式1：设计接口，然后长方形和正方形各自实现这个接口</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//形状类：结算面积和周长</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">area</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">perimeter</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//长方形：实现接口并实现方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span> <span class="keyword">implements</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">double</span> width;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">double</span> height;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Rectangle</span><span class="params">(<span class="keyword">double</span> width,<span class="keyword">double</span> height)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.width=width;</span><br><span class="line">		<span class="keyword">this</span>.height=height;</span><br><span class="line">	&#125;	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">area</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.width*<span class="keyword">this</span>.height;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">perimeter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">2</span>*(<span class="keyword">this</span>.width+<span class="keyword">this</span>.height);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//正方形：实现接口并实现方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Square</span> <span class="keyword">implements</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">double</span> side;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Square</span><span class="params">(<span class="keyword">double</span> side)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.side=side;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">area</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> side*side;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">perimeter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">4</span>*side;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>方式2：使用extents<br>
因为正方形 <strong>is a</strong> 长方形，所以可以使用继承来设计正方形，然后在构造函数中使用super函数；</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Square</span> <span class="keyword">extends</span> <span class="title">Rectangle</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">double</span> side;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Square</span><span class="params">(<span class="keyword">double</span> side)</span></span>&#123;</span><br><span class="line">		<span class="keyword">super</span>(side,side);</span><br><span class="line">		<span class="keyword">this</span>.side=side;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		Square s=<span class="keyword">new</span> Square(<span class="number">2.5</span>);</span><br><span class="line">		System.out.println(s.perimeter());</span><br><span class="line">		System.out.println(s.area());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="java使用递归计算123n之间的和"><a class="markdownIt-Anchor" href="#java使用递归计算123n之间的和"></a> java使用递归计算1+2+3+…+n之间的和</h3>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SumNumber</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(sumN(<span class="number">10</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//使用递归的方法计算1+2+3+4+....n的和; 切记注意n不能小于1</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">sumN</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (n == <span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> n+ sumN(n-<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="java读取一篇英文文章并输出其中出现单词次数最多的3个单词以及次数"><a class="markdownIt-Anchor" href="#java读取一篇英文文章并输出其中出现单词次数最多的3个单词以及次数"></a> java读取一篇英文文章，并输出其中出现单词次数最多的3个单词以及次数</h3>
<p>文件文章中存在,.以及空格</p>
<ul>
<li>读取文件内容</li>
<li>对文件进行内容匹配</li>
<li>使用map 保存单词、次数</li>
<li>map排序</li>
<li>输出</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WordCount</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//1. 使用流读取文件</span></span><br><span class="line">            BufferedReader reader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> FileReader(<span class="string">&quot;d:/n.txt&quot;</span>));</span><br><span class="line">            StringBuffer sb = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">            String line;</span><br><span class="line">            <span class="keyword">while</span> ((line = reader.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                sb.append(line);</span><br><span class="line">            &#125;</span><br><span class="line">            reader.close();</span><br><span class="line">            <span class="comment">//替换所有的英文逗号和句号</span></span><br><span class="line">            String temp = sb.toString().replaceAll(<span class="string">&quot;/[\\w\\,\\.]+/&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">            <span class="comment">//2.使用正则表达式匹配</span></span><br><span class="line">            Pattern pattern = Pattern.compile(<span class="string">&quot;/[a-zA-Z\\w\\,\\.]+/&quot;</span>);</span><br><span class="line">            Matcher matcher = pattern.matcher(temp);</span><br><span class="line">            Map&lt;String, Integer&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;(<span class="number">16</span>);</span><br><span class="line">            String word;</span><br><span class="line">            <span class="keyword">int</span> count;</span><br><span class="line">            <span class="keyword">while</span> (matcher.find()) &#123;</span><br><span class="line">                word = matcher.group();</span><br><span class="line">                <span class="keyword">if</span> (map.containsKey(word)) &#123;</span><br><span class="line">                    count = map.get(word);</span><br><span class="line">                    map.put(word, count + <span class="number">1</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    map.put(word, <span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//将map的数据根据count排序；</span></span><br><span class="line">            List&lt;Map.Entry&lt;String, Integer&gt;&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;(map.entrySet());</span><br><span class="line">            Collections.sort(list, Comparator.comparing(Map.Entry::getValue));</span><br><span class="line">            <span class="keyword">int</span> last = list.size() - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = last; i &gt; last - <span class="number">5</span>; i--) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;key=&quot;</span> + list.get(i).getKey() + <span class="string">&quot; value=&quot;</span> + list.get(i).getValue());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="java-获取字符串第一次出现重复的字符"><a class="markdownIt-Anchor" href="#java-获取字符串第一次出现重复的字符"></a> java 获取字符串第一次出现重复的字符</h3>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">findDuplicate</span><span class="params">(String str)</span></span>&#123;</span><br><span class="line">    <span class="keyword">char</span>[] chars = str.toCharArray();</span><br><span class="line">    Set&lt;Character&gt; uniqueChars = <span class="keyword">new</span> HashSet(chars.length,<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; chars.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!uniqueChars.add(chars[i]))&#123;</span><br><span class="line">            <span class="keyword">return</span> i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>算法</category>
      </categories>
      <tags>
        <tag>algorithm</tag>
      </tags>
  </entry>
  <entry>
    <title>Java内部类初始化</title>
    <url>/java-inner-class-01/</url>
    <content><![CDATA[<h3 id="1-在同个java文件中但不是内部类"><a class="markdownIt-Anchor" href="#1-在同个java文件中但不是内部类"></a> 1. 在同个java文件中，但不是内部类</h3>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">C</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//在同一个Java文件中只能存在一个public类，除内部类外</span></span><br><span class="line"><span class="comment">//只允许使用“public”、“abstract”和“final”。</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">D</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//实例化</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    D d = <span class="keyword">new</span> D();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-常规内部类"><a class="markdownIt-Anchor" href="#2-常规内部类"></a> 2. 常规内部类</h3>
<p>要实例化内部类对象，必须先有外部类对象，通过外部类对象.new 内部类();来实例化内部类对象，在其他文件或者其他包内都是这样，只是要能在其他包实例化的话，内部类Inner还得加上修饰符public。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Outter</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Inner</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Outter out = <span class="keyword">new</span> Outter();</span><br><span class="line">        Outter.Inner in = out.<span class="function">new <span class="title">Inner</span><span class="params">()</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//第二种情况：通过提供方法来获取实例对象</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">B</span></span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">            System.out.println(<span class="number">111</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> B <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> B();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        A a = <span class="keyword">new</span> A();</span><br><span class="line">        B b = a.getInstance();</span><br><span class="line">        b.test();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-静态内部类"><a class="markdownIt-Anchor" href="#3-静态内部类"></a> 3. 静态内部类</h3>
<p>实例化静态内部类和实例化常规内部类有类似的地方，而不同之处在与静态内部类由于是静态的，所以不需要外部类对象就可以实例化，如上例Outter.Inner in = new Outter.Inner();<br>
在其他Java文件也是这么实例化的</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Outter</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Inner</span> </span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Outter.Inner in = <span class="keyword">new</span> Outter.Inner();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-局部内部类"><a class="markdownIt-Anchor" href="#4-局部内部类"></a> 4. 局部内部类</h3>
<p>局部内部类是定义在一个方法或者一个作用域里面的类，它和成员内部类的区别在于局部内部类的访问仅限于方法内或者该作用域内，所以只能在方法或者该作用域内实例化,局部内部类不能有访问说明符,因为它不是外围类的一部分,但是可以访问当前代码块的常量,以及此外围类的所有成员</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pint</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="class"><span class="keyword">class</span> <span class="title">C</span> </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">new</span> C();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pint</span><span class="params">(<span class="keyword">boolean</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (b) &#123;</span><br><span class="line">            <span class="class"><span class="keyword">class</span> <span class="title">D</span> </span>&#123;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">new</span> D();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-匿名内部类"><a class="markdownIt-Anchor" href="#5-匿名内部类"></a> 5. 匿名内部类</h3>
<p>匿名内部类可以继承一个类或实现一个接口，这里的ClassOrInterfaceName是匿名内部类所继承的类名或实现的接口名。但匿名内部类不能同时实现一个接口和继承一个类，也不能实现多个接口。如果实现了一个接口，该类是Object类的直接子类，匿名类继承一个类或实现一个接口，不需要extends和implements关键字</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ArrayList&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;String&gt;() &#123;&#123;</span><br><span class="line">        add(<span class="string">&quot;A&quot;</span>);</span><br><span class="line">        add(<span class="string">&quot;B&quot;</span>);</span><br><span class="line">        add(<span class="string">&quot;C&quot;</span>);</span><br><span class="line">&#125;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Thread(</span><br><span class="line">        <span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123; ... &#125;</span><br><span class="line">        &#125;</span><br><span class="line">).start();</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>内部类</tag>
      </tags>
  </entry>
  <entry>
    <title>Java 8学习</title>
    <url>/java8%E7%89%B9%E6%80%A7/</url>
    <content><![CDATA[<h2 id="1-optional"><a class="markdownIt-Anchor" href="#1-optional"></a> 1. Optional</h2>
<p>Optional 类主要解决的问题是臭名昭著的空指针异常（NullPointerException)。<br>
本质上，这是一个包含有可选值的包装类，这意味着 Optional 类既可以含有对象也可以为空</p>
<h3 id="11-optional构造方式"><a class="markdownIt-Anchor" href="#11-optional构造方式"></a> 1.1. optional构造方式</h3>
<ul>
<li>
<p>Optional.of(T)</p>
<p>该方式的入参不能为null，否则会有NPE，在确定入参不为空时使用该方式。</p>
</li>
<li>
<p>Optional.ofNullable(T)</p>
<p>该方式的入参可以为null，当入参不确定为非null时使用。</p>
</li>
<li>
<p>Optional.empty()</p>
<p>这种方式是返回一个空Optional，等效Optional.ofNullable(null)</p>
</li>
</ul>
<h3 id="12-如何正确的使用optional"><a class="markdownIt-Anchor" href="#12-如何正确的使用optional"></a> 1.2. 如何正确的使用Optional</h3>
<ul>
<li>
<p>尽量避免使用的地方</p>
<ol>
<li>
<p>避免使用Optional.isPresent()来检查实例是否存在，因为这种方式和null != obj没有区别，这样用就没什么意义了。</p>
</li>
<li>
<p>避免使用Optional.get()方式来获取实例对象，因为使用前需要使用Optional.isPresent()来检查实例是否存在，否则会出现NPE问题。</p>
</li>
<li>
<p>避免使用Optional作为类或者实例的属性，而应该在返回值中用来包装返回实例对象。</p>
</li>
<li>
<p>避免使用Optional作为方法的参数，原因同3。</p>
</li>
</ol>
</li>
<li>
<p>正确使用方式</p>
<ol>
<li>
<p>实例对象存在则返回，否则提供默认值或者通过方法来设置返回值，即使用orElse/orElseGet方式：</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//存在则返回</span></span><br><span class="line">User king = <span class="keyword">new</span> User(<span class="number">1</span>, <span class="string">&quot;king&quot;</span>);</span><br><span class="line">Optional&lt;User&gt; userOpt = Optional.of(king);</span><br><span class="line">User user =  userOpt.orElse(<span class="keyword">null</span>);</span><br><span class="line">System.out.println(user.getName());</span><br><span class="line"></span><br><span class="line"><span class="comment">//不存在提供默认值</span></span><br><span class="line">User user2 = <span class="keyword">null</span>;</span><br><span class="line">Optional&lt;User&gt; userOpt2 = Optional.ofNullable(user2);</span><br><span class="line">User user3 = userOpt2.orElse(unknown);</span><br><span class="line">System.out.println(user3.getName());</span><br><span class="line"></span><br><span class="line"><span class="comment">//通过方法提供值</span></span><br><span class="line">User user4 = userOpt2.orElseGet(() -&gt; <span class="keyword">new</span> User(<span class="number">0</span>, <span class="string">&quot;DEFAULT&quot;</span>)); </span><br><span class="line">System.out.println(user4.getName())</span><br><span class="line">    </span><br><span class="line"> <span class="comment">//不建议下面这种使用</span></span><br><span class="line"><span class="keyword">if</span>(userOpt.isPresent()) &#123;</span><br><span class="line">    System.out.println(userOpt.get().getName());</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">//。。。</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>使用ifPresent()来进行对象操作，存在则操作，否则不操作。</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//实例存在则操作，否则不操作</span></span><br><span class="line">userOpt.ifPresent(u -&gt; System.out.println(u.getName()));</span><br><span class="line">userOpt2.ifPresent(u -&gt; System.out.println(u.getName()));</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>使用map/flatMap来获取关联数据</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//使用map方法获取关联数据</span></span><br><span class="line">System.out.println(userOpt.map(u -&gt; u.getName()).orElse(<span class="string">&quot;Unknown&quot;</span>));</span><br><span class="line">System.out.println(userOpt2.map(u -&gt; u.getName()).orElse(<span class="string">&quot;Default&quot;</span>));</span><br><span class="line"><span class="comment">//使用flatMap方法获取关联数据</span></span><br><span class="line">List&lt;String&gt; interests = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">interests.add(<span class="string">&quot;a&quot;</span>);interests.add(<span class="string">&quot;b&quot;</span>);interests.add(<span class="string">&quot;c&quot;</span>);</span><br><span class="line">user.setInterests(interests);</span><br><span class="line">List&lt;String&gt; interests2 = Optional.of(user)</span><br><span class="line">    .flatMap(u -&gt; Optional.ofNullable(u.getInterests()))</span><br><span class="line">    .orElse(Collections.emptyList());</span><br><span class="line">System.out.println(interests2.isEmpty());</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
</ul>
<h3 id="13optional判断第三方接口"><a class="markdownIt-Anchor" href="#13optional判断第三方接口"></a> 1.3.Optional判断第三方接口</h3>
<p>使用java8的optional可以减少很多的NPE，再也不用当心别人的接口返回值问题了，也不用满屏的if（a != null）这种判断，下面是使用过程中遇到的问题以及如何使用Optional解决。</p>
<h4 id="131-接口返回参数问题"><a class="markdownIt-Anchor" href="#131-接口返回参数问题"></a> 1.3.1. 接口返回参数问题</h4>
<ol>
<li>在微服务中使用feign调用其他接口，总担心别人返回的参数是否符合标准</li>
<li>参数符合标准后，然后再进行数据判断，先判断是否code为200，然后判断数据存不存在，这样冗余的代码就很多</li>
</ol>
<p>这是我们期望的返回格式</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">&quot;code&quot;</span>: <span class="string">&quot;200&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;msg&quot;</span>: <span class="string">&quot;调用成功!&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;data&quot;</span>: []</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//模拟接口调用方法</span></span><br><span class="line">Map&lt;String,Object&gt; map = serviceImpl.queryList();</span><br><span class="line"><span class="comment">//即使map为空也能正常返回，配合map直接映射数据值</span></span><br><span class="line"><span class="keyword">return</span> Optional.ofNullable(map).map(r-&gt; r.get(<span class="string">&quot;data&quot;</span>)).orElseGet(ArrayList:: <span class="keyword">new</span>)</span><br><span class="line">    </span><br><span class="line"> <span class="comment">//JSONObject 判断是否返回成功，如果成功返回200， 不成功返回400   </span></span><br><span class="line">JSONObject jsonObject = service.updateDate();</span><br><span class="line">Optional.ofNullable(jsonObject).map(r-&gt;r.getInteger(<span class="string">&quot;code&quot;</span>)).orElse(<span class="number">400</span>)</span><br></pre></td></tr></table></figure>
<h4 id="132-避免判断风暴"><a class="markdownIt-Anchor" href="#132-避免判断风暴"></a> 1.3.2. 避免判断风暴</h4>
<p>对象层层嵌套，为了逻辑严谨必须要进行空判断</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//对于一个对象里面嵌套对象，那么需要层层去判断非空</span></span><br><span class="line">School school = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span>(school != <span class="keyword">null</span>)&#123;</span><br><span class="line">    Clazz clazz = school.getClazz();</span><br><span class="line">    <span class="keyword">if</span>(clazz != <span class="keyword">null</span>)&#123;</span><br><span class="line">        Student student = clazz.getStudent();</span><br><span class="line">        <span class="keyword">if</span>(student != <span class="keyword">null</span>)&#123;</span><br><span class="line">            String name = student.getName();</span><br><span class="line">            <span class="keyword">if</span>(name == <span class="keyword">null</span> || <span class="string">&quot;&quot;</span>.equals(name))&#123;</span><br><span class="line">                name = <span class="string">&quot;学生的姓名为空&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//使用Optional后</span></span><br><span class="line"> String name = Optional.ofNullable(school)</span><br><span class="line">                .map(School::getClazz)</span><br><span class="line">                .map(Clazz::getStudent)</span><br><span class="line">                .map(Student::getName)</span><br><span class="line">                .orElse(<span class="string">&quot;学生的姓名为空&quot;</span>);</span><br></pre></td></tr></table></figure>
<h2 id="2-stream"><a class="markdownIt-Anchor" href="#2-stream"></a> 2. Stream</h2>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//找出某一个字段等于某个值的那一条数据</span></span><br><span class="line">JaponicaRiceCheck1 streamCheck = listItemRice.stream()</span><br><span class="line">.filter(o -&gt; o.getSYS_PARENTID().equals(check.getSYS_ID())).findAny().orElse(<span class="keyword">null</span>);</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>知识整理</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>锁优化</title>
    <url>/lock01/</url>
    <content><![CDATA[<h2 id="1-优化思路以及方法"><a class="markdownIt-Anchor" href="#1-优化思路以及方法"></a> 1. 优化思路以及方法</h2>
<ul>
<li>减少锁持有时间</li>
<li>减小锁粒度</li>
<li>锁分离</li>
<li>锁粗化</li>
<li>锁消除</li>
</ul>
<h3 id="11-减少锁持有时间"><a class="markdownIt-Anchor" href="#11-减少锁持有时间"></a> 1.1 减少锁持有时间</h3>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">syncMethod</span><span class="params">()</span></span>&#123;</span><br><span class="line">    othercode1();</span><br><span class="line">    mutextMethod();</span><br><span class="line">    othercode2();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>像上述代码，在进入方法前就要得到锁，其他线程就要在外面等待。</p>
<p>分析：锁里面的资源在同一时间只允许一个线程执行，我们不仅要减少其他线程等待的时间，也要尽力减少线程在锁里面的执行时间，所以，尽量只有在有线程安全要求的程序代码上加锁。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">syncMethod</span><span class="params">()</span></span>&#123;</span><br><span class="line">    othercode1();</span><br><span class="line">    <span class="keyword">synchronized</span>(<span class="keyword">this</span>)&#123;</span><br><span class="line">        metextMethod();</span><br><span class="line">    &#125;</span><br><span class="line">    othercode2();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="12-减小锁粒度"><a class="markdownIt-Anchor" href="#12-减小锁粒度"></a> 1.2 减小锁粒度</h3>
<p>将大对象（这个对象可能会被很多线程访问）拆成小对象，大大增加并行度。</p>
<p>降低锁竞争，那么偏向锁、轻量级锁成功率才会提高。</p>
<p>最最典型的减小锁粒度的案例就是ConcurrentHashMap。在HashMap的基础上进行优化，使用了cas与synchronized来确保安全性，在保证安全性的基础上为了充分利用线程资源，更是巧妙的设计了多线程同扩容的模式。</p>
<h3 id="13-锁分离"><a class="markdownIt-Anchor" href="#13-锁分离"></a> 1.3 锁分离</h3>
<p>最常见的锁分离就是读写锁ReadWriteLock，根据功能进行分离成读锁和写锁。这样读读不互斥，读写互斥，写写互斥。既保证了线程安全，又提高了性能。</p>
<p>分析：读写分离这种思想可以延伸到我们其他的设计中，只要操作上互不影响，那锁就可以进行分离，比如：LinkedBlockingQueue</p>
<img src="..\images/read_writer_Lock1.png" alt="read_writer_Lock1" style="zoom: 67%;">
<p>从头部获取数据，从尾部放入数据，使用两把锁。</p>
<h3 id="14-锁粗化"><a class="markdownIt-Anchor" href="#14-锁粗化"></a> 1.4 锁粗化</h3>
<p>通常情况下，为了保证多线程间的有效并发，会要求每个线程持有锁的时间尽量短，即在使用完公共资源后，应该立即释放锁，只有这样，等待在这个锁上的其他线程才能尽早的获取资源执行任务；但是凡事都有一个度，如果对同一个锁不停的进行请求、同步和释放，其本身也会消耗系统宝贵的资源，反而不利于性能的优化。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demoMethod</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">synchronized</span>&#123;</span><br><span class="line">    	<span class="comment">//dow sth.</span></span><br><span class="line">	&#125;</span><br><span class="line">    <span class="comment">//....做其他不需要同步的工作，但能很快执行完毕</span></span><br><span class="line">    <span class="keyword">synchronized</span>&#123;</span><br><span class="line">        <span class="comment">//do sth.</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这种情况，根据锁粗化的思想，应该合并：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demoMethod</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//整合成一次锁请求,前提时中间哪些不需要同步的工作很快就执行完成</span></span><br><span class="line">    <span class="keyword">synchronized</span>(lock)&#123;</span><br><span class="line">        <span class="comment">//do sth.</span></span><br><span class="line">        <span class="comment">//....做其他不需要同步的工作，但能很快执行完毕</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再举一个极端的例子：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i =<span class="number">0</span>; i &lt; circle; i++)&#123;</span><br><span class="line">    <span class="keyword">synchronized</span>(lock)&#123;</span><br><span class="line">        <span class="comment">//.....</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在一个循环内不同得获得锁。虽然JDK内部会对这个代码做些优化，但是还不如直接写成：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">synchronized</span>(lock)&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i =<span class="number">0</span>; i &lt; circle; i++)&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当然如果有需求说，这样的循环太久，需要给其他线程不要等待太久，那只能写成上面那种。如果没有这样类似的需求，还是直接写成后者那种比较好。<br>
<strong>分析</strong>: 锁粗化是JVM默认启动的一种机制，锁粗化针对的是对连续的区域进行分段加锁这种场景，JVM会自发进行优化。但作为开发者而言在满足业务的情况下，应该减少锁的使用。</p>
<h3 id="15-锁消除"><a class="markdownIt-Anchor" href="#15-锁消除"></a> 1.5 锁消除</h3>
<p>锁消除是在编译器级别的事情。在即时编译器(JIT)时，如果发现不可能被共享的对象，则可以消除这些对象的锁操作。也许你会觉得奇怪，既然有些对象不可能被多线程访问，那为什么要加锁呢？写代码时直接不加锁不就好了。<br>
但是有时，这些锁并不是程序员所写的，有的是JDK实现中就有锁的，比如Vector和StringBuffer这样的类，它们中的很多方法都是有锁的。当我们在一些不会有线程安全的情况下使用这些类的方法时，达到某些条件时，编译器会将锁消除来提高性能。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span> <span class="keyword">throws</span> InterrruptedException</span>&#123;</span><br><span class="line">    <span class="keyword">long</span> start = System.currentTimeTimeMillis();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; <span class="number">20000</span>; i++)&#123;</span><br><span class="line">        createStringBuffer(<span class="string">&quot;JVM&quot;</span>,<span class="string">&quot;asdfasdfasdf&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">long</span> bufferCost = System.currentTimeTimeMillis() - start;</span><br><span class="line">    System.out.println(<span class="string">&quot;createStringBuffer:&quot;</span>+bufferCost+<span class="string">&quot;ms&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">createStringBuffer</span><span class="params">(String s1, String s2)</span></span>&#123;</span><br><span class="line">    StringBuffer sb = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">    sb.append(s1);</span><br><span class="line">    sb.append(s2);</span><br><span class="line">    <span class="keyword">return</span> sb.toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上述代码中的StringBuffer.append是一个同步操作，但是StringBuffer却是一个局部变量，并且方法也并没有把StringBuffer返回，所以不可能会有多线程去访问它。那么此时StringBuffer中的同步操作就是没有意义的。<br>
开启锁消除是在JVM参数上设置的，当然需要在server模式下：</p>
<figure class="highlight tex"><table><tr><td class="code"><pre><span class="line">-server -XX:+DoEscapeAnalysis -XX:+EliminateLocks</span><br></pre></td></tr></table></figure>
<p>并且要开启逃逸分析。 逃逸分析的作用呢，就是看看变量是否有可能逃出作用域的范围。<br>
比如上述的StringBuffer，上述代码中craeteStringBuffer的返回是一个String，所以这个局部变量StringBuffer在其他地方都不会被使用。如果将craeteStringBuffer改成</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> StringBuffer <span class="title">createStringBuffer</span><span class="params">(String s1, String s2)</span></span>&#123;</span><br><span class="line">    StringBuffer sb = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">    sb.append(s1);</span><br><span class="line">    sb.append(s2);</span><br><span class="line">    <span class="keyword">return</span> sb;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>那么这个 StringBuffer被返回后，是有可能被任何其他地方所使用的（譬如被主函数将返回结果put进map啊等等）。那么JVM的逃逸分析可以分析出，这个局部变量 StringBuffer逃出了它的作用域。<br>
所以基于逃逸分析，JVM可以判断，如果这个局部变量StringBuffer并没有逃出它的作用域，那么可以确定这个StringBuffer并不会被多线程所访问，那么就可以把这些多余的锁给去掉来提高性能。<br>
当JVM参数为：</p>
<figure class="highlight tex"><table><tr><td class="code"><pre><span class="line">-server -XX:+DoEscapeAnalysis -XX:+EliminateLocks</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight tex"><table><tr><td class="code"><pre><span class="line">createStringBuffer: 302ms</span><br></pre></td></tr></table></figure>
<p>JVM参数为：</p>
<figure class="highlight tex"><table><tr><td class="code"><pre><span class="line">-server -XX:+DoEscapeAnalysis -XX:-EliminateLocks</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight tex"><table><tr><td class="code"><pre><span class="line">createStringBuffer: 660ms</span><br></pre></td></tr></table></figure>
<p>显然，锁消除的效果还是很明显的。</p>
]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>lock</tag>
      </tags>
  </entry>
  <entry>
    <title>MVCC多版本并发控制</title>
    <url>/mvcc/</url>
    <content><![CDATA[<h3 id="1-mvcc"><a class="markdownIt-Anchor" href="#1-mvcc"></a> 1. MVCC</h3>
<p>全称Multi-Version Concurrency Control即多版本并发控制。MVCC是一种并发控制的方法，一般在数据库管理系统中，实现对数据库的并发访问，在编程语言中是心啊事务内存。<br>
MVCC在mysql Innodb中的实现主要是为了提高数据库并发性能，用更好的方式去处理读-写冲突，做到即使读写冲突时，也能做到不加锁，非阻塞并发读</p>
<h3 id="2-当前读和快照读"><a class="markdownIt-Anchor" href="#2-当前读和快照读"></a> 2. 当前读和快照读</h3>
<ul>
<li>
<p>当前读</p>
<p>像select lock in share mode（共享锁），select for update， update, insert,delete(排他锁)这些操作都是一种当前读；<strong>当前读就是读取记录的最新版本，读取时还要保证其他并发事务不能修改当前记录，会对读取的记录进行加锁</strong>。</p>
</li>
<li>
<p>快照读</p>
<p>像不加锁的select操作就是快照读，即不加锁的非阻塞读；快照读的前提是隔离级别不是串行级别（串行级别快照读会变成当前读）；快照读的实现是基于多版本并发控制（即MVCC）；可以任务MVCC是行锁的一个变种，但它在很多情况下，避免了加锁操作，降低了开销；<br>
既然是基于多版本，即快照读可能读到的并不一定是最新版本的数据，有可能是之前的历史版本</p>
</li>
</ul>
<p><strong>MVCC就是为了实现读（快照读）-写冲突不加锁，当前读实际上是一种加锁的操作，是悲观锁的实现。</strong></p>
<hr>
<h3 id="3-当前读-快照读和mvcc的关系"><a class="markdownIt-Anchor" href="#3-当前读-快照读和mvcc的关系"></a> 3. 当前读、快照读和MVCC的关系</h3>
<p>MVCC多版本并发控制指的是&quot;维持一个数据的多个版本，使得读写操作没有冲突&quot;；<br>
Mysql通过快照读的方式去实现MVCC理想模型的其中一个具体非阻塞读功能，相对而言，当前读就是悲观锁的具体功能实现</p>
<p>MVCC模型在Mysql中具体实现有3个隐式字段：undo日志、Read View等去完成的</p>
<h3 id="4-mvcc的作用与好处"><a class="markdownIt-Anchor" href="#4-mvcc的作用与好处"></a> 4. MVCC的作用与好处</h3>
<p>数据库并发场景分为以下三种：</p>
<ul>
<li>读-读：没有问题，也不需要并发控制</li>
<li>读-写：有线程安全问题，可能会造成事务隔离性问题，（脏读、幻读、不可重复读）</li>
<li>写-写：有线程安全问题，可能会存在更新丢失问题</li>
</ul>
<p><strong>MVCC带来的好处：</strong></p>
<p>MVCC是一种用来解决读-写冲突的无所并发控制（在MVCC提出之前采用的是采用<strong>悲观锁</strong>），也就是事务分配增长的时间戳，为每个修改保存一个版本，版本与事务时间戳关联，读操作只读该事务前的数据库快照，主要解决以下问题：</p>
<ul>
<li>在并发读写数据库时，可以做到在读操作是不用阻塞写操作，写操作也不用阻塞读操作，提高了数据库并发读写的性能；</li>
<li>解决脏读、幻读、不可重复读等事务隔离性问题，但不能解决更新丢失问题</li>
</ul>
<p><strong>MVCC组合方法</strong></p>
<ul>
<li>MVCC + 悲观锁： MVCC解决读写冲突，悲观锁解决写写冲突</li>
<li>MVCC + 乐观锁： MVCC解决读写冲突，乐观锁解决写写冲突，这种方式可能最大程度的提高数据库并发性能，并解决读写冲突和写写冲突导致的问题</li>
</ul>
<h3 id="5-mvcc的实现原理"><a class="markdownIt-Anchor" href="#5-mvcc的实现原理"></a> 5. MVCC的实现原理</h3>
<p>实现原理主要是依赖记录中的 3个隐式字段、undo日志 、ReadView 来实现的</p>
<p>在Mysql的InnoDB引擎中就是指在已提交读(READ COMMITTD)和可重复读(REPEATABLE READ)这两种隔离级别下的事务对于SELECT操作会访问版本链中的记录的过程<br>
这就使得别的事务可以修改这条记录，反正每次修改都会在版本链中记录。SELECT可以去版本链中拿记录，这就实现了读-写，写-读的并发执行，提升了系统的性能。</p>
<h4 id="51-版本链"><a class="markdownIt-Anchor" href="#51-版本链"></a> 5.1 版本链</h4>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">begin</span>;</span><br><span class="line">#触发分配TRX_ID</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_role;</span><br><span class="line">#指定TRX_MYSQL_THREAD_ID<span class="operator">=</span>当前CONNECTION_ID,表示查询当前连接</span><br><span class="line"><span class="keyword">select</span> TRX_ID, ROLL_PTR, ROW_ID  <span class="keyword">from</span> INFORMATION_SCHEMA.INNODB_TRX <span class="keyword">where</span> TRX_MYSQL_THREAD_ID <span class="operator">=</span> CONNECTION_ID();</span><br><span class="line"><span class="keyword">commit</span>;</span><br></pre></td></tr></table></figure>
<p>在InnoDB引擎表中，它的聚簇索引记录中有两个必要的隐藏列：</p>
<ul>
<li>
<p>TRX_ID</p>
<p>6byte，这个id用来存储的每次对某条聚簇索引记录进行修改的时候的事务id</p>
</li>
<li>
<p>roll_pointer</p>
<p>每次对哪条聚簇索引记录有修改的时候，都会把老版本写入undo日志中。这个roll_pointer就是存了一个指针，它指向这条聚簇索引记录的上一个版本的位置，通过它来获得上一个版本的记录信息。(注意插入操作的undo日志没有这个属性，因为它没有老版本)</p>
</li>
<li>
<p>ROW_ID</p>
<p>6byte，隐含的自增ID（隐藏主键），如果数据表没有主键，InnoDB会自动以DB_ROW_ID产生一个聚簇索引</p>
</li>
<li>
<p>实际还有一个删除flag隐藏字段, 既记录被更新或删除并不代表真的删除，而是删除flag变了<br>
<img src="/mvcc/02.png" alt></p>
</li>
</ul>
<p>比如现在有个事务id是60的执行的这条记录的修改语句</p>
<p><img src="/mvcc/03.png" alt></p>
<p>此时在undo日志中就存在版本链<br>
<img src="/mvcc/04.png" alt></p>
<h4 id="52-readview"><a class="markdownIt-Anchor" href="#52-readview"></a> 5.2 ReadView</h4>
<p>已提交读和可重复读的区别就在于它们生成ReadView的策略不同<br>
ReadView中主要就是有个列表来存储我们系统中当前活跃着的读写事务，也就是begin了还未提交的事务。通过这个列表来判断记录的某个版本是否对当前事务可见。假设当前列表里的事务id为[80,100]。</p>
<ul>
<li>如果你要访问的记录版本的事务id为50，比当前列表最小的id80小，那说明这个事务在之前就提交了，所以对当前活动的事务来说是可访问的。</li>
<li>如果你要访问的记录版本的事务id为90,发现此事务在列表id最大值和最小值之间，那就再判断一下是否在列表内，如果在那就说明此事务还未提交，所以版本不能被访问。如果不在那说明事务已经提交，所以版本可以被访问。</li>
<li>如果你要访问的记录版本的事务id为110，那比事务列表最大id100都大，那说明这个版本是在ReadView生成之后才发生的，所以不能被访问。<br>
这些记录都是去版本链里面找的，先找最近记录，如果最近这一条记录事务id不符合条件，不可见的话，再去找上一个版本再比较当前事务的id和这个版本事务id看能不能访问，以此类推直到返回可见的版本或者结束。</li>
</ul>
]]></content>
      <categories>
        <category>mysql</category>
      </categories>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title>mysql索引</title>
    <url>/mysql-index/</url>
    <content><![CDATA[<p>拿汉语字典的目录页（索引）打比方，我们可以按拼音、笔画、偏旁部首等排序的目录（索引）快速查找到需要的字。<br>
索引分单列索引和组合索引。</p>
<ul>
<li>单列索引，即一个索引只包含单个列，一个表可以有多个单列索引，但这不是组合索引。</li>
<li>组合索引，即一个索引包含多个列。</li>
</ul>
<p>创建索引时，你需要确保该索引是应用在 SQL 查询语句的条件(一般作为 WHERE 子句的条件)。<br>
实际上，索引也是一张表，该表保存了主键与索引字段，并指向实体表的记录。<br>
上面都在说使用索引的好处，但过多的使用索引将会造成滥用。因此索引也会有它的缺点：<br>
虽然索引大大提高了查询速度，同时却会降低更新表的速度，如对表进行INSERT、UPDATE和DELETE。因为更新表时，MySQL不仅要保存数据，还要保存一下索引文件。<br>
建立索引会占用磁盘空间的索引文件。</p>
<h2 id="1普通索引"><a class="markdownIt-Anchor" href="#1普通索引"></a> 1.普通索引</h2>
<ul>
<li>创建索引  <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 如果是CHAR，VARCHAR类型，length可以小于字段实际长度；如果是BLOB和TEXT类型，必须指定 length。</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX indexName <span class="keyword">on</span> table_name (column_name )</span><br></pre></td></tr></table></figure>
</li>
<li>添加索引（修改表结构）  <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 表结构已经存在了，然后使用alter修改表结构添加索引</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> table_name  <span class="keyword">add</span> INDEX indexName(column_name )</span><br></pre></td></tr></table></figure>
</li>
<li>创建表指定  <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> mytable(  </span><br><span class="line">    ID <span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,   </span><br><span class="line">    username <span class="type">VARCHAR</span>(<span class="number">16</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,  </span><br><span class="line">    INDEX [indexName] (username(length))  </span><br><span class="line">); </span><br></pre></td></tr></table></figure>
</li>
<li>删除索引  <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">drop</span> index [indexName] <span class="keyword">on</span>  table_name </span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="2-唯一索引"><a class="markdownIt-Anchor" href="#2-唯一索引"></a> 2. 唯一索引</h2>
<p>他和普通索引类似，不同的是：索引列的值必须唯一，但允许有控制。如果是组合索引，则列值的组合必须唯一。</p>
<ul>
<li>
<p>创建索引</p>
  <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> INDEX indexName <span class="keyword">ON</span> table_name (column_name (length ))</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>修改表结构</p>
  <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">table</span> mytable <span class="keyword">ADD</span> <span class="keyword">UNIQUE</span> [indexName] (column_name(length))</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>创建表的时候指定</p>
  <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> mytable(  </span><br><span class="line">    ID <span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,   </span><br><span class="line">    username <span class="type">VARCHAR</span>(<span class="number">16</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,  </span><br><span class="line">    <span class="keyword">UNIQUE</span> [indexName] (username(length))  </span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="3组合索引"><a class="markdownIt-Anchor" href="#3组合索引"></a> 3.组合索引</h2>
<ul>
<li>修改表结构指定索引  <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name <span class="keyword">ADD</span> INDEX indexName (column_name1 , column_name2,...)</span><br></pre></td></tr></table></figure>
</li>
<li>创建表的时候指定  <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> mytable(  </span><br><span class="line">    ID <span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,   </span><br><span class="line">    username <span class="type">VARCHAR</span>(<span class="number">16</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,  </span><br><span class="line">    KEY [indexName] (column_name1 , column_name2,...)  </span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="31-组合索引查询问题"><a class="markdownIt-Anchor" href="#31-组合索引查询问题"></a> 3.1 组合索引查询问题</h3>
<p><strong>问题描述：<strong>在mysql中有张表test_a，有3个字段id,name,num；对这三个字段建立组合索引，那么查询时使用其中某两个或者一个作为查询条件，是否还会走索引<br>
<img src="/mysql-index/01.png" alt="表结构"><br>
根据查询字段的位置不同来决定，如查询</strong>id</strong>、<strong>id,num</strong>、<strong>id,num,name</strong>、 <strong>id, name</strong> 都可以走索引的，其他条件的查询不能走索引。</p>
<p><strong>组合索引 有“最左前缀”原则。就是只从最左面的开始组合，并不是所有只要含有这三列存在的字段的查询都会用到该组合索引</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 添加组合索引</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> test_a <span class="keyword">ADD</span> INDEX <span class="string">&#x27;lianhe&#x27;</span>(id, num, name)</span><br></pre></td></tr></table></figure>
<ol>
<li>使用三个字段id, num, name查询</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 只要三个条件都有，可以随意变换位置，结果都会走索引</span></span><br><span class="line"><span class="comment">-- 优化器会将条件顺序优化成上面三种情况后执行</span></span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> test_a <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="number">1</span> <span class="keyword">AND</span> num<span class="operator">=</span><span class="string">&#x27;001&#x27;</span> <span class="keyword">AND</span> name <span class="operator">=</span> <span class="string">&#x27;1#&#x27;</span></span><br></pre></td></tr></table></figure>
<p><img src="/mysql-index/02.png" alt="使用三个字段id, num, name查询"><br>
从执行结果上可以看到是从走索引进行查询的</p>
<ol start="2">
<li>使用num, name 查询</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> test_a <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;1#&#x27;</span></span><br><span class="line"></span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> test_a <span class="keyword">WHERE</span> num<span class="operator">=</span><span class="string">&#x27;001&#x27;</span> </span><br></pre></td></tr></table></figure>
<p><img src="/mysql-index/03.png" alt="使用id, name 查询"><br>
3. 使用id, name或者id, num 查询</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 只要包括id，可以随意变换位置，结果都会走索引</span></span><br><span class="line"><span class="comment">-- 优化器会将条件顺序优化成上面三种情况后执行</span></span><br><span class="line"><span class="comment">--如果只有两个字段，只有id条件命中，num或者name 条件不走联合索引。</span></span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> test_a <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="number">1</span> <span class="keyword">AND</span> name <span class="operator">=</span> <span class="string">&#x27;1#&#x27;</span></span><br></pre></td></tr></table></figure>
<p><img src="/mysql-index/02.png" alt="使用id, name 查询"></p>
<p>需要避免索引失效的情况，如：LIKE %xxx，或者条件中使用函数等。<br>
4. 使用id查询</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> test_a <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="number">1</span></span><br></pre></td></tr></table></figure>
<p><img src="/mysql-index/02.png" alt="使用id查询"></p>
<ol start="5">
<li>使用name或者num查询</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> test_a <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;1#&#x27;</span></span><br><span class="line"></span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> test_a <span class="keyword">WHERE</span> num <span class="operator">=</span> <span class="string">&#x27;001&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="32-创建组合索引选择规则"><a class="markdownIt-Anchor" href="#32-创建组合索引选择规则"></a> 3.2 创建组合索引选择规则</h3>
<ul>
<li>经常用的列优先（最左匹配原则）</li>
<li>离散度高的列优先（离散度高原则）</li>
<li>宽度小的列优先（最少空间原则）</li>
</ul>
<h2 id="4使用alter命令添加索引"><a class="markdownIt-Anchor" href="#4使用alter命令添加索引"></a> 4.使用alter命令添加索引</h2>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 该语句添加一个主键，这意味着索引值必须是唯一的，且不能为NULL。</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tbl_name <span class="keyword">ADD</span> <span class="keyword">PRIMARY</span> KEY (column_list): </span><br><span class="line">    </span><br><span class="line"><span class="comment">--  这条语句创建索引的值必须是唯一的（除了NULL外，NULL可能会出现多次）。</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tbl_name <span class="keyword">ADD</span> <span class="keyword">UNIQUE</span> index_name (column_list):</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 添加普通索引，索引值可出现多次。</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tbl_name <span class="keyword">ADD</span> INDEX index_name (column_list):</span><br><span class="line"></span><br><span class="line"><span class="comment">--该语句指定了索引为 FULLTEXT ，用于全文索引。</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tbl_name <span class="keyword">ADD</span> FULLTEXT index_name (column_list):</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>mysql</category>
      </categories>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title>mysql事务</title>
    <url>/mysql-transcation/</url>
    <content><![CDATA[<h2 id="事务的定义"><a class="markdownIt-Anchor" href="#事务的定义"></a> 事务的定义</h2>
<p>事务是数据管理系统DBMS执行过程中的一个<strong>逻辑单位</strong>，有一个有限的数据库<strong>操作序列</strong>构成</p>
<h2 id="事务四大特性"><a class="markdownIt-Anchor" href="#事务四大特性"></a> 事务四大特性</h2>
<ol>
<li>原子性atomicity：依赖undo log做到全部失败</li>
<li>隔离性isolation：实现方式LBCC 和 MVCC</li>
<li>持久性durability ：实现方式redo log和double write</li>
<li>一致性consistency：通过上面的三种方式实现</li>
</ol>
<p>数据恢复：</p>
<ul>
<li>redo log 崩溃恢复</li>
<li>双写缓冲（double write）</li>
</ul>
<p>Mysql中insert、delete、update 自带事务</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> veriables <span class="keyword">like</span> ‘autocommit’;</span><br><span class="line"><span class="keyword">set</span> session autocommit <span class="operator">=</span> <span class="keyword">on</span>;</span><br><span class="line">update xxx <span class="keyword">where</span> <span class="keyword">set</span> xx <span class="operator">=</span><span class="number">1</span> ;</span><br><span class="line"><span class="keyword">commit</span>;</span><br></pre></td></tr></table></figure>
<p>结束事务两种方式：rollback     commit</p>
<h2 id="事务并发的三大问题"><a class="markdownIt-Anchor" href="#事务并发的三大问题"></a> 事务并发的三大问题</h2>
<p>数据并发的三大问题其实都是数据库读一致性问题，必须有数据库提供一定的事务隔离机制来解决。</p>
<h3 id="脏读"><a class="markdownIt-Anchor" href="#脏读"></a> 脏读</h3>
<p><img src="/mysql-transcation/image-20201202210510525.png" alt="image-20200727224117281"></p>
<h3 id="不可重复读"><a class="markdownIt-Anchor" href="#不可重复读"></a> 不可重复读</h3>
<p><img src="/mysql-transcation/image-20201202210235089.png" alt="image-20200727224117281"></p>
<h3 id="幻读"><a class="markdownIt-Anchor" href="#幻读"></a> 幻读</h3>
<p><img src="/mysql-transcation/image-20201202210357906.png" alt="image-20200727224117281"></p>
<h2 id="事务隔离级别"><a class="markdownIt-Anchor" href="#事务隔离级别"></a> 事务隔离级别</h2>
<p><a href="http://www.contrib.andrew.cmu.edu/~shadow/sql/sql1992.txt">http://www.contrib.andrew.cmu.edu/~shadow/sql/sql1992.txt</a><br>
<img src="/mysql-transcation/image-20201202210817094.png" alt="image-20200727224117281"><br>
<img src="/mysql-transcation/image-20201202211406282.png" alt="image-20200727224117281"></p>
<p><img src="/mysql-transcation/image-20201202211752764.png" alt="image-20201202211752764"></p>
<h3 id="mvcc思想"><a class="markdownIt-Anchor" href="#mvcc思想"></a> MVCC思想</h3>
<p><img src="/mysql-transcation/image-20201202212103393.png" alt="image-20201202212103393"></p>
<h4 id="read-view一致性试图"><a class="markdownIt-Anchor" href="#read-view一致性试图"></a> Read View（一致性试图）</h4>
<p>存储内容</p>
<p><img src="/mysql-transcation/image-20201202213520136.png" alt="image-20201202213520136"></p>
<h4 id="read-view判断规则"><a class="markdownIt-Anchor" href="#read-view判断规则"></a> Read View判断规则</h4>
<p><img src="/mysql-transcation/image-20201202213757692.png" alt="image-20201202213757692"></p>
<h4 id="rc与rr-read-view-的区别"><a class="markdownIt-Anchor" href="#rc与rr-read-view-的区别"></a> RC与RR read View 的区别</h4>
<p><img src="/mysql-transcation/image-20201202214418001.png" alt="image-20201202214418001"></p>
<p>所以RC解决不了脏读的问题</p>
<h1 id="mysql-innodb所得基本类型"><a class="markdownIt-Anchor" href="#mysql-innodb所得基本类型"></a> Mysql InnoDb所得基本类型</h1>
<p>InnoDB支持行锁</p>
<p>MyiSAM支持行锁</p>
<p>表锁和行锁的区别</p>
<ul>
<li>锁力度：表锁 &gt; 行锁</li>
<li>加锁效率：表锁 &gt; 行锁</li>
<li>冲突概率：表锁 &gt; 行锁</li>
<li>并发性能：表锁 &lt; 行锁</li>
</ul>
<h2 id="表锁"><a class="markdownIt-Anchor" href="#表锁"></a> 表锁</h2>
<p><img src="/mysql-transcation/image-20201202214957559.png" alt="image-20201202214957559"></p>
<p>一个事务能够给一张表加上锁的前提是：没有其他任何一个事务锁定了这张表的任意一行数据。如果没有意向锁的话，那么加表锁需要扫描表中的每行数据，大大的浪费时间；</p>
<p>如果在添加行锁的时候，会在表上添加意向锁，那么在添加表锁的时候就不需要去扫描所有表数据了，只需要看下表上是否由意向锁就可；</p>
<h2 id="行锁"><a class="markdownIt-Anchor" href="#行锁"></a> 行锁</h2>
<h3 id="共享锁shared-locks"><a class="markdownIt-Anchor" href="#共享锁shared-locks"></a> 共享锁shared locks</h3>
<p><img src="/mysql-transcation/image-20201202215350319.png" alt="image-20201202215350319"></p>
<h3 id="排它锁exclusive-locks"><a class="markdownIt-Anchor" href="#排它锁exclusive-locks"></a> 排它锁Exclusive locks</h3>
<p><img src="/mysql-transcation/image-20201202215717524.png" alt="image-20201202215717524"></p>
<h3 id="innodb行锁锁定的是什么"><a class="markdownIt-Anchor" href="#innodb行锁锁定的是什么"></a> Innodb行锁锁定的是什么</h3>
<p>锁定的是index索引，如果表中没有索引，那么Innodb会把隐藏列DB_ROW_ID当作聚集索引</p>
<p>加锁一定要加上条件，不然会锁表</p>
<p><img src="/mysql-transcation/image-20201202222250939.png" alt="image-20201202222250939"></p>
<h3 id="记录锁rcord-lock-锁定记录"><a class="markdownIt-Anchor" href="#记录锁rcord-lock-锁定记录"></a> 记录锁Rcord Lock 锁定记录</h3>
<p><img src="/mysql-transcation/image-20201202222823984.png" alt="image-20201202222823984"></p>
<h3 id="间隙锁gap-lock-锁定范围"><a class="markdownIt-Anchor" href="#间隙锁gap-lock-锁定范围"></a> 间隙锁Gap Lock 锁定范围</h3>
<p>专门用于阻塞插入，间隙锁如果没有命中的话，会锁定最后一个值到正无穷，那么在最后一个值和正无穷之间的插入都不能成功。</p>
<p><img src="/mysql-transcation/image-20201202222914087.png" alt="image-20201202222914087"></p>
<h3 id="临健锁next-key-lock-锁定范围加记录"><a class="markdownIt-Anchor" href="#临健锁next-key-lock-锁定范围加记录"></a> 临健锁Next-key Lock ：锁定范围加记录</h3>
<p><img src="/mysql-transcation/image-20201202223655445.png" alt="image-20201202223655445"></p>
<p><strong>为了解决幻读的问题</strong></p>
<h3 id="事务隔离级别的实现"><a class="markdownIt-Anchor" href="#事务隔离级别的实现"></a> 事务隔离级别的实现</h3>
<p><img src="/mysql-transcation/image-20201202224136052.png" alt="image-20201202224136052"></p>
<h3 id="事务隔离级别的选择"><a class="markdownIt-Anchor" href="#事务隔离级别的选择"></a> 事务隔离级别的选择</h3>
<p><img src="/mysql-transcation/image-20201202224412832.png" alt="image-20201202224412832"></p>
]]></content>
      <categories>
        <category>mysql</category>
      </categories>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title>mysql知识总结</title>
    <url>/mysql/</url>
    <content><![CDATA[<h1 id="mysql-初识"><a class="markdownIt-Anchor" href="#mysql-初识"></a> mysql 初识</h1>
<h2 id="1-版本历史"><a class="markdownIt-Anchor" href="#1-版本历史"></a> 1. 版本历史</h2>
<ul>
<li>1996年 mysql.10发布</li>
<li>1996年10月3.11.1发布</li>
<li>2000年ISAM升级成MyISAM引擎，mysql开源</li>
<li>2003年 Mysql4.0发布集成InnoDB存储引擎</li>
<li>2005年 MySQL 5.0版本发布，提供了试图，存储过程等功能</li>
<li>2010年MySQL5.5发布，InnoDB成为默认的存储引擎</li>
<li>2016年发布8.0.0版本</li>
</ul>
<h2 id="2-流行分支"><a class="markdownIt-Anchor" href="#2-流行分支"></a> 2. 流行分支</h2>
<ul>
<li>Maria DB</li>
<li>Percona Server</li>
</ul>
<h2 id="3-sql-执行流程"><a class="markdownIt-Anchor" href="#3-sql-执行流程"></a> 3. SQL 执行流程</h2>
<h3 id="通信类型"><a class="markdownIt-Anchor" href="#通信类型"></a> 通信类型</h3>
<ul>
<li>同步</li>
<li>异步</li>
</ul>
<h3 id="连接方式"><a class="markdownIt-Anchor" href="#连接方式"></a> 连接方式</h3>
<ul>
<li>长连接</li>
<li>短连接</li>
</ul>
<h3 id="超时时间"><a class="markdownIt-Anchor" href="#超时时间"></a> 超时时间</h3>
<ul>
<li>
<p>非交互式超时时间，如JDBC程序，单位s</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">GLOBAL</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;wait_timeout&#x27;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>交互式超时间，如数据库工具</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">GLOBAL</span> variables <span class="keyword">LIKE</span> <span class="string">&#x27;interactive_timeout&#x27;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="查看连接"><a class="markdownIt-Anchor" href="#查看连接"></a> 查看连接</h3>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">GLOBAL</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;Thread%&#x27;</span></span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th style="text-align:center">连接名称</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Threads_cached</td>
<td style="text-align:center">缓存中的线程</td>
</tr>
<tr>
<td style="text-align:center">Threads_connected</td>
<td style="text-align:center">连接中线程</td>
</tr>
<tr>
<td style="text-align:center">Threads_created</td>
<td style="text-align:center">创建过的线程</td>
</tr>
<tr>
<td style="text-align:center">Threads_running</td>
<td style="text-align:center">正在执行的线程</td>
</tr>
</tbody>
</table>
<h4 id="查看所有的线程"><a class="markdownIt-Anchor" href="#查看所有的线程"></a> 查看所有的线程</h4>
<p>如果是root权限，可以看到所有用户发起的线程，否则只能看到自己的线程</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> processlist</span><br></pre></td></tr></table></figure>
<p><img src="/mysql/image-20200727224117281.png" alt="image-20200727224117281"></p>
<ul>
<li>id ：一个表示，kill一个语句的时候可以使用</li>
<li>user：显示当前用户，如果不是root，这个命令就只显示你权限范围内的sql语句</li>
<li>host：显示这个语句是从哪个ip的端口上发出的，可以用来追踪出问题语句的用户</li>
<li>db：显示这个进程目前连接的是哪个数据库</li>
<li>commmand：显示当年连接的执行命令，一般分为休眠slee、查询query、连接connect</li>
<li>time：此状态持续的时间，单位是秒</li>
<li>state： 显示使用当年连接的sql语句状态，state只是语句执行中的某一个状态，如查询：需要经过copying to tmp table、sorting result、sending data等转台才可以完成</li>
<li>info：显示这个sql语句，因为长度有限，所以长的sql语句就显示不全</li>
</ul>
<h4 id="查看最大连接数"><a class="markdownIt-Anchor" href="#查看最大连接数"></a> 查看最大连接数</h4>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">LIKE</span> <span class="string">&#x27;max_connections&#x27;</span>; <span class="operator">/</span><span class="operator">/</span>一般默认是<span class="number">151</span>，最大可以是<span class="number">2</span>的<span class="number">14</span>次方</span><br></pre></td></tr></table></figure>
<h4 id="mysql变量级别"><a class="markdownIt-Anchor" href="#mysql变量级别"></a> mysql变量级别</h4>
<ul>
<li>
<p>global全局</p>
<figure class="highlight tex"><table><tr><td class="code"><pre><span class="line">在mysql中修改全局变量global有两种方法：</span><br><span class="line">1. 修改my.ini配置文件（永久有效）</span><br><span class="line">2. 在不修改配置文件的基础上，使用关键字global设置全局变量</span><br><span class="line">   set global autocommit = 1;将autocommit变量的值设置为ON，需要注意的是此方法对global全局变量的设计进对于新开启的会话有效，对已开启的会话无效，同理，如果修改回哈session变量，可以使用session关键字，如set session autocommit = 1；这个仅对本session的变量配置有效，对其他的session无效；（在MySQL服务重启之后，数据库的配置重新按照my.ini文件 初始化，global和session 的配置都会失效）</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>session当前会话</p>
</li>
</ul>
<h3 id="通信协议"><a class="markdownIt-Anchor" href="#通信协议"></a> 通信协议</h3>
<ul>
<li>Unix Socket</li>
<li>TCP/IP</li>
<li>Named Pipes命名管道</li>
<li>Share Memory共享内存</li>
</ul>
<h3 id="通信方式"><a class="markdownIt-Anchor" href="#通信方式"></a> 通信方式</h3>
<ul>
<li>单工</li>
<li>半双工</li>
<li>全双工</li>
</ul>
<p><img src="/mysql/image-20200727231112059.png" alt="image-20200727231112059"></p>
<h3 id="mysql-缓存"><a class="markdownIt-Anchor" href="#mysql-缓存"></a> MySQL 缓存</h3>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;query_cache%&#x27;</span></span><br><span class="line">#默认关闭，是因为mysql要保证两次执行的<span class="keyword">sql</span>完全一致，连空格，大小写都一致，而且当数据表中的任何一条数据发生变化，整个缓存会失效；</span><br></pre></td></tr></table></figure>
<p>#2. 删除数据</p>
<h2 id="1-数据删除方式"><a class="markdownIt-Anchor" href="#1-数据删除方式"></a> 1. 数据删除方式</h2>
<ul>
<li>DELETE</li>
<li>Truncate</li>
<li>Drop</li>
</ul>
<h2 id="2-执行速度"><a class="markdownIt-Anchor" href="#2-执行速度"></a> 2. 执行速度</h2>
<p>drop &gt; truncate &gt; delete</p>
<h3 id="21-delete"><a class="markdownIt-Anchor" href="#21-delete"></a> 2.1 DELETE</h3>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> table_name <span class="keyword">WHERE</span> XXX</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>DELETE 数据数据库DML操作语言，只删除数据不删除表的结构，会走事务，执行时会触发trigger</p>
</li>
<li>
<p>在InnoDB中，delete其实并不会真的把数据删除，mysqL实际上只是给删除的数据打个标记为删除，因此delete删除表中的数据，表文件在磁盘所占的控件不会变小，存储控件不会被释放，只是把删除的数据设置为不可见。虽然未释放磁盘控件，但是下次插入数据的时候，仍然可以重用这部分空间（重用-&gt;覆盖）</p>
</li>
<li>
<p>delete执行时，会先把所删除数据缓存到rollback segement中，事务commit之后生效</p>
</li>
<li>
<p><strong>delete from  table_name</strong> 删除表的全部数据对于MyISAM会释放磁盘控件，Innodb不会释放磁盘空间</p>
</li>
<li>
<p>对于<strong>DELETE from table_name where xxx</strong>带条件的删除，不管是Innodb还是MyISAM都不会释放磁盘控件</p>
</li>
<li>
<p>delete 操作以后使用<strong>optimize table  table_name</strong>会里级释放磁盘空间（不管是Innodb还是MyISAM）</p>
  <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">--查看表占用磁盘空间大小</span></span><br><span class="line"><span class="keyword">select</span> concat(round(<span class="built_in">sum</span>(DATA_LENGTH<span class="operator">/</span><span class="number">1024</span><span class="operator">/</span><span class="number">1024</span>),<span class="number">2</span>),<span class="string">&#x27;M&#x27;</span>) <span class="keyword">as</span> table_size</span><br><span class="line"><span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span><span class="string">&#x27;demo_db&#x27;</span> <span class="keyword">AND</span> table_name<span class="operator">=</span><span class="string">&#x27;demo_table&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 执行空间优化语句，以及执行后的表size变化</span></span><br><span class="line">optimize <span class="keyword">table</span> demo_table</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>delete 操作时一行一行执行删除的，并且同时将该行的删除操作日志记录在redo和undo表空间中以便进行回滚（rollback）和重做操作</strong>，生成大量日志也会占用磁盘空间</p>
</li>
</ul>
<h3 id="22-truncate"><a class="markdownIt-Anchor" href="#22-truncate"></a> 2.2 Truncate</h3>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">--删除表数据， 不带where条件</span></span><br><span class="line"><span class="comment">--与不带where的delete ：只删除数据，而不删除表的结构	</span></span><br><span class="line"><span class="keyword">Truncate</span> <span class="keyword">table</span> table_name</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p><strong>Truncate数据数据库DDL定义语言，不走事务，原数据不放到rollback segement中，操作不触发trigger</strong>，执行后里级生效，无法找回；</p>
</li>
<li>
<p><strong>truncate table table_name里级释放磁盘空间不管是Innodb 和MyISAM</strong>；truncate table其实有点类似余drop table然后create，只不过这个crate table的过程做了优化，比如表结构文件之前已经有了等，所以速度上应该是接近drop table的速度</p>
</li>
<li>
<p>truncate 能快速清空一个表，并且重置auto_increment的值</p>
<p>​	但是对于不同的类型存储引擎需要注意的地方是：</p>
<ul>
<li><strong>对于MyISAM</strong>：truncate会重置auto_increment（自增序列）的值为1，而delete后表仍然保持auto_increment。</li>
<li><strong>对于Innodb</strong>：truncate会重置auto_increment（自增序列）的值为1， 而delete后表仍然保持auto_increment。但是在做delete整个表之后重启mysql的话，而重启后的auto_increment会被置为1</li>
</ul>
<p>也就是说，Innodb的表本身是无法持久保存auto_increment。delete表之后auto_increment仍然保存在内存，但是重启后就丢失了，只能从1开始，实质上重启后的auto_increment会从SELETE 1+MAX(ai_col) FROM t开始</p>
</li>
<li>
<p>小心使用 truncate，尤其没有备份的时候，如果误删除线上的表，记得及时联系中国民航，订票电话：400-806-9553</p>
</li>
</ul>
<h3 id="23-drop"><a class="markdownIt-Anchor" href="#23-drop"></a> 2.3 Drop</h3>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 删除表结构以及表数据</span></span><br><span class="line"><span class="keyword">Drop</span> <span class="keyword">table</span> table_name</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p><strong>drop：属于数据库DDL定义语言，同Truncate；</strong></p>
<p><strong>执行后立即生效，无法找回！ 执行后立即生效，无法找回！ 执行后立即生效，无法找回！</strong></p>
</li>
<li>
<p>**drop table table_name 立刻释放磁盘空间 ，不管是 InnoDB 和 MyISAM; **drop 语句将删除表的结构被依赖的约束(constrain)、触发器(trigger)、索引(index); 依赖于该表的存储过程/函数将保留,但是变为 invalid 状态。</p>
</li>
<li>
<p>小心使用 drop ，要删表跑路的兄弟，请在订票成功后在执行操作！订票电话：400-806-9553</p>
</li>
</ul>
<h2 id="3-总结"><a class="markdownIt-Anchor" href="#3-总结"></a> 3. 总结</h2>
<p><strong>可以这么理解，一本书，delete是把目录撕了，truncate是把书的内容撕下来烧了，drop是把书烧了</strong></p>
]]></content>
      <categories>
        <category>mysql</category>
      </categories>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title>mysql数据库锁</title>
    <url>/mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E9%94%81/</url>
    <content><![CDATA[<p>当数据库有事物的时候，可能会产生数据的不一致，这时就需要一些机制来保证访问的次序，这就是锁的机制；<br>
<strong>锁的作用</strong>：用于挂你对共享资源的并发访问，保证数据库的完整性和一致性。<br>
##1. 不同引擎的锁以及锁分类<br>
<strong>Mysql数据库中，InnoDB支持表、行级锁，而MyISAM支持表级锁</strong><br>
<br><br>
Mysql大致可以归纳为以下3种锁：</p>
<ul>
<li>表级锁：开销小，加锁块，不会出现死锁，发生锁冲突的概率最高，并发度最低。</li>
<li>行级锁：开销大，加锁慢，会出现死锁，发生锁冲突的概率最低，并发度最高。</li>
<li>页面锁：开销和加锁的时间介于表级锁和行级锁之间，会出现死锁，锁粒度介于两者之间；并发度一般，一次锁定相邻一组记录</li>
</ul>
<p>Mysql表级锁两种模式: <strong>表共享锁（Table Read Lock）和 表独占写锁（Table Write Lock）</strong>，表现如下：</p>
<ul>
<li>对一个表的读操作，不会阻塞其他用户对同一表请求，但会阻塞对同一表的写请求；</li>
<li>对MyISAM的写操作，则会则色其他用户对同一表的读和写操作；</li>
<li>MyISAM表的读操作和写操作之间，以及写操作之间是串行的。<br>
当一个线程获得对一个表的写锁后，只有持有锁的线程可以对表进行更新操作，其他线程的读、写操作都会等待。</li>
</ul>
<p>##2.加表级锁<br>
MyISAM在执行查询语句（SELECT）前，会自动给涉及的所有表加读锁，在执行更新操作（UPDATE、DELETE、INSERT等）前，会自动给涉及的表加写锁，这个过程并不需要用户干预，因此用户一般不需要直接用LOCK TABLE命令给MyISAM表显式加锁。<br>
给MyISAM表显式加锁，一般是为了一定程度模拟事务操作，实现对某一时间点多个表的一致性读取。例如，有一个订单表orders，其中记录有订单的总金额total，同时还有一个订单明细表order_detail，其中记录有订单每一产品的金额小计subtotal，假设我们需要检查这两个表的金额合计是否相等，可能就需要执行如下两条SQL</p>
]]></content>
      <categories>
        <category>mysql</category>
      </categories>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title>Java内存泄漏排查</title>
    <url>/outOfMemoryError/</url>
    <content><![CDATA[<h2 id="1内存溢出"><a class="markdownIt-Anchor" href="#1内存溢出"></a> 1.内存溢出</h2>
<p>java.lang.OutOfMemoryError：是指程序在申请内存是，没有足够的内存克难攻坚供其使用，出现OutOfMemoryError</p>
<ol>
<li>
<p>产生原因</p>
<ul>
<li>JMM内存过小</li>
<li>程序不严谨，产生了过多的垃圾</li>
</ul>
</li>
<li>
<p>具体表现在以下集中情况</p>
<ul>
<li>内存中加载的数据量过于庞大，如一次从数据库取出过多的数据</li>
<li>集合类中有对对象的引用，使用完后未清空，使得JVM不能回收</li>
<li>代码中存在死循环或循环过多产生过多重复的对象实体</li>
<li>使用第三方软件的bug</li>
<li>启动参数内存值设定过小</li>
</ul>
</li>
<li>
<p>常见错误提示</p>
<ul>
<li>tomcat:java.lang.OutOfMemoryError: PermGen space</li>
<li>tomcat:java.lang.OutOfMemoryError: Java heap space</li>
<li>weblogic:Root cause of ServletException java.lang.OutOfMemoryError</li>
<li>resin:java.lang.OutOfMemoryError</li>
<li>java:java.lang.OutOfMemoryError</li>
</ul>
</li>
<li>
<p>解决方法</p>
<ul>
<li>增加JVM的内存大小<br>
对于tomcat容器，找到tomcat在电脑中的安装目录，进入这个目录，然后进入bin目录中，在window环境下找到bin目录中的catalina.bat，<a href="http://xn--linuxcatalina-t40uj69bkxsyifbo6cbj6d.sh">在linux环境下找到catalina.sh</a>。<br>
编辑catalina.bat文件，找到JAVA_OPTS（具体来说是 set “JAVA_OPTS=%JAVA_OPTS% %LOGGING_MANAGER%”）这个选项的位置，这个参数是Java启动的时候，需要的启动参数。<br>
也可以在操作系统的环境变量中对JAVA_OPTS进行设置，因为tomcat在启动的时候，也会读取操作系统中的环境变量的值，进行加载。<br>
如果是修改了操作系统的环境变量，需要重启机器，再重启tomcat，如果修改的是tomcat配置文件，需要将配置文件保存，然后重启tomcat，设置就能生效了</li>
<li>优化程序，释放垃圾<br>
主要思路就是避免程序体现上出现的情况。避免死循环，防止一次载入太多的数据，提高程序健壮型及时释放。因此，从根本上解决Java内存溢出的唯一方法就是修改程序，及时地释放没用的对象，释放内存空间</li>
</ul>
</li>
</ol>
<h2 id="2-内存泄漏"><a class="markdownIt-Anchor" href="#2-内存泄漏"></a> 2. 内存泄漏</h2>
<p>Memory Leak，是指程序在申请内存后，无法释放已申请的内存空间，一次内存泄露危害可以忽略，但内存泄露堆积后果很严重，无论多少内存，迟早会被占光。<br>
在Java中，内存泄漏就是存在一些被分配的对象，这些对象有下面两个特点：<br>
1）首先，这些对象是可达的，即在有向图中，存在通路可以与其相连；<br>
2）其次，这些对象是无用的，即程序以后不会再使用这些对象。<br>
如果对象满足这两个条件，这些对象就可以判定为Java中的内存泄漏，这些对象不会被GC所回收，然而它却占用内存。<br>
关于内存泄露的处理页就是提高程序的健壮型，因为内存泄露是纯代码层面的问题</p>
<h2 id="3内存溢出和内存泄漏的联系"><a class="markdownIt-Anchor" href="#3内存溢出和内存泄漏的联系"></a> 3.内存溢出和内存泄漏的联系</h2>
<p>内存泄露会最终会导致内存溢出。<br>
<strong>相同点</strong>：都会导致应用程序运行出现问题，性能下降或挂起。<br>
<strong>不同点</strong>：<br>
1) 内存泄露是导致内存溢出的原因之一，内存泄露积累起来将导致内存溢出。<br>
2) 内存泄露可以通过完善代码来避免，内存溢出可以通过调整配置来减少发生频率，但无法彻底避免。</p>
<h2 id="4排查案例"><a class="markdownIt-Anchor" href="#4排查案例"></a> 4.排查案例</h2>
<p>Java的内存泄露多半是因为对象存在无效的引用，对象得不到释放，如果发现Java应用程序占用的内存出现了泄露的迹象，那么我们一般采用下面的步骤分析：</p>
<ol>
<li>用工具生成java应用程序的heap dump（如jmap）</li>
<li>使用Java heap分析工具（如MAT），找出内存占用超出预期的嫌疑对象</li>
<li>根据情况，分析嫌疑对象和其他对象的引用关系。</li>
<li>分析程序的源代码，找出嫌疑对象数量过多的原因。</li>
</ol>
<p>实际操作如下：<br>
1.登录linux服务器，获取tomcat的pid</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ps -ef|grep java</span><br></pre></td></tr></table></figure>
<p>2.利用jmap初步分析内存映射</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">jmap -histo:live pid | head -7</span><br></pre></td></tr></table></figure>
<p><img src="/outOfMemoryError/01.png" alt="jmap"><br>
第2行是我们业务系统的对象，通过这个对象的引用可以初步分析出到底是哪里出现了引用未被垃圾回收收集，通知开发人员优化相关代码</p>
<p>3.如果上面一步还无法定位到关键信息，那么需要拿到heap dump，生成离线文件，做进一步分析</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">jmap -dump:live,format=b,file=heap.hprof 3514 </span><br></pre></td></tr></table></figure>
<p><img src="/outOfMemoryError/02.png" alt="jmap"><br>
4. 拿到heap dump文件，利用eclipse插件MAT来分析heap profile。</p>
<ul>
<li>1.安装MAT插件</li>
<li>2.在eclipse里切换到Memory Analysis视图</li>
<li>3.用MAT打开heap profile文件。<br>
<img src="/outOfMemoryError/03.png" alt="jmap"><br>
直接看到下面Action窗口，有4种Action来分析heap profile，介绍其中最常用的2种:</li>
<li><strong>Histogram</strong>：这个使用的最多，跟上面的jmap -histo 命令类似，只是在MAT里面可以用GUI来展示应用系统各个类产生的实例。<br>
<img src="/outOfMemoryError/04.png" alt="jmap"><br>
Shllow Heap排序后发现 Cms_Organization 这个类占用的内存比较多（没有得到及时GC），查看引用<br>
<img src="/outOfMemoryError/05.png" alt="jmap"><br>
分析引用栈，找到无效引用，打开源码<br>
<img src="/outOfMemoryError/06.png" alt="jmap"><br>
<strong>查看源码！！！</strong></li>
</ul>
]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>内存溢出</tag>
      </tags>
  </entry>
  <entry>
    <title>redis常见使用场景</title>
    <url>/redis-usage-scenario/</url>
    <content><![CDATA[<h2 id="1-缓存"><a class="markdownIt-Anchor" href="#1-缓存"></a> 1. 缓存</h2>
<p>String类型<br>
例如：热点数据缓存、对象缓存、全页缓存可以提升热点数据的访问效率</p>
<h2 id="2-数据共享分布式"><a class="markdownIt-Anchor" href="#2-数据共享分布式"></a> 2. 数据共享分布式</h2>
<p>String类型，因为redis是分布式的独立服务，可以在多个应用服务之间共享，例如分布式session</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.session<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-session-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="3-分布式锁"><a class="markdownIt-Anchor" href="#3-分布式锁"></a> 3. 分布式锁</h2>
<p>String类型 setnx方法，只有不存在时才能添加成功返回true</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">getLock</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">    Long flag = jedis.setnx(key, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (flag == <span class="number">1</span>) &#123;</span><br><span class="line">        jedis.expire(key, <span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> flag == <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">releaseLock</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">    jedis.del(key);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="4-全局id"><a class="markdownIt-Anchor" href="#4-全局id"></a> 4. 全局ID</h2>
<p>int 类型， incrby, 利用原子性</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">incrby userid 1000</span><br></pre></td></tr></table></figure>
<p>分库分表的场景，一次性拿一段。</p>
<h2 id="5-计数器"><a class="markdownIt-Anchor" href="#5-计数器"></a> 5. 计数器</h2>
<p>int 类型，incr方法<br>
例如：文章的阅读量、微博点赞数；允许一定的延迟，先写入redis在定时同步到数据库</p>
<ol>
<li>第一种方法</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestService</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    RedisTemplate&lt;String,Object&gt; redisTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Resource(name=&quot;redisTemplate&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> ValueOperations&lt;String,Object&gt; ops;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">testRedis</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//此方法会先检查key是否存在，存在+1，不存在先初始化，再+1</span></span><br><span class="line">            ops.increment(<span class="string">&quot;success&quot;</span>, <span class="number">1</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//return (int) ops.get(&quot;success&quot;); //使用这个会出现错误，报错信息 Caused by: org.springframework.core.serializer.support.SerializationFailedException: Failed to deserialize payload. Is the byte array a result of corresponding serialization for DefaultDeserializer?; nested exception is java.io.EOFException。</span></span><br><span class="line">            <span class="keyword">return</span> Integer.valueOf(redisTemplate.boundValueOps(<span class="string">&quot;success&quot;</span>).get(<span class="number">0</span>, -<span class="number">1</span>));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> handle exception</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>第二种方法</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestService</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    RedisTemplate&lt;String,Object&gt; redisTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Resource(name=&quot;redisTemplate&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> ValueOperations&lt;String,Object&gt; ops;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">testRedis</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//此方法会先检查key是否存在，存在+1，不存在先初始化，再+1</span></span><br><span class="line">            ops.increment(<span class="string">&quot;success&quot;</span>, <span class="number">1</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//return (int) ops.get(&quot;success&quot;);</span></span><br><span class="line">            <span class="comment">//return Integer.valueOf(redisTemplate.boundValueOps(&quot;success&quot;).get(0, -1));</span></span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">int</span>) getKey(<span class="string">&quot;success&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> handle exception</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getKey</span><span class="params">(<span class="keyword">final</span> String key)</span> </span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> redisTemplate.execute(<span class="keyword">new</span> RedisCallback&lt;Long&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Long <span class="title">doInRedis</span><span class="params">(RedisConnection connection)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">                </span><br><span class="line">                RedisSerializer&lt;String&gt; redisSerializer = redisTemplate.getStringSerializer();</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">byte</span>[] rowkey = redisSerializer.serialize(key);</span><br><span class="line">                <span class="keyword">byte</span>[] rowval = connection.get(rowkey);</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    String val = redisSerializer.deserialize(rowval);</span><br><span class="line">                    <span class="keyword">return</span> Long.parseLong(val);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">0L</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>设置每天零点过期，重新计数</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//当天时间</span></span><br><span class="line">Date date = <span class="keyword">new</span> Date();</span><br><span class="line"><span class="comment">//当天零点</span></span><br><span class="line">date = DateUtils.truncate(date, Calendar.DAY_OF_MONTH);</span><br><span class="line"><span class="comment">//第二天零点</span></span><br><span class="line">date = DateUtils.addDays(date, +<span class="number">1</span>);</span><br><span class="line">redisTemplate.expireAt(<span class="string">&quot;success&quot;</span>, date);</span><br></pre></td></tr></table></figure>
<h2 id="6-限流"><a class="markdownIt-Anchor" href="#6-限流"></a> 6. 限流</h2>
<p>int类型，incr方法<br>
以访问者的IP和其他信息作为key,访问一次增加一次次数，超过次数 则返回false</p>
<h2 id="7-位统计"><a class="markdownIt-Anchor" href="#7-位统计"></a> 7. 位统计</h2>
<p>String类型的bitcount<br>
字符是以8位二进制存储的</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">set k1 a</span><br><span class="line">setbit k1 6 1</span><br><span class="line">setbit k1 7 0</span><br><span class="line">get k1 </span><br><span class="line">/* 6 7 代表的a的二进制位的修改</span><br><span class="line"></span><br><span class="line">a 对应的ASCII码是97，转换为二进制数据是01100001</span><br><span class="line">b 对应的ASCII码是98，转换为二进制数据是01100010</span><br><span class="line"></span><br><span class="line">因为bit非常节省空间（1 MB=8388608 bit），可以用来做大数据量的统计。</span><br><span class="line">*/</span><br></pre></td></tr></table></figure>
<p>例如：在线用户统计，留存用户统计</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">setbit onlineusers 01 </span><br><span class="line">setbit onlineusers 11 </span><br><span class="line">setbit onlineusers 20</span><br></pre></td></tr></table></figure>
<p>支持按位与、按位或等等操作</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">BITOPANDdestkeykey[key...] ，对一个或多个 key 求逻辑并，并将结果保存到 destkey 。       </span><br><span class="line">BITOPORdestkeykey[key...] ，对一个或多个 key 求逻辑或，并将结果保存到 destkey 。 </span><br><span class="line">BITOPXORdestkeykey[key...] ，对一个或多个 key 求逻辑异或，并将结果保存到 destkey 。 </span><br><span class="line">BITOPNOTdestkeykey ，对给定 key 求逻辑非，并将结果保存到 destkey 。</span><br></pre></td></tr></table></figure>
<p>计算出7天都在线的用户</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">BITOP &quot;AND&quot; &quot;7_days_both_online_users&quot; &quot;day_1_online_users&quot; &quot;day_2_online_users&quot; ...  &quot;day_7_online_users&quot;</span><br></pre></td></tr></table></figure>
<h2 id="8-购物车"><a class="markdownIt-Anchor" href="#8-购物车"></a> 8. 购物车</h2>
<p>String 或hash。所有String可以做的hash都可以<br>
hash类型是一个String类型的field和value的映射表，每个hash都可以存储2^32 -1键值对<br>
<strong>使用hash做购物车：以用户id为key, 商品id为field，商品数量为value。</strong><br>
<img src="/redis-usage-scenario/01.png" alt></p>
<h2 id="9-用户消息时间线timeline"><a class="markdownIt-Anchor" href="#9-用户消息时间线timeline"></a> 9. 用户消息时间线timeline</h2>
<p>list，双向链表，直接作为timeline就好了。插入有序</p>
<h2 id="10-消息队列"><a class="markdownIt-Anchor" href="#10-消息队列"></a> 10. 消息队列</h2>
<p>List提供了两个阻塞的弹出操作：blpop/brpop，可以设置超时时间</p>
<ul>
<li>
<p>blpop：blpop key1 timeout 移除并获取列表的第一个元素，如果列表没有元素会阻塞列表直到等待超时或发现可弹出元素为止。</p>
</li>
<li>
<p>brpop：brpop key1 timeout 移除并获取列表的最后一个元素，如果列表没有元素会阻塞列表直到等待超时或发现可弹出元素为止。<br>
上面的操作。其实就是java的阻塞队列。学习的东西越多。学习成本越低</p>
</li>
<li>
<p>队列：先进先除：rpush blpop，左头右尾，右边进入队列，左边出队列</p>
</li>
<li>
<p>栈：先进后出：rpush brpop</p>
</li>
</ul>
<h2 id="11-抽奖"><a class="markdownIt-Anchor" href="#11-抽奖"></a> 11. 抽奖</h2>
<p>自带一个随机获得值</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">spop myset</span><br></pre></td></tr></table></figure>
<h2 id="12-点赞-签到-打卡"><a class="markdownIt-Anchor" href="#12-点赞-签到-打卡"></a> 12. 点赞、签到、打卡</h2>
<p><img src="/redis-usage-scenario/02.png" alt="点赞、签到、打卡"><br>
假如上面的微博ID是t1001，用户ID是u3001</p>
<p>用 like:t1001 来维护 t1001 这条微博的所有点赞用户</p>
<ul>
<li>点赞了这条微博：sadd like:t1001 u3001</li>
<li>取消点赞：srem like:t1001 u3001</li>
<li>是否点赞：sismember like:t1001 u3001</li>
<li>点赞的所有用户：smembers like:t1001</li>
<li>点赞数：scard like:t1001</li>
</ul>
<h2 id="13-商品标签"><a class="markdownIt-Anchor" href="#13-商品标签"></a> 13. 商品标签</h2>
<p><img src="/redis-usage-scenario/03.png" alt="商品标签"><br>
用 tags:i5001 来维护商品所有的标签。</p>
<ul>
<li>sadd tags:i5001 画面清晰细腻</li>
<li>sadd tags:i5001 真彩清晰显示屏</li>
<li>sadd tags:i5001 流程至极</li>
</ul>
<h2 id="14商品筛选"><a class="markdownIt-Anchor" href="#14商品筛选"></a> 14.商品筛选</h2>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">// 获取差集</span><br><span class="line">sdiff set1 set2</span><br><span class="line">// 获取交集（intersection ）</span><br><span class="line">sinter set1 set2</span><br><span class="line">// 获取并集</span><br><span class="line">sunion set1 set2</span><br></pre></td></tr></table></figure>
<p><img src="/redis-usage-scenario/04.png" alt="商品筛选"></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sadd brand:apple iPhone11</span><br><span class="line"></span><br><span class="line">sadd brand:ios iPhone11</span><br><span class="line"></span><br><span class="line">sad screensize:6.0-6.24 iPhone11</span><br><span class="line"></span><br><span class="line">sad screentype:lcd iPhone 11</span><br></pre></td></tr></table></figure>
<p>筛选商品，苹果的、ios的、屏幕在6.0-6.24之间的，屏幕材质是LCD屏幕</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sinter brand:apple brand:ios screensize:6.0-6.24 screentype:lcd</span><br></pre></td></tr></table></figure>
<h2 id="15-用户关注-推荐模型"><a class="markdownIt-Anchor" href="#15-用户关注-推荐模型"></a> 15. 用户关注、推荐模型</h2>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># follow 关注 fans 粉丝</span></span></span><br><span class="line">sadd 1:follow 2</span><br><span class="line">sadd 2:fans 1</span><br><span class="line">sadd 1:fans 2</span><br><span class="line">sadd 2:follow 1</span><br></pre></td></tr></table></figure>
<p>我关注的人也关注了他(取交集)：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sinter 1:follow 2:fans</span><br></pre></td></tr></table></figure>
<p>可能认识的人：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 用户1可能认识的人(差集)：</span></span></span><br><span class="line">sdiff 2:follow 1:follow</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 用户2可能认识的人：</span></span></span><br><span class="line">sdiff 1:follow 2:follow</span><br></pre></td></tr></table></figure>
<h2 id="16-排行榜"><a class="markdownIt-Anchor" href="#16-排行榜"></a> 16. 排行榜</h2>
<p>id 为6001 的新闻点击数加1：zincrby hotNews:20190926 1 n6001<br>
获取今天点击最多的15条：zrevrange hotNews:20190926 0 15 withscores<br>
<img src="/redis-usage-scenario/05.png" alt="排行榜"></p>
<hr>
<p><img src="/redis-usage-scenario/06.png" alt></p>
<h2 id="redis不适用的场景"><a class="markdownIt-Anchor" href="#redis不适用的场景"></a> redis不适用的场景</h2>
<p>Redis是一种缓存技术，主要用来提高应用的性能，更多的应用场景是对数据库读数据进行缓存，减轻数据库的IO的访问压力，以下场景不太适合使用Redis:</p>
<ul>
<li>
<p>数据规模大小角度</p>
<p>Redis是将数据放在内存进行缓存的，内存相对于磁盘来锁价格是比较贵的。<strong>如果成本是需要考虑的重要因素，那么大规模的数据就不太适合</strong>；</p>
</li>
<li>
<p>数据冷热程度角度</p>
<p>很多业务数据可以根据数据读的频繁程度分为热数据和冷数据；<strong>频繁使用的热数据一般适合用redis，冷数据一般不太适合用redis</strong>,如果大量的冷数据进行了缓存，那是对内存资源的浪费，<br>
所以在应用场景上区分冷热数据，将热数据放在内存中，进而提高性能。</p>
</li>
</ul>
]]></content>
      <categories>
        <category>中间件</category>
      </categories>
      <tags>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux环境下安装Redis</title>
    <url>/redis_install/</url>
    <content><![CDATA[<h5 id="1-安装gcc"><a class="markdownIt-Anchor" href="#1-安装gcc"></a> 1. 安装gcc</h5>
   <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum -y install gcc gcc-c++</span><br></pre></td></tr></table></figure>
<h5 id="2-下载安装包"><a class="markdownIt-Anchor" href="#2-下载安装包"></a> 2. 下载安装包</h5>
   <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget http://download.redis.io/redis-stable.tar.gz </span><br></pre></td></tr></table></figure>
<h5 id="3-解压"><a class="markdownIt-Anchor" href="#3-解压"></a> 3. 解压</h5>
   <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">tar xvzf redis-stable.tar.gz</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">移动redis目录，一般都会将redis目录放置到 /usr/<span class="built_in">local</span>/redis目录</span></span><br><span class="line">mv redis-6.2.6 /usr/local/redis</span><br></pre></td></tr></table></figure>
<h5 id="4-编译"><a class="markdownIt-Anchor" href="#4-编译"></a> 4. 编译</h5>
   <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /usr/local/redis</span><br><span class="line">make</span><br><span class="line"><span class="meta">#</span><span class="bash"> 如果执行make命令报错：cc 未找到命令，原因是虚拟机系统中缺少gcc，执行下面命令安装gcc：yum -y install gcc automake autoconf libtool make</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">如果使用make失败，致命错误:jemalloc/jemalloc.h: 没有那个文件或目录，则需要在make指定分配器为libc make MALLOC=libc</span></span><br><span class="line">//make之后如果出现Hint: To run &#x27;make test&#x27; is a good idea ;</span><br><span class="line">//运行make test, 会提示需要安装tcl,执行yum install tcl</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">执行下面命令安装redis，并指定安装目录</span></span><br><span class="line">make install PREFIX=/usr/local/redis</span><br></pre></td></tr></table></figure>
<h5 id="5-配置密码以及允许外网ip访问"><a class="markdownIt-Anchor" href="#5-配置密码以及允许外网ip访问"></a> 5. 配置密码以及允许外网ip访问</h5>
   <figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment">#在redis.conf中配置requirepass 密码以及port端口号（非必须）</span></span><br><span class="line"><span class="attr">requirepass</span> <span class="string">xxx</span></span><br><span class="line"><span class="attr">port</span> <span class="string">6379 </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#开启redis允许外网ip访问，在 Linux 中安装了redis 服务，当在客户端通过远程连接的方式连接时，报could not connect错误。错误的原因为：redis采用的安全策略，默认会只准许本地访问。</span></span><br><span class="line"><span class="comment">#将所有的bing信息全部屏蔽</span></span><br><span class="line"><span class="comment">#bind 192.168.1.100 10.0.0.1</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#配置redis后台启动，如果不配置的话可以使用hohup启动</span></span><br><span class="line"><span class="attr">daemonize</span> <span class="string">yes</span></span><br></pre></td></tr></table></figure>
<h5 id="6-启动redis服务"><a class="markdownIt-Anchor" href="#6-启动redis服务"></a> 6. 启动redis服务</h5>
   <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd ./src</span><br><span class="line">nohup ./redis-server ../redis.conf &amp;</span><br></pre></td></tr></table></figure>
<h5 id="7-查看redis进程"><a class="markdownIt-Anchor" href="#7-查看redis进程"></a> 7. 查看redis进程</h5>
   <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost redis]# pstree</span><br></pre></td></tr></table></figure>
<p><img src="/redis_install/image-20201201155441018.png" alt="image-20201210103251475"></p>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title>springboot读取yml配置的方式</title>
    <url>/springboot-yml/</url>
    <content><![CDATA[<p>springboot项目中默认的配置文件是application.properties；</p>
<h3 id="1yml文件规则"><a class="markdownIt-Anchor" href="#1yml文件规则"></a> 1.yml文件规则</h3>
<ul>
<li>树状结构，结构清晰</li>
<li>不支持tab缩进</li>
<li>可以使用&quot;_“或”-&quot;消协字母代替大写字母；如userName 与user-name， user_name含义是一样的（宽松绑定原则 relaxed binding）; key: value格式书写，value前面有个空格</li>
</ul>
<h3 id="2-数据格式"><a class="markdownIt-Anchor" href="#2-数据格式"></a> 2. 数据格式</h3>
<ul>
<li>
<p>普通的值（数字，字符串，布尔）如：</p>
  <figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">port:</span> <span class="number">123</span>      </span><br><span class="line"><span class="attr">name:</span> <span class="string">abc</span>      </span><br><span class="line"><span class="attr">flag:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>字符串默认不用加上单引号或者双引号；</p>
<p>“”：双引号；不会转义字符串里面的特殊字符；特殊字符会作为本身想表示的意思,name: “zhangsan \n lisi”：输出；zhangsan 换行 lisi</p>
<p>‘’：单引号；会转义特殊字符，特殊字符最终只是一个普通的字符串数据,name: ‘zhangsan \n lisi’：输出；zhangsan \n lisi</p>
</li>
<li>
<p>对象、Map(属性和值)如：</p>
  <figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment">#k: v：在下一行来写对象的属性和值的关系；注意缩进(不支持tab,使用空格)</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8123</span></span><br><span class="line">  <span class="attr">tomcat:</span></span><br><span class="line">    <span class="attr">uri-encoding:</span> <span class="string">utf-8</span></span><br><span class="line">  <span class="attr">servlet:</span></span><br><span class="line">    <span class="attr">context-path:</span> <span class="string">/app</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>数组（list， set）</p>
  <figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment">#用- 值表示数组中的一个元素</span></span><br><span class="line"><span class="attr">hands:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">left</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">right</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="3-读取方式"><a class="markdownIt-Anchor" href="#3-读取方式"></a> 3. 读取方式</h3>
<ol>
<li>
<p>@Value注解</p>
 <figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8081</span></span><br></pre></td></tr></table></figure>
 <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Value(&quot;$&#123;server.port&#125;&quot;)</span><br><span class="line">public String port;</span><br></pre></td></tr></table></figure>
<p>此处的port所在的类需要是一个组件,如果是实体类需要加上@Component</p>
</li>
<li>
<p>@ConfigurationProperties</p>
<p>需要一个JavaBean 来专门映射配置的话,我们一般会使用@ConfigurationProperties来读取.</p>
<p>使用的使用需要@EnableConfigurationProperties注解让类被springboot扫描到；</p>
 <figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">druid:</span></span><br><span class="line">      <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3307/app?useUnicode=yes&amp;characterEncoding=UTF-8&amp;useSSL=false&amp;serverTimezone=GMT%2B8&amp;useLegacyDatetimeCode=false</span></span><br><span class="line">      <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">root</span></span><br></pre></td></tr></table></figure>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//prefix 指定前缀</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;spring.datasource&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDataSourceProperties</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line">    <span class="keyword">private</span> String driverClassName;</span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="comment">//省略getter setter方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>前缀定义了哪些外部属性将绑定到类的字段上</li>
<li>根据 Spring Boot 宽松的绑定规则，类的属性名称必须与外部属性的名称匹配</li>
<li>我们可以简单地用一个值初始化一个字段来定义一个默认值</li>
<li>类本身可以是包私有的</li>
<li>类的字段必须有公共 setter 方法</li>
</ul>
</li>
<li>
<p>Environment</p>
<p>Spring Environment bean</p>
 <figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">@RestController</span></span><br><span class="line"><span class="string">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line"><span class="string">public</span> <span class="string">class</span> <span class="string">TestC</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="string">@Autowired</span></span><br><span class="line">    <span class="string">private</span> <span class="string">Environment</span> <span class="string">env;</span></span><br><span class="line"></span><br><span class="line">    <span class="string">@RequestMapping(value</span> <span class="string">=</span> <span class="string">&quot;index&quot;</span>, <span class="string">method</span> <span class="string">=</span> <span class="string">RequestMethod.GET)</span></span><br><span class="line">    <span class="string">public</span> <span class="string">String</span> <span class="string">index()</span> &#123;</span><br><span class="line">        <span class="string">return</span> <span class="string">&quot;environment : &quot;</span><span class="string">+</span> <span class="string">env.getProperty(&quot;spring.datasource.druid.url&quot;);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>springboot</tag>
      </tags>
  </entry>
  <entry>
    <title>常见sql优化方式</title>
    <url>/sql-01/</url>
    <content><![CDATA[<ol>
<li>
<p>对查询进行优化，应尽量避免全表扫描，首先应考虑在 where 及 order by 涉及的列上建立索引。</p>
</li>
<li>
<p>应尽量避免在 where 子句中对字段进行 null 值判断，否则将导致引擎放弃使用索引而进行全表扫描，如：</p>
 <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> id <span class="keyword">from</span> t <span class="keyword">where</span> num <span class="keyword">is</span> <span class="keyword">null</span>    </span><br><span class="line"><span class="comment">-- 可以在num上设置默认值0，确保表中num列没有null值，然后这样查询：    </span></span><br><span class="line"><span class="keyword">select</span> id <span class="keyword">from</span> t <span class="keyword">where</span> num<span class="operator">=</span><span class="number">0</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>应尽量避免在 where 子句中使用!=或&lt;&gt;操作符，否则将引擎放弃使用索引而进行全表扫描。</p>
</li>
<li>
<p>应尽量避免在 where 子句中使用 or 来连接条件，否则将导致引擎放弃使用索引而进行全表扫描，如：</p>
 <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> id <span class="keyword">from</span> t <span class="keyword">where</span> num<span class="operator">=</span><span class="number">10</span> <span class="keyword">or</span> num<span class="operator">=</span><span class="number">20</span>    </span><br><span class="line"><span class="comment">--可以这样查询：    </span></span><br><span class="line"><span class="keyword">select</span> id <span class="keyword">from</span> t <span class="keyword">where</span> num<span class="operator">=</span><span class="number">10</span>    </span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span>    </span><br><span class="line"><span class="keyword">select</span> id <span class="keyword">from</span> t <span class="keyword">where</span> num<span class="operator">=</span><span class="number">20</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>in 和 not in 也要慎用，否则会导致全表扫描，如：</p>
 <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> id <span class="keyword">from</span> t <span class="keyword">where</span> num <span class="keyword">in</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)    </span><br><span class="line"><span class="comment">--对于连续的数值，能用 between 就不要用 in 了：    </span></span><br><span class="line"><span class="keyword">select</span> id <span class="keyword">from</span> t <span class="keyword">where</span> num <span class="keyword">between</span> <span class="number">1</span> <span class="keyword">and</span> <span class="number">3</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>下面的查询也将导致全表扫描：</p>
 <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> id <span class="keyword">from</span> t <span class="keyword">where</span> name <span class="keyword">like</span> <span class="string">&#x27;%abc%&#x27;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>应尽量避免在 where 子句中对字段进行表达式操作，这将导致引擎放弃使用索引而进行全表扫描。如：</p>
 <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> id <span class="keyword">from</span> t <span class="keyword">where</span> num<span class="operator">/</span><span class="number">2</span><span class="operator">=</span><span class="number">100</span>    </span><br><span class="line"><span class="comment">---应改为:    </span></span><br><span class="line"><span class="keyword">select</span> id <span class="keyword">from</span> t <span class="keyword">where</span> num<span class="operator">=</span><span class="number">100</span><span class="operator">*</span><span class="number">2</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>应尽量避免在where子句中对字段进行函数操作，这将导致引擎放弃使用索引而进行全表扫描。如：</p>
 <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> id <span class="keyword">from</span> t <span class="keyword">where</span> <span class="built_in">substring</span>(name,<span class="number">1</span>,<span class="number">3</span>)<span class="operator">=</span><span class="string">&#x27;abc&#x27;</span><span class="comment">--name以abc开头的id    </span></span><br><span class="line"><span class="comment">---应改为:    </span></span><br><span class="line"><span class="keyword">select</span> id <span class="keyword">from</span> t <span class="keyword">where</span> name <span class="keyword">like</span> <span class="string">&#x27;abc%&#x27;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>不要在 where 子句中的“=”左边进行函数、算术运算或其他表达式运算，否则系统将可能无法正确使用索引。</p>
</li>
<li>
<p>在使用索引字段作为条件时，如果该索引是复合索引，那么必须使用到该索引中的第一个字段作为条件时才能保证系统使用该索引，否则该索引将不会被使用，并且应尽可能的让字段顺序与索引顺序相一致。</p>
</li>
<li>
<p>不要写一些没有意义的查询，如需要生成一个空表结构：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> col1,col2 <span class="keyword">into</span> #t <span class="keyword">from</span> t <span class="keyword">where</span> <span class="number">1</span><span class="operator">=</span><span class="number">0</span>    </span><br><span class="line"><span class="comment">--这类代码不会返回任何结果集，但是会消耗系统资源的，应改成这样：    </span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> #t(...)</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>很多时候用 exists 代替 in 是一个好的选择：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> num <span class="keyword">from</span> a <span class="keyword">where</span> num <span class="keyword">in</span>(<span class="keyword">select</span> num <span class="keyword">from</span> b)    </span><br><span class="line"><span class="comment">--用下面的语句替换：    </span></span><br><span class="line"><span class="keyword">select</span> num <span class="keyword">from</span> a <span class="keyword">where</span> <span class="keyword">exists</span>(<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> b <span class="keyword">where</span> num<span class="operator">=</span>a.num)</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>并不是所有索引对查询都有效，SQL是根据表中数据来进行查询优化的，当索引列有大量数据重复时，SQL查询可能不会去利用索引，如一表中有字段sex，male、female几乎各一半，那么即使在sex上建了索引也对查询效率起不了作用。</p>
</li>
<li>
<p>索引并不是越多越好，索引固然可以提高相应的 select 的效率，但同时也降低了 insert 及 update 的效率，因为 insert 或 update 时有可能会重建索引，所以怎样建索引需要慎重考虑，视具体情况而定。<br>
一个表的索引数最好不要超过6个，若太多则应考虑一些不常使用到的列上建的索引是否有必要。</p>
</li>
<li>
<p>尽量使用数字型字段，若只含数值信息的字段尽量不要设计为字符型，这会降低查询和连接的性能，并会增加存储开销。<br>
这是因为引擎在处理查询和连接时会逐个比较字符串中每一个字符，而对于数字型而言只需要比较一次就够了。</p>
</li>
<li>
<p>尽可能的使用 varchar 代替 char ，因为首先变长字段存储空间小，可以节省存储空间，其次对于查询来说，在一个相对较小的字段内搜索效率显然要高些。</p>
</li>
<li>
<p>任何地方都不要使用 select * from t ，用具体的字段列表代替“*”，不要返回用不到的任何字段。</p>
</li>
<li>
<p>避免频繁创建和删除临时表，以减少系统表资源的消耗。</p>
</li>
<li>
<p>临时表并不是不可使用，适当地使用它们可以使某些例程更有效，例如，当需要重复引用大型表或常用表中的某个数据集时。但是，对于一次性事件，最好使用导出表。</p>
</li>
<li>
<p>在新建临时表时，如果一次性插入数据量很大，那么可以使用 select into 代替 create table，避免造成大量 log ，以提高速度；如果数据量不大，为了缓和系统表的资源，应先create table，然后insert。</p>
</li>
<li>
<p>如果使用到了临时表，在存储过程的最后务必将所有的临时表显式删除，先 truncate table ，然后 drop table ，这样可以避免系统表的较长时间锁定。</p>
</li>
<li>
<p>尽量避免使用游标，因为游标的效率较差，如果游标操作的数据超过1万行，那么就应该考虑改写。</p>
</li>
<li>
<p>使用基于游标的方法或临时表方法之前，应先寻找基于集的解决方案来解决问题，基于集的方法通常更有效。</p>
</li>
<li>
<p>与临时表一样，游标并不是不可使用。对小型数据集使用 FAST_FORWARD 游标通常要优于其他逐行处理方法，尤其是在必须引用几个表才能获得所需的数据时。<br>
在结果集中包括“合计”的例程通常要比使用游标执行的速度快。如果开发时间允许，基于游标的方法和基于集的方法都可以尝试一下，看哪一种方法的效果更好。</p>
</li>
<li>
<p>尽量避免大事务操作，提高系统并发能力。</p>
</li>
<li>
<p>尽量避免向客户端返回大数据量，若数据量过大，应该考虑相应需求是否合理。</p>
</li>
</ol>
]]></content>
      <categories>
        <category>mysql</category>
      </categories>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title>Java守护线程和非守护线程</title>
    <url>/thread-01/</url>
    <content><![CDATA[<p>用户线程：我们平常创建的普通线程。</p>
<p>守护线程：用来服务于用户线程；不需要上层逻辑介入</p>
<p>java线程分为守护线程和非守护线程，当java jvm检测主线程或其他子线程执行完之后，守护线程也会马上停止执行，我们可以使用Thread.setDaemon(ture或false)来设置一个线程是守护线程还是非守护线程，默认为false，可以通过Thread.isDaemon()方法查询该线程是否是守护线程</p>
<p>守护线程是所有的用户线程结束生命周期，守护线程才会结束生命周期，只要有一个用户线程存在，那么守护线程就不会结束，例如Java中的垃圾 回收器就是一个守护线程，只有应用程序中所有的线程结束，它才会结束。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DaemonThread</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Thread thread = <span class="keyword">new</span> Thread(DaemonThread::print);</span><br><span class="line">        thread.setDaemon(<span class="keyword">true</span>);</span><br><span class="line">        thread.start();</span><br><span class="line">        System.out.println(<span class="string">&quot;主线程main 结束&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> counter = <span class="number">1</span>;</span><br><span class="line">        <span class="comment">//写一个死循环的方法来测试</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Counter:&quot;</span> + counter++);</span><br><span class="line">                Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">主线程main 结束</span><br><span class="line">Counter:1</span><br></pre></td></tr></table></figure>
<p>如果我们将daemon设置为非守护线程，代码如下:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">thread.setDaemon(<span class="keyword">false</span>);</span><br></pre></td></tr></table></figure>
<p>这个时候就不会退出while(true)循环了，会一直执行下去，结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">主线程main 结束</span><br><span class="line">Counter:1</span><br><span class="line">Counter:2</span><br><span class="line">Counter:3</span><br><span class="line">Counter:4</span><br><span class="line">Counter:5</span><br><span class="line">....</span><br></pre></td></tr></table></figure>
<p><strong>总结：守护线程是为用户线程服务的，当用户线程全部结束，守护线程会自动结束。</strong></p>
<p><strong>注意事项：</strong></p>
<ol>
<li>thread.setDaemon(true)必须在thread.start()之前设置，否则会跑出一个IllegalThreadStateException异常。你不能把正在运行的常规线程设置为守护线程。</li>
<li>在Daemon线程中产生的新线程也是Daemon的。</li>
<li>守护线程不能用于去访问固有资源，比如读写操作或者计算逻辑。因为它会在任何时候甚至在一个操作的中间发生中断。</li>
<li>Java自带的多线程框架，比如ExecutorService，会将守护线程转换为用户线程，所以如果要使用后台线程就不能用Java的线程池。</li>
</ol>
<p><strong>意义以及应用场景:</strong></p>
<p>当主线程结束时，结束其余的子线程（守护线程）自动关闭，就免去了还要继续关闭子线程的麻烦。如：Java垃圾回收线程就是一个典型的守护线程；内存资源或者线程的管理，但是非守护线程也可以。</p>
]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>守护线程</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo添加评论系统Valine</title>
    <url>/valine/</url>
    <content><![CDATA[<p>Hexo的评论系统有很多，常见的有以下几个</p>
<ul>
<li><s>多说</s></li>
<li><s>网易云跟帖</s></li>
<li>畅言</li>
<li>来必力（LiveRe）</li>
<li>Disqus</li>
<li>Hypercomments</li>
<li>valine</li>
</ul>
<p>首先多说和网易云已经倒下了，其次畅言需要备案，Disqus，Hypercomments和LiveRe都是国外的，加载速度贼慢，甚至有被墙的可能，寻觅了很久之后，从Material主题换成next主题之后，终于找到了一个好用的评论系统，那就是 valine</p>
<p>我使用的是Next 6.x版本，本身就已经集成了valine，因此正常情况下是按照官方文档走就可以了，5分钟开启你的评论系统~</p>
<ol>
<li>
<p>注册LeanCloud</p>
<p>我们的评论系统其实是放在Leancloud上的，因此首先需要去注册一个账号，注册地址：<a href="https://www.leancloud.cn/">https://www.leancloud.cn/</a><br>
<img src="/valine/1.png" alt></p>
</li>
<li>
<p>获取AppId</p>
<p>注册完了之后 创建一个应用，名字随便起；然后进入应用-&gt;设置-&gt;应用凭证 中获取appid 和 appkey<br>
<img src="/valine/2.png" alt></p>
</li>
<li>
<p>配置valine</p>
<p>拿到appid和appkey之后，打开主题配置文件_config.yml 搜索 valine，填入appid 和 appkey</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">comment:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">valine</span>  <span class="comment"># 启用哪种评论系统</span></span><br><span class="line">    <span class="attr">valine:</span> <span class="comment"># Valine. https://valine.js.org</span></span><br><span class="line">       <span class="attr">appid:</span> <span class="string">your</span> <span class="string">leancloud</span> <span class="string">application</span> <span class="string">appid</span></span><br><span class="line">       <span class="attr">appkey:</span> <span class="string">your</span> <span class="string">leancloud</span> <span class="string">application</span> <span class="string">appkey</span></span><br><span class="line">       <span class="attr">notify:</span> <span class="literal">false</span> <span class="comment"># mail notifier , https://github.com/xCss/Valine/wiki</span></span><br><span class="line">       <span class="attr">verify:</span> <span class="literal">false</span> <span class="comment"># Verification code</span></span><br><span class="line">       <span class="attr">placeholder:</span> <span class="string">Just</span> <span class="string">go</span> <span class="string">go</span> <span class="comment"># comment box placeholder</span></span><br><span class="line">       <span class="attr">avatar:</span> <span class="string">mm</span> <span class="comment"># gravatar style</span></span><br><span class="line">       <span class="attr">meta:</span> <span class="string">nick,mail</span> <span class="comment">#,link      #   custom comment header</span></span><br><span class="line">       <span class="attr">pageSize:</span> <span class="number">10</span> <span class="comment"># pagination size</span></span><br><span class="line">       <span class="attr">visitor:</span> <span class="literal">true</span> <span class="comment"># Article reading statistic https://valine.js.org/visitor.html</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>LeanCloud 安全域名配置</p>
<p>在LeanCloud -&gt; 设置 -&gt; 安全中心 -&gt; Web 安全域名 把你的域名加进去<br>
<img src="/valine/3.png" alt></p>
</li>
<li>
<p>查看评论数据</p>
<p>在数据存储 -&gt; 结构化数据 中可以查看到所有的存储的数据信息<br>
<img src="/valine/4.png" alt></p>
</li>
</ol>
]]></content>
      <categories>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>volatile关键字</title>
    <url>/volatile/</url>
    <content><![CDATA[<h2 id="1volatile作用"><a class="markdownIt-Anchor" href="#1volatile作用"></a> 1.volatile作用</h2>
<p>volatile保证有序性，可见性，不能保证原子性</p>
<ol>
<li>禁止指令重排</li>
<li>保证了不同线程对这个变量进行操作时的可见性，即一个线程修改了某个变量值，这个新值对其他线程立即可见的</li>
<li>不能保证原子性(线程不安全)</li>
</ol>
<h2 id="2-实现原理"><a class="markdownIt-Anchor" href="#2-实现原理"></a> 2. 实现原理</h2>
<ol>
<li>通过插入内存屏障指令禁止编译器和CPU对程序进行重排序。</li>
<li>当对声明了volatile的变量进行写操作时，JVM就会向处理器发送一条Lock前缀的指令，这条Lock前缀指令产生如下两个作用：
<ul>
<li>Lock前缀指令会引起处理器缓存回写到系统内存，并使用缓存一致性机制来确保回写的原子性。</li>
<li>一个处理器的缓存回写到系统内存会导致其他处理器的缓存无效。处理器使用MESI控制协议去维护内部缓存和其他处理器缓存的一致性。处理器能嗅探其他处理器访问系统内存和它们的内部缓存。处理器使用嗅探技术保证它的内部缓存、系统内存和其他处理器的缓存的数据在总线上保持一致。例如，在Pentium和P6 family处理器中，如果通过嗅探一个处理器来检测其他处理器打算写内存地址，而这个地址当前处于共享状态，那么正在嗅探的处理器将使它的缓存行无效，在下次访问相同内存地址时，强制执行缓存行填充</li>
</ul>
</li>
</ol>
<h2 id="3synchronized与volatile比较"><a class="markdownIt-Anchor" href="#3synchronized与volatile比较"></a> 3.synchronized与volatile比较</h2>
<ol>
<li>volatile关键字是线程同步的轻量级实现，性能较synchronized好；但是volatile关键字只能用于变量，而synchronized关键字可以修饰方法以及代码块</li>
<li>synchronized关键字在java1.6之后进行了主要包括为了减少获得锁和释放锁带来的性能消耗而引入的偏向锁和轻量级锁以及其他各种优化之后执行效率有了显著的提升；</li>
<li>多线程访问volatile关键字不会发生阻塞，而synchronized关键字可能会发生阻塞</li>
<li>volatile关键字保证数据的可见性，但是不能保证数据的原子性；synchronized关键字两者都能保证（synchronized保证原子性，有序性，可见性）</li>
<li>volatile关键字主要用于解决变量在多个线程之间的可见性，而synchronized关键字解决的是多个线程之间访问资源的同步性。</li>
<li>synchronized是同步锁，同步快内的代码相当于同一时刻单线程执行</li>
</ol>
<h2 id="4-可见性问题"><a class="markdownIt-Anchor" href="#4-可见性问题"></a> 4. 可见性问题</h2>
<p>Java虚拟机规范中定义了一种Java内存 模型（Java Memory Model，即JMM）来屏蔽掉各种硬件和操作系统的内存访问差异，以实现让Java程序在各种平台下都能达到一致的并发效果。Java内存模型的主要目标就是定义程序中各个变量的访问规则，即在虚拟机中将变量存储到内存和从内存中取出变量这样的细节。</p>
<p>JMM中规定所有的变量都存储在主内存（Main Memory）中，每条线程都有自己的工作内存（Work Memory），线程的工作内存中保存了该线程所使用的变量的从主内存中拷贝的副本。线程对于变量的读、写都必须在工作内存中进行，而不能直接读、写主内存中的变量。同时，本线程的工作内存的变量也无法被其他线程直接访问，必须通过主内存完成<br>
整体内存模型如下：<br>
<img src="/volatile/01.png" alt="image-20201210103251475"></p>
<h3 id="41-synchronized"><a class="markdownIt-Anchor" href="#41-synchronized"></a> 4.1 synchronized</h3>
<p>synchronized关键字的语义JMM（Java Main Memory）有两个规定，保证其实现内存可见性：<br>
- <strong>线程解锁前，必须把共享变量的最新值刷新到主内存中</strong><br>
- <strong>线程加锁前，将清空工作内存中共享变量的值，从主内存中重新取值</strong></p>
<h3 id="42-volatile"><a class="markdownIt-Anchor" href="#42-volatile"></a> 4.2 volatile</h3>
<ul>
<li>当对volatile变量执行写操作后，JMM会把工作内存中的最新变量值强制刷新到主内存</li>
<li>写操作会导致其他线程中的缓存无效<br>
这样，其他线程使用缓存时，发现本地工作内存中此变量无效，便从主内存中获取，这样获取到的变量便是最新的值，实现了线程的可见性。</li>
</ul>
]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>thread</tag>
      </tags>
  </entry>
  <entry>
    <title>在线修改静态文件</title>
    <url>/%E5%9C%A8%E7%BA%BF%E4%BF%AE%E6%94%B9%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6/</url>
    <content><![CDATA[<p>项目运行时，如果需要修改某个css、js、html等文件的时候，需要自己连接到服务器然后修改，更有甚者需要连接vpn、堡垒机等等，特别烦！！！！于是弄了一个在线修改静态文件的工具，在此记录一下。</p>
<h4 id="1-引入pom"><a class="markdownIt-Anchor" href="#1-引入pom"></a> 1. 引入pom</h4>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.xiaoyuge5201<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>static-file-modify-online<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="2-添加前后台代码"><a class="markdownIt-Anchor" href="#2-添加前后台代码"></a> 2. 添加前后台代码</h4>
<p>前台使用的是thymeleaf，根据自己项目的实际情况修改！</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">链接: https://pan.baidu.com/s/1oW38vpj74yKOOtbu5xGCOQ  </span><br><span class="line">密码: tcmg</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>LockSupport一个很灵活的线程工具类</title>
    <url>/locksupport/</url>
    <content><![CDATA[<p>LockSupport是一个编程工具类， 主要是为了阻塞和唤醒线程用的。所有的方法都是静态方法，可以让线程在任意位置阻塞，也可以在任意位置唤醒</p>
<p>主要的方法： park(阻塞线程)  和  unpark(启动唤醒线程)</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//源码</span></span><br><span class="line"><span class="keyword">package</span> java.util.concurrent.locks;</span><br><span class="line"><span class="keyword">import</span> sun.misc.Unsafe;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LockSupport</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">LockSupport</span><span class="params">()</span> </span>&#123;&#125; <span class="comment">// Cannot be instantiated.</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setBlocker</span><span class="params">(Thread t, Object arg)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Even though volatile, hotspot doesn&#x27;t need a write barrier here.</span></span><br><span class="line">        UNSAFE.putObject(t, parkBlockerOffset, arg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> thread the thread to unpark, or &#123;<span class="doctag">@code</span> null&#125;, in which case</span></span><br><span class="line"><span class="comment">     *        this operation has no effect</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">unpark</span><span class="params">(Thread thread)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (thread != <span class="keyword">null</span>)</span><br><span class="line">            UNSAFE.unpark(thread);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 阻塞当前线程</span></span><br><span class="line"><span class="comment">     * blocker是用来记录线程被阻塞时被谁阻塞的。用于线程监控和分析工具来定位原因的。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> blocker the synchronization object responsible for this</span></span><br><span class="line"><span class="comment">     *        thread parking</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.6</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">park</span><span class="params">(Object blocker)</span> </span>&#123;</span><br><span class="line">        Thread t = Thread.currentThread();</span><br><span class="line">        <span class="comment">//setBlocker作用是记录t线程是被broker阻塞的</span></span><br><span class="line">        setBlocker(t, blocker);</span><br><span class="line">        <span class="comment">//UNSAFE是一个非常强大的类，他的的操作是基于底层的</span></span><br><span class="line">        UNSAFE.park(<span class="keyword">false</span>, <span class="number">0L</span>);</span><br><span class="line">        setBlocker(t, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 暂停当前线程，有超时时间</span></span><br><span class="line"><span class="comment">     * blocker是用来记录线程被阻塞时被谁阻塞的。用于线程监控和分析工具来定位原因的。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> blocker the synchronization object responsible for this</span></span><br><span class="line"><span class="comment">     *        thread parking</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> nanos the maximum number of nanoseconds to wait</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.6</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">parkNanos</span><span class="params">(Object blocker, <span class="keyword">long</span> nanos)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (nanos &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            Thread t = Thread.currentThread();</span><br><span class="line">            setBlocker(t, blocker);</span><br><span class="line">            UNSAFE.park(<span class="keyword">false</span>, nanos);</span><br><span class="line">            setBlocker(t, <span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 暂停当前线程，知道某个时间</span></span><br><span class="line"><span class="comment">     * blocker是用来记录线程被阻塞时被谁阻塞的。用于线程监控和分析工具来定位原因的。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> blocker the synchronization object responsible for this</span></span><br><span class="line"><span class="comment">     *        thread parking</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> deadline the absolute time, in milliseconds from the Epoch,</span></span><br><span class="line"><span class="comment">     *        to wait until</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.6</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">parkUntil</span><span class="params">(Object blocker, <span class="keyword">long</span> deadline)</span> </span>&#123;</span><br><span class="line">        Thread t = Thread.currentThread();</span><br><span class="line">        setBlocker(t, blocker);</span><br><span class="line">        UNSAFE.park(<span class="keyword">true</span>, deadline);</span><br><span class="line">        setBlocker(t, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the blocker object supplied to the most recent</span></span><br><span class="line"><span class="comment">     * invocation of a park method that has not yet unblocked, or null</span></span><br><span class="line"><span class="comment">     * if not blocked.  The value returned is just a momentary</span></span><br><span class="line"><span class="comment">     * snapshot -- the thread may have since unblocked or blocked on a</span></span><br><span class="line"><span class="comment">     * different blocker object.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> t the thread</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the blocker</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> NullPointerException if argument is null</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.6</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">getBlocker</span><span class="params">(Thread t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (t == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">        <span class="keyword">return</span> UNSAFE.getObjectVolatile(t, parkBlockerOffset);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 无期限暂停当前线程</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">park</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        UNSAFE.park(<span class="keyword">false</span>, <span class="number">0L</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 暂停当前线程，不过有超时时间限制</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">parkNanos</span><span class="params">(<span class="keyword">long</span> nanos)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (nanos &gt; <span class="number">0</span>)</span><br><span class="line">            UNSAFE.park(<span class="keyword">false</span>, nanos);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 暂停当前线程，知道某个时间</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> deadline 暂停结束时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">parkUntil</span><span class="params">(<span class="keyword">long</span> deadline)</span> </span>&#123;</span><br><span class="line">        UNSAFE.park(<span class="keyword">true</span>, deadline);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the pseudo-randomly initialized or updated secondary seed.</span></span><br><span class="line"><span class="comment">     * Copied from ThreadLocalRandom due to package access restrictions.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">nextSecondarySeed</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> r;</span><br><span class="line">        Thread t = Thread.currentThread();</span><br><span class="line">        <span class="keyword">if</span> ((r = UNSAFE.getInt(t, SECONDARY)) != <span class="number">0</span>) &#123;</span><br><span class="line">            r ^= r &lt;&lt; <span class="number">13</span>;   <span class="comment">// xorshift</span></span><br><span class="line">            r ^= r &gt;&gt;&gt; <span class="number">17</span>;</span><br><span class="line">            r ^= r &lt;&lt; <span class="number">5</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((r = java.util.concurrent.ThreadLocalRandom.current().nextInt()) == <span class="number">0</span>)</span><br><span class="line">            r = <span class="number">1</span>; <span class="comment">// avoid zero</span></span><br><span class="line">        UNSAFE.putInt(t, SECONDARY, r);</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Hotspot implementation via intrinsics API</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> sun.misc.Unsafe UNSAFE;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> parkBlockerOffset;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> SEED;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> PROBE;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> SECONDARY;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            UNSAFE = sun.misc.Unsafe.getUnsafe();</span><br><span class="line">            Class&lt;?&gt; tk = Thread.class;</span><br><span class="line">            parkBlockerOffset = UNSAFE.objectFieldOffset</span><br><span class="line">                (tk.getDeclaredField(<span class="string">&quot;parkBlocker&quot;</span>));</span><br><span class="line">            SEED = UNSAFE.objectFieldOffset</span><br><span class="line">                (tk.getDeclaredField(<span class="string">&quot;threadLocalRandomSeed&quot;</span>));</span><br><span class="line">            PROBE = UNSAFE.objectFieldOffset</span><br><span class="line">                (tk.getDeclaredField(<span class="string">&quot;threadLocalRandomProbe&quot;</span>));</span><br><span class="line">            SECONDARY = UNSAFE.objectFieldOffset</span><br><span class="line">                (tk.getDeclaredField(<span class="string">&quot;threadLocalRandomSecondarySeed&quot;</span>));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ex) &#123; <span class="keyword">throw</span> <span class="keyword">new</span> Error(ex); &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="与wait-notify对比"><a class="markdownIt-Anchor" href="#与wait-notify对比"></a> 与wait / notify对比</h3>
<p>LockSupport是用来阻塞和环线线程的，wait/notify同样也是，那么两者的区别是什么？</p>
<ul>
<li>wait和notify都是Object中的方法，在调用这两个方法前必须获得锁对象，但是park不需要获取某个对象的锁就可以锁住线程</li>
<li>notify只能随机选择一个线程唤醒，无法唤醒指定的线程，unpark可以唤醒一个指定的线程</li>
</ul>
<h3 id="locksupport使用"><a class="markdownIt-Anchor" href="#locksupport使用"></a> LockSupport使用</h3>
<h4 id="1-先interrupt在park"><a class="markdownIt-Anchor" href="#1-先interrupt在park"></a> 1. 先interrupt在park</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LockSupportTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">extends</span>  <span class="title">Thread</span></span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            System.out.println(getName() + <span class="string">&quot;进入线程&quot;</span>);</span><br><span class="line">            LockSupport.park();</span><br><span class="line">            System.out.println(<span class="string">&quot;运行结束&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;是否中断：&quot;</span>+Thread.currentThread().isInterrupted());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        MyThread thread = <span class="keyword">new</span> MyThread();</span><br><span class="line">        thread.start();</span><br><span class="line">        System.out.println(<span class="string">&quot;线程启动了，但是在内部进行了park&quot;</span>);</span><br><span class="line">        thread.interrupt();</span><br><span class="line">        System.out.println(<span class="string">&quot;main 线程结束&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//输出</span></span><br><span class="line"><span class="comment">//       线程启动了，但是在内部进行了park</span></span><br><span class="line"><span class="comment">//       main 线程结束</span></span><br><span class="line"><span class="comment">//       Thread-0进入线程</span></span><br><span class="line"><span class="comment">//       运行结束</span></span><br></pre></td></tr></table></figure>
<h4 id="2-先park在interrupt"><a class="markdownIt-Anchor" href="#2-先park在interrupt"></a> 2. 先park在interrupt</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">extends</span>  <span class="title">Thread</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(getName() + <span class="string">&quot;进入线程&quot;</span>);</span><br><span class="line">        LockSupport.park();</span><br><span class="line">        System.out.println(<span class="string">&quot;运行结束&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 输出：</span></span><br><span class="line"><span class="comment"> * 线程启动了，但是在内部进行了park</span></span><br><span class="line"><span class="comment"> * main 线程结束</span></span><br><span class="line"><span class="comment"> * Thread-0进入线程</span></span><br><span class="line"><span class="comment"> * 运行结束</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>
<h3 id="趣味题"><a class="markdownIt-Anchor" href="#趣味题"></a> 趣味题</h3>
<p>用两个线程，一个输出字母，一个输出数字交替输出如：1A2B3C4D…</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadDemoTest</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> Thread t1 = <span class="keyword">null</span>, t2 = <span class="keyword">null</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">char</span>[] a = <span class="string">&quot;1234567&quot;</span>.toCharArray();</span><br><span class="line">        <span class="keyword">char</span>[] b = <span class="string">&quot;ABCDEFG&quot;</span>.toCharArray();</span><br><span class="line"></span><br><span class="line">        t1 = <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">char</span> i : a) &#123;</span><br><span class="line">                System.out.print(i);</span><br><span class="line">                LockSupport.unpark(t2);</span><br><span class="line">                LockSupport.park();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;t1&quot;</span>);</span><br><span class="line"></span><br><span class="line">        t2 = <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">char</span> i : b) &#123;</span><br><span class="line">                LockSupport.park();</span><br><span class="line">                System.out.print(i);</span><br><span class="line">                LockSupport.unpark(t1);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;t1&quot;</span>);</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//输出：  1A2B3C4D5E6F7G</span></span><br></pre></td></tr></table></figure>
<p>使用自旋锁也可以实现上面的结果</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CasTest</span> </span>&#123;</span><br><span class="line">    <span class="comment">//定义枚举，包含两个变量</span></span><br><span class="line">    <span class="class"><span class="keyword">enum</span> <span class="title">ReadyToRun</span></span>&#123;T1, T2&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">volatile</span> ReadyToRun r = ReadyToRun.T1;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">char</span>[] a = <span class="string">&quot;1234567&quot;</span>.toCharArray();</span><br><span class="line">        <span class="keyword">char</span>[] b = <span class="string">&quot;ABCDEFG&quot;</span>.toCharArray();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">char</span> c : a)&#123;</span><br><span class="line">                <span class="comment">//当r不为T1时， 空转占着cpu等待，然后输出字符，将r的值设置为T2</span></span><br><span class="line">                <span class="keyword">while</span> (r != ReadyToRun.T1)&#123;&#125;</span><br><span class="line">                System.out.print(c+<span class="string">&quot; &quot;</span>);</span><br><span class="line">                r = ReadyToRun.T2;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;t1&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">char</span> c : b)&#123;</span><br><span class="line">                <span class="keyword">while</span> (r != ReadyToRun.T2)&#123;&#125;</span><br><span class="line">                System.out.print(c+<span class="string">&quot; &quot;</span>);</span><br><span class="line">                r = ReadyToRun.T1;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;t2&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>thread</tag>
      </tags>
  </entry>
  <entry>
    <title>二分法查找题</title>
    <url>/algorithm-dinary-search/</url>
    <content><![CDATA[<h3 id="1-第一个错误的版本"><a class="markdownIt-Anchor" href="#1-第一个错误的版本"></a> 1. 第一个错误的版本</h3>
<h3 id="11-题目描述"><a class="markdownIt-Anchor" href="#11-题目描述"></a> 1.1 题目描述</h3>
<p>你是产品经理，目前正在带领一个团队开发新的产品。不幸的是，你的产品的最新版本没有通过质量检测。由于每个版本都是基于之前的版本开发的，所以错误的版本之后的所有版本都是错的。<br>
假设你有 n 个版本 [1, 2, …, n]，你想找出导致之后所有版本出错的第一个错误的版本。<br>
你可以通过调用bool isBadVersion(version)接口来判断版本号 version 是否在单元测试中出错。实现一个函数来查找第一个错误的版本。你应该尽量减少对调用 API 的次数。<br>
示例</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">输入：n = 5, bad = 4</span><br><span class="line">输出：4</span><br><span class="line">解释：</span><br><span class="line">    调用 isBadVersion(3) -&gt; false </span><br><span class="line">    调用 isBadVersion(5) -&gt; true </span><br><span class="line">    调用 isBadVersion(4) -&gt; true</span><br><span class="line">所以，4 是第一个错误的版本</span><br></pre></td></tr></table></figure>
<h3 id="12-解题思路"><a class="markdownIt-Anchor" href="#12-解题思路"></a> 1.2 解题思路</h3>
<p>当一个版本为正确版本，则该版本之前的所有版本均为正确版本；当一个版本为错误版本，则该版本之后的所有版本均为错误版本。我们可以利用这个性质进行二分查找。</p>
<p>具体地，将左右边界分别初始化为 1和 n ，其中 n 是给定的版本数量。设定左右边界之后，每次我们都依据左右边界找到其中间的版本，检查其是否为正确版本。如果该版本为正确版本，那么第一个错误的版本必然位于该版本的右侧，我们缩紧左边界；否则第一个错误的版本必然位于该版本及该版本的左侧，我们缩紧右边界。<br>
这样我们每判断一次都可以缩紧一次边界，而每次缩紧时两边界距离将变为原来的一半，因此我们至多只需要缩紧 O(logn) 次。</p>
<h3 id="13-代码"><a class="markdownIt-Anchor" href="#13-代码"></a> 1.3 代码</h3>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">firstBadVersion</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> left = <span class="number">1</span>, right = n;</span><br><span class="line">    <span class="keyword">while</span> (left &lt; right)&#123;</span><br><span class="line">        <span class="keyword">int</span> mid = left + (right - left) / <span class="number">2</span>;    <span class="comment">// 防止计算时溢出</span></span><br><span class="line">        <span class="keyword">if</span> (isBadVersion(mid))&#123;</span><br><span class="line">            <span class="comment">// 答案在区间 [left, mid] 中</span></span><br><span class="line">           right = mid; <span class="comment">//如果中间版本是错误的版本，那么它之后的都是错误的;</span></span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 答案在区间 [mid+1, right] 中</span></span><br><span class="line">            left = mid + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//此时有 left == right,退出了while循环</span></span><br><span class="line">    <span class="keyword">return</span> left;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>算法</category>
      </categories>
      <tags>
        <tag>algorithm</tag>
      </tags>
  </entry>
  <entry>
    <title>mysqldumpslow分析慢查询日志</title>
    <url>/mysqldumpslow%E5%88%86%E6%9E%90%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97/</url>
    <content><![CDATA[<p>按照平均查询输出5行慢查询记录</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mysqldumpslow -s at -t 5 /phpstudy/data/slowquery.log</span><br></pre></td></tr></table></figure>
<ul>
<li>-s   排序方式，可选值有c（记录次数）、t（查询时间）、l（锁定时间）、r（返回记录）、a（平均）</li>
<li>-t    显示的记录数Spawn failed解决方式</li>
<li>-g   后面跟正则表达式（如 left join），不区分大小写。</li>
<li>-r   正序排序，即从小到大排序。</li>
<li>-d  调试 debug</li>
<li>-v   查看版本</li>
</ul>
<p>按照平均查询时间排序且只显示含有left join的记录</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mysqldumpslow -s at -g &#x27;left join&#x27; /phpstudy/data/slowquery.log</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>mysql</category>
      </categories>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title>TIDB设置sql_mode</title>
    <url>/sql-model/</url>
    <content><![CDATA[<h3 id="1-使用命令查询当前sql_mode"><a class="markdownIt-Anchor" href="#1-使用命令查询当前sql_mode"></a> 1. 使用命令查询当前sql_mode</h3>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> @<span class="variable">@sql</span>_mode</span><br><span class="line"><span class="comment">-- 或者</span></span><br><span class="line"><span class="keyword">select</span> @<span class="variable">@GLOBAL</span>.sql_mode</span><br></pre></td></tr></table></figure>
<p><img src="/sql-model/1.png" alt="sql_mode"></p>
<h5 id="sql_mode常用值"><a class="markdownIt-Anchor" href="#sql_mode常用值"></a> sql_mode常用值：</h5>
<ul>
<li>
<p>ONLY_FULL_GROUP_BY<br>
对于GROUP BY聚合操作，如果在SELECT中的列，没有在GROUP BY中出现，那么这个SQL是不合法的，因为列不在GROUP BY从句中</p>
</li>
<li>
<p>NO_AUTO_VALUE_ON_ZERO<br>
该值影响自增长列的插入。默认设置下，插入0或NULL代表生成下一个自增长值。如果用户希望插入的值为0，而该列又是自增长的，那么这个选项就有用了。</p>
</li>
<li>
<p>STRICT_TRANS_TABLES<br>
在该模式下，如果一个值不能插入到一个事务中，则中断当前的操作，对非事务表不做限制</p>
</li>
<li>
<p>NO_ZERO_IN_DATE<br>
在严格模式下，不允许日期和月份为零</p>
</li>
<li>
<p>NO_ZERO_DATE<br>
设置该值，mysql数据库不允许插入零日期，插入零日期会抛出错误而不是警告</p>
</li>
<li>
<p>ERROR_FOR_DIVISION_BY_ZERO<br>
在insert或update过程中，如果数据被零除，则产生错误而非警告。如果未给出该模式，那么数据被零除时Mysql返回NULL</p>
</li>
<li>
<p>NO_AUTO_CREATE_USER<br>
禁止GRANT创建密码为空的用户</p>
</li>
<li>
<p>NO_ENGINE_SUBSTITUTION<br>
如果需要的存储引擎被禁用或未编译，那么抛出错误。不设置此值时，用默认的存储引擎替代，并抛出一个异常</p>
</li>
<li>
<p>PIPES_AS_CONCAT<br>
将&quot;||&quot;视为字符串的连接操作符而非或运算符，这和Oracle数据库是一样是，也和字符串的拼接函数Concat想类似</p>
</li>
<li>
<p>ANSI_QUOTES<br>
启用ANSI_QUOTES后，不能用双引号来引用字符串，因为它被解释为识别符</p>
</li>
</ul>
<h3 id="2-临时设置新session仍然使用之前的sql_mode"><a class="markdownIt-Anchor" href="#2-临时设置新session仍然使用之前的sql_mode"></a> 2. 临时设置（新session仍然使用之前的sql_mode）</h3>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span> sql_mode<span class="operator">=</span>‘ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES’;</span><br></pre></td></tr></table></figure>
<h3 id="3-全局设置新session仍然使用修改后的sql_mode"><a class="markdownIt-Anchor" href="#3-全局设置新session仍然使用修改后的sql_mode"></a> 3. 全局设置（新session仍然使用修改后的sql_mode）</h3>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span> @<span class="variable">@global</span>.sql_mode<span class="operator">=</span><span class="string">&#x27;ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE‘；</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>mysql</category>
      </categories>
      <tags>
        <tag>tidb</tag>
      </tags>
  </entry>
  <entry>
    <title>转换成小写字母</title>
    <url>/algoright-2/</url>
    <content><![CDATA[<p>实现函数 ToLowerCase()，该函数接收一个字符串参数 str，并将该字符串中的大写字母转换成小写字母，之后返回新的字符串。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">示例 1：</span><br><span class="line">输入: &quot;Hello&quot;</span><br><span class="line">输出: &quot;hello&quot;</span><br><span class="line"></span><br><span class="line">示例2：</span><br><span class="line">输入: &quot;LOVELY&quot;</span><br><span class="line">输出: &quot;lovely&quot;</span><br></pre></td></tr></table></figure>
<h3 id="方法一-asccii码"><a class="markdownIt-Anchor" href="#方法一-asccii码"></a> 方法一： ASCCII码</h3>
<p><strong>解题思路：通过ascii码表操作字符串即可,a和A相差32；</strong></p>
<ul>
<li>a-z: 97 - 122</li>
<li>A-Z: 65 - 90</li>
<li>0-9: 48 - 57</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">toLowerCase</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (str == <span class="keyword">null</span> || str.length() == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> str;</span><br><span class="line">    &#125;</span><br><span class="line">    StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">char</span> ch : str.toCharArray()) &#123;</span><br><span class="line">        <span class="comment">// a-z：97-122  A-Z：65-90  0-9：48-57</span></span><br><span class="line">        <span class="keyword">if</span> (ch &gt;= <span class="string">&#x27;A&#x27;</span> &amp;&amp; ch &lt;= <span class="string">&#x27;Z&#x27;</span>) &#123;</span><br><span class="line">            sb.append((<span class="keyword">char</span>)(ch + <span class="number">32</span>));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            sb.append(ch);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sb.toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>或者：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">toLowerCase</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (str == <span class="keyword">null</span> || str.length() == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> str;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">char</span>[] ch = str.toCharArray();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; str.length(); i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (ch[i] &gt;= <span class="string">&#x27;A&#x27;</span> &amp;&amp; ch[i] &lt;= <span class="string">&#x27;Z&#x27;</span>) &#123;</span><br><span class="line">            ch[i] += <span class="number">32</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> String.valueOf(ch);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="方法二-位运算"><a class="markdownIt-Anchor" href="#方法二-位运算"></a> 方法二： 位运算</h3>
<p><strong>解题思路：</strong></p>
<ul>
<li>大写变小写、小写变大写：字符 ^= 32;</li>
<li>大写变小写、小写变小写：字符 |= 32;</li>
<li>大写变大写、小写变大写：字符 &amp;= 33;</li>
</ul>
<p>ASCII码表中大写的A是65，小写的a是97，它们的差是32<br>
65 | 32 转为二进制（按8位来算）可以得到 0100 0001 | 0010 0000 = 0110 0001 = 97 = a</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toLowerCase</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (str == <span class="keyword">null</span> || str.length() == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> str;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">char</span>[] ch = str.toCharArray();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; str.length(); i++) &#123;</span><br><span class="line">        ch[i] |= <span class="number">32</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> String.valueOf(ch);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>算法</category>
      </categories>
      <tags>
        <tag>algorithm</tag>
      </tags>
  </entry>
  <entry>
    <title>mysql行列转置</title>
    <url>/mysql%E8%A1%8C%E5%88%97%E8%BD%AC%E7%BD%AE/</url>
    <content><![CDATA[<p>数据表：<br>
<img src="/mysql%E8%A1%8C%E5%88%97%E8%BD%AC%E7%BD%AE/01.png" alt="原始数据"></p>
<p>行转列结果为：<br>
<img src="/mysql%E8%A1%8C%E5%88%97%E8%BD%AC%E7%BD%AE/02.png" alt="转置后结果"><br>
数据库表语句：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_score(</span><br><span class="line">    id <span class="type">int</span> <span class="keyword">primary</span> key auto_increment,</span><br><span class="line">    name <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span>,  #名字</span><br><span class="line">    Subject <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">not</span> <span class="keyword">null</span>, #科目</span><br><span class="line">    Fraction <span class="keyword">double</span> <span class="keyword">default</span> <span class="number">0</span>  #分数</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `t_score`(name,Subject,Fraction) <span class="keyword">VALUES</span></span><br><span class="line">     (<span class="string">&#x27;王海&#x27;</span>, <span class="string">&#x27;语文&#x27;</span>, <span class="number">86</span>),</span><br><span class="line">     (<span class="string">&#x27;王海&#x27;</span>, <span class="string">&#x27;数学&#x27;</span>, <span class="number">83</span>),</span><br><span class="line">     (<span class="string">&#x27;王海&#x27;</span>, <span class="string">&#x27;英语&#x27;</span>, <span class="number">93</span>),</span><br><span class="line">     (<span class="string">&#x27;陶俊&#x27;</span>, <span class="string">&#x27;语文&#x27;</span>, <span class="number">88</span>),</span><br><span class="line">     (<span class="string">&#x27;陶俊&#x27;</span>, <span class="string">&#x27;数学&#x27;</span>, <span class="number">84</span>),</span><br><span class="line">     (<span class="string">&#x27;陶俊&#x27;</span>, <span class="string">&#x27;英语&#x27;</span>, <span class="number">94</span>),</span><br><span class="line">     (<span class="string">&#x27;刘可&#x27;</span>, <span class="string">&#x27;语文&#x27;</span>, <span class="number">80</span>),</span><br><span class="line">     (<span class="string">&#x27;刘可&#x27;</span>, <span class="string">&#x27;数学&#x27;</span>, <span class="number">86</span>),</span><br><span class="line">     (<span class="string">&#x27;刘可&#x27;</span>, <span class="string">&#x27;英语&#x27;</span>, <span class="number">88</span>),</span><br><span class="line">     (<span class="string">&#x27;李春&#x27;</span>, <span class="string">&#x27;语文&#x27;</span>, <span class="number">89</span>),</span><br><span class="line">     (<span class="string">&#x27;李春&#x27;</span>, <span class="string">&#x27;数学&#x27;</span>, <span class="number">80</span>),</span><br><span class="line">     (<span class="string">&#x27;李春&#x27;</span>, <span class="string">&#x27;英语&#x27;</span>, <span class="number">87</span>);</span><br></pre></td></tr></table></figure>
<ol>
<li>方法一：使用if <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">    name <span class="keyword">as</span> 名字 ,</span><br><span class="line">    <span class="built_in">sum</span>(if(Subject<span class="operator">=</span><span class="string">&#x27;语文&#x27;</span>,Fraction,<span class="number">0</span>)) <span class="keyword">as</span> 语文,</span><br><span class="line">    <span class="built_in">sum</span>(if(Subject<span class="operator">=</span><span class="string">&#x27;数学&#x27;</span>,Fraction,<span class="number">0</span>))<span class="keyword">as</span> 数学, </span><br><span class="line">    <span class="built_in">sum</span>(if(Subject<span class="operator">=</span><span class="string">&#x27;英语&#x27;</span>,Fraction,<span class="number">0</span>))<span class="keyword">as</span> 英语,</span><br><span class="line">    round(<span class="built_in">AVG</span>(Fraction),<span class="number">2</span>) <span class="keyword">as</span> 平均分,</span><br><span class="line">    <span class="built_in">SUM</span>(Fraction) <span class="keyword">as</span> 总分</span><br><span class="line"><span class="keyword">from</span> t_score <span class="keyword">group</span> <span class="keyword">by</span> name</span><br><span class="line"><span class="comment">-- 如果不用求总分的话，不需要下面的union</span></span><br><span class="line"><span class="keyword">union</span>(</span><br><span class="line">    <span class="keyword">select</span> name <span class="keyword">as</span> 名字 , <span class="built_in">sum</span>(语文) Chinese,<span class="built_in">sum</span>(数学) Math,<span class="built_in">sum</span>(英语) English,round(<span class="built_in">AVG</span>(总分),<span class="number">2</span>)<span class="keyword">as</span> 平均分,<span class="built_in">sum</span>(总分) score  <span class="keyword">from</span>(</span><br><span class="line">        <span class="keyword">select</span> <span class="string">&#x27;TOTAL&#x27;</span> <span class="keyword">as</span> name,</span><br><span class="line">        <span class="built_in">sum</span>(if(Subject<span class="operator">=</span><span class="string">&#x27;语文&#x27;</span>,Fraction,<span class="number">0</span>)) <span class="keyword">as</span> 语文,</span><br><span class="line">        <span class="built_in">sum</span>(if(Subject<span class="operator">=</span><span class="string">&#x27;数学&#x27;</span>,Fraction,<span class="number">0</span>))<span class="keyword">as</span> 数学, </span><br><span class="line">        <span class="built_in">sum</span>(if(Subject<span class="operator">=</span><span class="string">&#x27;英语&#x27;</span>,Fraction,<span class="number">0</span>))<span class="keyword">as</span> 英语,</span><br><span class="line">        <span class="built_in">SUM</span>(Fraction) <span class="keyword">as</span> 总分</span><br><span class="line">        <span class="keyword">from</span> t_score <span class="keyword">group</span> <span class="keyword">by</span> Subject </span><br><span class="line">    )t <span class="keyword">GROUP</span> <span class="keyword">BY</span> t.`name`</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
</li>
<li>方法二：使用case <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> name <span class="keyword">as</span> name,</span><br><span class="line"><span class="built_in">sum</span>(<span class="keyword">case</span> <span class="keyword">when</span> Subject <span class="operator">=</span> <span class="string">&#x27;语文&#x27;</span> <span class="keyword">then</span> Fraction <span class="keyword">end</span>) <span class="keyword">as</span> Chinese,</span><br><span class="line"><span class="built_in">sum</span>(<span class="keyword">case</span> <span class="keyword">when</span> Subject <span class="operator">=</span> <span class="string">&#x27;数学&#x27;</span> <span class="keyword">then</span> Fraction <span class="keyword">end</span>) <span class="keyword">as</span> Math,</span><br><span class="line"><span class="built_in">sum</span>(<span class="keyword">case</span> <span class="keyword">when</span> Subject <span class="operator">=</span> <span class="string">&#x27;英语&#x27;</span> <span class="keyword">then</span> Fraction <span class="keyword">end</span>) <span class="keyword">as</span> English,</span><br><span class="line"><span class="built_in">sum</span>(fraction)<span class="keyword">as</span> score</span><br><span class="line"><span class="keyword">from</span> t_score <span class="keyword">group</span> <span class="keyword">by</span> name</span><br><span class="line"><span class="comment">-- 如果不用求总分的话，不需要下面的union</span></span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> name <span class="keyword">as</span> Name,<span class="built_in">sum</span>(Chinese) <span class="keyword">as</span> Chinese,<span class="built_in">sum</span>(Math) <span class="keyword">as</span> Math,<span class="built_in">sum</span>(English) <span class="keyword">as</span> English,<span class="built_in">sum</span>(score) <span class="keyword">as</span> score <span class="keyword">from</span>(</span><br><span class="line">    <span class="keyword">select</span> <span class="string">&#x27;TOTAL&#x27;</span> <span class="keyword">as</span> name,</span><br><span class="line">    <span class="built_in">sum</span>(<span class="keyword">case</span> <span class="keyword">when</span> Subject <span class="operator">=</span> <span class="string">&#x27;语文&#x27;</span> <span class="keyword">then</span> Fraction <span class="keyword">end</span>) <span class="keyword">as</span> Chinese,</span><br><span class="line">    <span class="built_in">sum</span>(<span class="keyword">case</span> <span class="keyword">when</span> Subject <span class="operator">=</span> <span class="string">&#x27;数学&#x27;</span> <span class="keyword">then</span> Fraction <span class="keyword">end</span>) <span class="keyword">as</span> Math,</span><br><span class="line">    <span class="built_in">sum</span>(<span class="keyword">case</span> <span class="keyword">when</span> Subject <span class="operator">=</span> <span class="string">&#x27;英语&#x27;</span> <span class="keyword">then</span> Fraction <span class="keyword">end</span>) <span class="keyword">as</span> English,</span><br><span class="line">    <span class="built_in">sum</span>(fraction)<span class="keyword">as</span> score</span><br><span class="line">    <span class="keyword">from</span> t_score <span class="keyword">group</span> <span class="keyword">by</span> Subject,name)t <span class="keyword">GROUP</span> <span class="keyword">BY</span> t.`name`</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
</li>
<li>方法三：使用with rollup<br>
在group分组字段的基础上在进行统计数据； <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">    <span class="comment">-- coalesce(name,&#x27;TOTAL&#x27;) name,</span></span><br><span class="line">    ifnull(name,<span class="string">&#x27;TOTAL&#x27;</span>) name,</span><br><span class="line">    <span class="built_in">sum</span>(if(Subject<span class="operator">=</span><span class="string">&#x27;语文&#x27;</span>,Fraction,<span class="number">0</span>)) <span class="keyword">as</span> 语文,</span><br><span class="line">    <span class="built_in">sum</span>(if(Subject<span class="operator">=</span><span class="string">&#x27;英语&#x27;</span>,Fraction,<span class="number">0</span>)) <span class="keyword">as</span> 英语,</span><br><span class="line">    <span class="built_in">sum</span>(if(Subject<span class="operator">=</span><span class="string">&#x27;数学&#x27;</span>,Fraction,<span class="number">0</span>))<span class="keyword">as</span> 数学,</span><br><span class="line">    <span class="built_in">sum</span>(Fraction) 总分</span><br><span class="line"><span class="keyword">from</span> t_score <span class="keyword">group</span> <span class="keyword">by</span> name <span class="keyword">with</span> <span class="keyword">rollup</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
]]></content>
      <categories>
        <category>mysql</category>
      </categories>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title>Mysql添加/修改/删除字段</title>
    <url>/mysql-column/</url>
    <content><![CDATA[<h3 id="1-添加字段"><a class="markdownIt-Anchor" href="#1-添加字段"></a> 1. 添加字段</h3>
<h4 id="11-在末尾添加字段"><a class="markdownIt-Anchor" href="#11-在末尾添加字段"></a> 1.1 在末尾添加字段</h4>
<p>1）语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>表名<span class="operator">&gt;</span> <span class="keyword">ADD</span> <span class="operator">&lt;</span>字段名<span class="operator">&gt;</span> <span class="operator">&lt;</span>数据类型<span class="operator">&gt;</span> [约束条件];</span><br></pre></td></tr></table></figure>
<p>语法格式的说明：</p>
<ul>
<li>&lt;表名&gt; 为数据表的名字；</li>
<li>&lt;字段名&gt; 为所要添加的字段的名字；</li>
<li>&lt;数据类型&gt; 为所要添加的字段能存储数据的数据类型；</li>
<li>[约束条件] 是可选的，用来对添加的字段进行约束。</li>
<li>这种语法格式默认在表的最后位置（最后一列的后面）添加新字段</li>
</ul>
<p>2）示例：在user表末尾添加字段phone</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">user</span> <span class="keyword">ADD</span> phone <span class="type">VARCHAR</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;电话号码&#x27;</span>;</span><br></pre></td></tr></table></figure>
<h4 id="12-在开头添加字段"><a class="markdownIt-Anchor" href="#12-在开头添加字段"></a> 1.2 在开头添加字段</h4>
<p>1）语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>表名<span class="operator">&gt;</span> <span class="keyword">ADD</span> <span class="operator">&lt;</span>字段名<span class="operator">&gt;</span> <span class="operator">&lt;</span>数据类型<span class="operator">&gt;</span> [约束条件] <span class="keyword">FIRST</span>;</span><br></pre></td></tr></table></figure>
<p>FIRST 关键字一般放在语句的末尾<br>
2）示例：在user表开头添加字段user_id</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">user</span> <span class="keyword">ADD</span> user_id <span class="type">VARCHAR</span>(<span class="number">32</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;用户主键&#x27;</span> <span class="keyword">FIRST</span>;</span><br></pre></td></tr></table></figure>
<h4 id="13-在中间添加字段"><a class="markdownIt-Anchor" href="#13-在中间添加字段"></a> 1.3 在中间添加字段</h4>
<p>1）语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>表名<span class="operator">&gt;</span> <span class="keyword">ADD</span> <span class="operator">&lt;</span>字段名<span class="operator">&gt;</span> <span class="operator">&lt;</span>数据类型<span class="operator">&gt;</span> [约束条件] AFTER <span class="operator">&lt;</span>已经存在的字段名<span class="operator">&gt;</span>;</span><br></pre></td></tr></table></figure>
<p>AFTER 的作用是将新字段添加到某个已有字段后面。<br>
注意：只能在某个已有字段的后面添加新字段，不能在它的前面添加新字段</p>
<p>2）示例：在user表的user_id字段后添加username字段</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">user</span> <span class="keyword">ADD</span> username <span class="type">VARCHAR</span>(<span class="number">30</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;用户名&#x27;</span> AFTER `user_id`;</span><br></pre></td></tr></table></figure>
<h3 id="2-修改字段"><a class="markdownIt-Anchor" href="#2-修改字段"></a> 2. 修改字段</h3>
<h4 id="21-修改字段属性"><a class="markdownIt-Anchor" href="#21-修改字段属性"></a> 2.1 修改字段属性</h4>
<p>1）语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>表名<span class="operator">&gt;</span> MODIFY <span class="operator">&lt;</span>字段名<span class="operator">&gt;</span> <span class="operator">&lt;</span>数据类型<span class="operator">&gt;</span> [约束条件];</span><br></pre></td></tr></table></figure>
<p>2）示例1：修改字段属性</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 将email字段VARCHAR(50)修改成VARCHAR(200)</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">user</span> MODIFY email <span class="type">VARCHAR</span>(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;email@163.com&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>注意：修改时如果不带完整性约束条件，原有的约束条件将丢失，如果想保留修改时就得带上完整性约束条件</p>
<p>3）示例2： 将email移到phone后面</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">user</span> MODIFY email <span class="type">VARCHAR</span>(<span class="number">50</span>) AFTER `phone`;</span><br></pre></td></tr></table></figure>
<p>4）示例3：放置第一个，保留原完成性约束条件</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">user</span>`MODIFY email <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;test@163.com&#x27;</span> <span class="keyword">FIRST</span>;</span><br></pre></td></tr></table></figure>
<p>5）示例4：修改成大小写敏感，即查询区分大小写</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">user</span> MODIFY username <span class="type">VARCHAR</span>(<span class="number">30</span>) <span class="type">BINARY</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;用户名&#x27;</span>;</span><br></pre></td></tr></table></figure>
<h4 id="22-修改字段名称和属性"><a class="markdownIt-Anchor" href="#22-修改字段名称和属性"></a> 2.2 修改字段名称和属性</h4>
<p>1）语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>表名<span class="operator">&gt;</span> CHANGE <span class="operator">&lt;</span>原字段名<span class="operator">&gt;</span> <span class="operator">&lt;</span>新字段名<span class="operator">&gt;</span> <span class="operator">&lt;</span>数据类型<span class="operator">&gt;</span> [约束条件];</span><br></pre></td></tr></table></figure>
<p>2）示例：将username字段修改成user_name</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">user</span> CHANGE username user_name <span class="type">VARCHAR</span>(<span class="number">30</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;用户名&#x27;</span>;</span><br></pre></td></tr></table></figure>
<h4 id="23-添加-删除默认值"><a class="markdownIt-Anchor" href="#23-添加-删除默认值"></a> 2.3 添加、删除默认值</h4>
<p>1）语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 添加默认值</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>表名<span class="operator">&gt;</span> <span class="keyword">ALTER</span> <span class="operator">&lt;</span>字段名<span class="operator">&gt;</span> <span class="keyword">SET</span> <span class="keyword">DEFAULT</span> <span class="operator">&lt;</span>默认值<span class="operator">&gt;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除默认值</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>表名<span class="operator">&gt;</span> <span class="keyword">ALTER</span> <span class="operator">&lt;</span>字段名<span class="operator">&gt;</span> <span class="keyword">DROP</span> <span class="keyword">DEFAULT</span>;</span><br></pre></td></tr></table></figure>
<p>2）示例：给sex添加默认值</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">USER</span> <span class="keyword">ALTER</span> sex <span class="keyword">SET</span> <span class="keyword">DEFAULT</span>  <span class="string">&#x27;难&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>3）示例：删除sex默认值</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">user</span> <span class="keyword">ALTER</span> sex <span class="keyword">DROP</span> <span class="keyword">DEFAULT</span>;</span><br></pre></td></tr></table></figure>
<h4 id="24-添加-删除主键"><a class="markdownIt-Anchor" href="#24-添加-删除主键"></a> 2.4 添加、删除主键</h4>
<ol>
<li>语法：</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 添加主键</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>表名<span class="operator">&gt;</span> <span class="keyword">ADD</span> [<span class="keyword">CONSTRAINT</span> <span class="operator">&lt;</span>约束名<span class="operator">&gt;</span>] <span class="keyword">PRIMARY</span> KEY (<span class="operator">&lt;</span>字段名称,...<span class="operator">&gt;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除主键</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>表名<span class="operator">&gt;</span> <span class="keyword">DROP</span> <span class="keyword">PRIMARY</span> KEY;</span><br></pre></td></tr></table></figure>
<p>2）示例：添加主键</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">user</span> <span class="keyword">ADD</span> <span class="keyword">PRIMARY</span>  KEY (user_id)</span><br></pre></td></tr></table></figure>
<p>3）示例：添加复合主键</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span>  user_role <span class="keyword">ADD</span> <span class="keyword">PRIMARY</span> KEY (user_id, role_id);</span><br></pre></td></tr></table></figure>
<p>4）示例：删除主键</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">user</span> <span class="keyword">DROP</span> <span class="keyword">PRIMARY</span> KEY;</span><br></pre></td></tr></table></figure>
<p>5）示例：删除带自增长属性的主键</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 先用MODIFY删除自增长属性，注意MODIFY不能去掉主键属性</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> test MODIFY id <span class="type">INT</span> UNSIGNED;</span><br><span class="line"><span class="comment">-- 再来删除主键</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> test <span class="keyword">DROP</span> <span class="keyword">PRIMARY</span> KEY;</span><br></pre></td></tr></table></figure>
<h4 id="25-添加-删除唯一索引"><a class="markdownIt-Anchor" href="#25-添加-删除唯一索引"></a> 2.5 添加、删除唯一索引</h4>
<p>1）语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 添加唯一性约束</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>表名<span class="operator">&gt;</span> <span class="keyword">ADD</span> [CONSTANT <span class="operator">&lt;</span>约束名<span class="operator">&gt;</span>] <span class="keyword">UNIQUE</span> [INDEX <span class="operator">|</span> KEY] [索引名称](<span class="operator">&lt;</span>字段名称,...<span class="operator">&gt;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除唯一性约束</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>表名<span class="operator">&gt;</span> <span class="keyword">DROP</span> [INDEX <span class="operator">|</span> KEY] [索引名称];</span><br></pre></td></tr></table></figure>
<p>2）示例：为username添加唯一性约束，如果没有指定索引名称，系统会以字段名建立索引</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">user</span> <span class="keyword">ADD</span> <span class="keyword">UNIQUE</span>(username);</span><br></pre></td></tr></table></figure>
<p>3）示例：为username添加唯一性约束，并指定索引名称</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">user</span> <span class="keyword">ADD</span> <span class="keyword">UNION</span> KEY uni_username(username);</span><br></pre></td></tr></table></figure>
<p>4）示例：查看索引</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">user</span>;</span><br></pre></td></tr></table></figure>
<p>5）示例：添加联合UNIQUE</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">user</span> <span class="keyword">ADD</span> <span class="keyword">UNIQUE</span> INDEX uni_nickname_username(nickname, username);</span><br></pre></td></tr></table></figure>
<p>6）示例：删除索引</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">user</span> <span class="keyword">DROP</span> INDEX username;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">user</span> <span class="keyword">DROP</span> KEY uni_username;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">user</span> <span class="keyword">DROP</span> INDEX uni_nickname_username;</span><br></pre></td></tr></table></figure>
<h4 id="26-修改表的存储引擎"><a class="markdownIt-Anchor" href="#26-修改表的存储引擎"></a> 2.6 修改表的存储引擎</h4>
<p>1）语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>表名<span class="operator">&gt;</span> ENGINE<span class="operator">=</span><span class="operator">&lt;</span>存储引擎名称<span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>
<p>2）示例：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">user</span> ENGINE<span class="operator">=</span>MyISAM;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">user</span> ENGINE<span class="operator">=</span>INNODB;</span><br></pre></td></tr></table></figure>
<h4 id="27-修改自增长值"><a class="markdownIt-Anchor" href="#27-修改自增长值"></a> 2.7 修改自增长值</h4>
<p>1）语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>表名<span class="operator">&gt;</span> AUTO_INCREMENT<span class="operator">=</span>[值];</span><br></pre></td></tr></table></figure>
<p>2）示例：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">user</span> AUTO_INCREMENT<span class="operator">=</span> <span class="number">100</span>;</span><br></pre></td></tr></table></figure>
<p>博客原文链接：<a href="https://www.cnblogs.com/Jimc/p/12979319.html">https://www.cnblogs.com/Jimc/p/12979319.html</a><br>
如有侵权，请联系删除！</p>
]]></content>
      <categories>
        <category>mysql</category>
      </categories>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title>安装Centos系统以及配置IP</title>
    <url>/Installing-CentOS-system/</url>
    <content><![CDATA[<h2 id="1-系统安装"><a class="markdownIt-Anchor" href="#1-系统安装"></a> 1. 系统安装</h2>
<ol>
<li>
<p>安装<br>
<img src="/Installing-CentOS-system/1.png" alt></p>
</li>
<li>
<p>选择语言<br>
<img src="/Installing-CentOS-system/2.png" alt></p>
</li>
<li>
<p>设置时区以及软件安装<br>
<img src="/Installing-CentOS-system/3.png" alt></p>
</li>
<li>
<p>选择GNOME桌面，开发工具。然后点击左上角的完成<br>
<img src="/Installing-CentOS-system/4.png" alt></p>
</li>
<li>
<p>配置分区，选址本地标准磁盘，并且在分区中勾选&quot;我要配置分区&quot;,“我想让额外空间可用”；初学者可以使用自动配置分区<br>
<img src="/Installing-CentOS-system/5.png" alt></p>
</li>
<li>
<p>开始安装<br>
<img src="/Installing-CentOS-system/6.png" alt></p>
</li>
<li>
<p>设置Root账户<br>
<img src="/Installing-CentOS-system/7.png" alt></p>
</li>
<li>
<p>等待安装成功,安装成功后会提示重启；<br>
<img src="/Installing-CentOS-system/8.png" alt></p>
</li>
</ol>
<h2 id="2-永久关闭防火墙"><a class="markdownIt-Anchor" href="#2-永久关闭防火墙"></a> 2. 永久关闭防火墙</h2>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">一、下面是red hat/CentOs7关闭防火墙的命令!</span><br><span class="line"><span class="meta">#</span><span class="bash">1:查看防火状态</span></span><br><span class="line">systemctl status firewalld</span><br><span class="line">service iptables status</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">2:暂时关闭防火墙</span></span><br><span class="line">systemctl stop firewalld</span><br><span class="line">service iptables stop</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">3:永久关闭防火墙</span></span><br><span class="line">systemctl disable firewalld</span><br><span class="line">chkconfig iptables off</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">4:重启防火墙</span></span><br><span class="line"></span><br><span class="line">systemctl enable firewalld</span><br><span class="line">service iptables restart</span><br></pre></td></tr></table></figure>
<h2 id="3-配置selinux"><a class="markdownIt-Anchor" href="#3-配置selinux"></a> 3. 配置SELinux</h2>
<p>SELinux是Linux 内核中提供的强制访问控制系统。selinux有disabled、permissive、enforcing 三种选择：</p>
<ul>
<li>disabled ：不启用控制系统。</li>
<li>permissive：开启控制系统，但是处于警告模式。即使你违反了策略的话它让你继续操作，但是把你的违反的内容记录下来。</li>
<li>Enforcing：开启控制系统，处于强制状态。一旦违反了策略，就无法继续操作下去</li>
</ul>
<p>使用命令：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /etc/sysconfig/</span><br><span class="line">vim selinux</span><br></pre></td></tr></table></figure>
<p><img src="/Installing-CentOS-system/3-1.png" alt></p>
<h2 id="4修改ip配置文件"><a class="markdownIt-Anchor" href="#4修改ip配置文件"></a> 4.修改ip配置文件</h2>
<ol>
<li>
<p>进入文件目录</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /etc/sysconfig/network-scripts/   #进入配置文件</span><br></pre></td></tr></table></figure>
<p><img src="/Installing-CentOS-system/4-1.png" alt></p>
</li>
<li>
<p>写入配置信息并保存退出</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim ifcfg-ens33 #编辑配置文件ifcfg-ens33</span><br></pre></td></tr></table></figure>
<p>如果要设置固定IP的话，常见设置属性有：BOOTPROTO、ONBOOT、IPADDR、NETMASK、GATEWAY</p>
 <figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment">#以下为配置文件的内容</span></span><br><span class="line"><span class="string">TYPE=&quot;Ethernet&quot;</span>		<span class="comment">#网卡类型（通常是Ethemet以太网）</span></span><br><span class="line"><span class="string">PROXY_METHOD=&quot;none&quot;</span>	<span class="comment">#代理方式：为关闭状态</span></span><br><span class="line"><span class="string">BROWSER_ONLY=&quot;no&quot;</span>	<span class="comment">#只是浏览器：否</span></span><br><span class="line"><span class="string">BOOTPROTO=&quot;static&quot;</span>	<span class="comment">#网卡的引导协议【static：静态IP(指定静态后IP地址就固定了,不建议采用动态分配)  dhcp：动态IP   none：不指定，不指定容易出现各种各样的网络受限】</span></span><br><span class="line"><span class="string">DEFROUTE=&quot;yes&quot;</span>		<span class="comment">#默认路由</span></span><br><span class="line"><span class="string">IPV4_FAILURE_FATAL=&quot;no&quot;</span>		<span class="comment">#是否开启IPV4致命错误检测</span></span><br><span class="line"><span class="string">IPV6INIT=&quot;yes&quot;</span>		<span class="comment">#IPV6是否自动初始化：是（现在还未用到IPV6，不会有任何影响）</span></span><br><span class="line"><span class="string">IPV6_AUTOCONF=&quot;yes&quot;</span>	<span class="comment">#IPV6是否自动配置：是（现在还未用到IPV6，不会有任何影响）</span></span><br><span class="line"><span class="string">IPV6_DEFROUTE=&quot;yes&quot;</span>	<span class="comment">#IPV6是否可以为默认路由：是（现在还未用到IPV6，不会有任何影响）</span></span><br><span class="line"><span class="string">IPV6_FAILURE_FATAL=&quot;no&quot;</span>		<span class="comment">#是否开启IPV6致命错误检测</span></span><br><span class="line"><span class="string">IPV6_ADDR_GEN_MODE=&quot;stable-privacy&quot;</span>	<span class="comment">#IPV6地址生成模型</span></span><br><span class="line"><span class="string">NAME=&quot;ens33&quot;</span>		<span class="comment">#网卡物理设备名称</span></span><br><span class="line"><span class="string">UUID=&quot;ab60d501-535b-49f5-a76b-3336a4120f64&quot;</span> <span class="comment">#通用唯一识别码，每一个网卡都会有，不能重复，否则两台linux机器只有一台可上网,可不写</span></span><br><span class="line"><span class="string">DEVICE=&quot;ens33&quot;</span>		<span class="comment">#网卡设备名称，必须和‘NAME’值一样</span></span><br><span class="line"><span class="string">ONBOOT=&quot;yes&quot;</span>		<span class="comment">#是否开机启动(如果yes则开机后自动加载使用当前配置文件)，要想网卡开机就启动或通过 `systemctl restart network`控制网卡,必须设置为 `yes`</span></span><br><span class="line"><span class="string">IPADDR=192.168.1.111</span>		<span class="comment"># 本机IP 设置固定IP 对应上面的BOOTPROTO</span></span><br><span class="line"><span class="string">NETMASK=255.255.255.0</span>		<span class="comment">#子网掩码 ,可不写</span></span><br><span class="line"><span class="string">GATEWAY=192.168.137.2</span>		<span class="comment">#默认网关 ,可不写</span></span><br><span class="line"><span class="string">DNS1=8.8.8.8</span> <span class="comment"># 可不写</span></span><br><span class="line"><span class="string">DNS2=8.8.8.5</span> <span class="comment"># 可不写</span></span><br><span class="line"><span class="string">ZONE=public</span> <span class="comment"># 可不写</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>重启网络服务</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">service network restart  #重启网卡</span><br></pre></td></tr></table></figure>
<p><img src="/Installing-CentOS-system/4-2.png" alt></p>
</li>
<li>
<p>查看IP</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ip addr</span><br></pre></td></tr></table></figure>
<p><img src="/Installing-CentOS-system/4-3.png" alt></p>
</li>
<li>
<p>重启系统</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">reboot</span><br></pre></td></tr></table></figure>
</li>
</ol>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Java中将List列表转换为字符串</title>
    <url>/list-to-string/</url>
    <content><![CDATA[<h3 id="1-tostring-方法"><a class="markdownIt-Anchor" href="#1-tostring-方法"></a> 1. toString() 方法</h3>
<p>List.toString()是最简单的，但它在开头和结尾添加方括号，每个字符串用逗号分隔符分隔。<br>
缺点是我们不能用另一个分隔符替换逗号，也不能去掉方括号</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ListToStringUsingToStringExample</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args)</span> </span>&#123;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">// creating a list with strings.</span></span><br><span class="line">    List&lt;String&gt; list = Arrays.asList(<span class="string">&quot;One&quot;</span>,</span><br><span class="line">                      <span class="string">&quot;Two&quot;</span>,</span><br><span class="line">                      <span class="string">&quot;Three&quot;</span>,</span><br><span class="line">                      <span class="string">&quot;Four&quot;</span>,</span><br><span class="line">                      <span class="string">&quot;Five&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// converting List&lt;String&gt; to String using toString() method</span></span><br><span class="line">    String stringFromList = list.toString();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// priting the string</span></span><br><span class="line">    System.out.println(<span class="string">&quot;String : &quot;</span>+stringFromList);        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 输出：String : [One, Two, Three, Four, Five]</span></span><br></pre></td></tr></table></figure>
<h3 id="2-java-8-stringjoin"><a class="markdownIt-Anchor" href="#2-java-8-stringjoin"></a> 2. Java 8 String.join()</h3>
<p>java 8 String添加了一个特殊的方法String.join()以将集合转换为具有给定分隔符的字符串</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ListToStringUsingString_JoinExample</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// creating a list with strings.</span></span><br><span class="line">        List&lt;String&gt; list = Arrays.asList(<span class="string">&quot;One&quot;</span>,</span><br><span class="line">                          <span class="string">&quot;Two&quot;</span>,</span><br><span class="line">                          <span class="string">&quot;Three&quot;</span>,</span><br><span class="line">                          <span class="string">&quot;Four&quot;</span>,</span><br><span class="line">                          <span class="string">&quot;Five&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// converting List&lt;String&gt; to String using toString() method</span></span><br><span class="line">        String stringFromList = String.join(<span class="string">&quot;~&quot;</span>, list);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// priting the string</span></span><br><span class="line">        System.out.println(<span class="string">&quot;String with tilde delimiter: &quot;</span>+stringFromList);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// delimiting with pipe | symbol.</span></span><br><span class="line">        String stringPipe = String.join(<span class="string">&quot;|&quot;</span>, list);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// printing</span></span><br><span class="line">        System.out.println(<span class="string">&quot;String with pipe delimiter : &quot;</span>+stringPipe);</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//输出：</span></span><br><span class="line"><span class="comment">//  String with tilde delimiter: One~Two~Three~Four~Five</span></span><br><span class="line"><span class="comment">//  String with pipe delimiter : One|Two|Three|Four|Five</span></span><br></pre></td></tr></table></figure>
<h3 id="3-collectorsjoining"><a class="markdownIt-Anchor" href="#3-collectorsjoining"></a> 3. Collectors.joining()</h3>
<p>Collectors.join()方法来自 java 8 stream api。Collctors.joining()方法将分隔符、前缀和后缀作为参数。此方法将列表转换为具有给定分隔符、前缀和后缀的字符串。</p>
<p>查看以下有关使用不同分隔符的 join() 方法的示例。但是，String.join() 方法不提供前缀和后缀选项。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ListToStringUsingString_JoinExample</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// creating a list with strings.</span></span><br><span class="line">        List&lt;String&gt; list = Arrays.asList(<span class="string">&quot;One&quot;</span>,</span><br><span class="line">                          <span class="string">&quot;Two&quot;</span>,</span><br><span class="line">                          <span class="string">&quot;Three&quot;</span>,</span><br><span class="line">                          <span class="string">&quot;Four&quot;</span>,</span><br><span class="line">                          <span class="string">&quot;Five&quot;</span>);</span><br><span class="line">    </span><br><span class="line">        <span class="comment">// using java 8 Collectors.joining with delimiter, prefix and suffix</span></span><br><span class="line">        String joiningString = list.stream().collect(Collectors.joining(<span class="string">&quot;-&quot;</span>, <span class="string">&quot;&#123;&quot;</span>, <span class="string">&quot;&#125;&quot;</span>));</span><br><span class="line">        <span class="comment">// printing</span></span><br><span class="line">        System.out.println(<span class="string">&quot;Collectors.joining string : &quot;</span>+joiningString);</span><br><span class="line">        String joiningString3 = list.stream().collect(Collectors.joining(<span class="string">&quot;@&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>));</span><br><span class="line">        <span class="comment">// printing</span></span><br><span class="line">        System.out.println(<span class="string">&quot;Collectors.joining string with @ separator : &quot;</span>+joiningString3);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//输出：</span></span><br><span class="line"><span class="comment">//Collectors.joining string : &#123;One-Two-Three-Four-Five&#125;</span></span><br><span class="line"><span class="comment">//Collectors.joining string with @ separator : One@Two@Three@Four@Five</span></span><br></pre></td></tr></table></figure>
<h3 id="4-apache-commons-stringutilsjoin"><a class="markdownIt-Anchor" href="#4-apache-commons-stringutilsjoin"></a> 4. Apache Commons StringUtils.join()</h3>
<p>使用来自 apache commons 包的外部库。该库有一个方法StringUtils.join() ，它采用类似于 String.join() 方法的列表和分隔符</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ListToStringUsingStringUtils_JoinExample</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// creating a list with strings.</span></span><br><span class="line">        List&lt;String&gt; list = Arrays.asList(<span class="string">&quot;One&quot;</span>,</span><br><span class="line">                          <span class="string">&quot;Two&quot;</span>,</span><br><span class="line">                          <span class="string">&quot;Three&quot;</span>,</span><br><span class="line">                          <span class="string">&quot;Four&quot;</span>,</span><br><span class="line">                          <span class="string">&quot;Five&quot;</span>);</span><br><span class="line">    </span><br><span class="line">        <span class="comment">// using java 8 Collectors.joining with delimiter, prefix and suffix</span></span><br><span class="line">        String joiningString = StringUtils.join(list, <span class="string">&quot;^&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// printing</span></span><br><span class="line">        System.out.println(<span class="string">&quot;StringUtils.join string with ^ delimiter : &quot;</span>+joiningString);</span><br><span class="line">        </span><br><span class="line">        String joiningString3 = StringUtils.join(list, <span class="string">&quot;$&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// printing</span></span><br><span class="line">        System.out.println(<span class="string">&quot;StringUtils.join string with @ separator : &quot;</span>+joiningString3);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//输出：</span></span><br><span class="line"><span class="comment">//  StringUtils.join string with ^ delimiter : One^Two^Three^Four^Five</span></span><br><span class="line"><span class="comment">//  StringUtils.join string with @ separator : One$Two$Three$Four$Five</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>集合</tag>
      </tags>
  </entry>
  <entry>
    <title>linux关机命令</title>
    <url>/shutdown/</url>
    <content><![CDATA[<h3 id="1-shutdown命令"><a class="markdownIt-Anchor" href="#1-shutdown命令"></a> 1. shutdown命令</h3>
<p>shutdown会给系统计划一个时间关机。它可以被用于停止、关机、重启机器。<br>
你可以指定一个时间字符串（通常是 now或者用hh:mm 指定小时/分钟）作为第一个参数。</p>
<p>shutdown命令示例：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">shutdown</span><br><span class="line"></span><br><span class="line">shutdown now  #立即关机</span><br><span class="line"></span><br><span class="line">shutdown 13:20  # 下午13：20关机</span><br><span class="line"></span><br><span class="line">shutdown -p now  ### 关闭机器</span><br><span class="line"></span><br><span class="line">shutdown -H now  ### 停止机器      </span><br><span class="line"></span><br><span class="line">shutdown -r09:35 ### 在 09:35am 重启机器</span><br><span class="line"></span><br><span class="line">shutdown -c  ## 取消关机</span><br></pre></td></tr></table></figure>
<h3 id="2-halt-命令"><a class="markdownIt-Anchor" href="#2-halt-命令"></a> 2. halt 命令</h3>
<p>halt通知硬件来停止所有的 CPU 功能，但是仍然保持通电。你可以用它使系统处于低层维护状态。<br>
注意在有些情况会它会完全关闭系统。</p>
<p>halt 命令示例：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">halt             ### 停止机器</span><br><span class="line"></span><br><span class="line">halt -p          ### 关闭机器</span><br><span class="line"></span><br><span class="line">halt --reboot    ### 重启机器</span><br></pre></td></tr></table></figure>
<h3 id="3poweroff-命令"><a class="markdownIt-Anchor" href="#3poweroff-命令"></a> 3.poweroff 命令</h3>
<p>poweroff会发送一个 ACPI 信号来通知系统关机</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">poweroff           ### 关闭机器</span><br><span class="line"></span><br><span class="line">poweroff --halt    ### 停止机器</span><br><span class="line"></span><br><span class="line">poweroff --reboot  ### 重启机器</span><br></pre></td></tr></table></figure>
<h3 id="4reboot-命令"><a class="markdownIt-Anchor" href="#4reboot-命令"></a> 4.reboot 命令</h3>
<p>reboot 通知系统重启。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">reboot           ### 重启机器</span><br><span class="line"></span><br><span class="line">reboot --halt    ### 停止机器</span><br><span class="line"></span><br><span class="line">reboot -p        ### 关闭机器</span><br></pre></td></tr></table></figure>
<h3 id="5-init-命令"><a class="markdownIt-Anchor" href="#5-init-命令"></a> 5. init 命令</h3>
<p>一. init是Linux系统操作中不可缺少的程序之一。<br>
所谓的init进程，它是一个由内核启动的用户级进程。<br>
内核自行启动（已经被载入内存，开始运行，并已初始化所有的设备驱动程序和数据结构等）之后，就通过启动一个用户级程序init的方式，完成引导进程。所以,init始终是第一个进程（其进程编号始终为1）。<br>
内核会在过去曾使用过init的几个地方查找它，它的正确位置（对Linux系统来说）是/sbin/init。如果内核找不到init，它就会试着运行/bin/sh，如果运行失败，系统的启动也会失败。</p>
<p>二. init一共分为7个级别，这7个级别的所代表的含义如下</p>
<p>0：停机或者关机（千万不能将initdefault设置为0）</p>
<p>1：单用户模式，只root用户进行维护</p>
<p>2：多用户模式，不能使用NFS(Net File System)</p>
<p>3：完全多用户模式（标准的运行级别）</p>
<p>4：安全模式</p>
<p>5：图形化（即图形界面）</p>
<p>6：重启（千万不要把initdefault设置为6）</p>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>shutdown</tag>
      </tags>
  </entry>
  <entry>
    <title>docker安装</title>
    <url>/docker-01/</url>
    <content><![CDATA[<p>新的服务器没有安装docker，使用docker命令时提示：docker: command not found错误信息</p>
<h5 id="1-更新yum包"><a class="markdownIt-Anchor" href="#1-更新yum包"></a> 1. 更新yum包</h5>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum update</span><br></pre></td></tr></table></figure>
<h5 id="2安装依赖软件包"><a class="markdownIt-Anchor" href="#2安装依赖软件包"></a> 2.安装依赖软件包</h5>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install -y yum-utils device-mapper-persistent-data lvm2</span><br></pre></td></tr></table></figure>
<h5 id="3设置yum源"><a class="markdownIt-Anchor" href="#3设置yum源"></a> 3.设置yum源</h5>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure>
<h5 id="4安装docker"><a class="markdownIt-Anchor" href="#4安装docker"></a> 4.安装docker</h5>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">默认安装最新的docker稳定版本。</span></span><br><span class="line">yum install docker-ce</span><br></pre></td></tr></table></figure>
<h5 id="5启动docker服务"><a class="markdownIt-Anchor" href="#5启动docker服务"></a> 5.启动docker服务</h5>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl start docker</span><br></pre></td></tr></table></figure>
<h5 id="6设置开机自启动"><a class="markdownIt-Anchor" href="#6设置开机自启动"></a> 6.设置开机自启动</h5>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl enable docker</span><br></pre></td></tr></table></figure>
<h5 id="7-查看docker版本信息"><a class="markdownIt-Anchor" href="#7-查看docker版本信息"></a> 7. 查看docker版本信息</h5>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker version</span><br></pre></td></tr></table></figure>
<p><img src="/docker-01/1.png" alt="查看docker版本"><br>
至此，解决。</p>
<h5 id="8-停止所有容器"><a class="markdownIt-Anchor" href="#8-停止所有容器"></a> 8. 停止所有容器</h5>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker stop $(docker ps -a | awk &#x27;&#123; print $1&#125;&#x27; | tail -n +2)</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>docker安装mysql</title>
    <url>/docker-mysql/</url>
    <content><![CDATA[<h5 id="1查看所有的镜像"><a class="markdownIt-Anchor" href="#1查看所有的镜像"></a> 1.查看所有的镜像</h5>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker search mysql</span><br></pre></td></tr></table></figure>
<p><img src="/docker-mysql/1.png" alt></p>
<h5 id="2拉取最新版本的镜像"><a class="markdownIt-Anchor" href="#2拉取最新版本的镜像"></a> 2.拉取最新版本的镜像</h5>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker pull mysql</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">或者指定版本</span></span><br><span class="line">docker pull mysql:8.0.16</span><br></pre></td></tr></table></figure>
<p><img src="/docker-mysql/2.png" alt></p>
<h5 id="3创建数据目录和配置文件"><a class="markdownIt-Anchor" href="#3创建数据目录和配置文件"></a> 3.创建数据目录和配置文件</h5>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mkdir -p /usr/mysql/conf /usr/mysql/data</span><br><span class="line"></span><br><span class="line">chmod -R 777 /usr/mysql/</span><br></pre></td></tr></table></figure>
<h5 id="4创建配置文件"><a class="markdownIt-Anchor" href="#4创建配置文件"></a> 4.创建配置文件</h5>
<p>在上面创建的配置文件目录/usr/mysql/conf下创建MySQL的配置文件my.cnf</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">touch my.cnf;</span><br><span class="line"></span><br><span class="line">vim /usr/mysql/conf/my.cnf;</span><br></pre></td></tr></table></figure>
<p>添加以下内容到上述创建的配置文件中</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">[client]</span></span><br><span class="line"><span class="comment">#socket = /usr/mysql/mysqld.sock</span></span><br><span class="line"><span class="meta">default-character-set</span> = <span class="string">utf8mb4</span></span><br><span class="line"><span class="attr">[mysqld]</span></span><br><span class="line"><span class="comment">#pid-file        = /var/run/mysqld/mysqld.pid</span></span><br><span class="line"><span class="comment">#socket          = /var/run/mysqld/mysqld.sock</span></span><br><span class="line"><span class="comment">#datadir         = /var/lib/mysql</span></span><br><span class="line"><span class="comment">#socket = /usr/mysql/mysqld.sock</span></span><br><span class="line"><span class="comment">#pid-file = /usr/mysql/mysqld.pid</span></span><br><span class="line"><span class="attr">datadir</span> = <span class="string">/usr/mysql/data</span></span><br><span class="line"><span class="attr">character_set_server</span> = <span class="string">utf8mb4</span></span><br><span class="line"><span class="attr">collation_server</span> = <span class="string">utf8mb4_bin</span></span><br><span class="line"><span class="meta">secure-file-priv</span>= <span class="string">NULL</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># Disabling symbolic-links is recommended to prevent assorted security risks</span></span><br><span class="line"><span class="meta">symbolic-links</span>=<span class="string">0</span></span><br><span class="line"><span class="comment"># Custom config should go here</span></span><br><span class="line"><span class="comment">!includedir /etc/mysql/conf.d/</span></span><br></pre></td></tr></table></figure>
<h5 id="5启动创建容器"><a class="markdownIt-Anchor" href="#5启动创建容器"></a> 5.启动创建容器</h5>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run --restart=unless-stopped -d --name mysql -v /usr/mysql/conf/my.cnf:/etc/mysql/my.cnf -v /usr/mysql/data:/var/lib/mysql -p 3306:3306 -e MYSQL_ROOT_PASSWORD=xiaoyuge mysql</span><br></pre></td></tr></table></figure>
<p>参数解释：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">–name mysql5.7 容器别名</span><br><span class="line">-p 3307:3306 映射容器端口号和宿主机端口号（本机3307端口映射容器3306端口）</span><br><span class="line">-v /data/mysql/datadir:/var/lib/mysql 目录映射（挂载宿主机目录和 docker容器中的目录，前面是宿主机目录，后面是容器内部目录）</span><br><span class="line">-v /data/mysql/conf.d:/etc/mysql/conf.d 目录映射（mysql配置目录）</span><br><span class="line">-d 后台运行</span><br><span class="line">-e 环境参数，MYSQL_ROOT_PASSWORD设置root用户的密码</span><br></pre></td></tr></table></figure>
<p><img src="/docker-mysql/3.png" alt="启动创建容器"><br>
执行上述命令后，执行查询容器的命令就可以看到创建的mysql容器</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker ps -a</span><br></pre></td></tr></table></figure>
<p><img src="/docker-mysql/4.png" alt="启动创建容器"></p>
<h5 id="常见问题"><a class="markdownIt-Anchor" href="#常见问题"></a> 常见问题</h5>
<h6 id="1远程无法链接"><a class="markdownIt-Anchor" href="#1远程无法链接"></a> 1.远程无法链接</h6>
<p>上述虽然安装好了mysql，但是使用远程的Navicat连接时提示错误，不能正确连接mysql，此时需要修改按照下面说的步骤修改一下mysql的密码模式以及主机等内容才可以。<br>
修改mysql密码以及可访问主机</p>
<ol>
<li>进入容器内部 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker exec -it mysql /bin/bash</span><br></pre></td></tr></table></figure>
</li>
<li>连接mysql <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mysql -uroot -p</span><br></pre></td></tr></table></figure>
</li>
<li>使用mysql库 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">use mysql;</span><br></pre></td></tr></table></figure>
</li>
<li>修改访问主机以及密码等，设置为所有主机可访问 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ALTER USER &#x27;root&#x27;@&#x27;%&#x27; IDENTIFIED WITH mysql_native_password BY &#x27;新密码&#x27;;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">注意： mysql_native_password，mysql8.x版本必须使用这种模式，否则navicate无法正确连接</span></span><br></pre></td></tr></table></figure>
</li>
<li>刷新 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">flush privileges;</span><br><span class="line"></span><br><span class="line">exit;</span><br></pre></td></tr></table></figure>
</li>
<li>远程使用Navicat连接数据库<br>
<img src="/docker-mysql/5.png" alt="连接"></li>
</ol>
<h6 id="2docker启动mysql容器报错"><a class="markdownIt-Anchor" href="#2docker启动mysql容器报错"></a> 2.docker启动mysql容器报错</h6>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run --restart=unless-stopped -d --name mysql -v /usr/mysql/conf/my.cnf:/etc/mysql/my.cnf -v /usr/mysql/data:/var/lib/mysql -p 3306:3306 -e MYSQL_ROOT_PASSWORD=xiaoyuge mysql</span><br></pre></td></tr></table></figure>
<p>启动时提示：Error response from daemon: OCI runtime create failed: container_linux.go:380: starting container process caused: process_linux.go:545: container init caused: Running hook #0:: error running hook: signal: segmentation fault (core dumped), stdout: , stderr:: unknown</p>
<p><img src="/docker-mysql/6.png" alt><br>
解决方式：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo yum upgrade</span><br></pre></td></tr></table></figure>
<p>或者可以试下</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">rm -rf /usr/mysql/conf/my.cnf</span><br><span class="line">touch /usr/mysql/conf/my.cnf</span><br><span class="line">vim my.cnf</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">然后重新配置一下</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title>docker安装nginx</title>
    <url>/docker-nginx/</url>
    <content><![CDATA[<h5 id="1查看所有的镜像"><a class="markdownIt-Anchor" href="#1查看所有的镜像"></a> 1.查看所有的镜像</h5>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker search nginx</span><br></pre></td></tr></table></figure>
<p><img src="/docker-nginx/1.png" alt></p>
<h5 id="2拉取最新版本的镜像"><a class="markdownIt-Anchor" href="#2拉取最新版本的镜像"></a> 2.拉取最新版本的镜像</h5>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker pull nginx</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">或者指定最新版本</span></span><br><span class="line">docker pull nginx:latest</span><br></pre></td></tr></table></figure>
<p><img src="/docker-nginx/2.png" alt></p>
<h5 id="3使用命令查看本地镜像确定nginx镜像已下载到本地"><a class="markdownIt-Anchor" href="#3使用命令查看本地镜像确定nginx镜像已下载到本地"></a> 3.使用命令查看本地镜像，确定nginx镜像已下载到本地</h5>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure>
<p><img src="/docker-nginx/3.png" alt></p>
<h5 id="4-创建挂载目录"><a class="markdownIt-Anchor" href="#4-创建挂载目录"></a> 4. 创建挂载目录</h5>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mkdir -p /data/nginx/&#123;conf,conf.d,html,logs&#125;</span><br></pre></td></tr></table></figure>
<h5 id="5-创建配置文件"><a class="markdownIt-Anchor" href="#5-创建配置文件"></a> 5. 创建配置文件</h5>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">touch nginx.cnf</span><br></pre></td></tr></table></figure>
<h5 id="6-nginx详情配置请参考httpsxiaoyugework20211205nginx-02"><a class="markdownIt-Anchor" href="#6-nginx详情配置请参考httpsxiaoyugework20211205nginx-02"></a> 6. Nginx详情配置请参考：<a href="https://xiaoyuge.work/2021/12/05/nginx-02/">https://xiaoyuge.work/2021/12/05/nginx-02/</a></h5>
<h5 id="7-查看容器"><a class="markdownIt-Anchor" href="#7-查看容器"></a> 7. 查看容器</h5>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker ps -a</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> docker stop xxx  停止某个容器运行</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> docker rm xxx  删除容器</span></span><br></pre></td></tr></table></figure>
<p><img src="/docker-nginx/6.png" alt="查看容器"></p>
<h5 id="8启动容器挂载配置文件"><a class="markdownIt-Anchor" href="#8启动容器挂载配置文件"></a> 8.启动容器，挂载配置文件</h5>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run --name mynginx -d -p 80:80 -v /data/nginx/conf/nginx.conf:/etc/nginx/nginx.conf -v /data/nginx/logs:/var/log/nginx -d docker.io/nginx</span><br></pre></td></tr></table></figure>
<p>可以通过命令docker exec -it nginx-test bash进入容器内容修改配置</p>
<p><img src="/docker-nginx/4.png" alt></p>
<h5 id="9安装完毕访问地址-httplocalhost8080出现如下内容安装成功"><a class="markdownIt-Anchor" href="#9安装完毕访问地址-httplocalhost8080出现如下内容安装成功"></a> 9.安装完毕，访问地址 <a href="http://localhost:8080">http://localhost:8080</a>，出现如下内容，安装成功！！！</h5>
<p><img src="/docker-nginx/5.png" alt></p>
<h5 id="10域名解析配置"><a class="markdownIt-Anchor" href="#10域名解析配置"></a> 10.域名解析配置</h5>
<p>我买的是阿里云的服务器以及域名，上面操作后，忘记在阿里云控制台中去配置<br>
<img src="/docker-nginx/7.png" alt><br>
<img src="/docker-nginx/8.png" alt="域名解析"></p>
<h5 id="11配置多个二级域名"><a class="markdownIt-Anchor" href="#11配置多个二级域名"></a> 11.配置多个二级域名</h5>
<p>在第8步的时候将docker容器中的nginx配置映射到了目录/data/nginx/conf下面；<br>
修改nginx.conf</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">user  nginx;</span><br><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line">error_log  /var/log/nginx/error.log warn;</span><br><span class="line">pid        /var/run/nginx.pid;</span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line">http &#123;</span><br><span class="line">    include       /etc/nginx/mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line">    log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class="line">                      &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class="line">                      &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br><span class="line">    access_log  /var/log/nginx/access.log  main;</span><br><span class="line">    sendfile        on;</span><br><span class="line">    #tcp_nopush     on;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line">    #gzip  on;</span><br><span class="line">    </span><br><span class="line">    #引入conf.d下面所有的配置文件</span><br><span class="line">    include /etc/nginx/conf.d/*.conf;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后在conf.d目录下面创建了两个子域名反向代理配置文件,其他的域名代理相同，只要改server_name和proxy_pass代理端口，配置文件需以.conf结尾<br>
<img src="/docker-nginx/8.png" alt="域名解析"></p>
<ul>
<li>
<p>note.xiaoyuge520.vip.conf</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">########   Nginx的main(全局配置)文件</span><br><span class="line">#指定nginx运行的用户及用户组,默认为nobody</span><br><span class="line">#user  nobody;</span><br><span class="line">#开启的线程数，一般跟逻辑CPU核数一致</span><br><span class="line">worker_processes  1;</span><br><span class="line">events &#123;</span><br><span class="line">#设置工作模式为epoll,除此之外还有select,poll,kqueue,rtsig和/dev/poll模式</span><br><span class="line">#use epoll;</span><br><span class="line">    #定义每个进程的最大连接数,受系统进程的最大打开文件数量限制。</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line">#######Nginx的Http服务器配置,Gzip配置</span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    #核心模块指令，智力默认设置为二进制流，也就是当文件类型未定义时使用这种方式</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line">    #开启高效文件传输模式</span><br><span class="line">    sendfile        on;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line">    ########Nginx的server虚拟主机配置</span><br><span class="line">    server &#123;</span><br><span class="line">        #监听端口为 80</span><br><span class="line">        listen       80;</span><br><span class="line">        #设置主机域名</span><br><span class="line">        server_name  note.xiaoyuge520.vip;</span><br><span class="line">        #设置访问的语言编码</span><br><span class="line">        #charset koi8-r;</span><br><span class="line">        #设置虚拟主机访问日志的存放路径及日志的格式为main</span><br><span class="line">        #access_log  logs/host.access.log  main;</span><br><span class="line"></span><br><span class="line">        #设置虚拟主机的基本信息</span><br><span class="line">        location / &#123;</span><br><span class="line">            proxy_set_header  Host  $http_host;</span><br><span class="line">            proxy_set_header  X-Real-IP  $remote_addr;</span><br><span class="line">            proxy_set_header  X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">            proxy_pass http://47.101.130.163:8086/note; # 代理ip:端口</span><br><span class="line">        &#125;</span><br><span class="line">        error_page   500 502 503 504  /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>record.xiaoyuge520.vip.conf</p>
  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">worker_processes  1;</span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line">#######Nginx的Http服务器配置,Gzip配置</span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line">    sendfile        on;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  record.xiaoyuge520.vip;</span><br><span class="line">        #access_log  logs/host.access.log  main;</span><br><span class="line">        location / &#123;</span><br><span class="line">            proxy_set_header  Host  $http_host;</span><br><span class="line">            proxy_set_header  X-Real-IP  $remote_addr;</span><br><span class="line">            proxy_set_header  X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">            proxy_pass http://47.101.130.163:8888/record; # 代理ip:端口</span><br><span class="line">        &#125;</span><br><span class="line">        error_page   500 502 503 504  /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>如果挂载之后容器运行正常却依然不能通过域名访问可尝试以下操作</strong></p>
  <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">查看所有容器,获取nginx的container 名称</span></span><br><span class="line">docker ps -a</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">向名称为nginx的容器发送脚本命令, mynginx 为容器名称</span></span><br><span class="line">docker exec -it mynginx /bin/bash</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">重新加载配置命令</span></span><br><span class="line">cd /etc/nginx/conf.d</span><br><span class="line">service nginx reload</span><br><span class="line"><span class="meta">#</span><span class="bash">检查配置文件路径是否正确</span></span><br></pre></td></tr></table></figure>
<p><strong>每一次更改配置文件都需要重启容器</strong></p>
<h2 id="-code11-"><a class="markdownIt-Anchor" href="#-code11-"></a> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 重启nginx容器</span></span><br><span class="line">docker restart nginx </span><br><span class="line"><span class="meta">  </span></span><br><span class="line"><span class="meta">#</span><span class="bash">查看容器状态</span></span><br><span class="line">docker ps</span><br><span class="line"><span class="meta">  </span></span><br><span class="line"><span class="meta">#</span><span class="bash">如果挂载失败，查看nginx容器<span class="built_in">log</span>,显示错误信息，根据错误信息 更改配置文件等</span></span><br><span class="line">docker logs -t nginx</span><br></pre></td></tr></table></figure></h2>
<p>以上配置完成之后能够通过域名访问网站，但是css样式却被nginx解析成text/plain，打开控制台可看到warn信息</p>
<p><strong>解决nginx将css文件解析为text/plain</strong></p>
<ul>
<li>
<p>方法一： ngin.conf中http添加：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">include       /etc/nginx/mime.types;</span><br><span class="line">default_type  application/octet-stream;</span><br></pre></td></tr></table></figure>
<p>注：此办法并不能使我网站的css正确解析，因为在拷贝nginx镜像中的原配置文件时，就已经添加mime.types了。却依然不能正确解析。</p>
</li>
<li>
<p>方法二：解析成功，原因未知</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">将index.html中<span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span>去掉。</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>通过域名访问：成功！！</p>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>Nginx基础篇（二）安装</title>
    <url>/nginx-02/</url>
    <content><![CDATA[<h2 id="1nginx安装"><a class="markdownIt-Anchor" href="#1nginx安装"></a> 1.Nginx安装</h2>
<ol>
<li>
<p>安装nginx前首先要确认系统中是否安装了gcc 、pcre-devel、zlib-devel、openssl-devel</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">1、rpm包安装的，可以用 rpm -qa 看到，如果要查找某软件包是否安装，用 rpm -qa | grep <span class="string">&quot;软件或者包的名字&quot;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">2、以deb包安装的，可以用 dpkg -l 看到。如果是查找指定软件包，用 dpkg -l | grep <span class="string">&quot;软件或者包的名字&quot;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">3、yum方法安装的，可以用 yum list installed 查找，如果是查找指定包，用 yum list installed | grep <span class="string">&quot;软件名或者包名&quot;</span></span></span><br><span class="line">yum list installed | grep &quot;gcc&quot;</span><br></pre></td></tr></table></figure>
<p><img src="/nginx-02/image-20201210100736952.png" alt="image-20201210103251475"></p>
</li>
<li>
<p>安装依赖包</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum -y install gcc pcre-devel zlib-devel openssl openssl-devel</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>下载并解压安装包</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">//创建nginx存放文件夹</span><br><span class="line">cd /usr/local</span><br><span class="line">mkdir nginx</span><br><span class="line">cd nginx</span><br><span class="line"><span class="meta">#</span><span class="bash">下载tar包</span></span><br><span class="line">wget http://nginx.org/download/nginx-1.13.7.tar.gz</span><br><span class="line">tar -xvf nginx-1.13.7.tar.gz</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>配置</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd nginx-1.13.7</span><br><span class="line">./configure --prefix=/usr/local/nginx</span><br><span class="line"></span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>测试是否安装成功</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./sbin/nginx -t</span><br></pre></td></tr></table></figure>
 <img src="/nginx-02/_posts/2021/07/nginx/image-20201210101238462.png" alt="image-20201210101238462" style="zoom: 67%;float:right;">
</li>
<li>
<p>配置nginx.conf</p>
 <figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="string">vim</span> <span class="string">/usr/local/nginx/cong/nginx.conf</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#修改如下</span></span><br><span class="line"><span class="string">server</span> &#123;</span><br><span class="line">  <span class="string">listen</span> <span class="number">80</span><span class="string">;</span></span><br><span class="line">  <span class="string">server_name</span> <span class="string">localhost;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 注意设定 root路径是有dist的</span></span><br><span class="line">  <span class="string">location</span> <span class="string">/</span> &#123;</span><br><span class="line">    <span class="string">root</span> <span class="string">/usr/local/webapp/dist;</span></span><br><span class="line">    <span class="string">index</span> <span class="string">/index.html;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">#跨域 ip和port自行替换</span></span><br><span class="line">  <span class="string">location</span> <span class="string">/adminApi</span> &#123;</span><br><span class="line">    <span class="string">proxy_pass</span> <span class="string">http://ip:port;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>启动</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">启动nginx</span></span><br><span class="line">cd /usr/local/nginx/sbin</span><br><span class="line">./nginx-02 </span><br></pre></td></tr></table></figure>
<p><strong>常用命令：</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">修改配置后重新启动</span></span><br><span class="line">./nginx-02 -s reload</span><br><span class="line"><span class="meta">#</span><span class="bash">如果出现：nginx: [error] open() ＂/usr/<span class="built_in">local</span>/nginx/logs/nginx.pid＂ failed</span></span><br><span class="line">/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf</span><br><span class="line"><span class="meta">#</span><span class="bash">再次启动即可</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">查看nginx进程是否启动</span></span><br><span class="line">ps -ef|grep nginx</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">平滑启动nginx</span></span><br><span class="line">kill -HUP</span><br><span class="line"><span class="meta">#</span><span class="bash">主进程号或进程号文件路径 或者使用</span></span><br><span class="line"></span><br><span class="line">/usr/nginx/sbin/nginx -s reload</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">注意，修改了配置文件后最好先检查一下修改过的配置文件是否正 确，以免重启后Nginx出现错误影响服务器稳定运行。</span></span><br><span class="line"><span class="meta">#</span><span class="bash">判断Nginx配置是否正确命令如下：</span></span><br><span class="line">nginx -t -c /usr/nginx/conf/nginx.conf</span><br><span class="line"><span class="meta">#</span><span class="bash">或者使用</span></span><br><span class="line">/usr/nginx/sbin/nginx -t</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">重启</span></span><br><span class="line">nginx reload</span><br><span class="line">/usr/local/nginx/sbin/nginx -s reload </span><br><span class="line">service nginx restart</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">启动</span></span><br><span class="line">./nginx-02</span><br><span class="line"><span class="meta">#</span><span class="bash">关闭</span></span><br><span class="line">./nginx-02 -s stop</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">配置nginx开机自启动</span></span><br><span class="line">vim /etc/rc.d/rc.local</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">再文件中添加nginx启动地址</span></span><br><span class="line"> </span><br><span class="line">touch /var/lock/subsys/local</span><br><span class="line">/usr/local/redis/bin/redis-server /usr/local/redis/etc/redis.conf</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">设置开机自启动nginx</span></span><br><span class="line">/usr/local/nginx/sb/nginx</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p><img src="/nginx-02/image-20210606160947369.png" alt="image-20201210103251475"></p>
<p>启动后访问localhost 效果如下：<br>
<img src="/nginx-02/image-20201210103251475.png" alt="image-20201210103251475"></p>
<h2 id="2nginx配置"><a class="markdownIt-Anchor" href="#2nginx配置"></a> 2.Nginx配置</h2>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">...... 全局块</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">	//events 块</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##数据库配置</span></span></span><br><span class="line">stream &#123;</span><br><span class="line">    server &#123;</span><br><span class="line">       listen 3306;</span><br><span class="line">       proxy_pass db;    </span><br><span class="line">    &#125;</span><br><span class="line">    upstream db &#123;</span><br><span class="line">       server 192.168.18.130:3305;</span><br><span class="line">       server 192.168.18.129:3305;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http&#123;</span><br><span class="line">    ##http全局块</span><br><span class="line">	server+&#123;</span><br><span class="line">		location +[]</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="21配置内容规则"><a class="markdownIt-Anchor" href="#21配置内容规则"></a> 2.1配置内容规则</h3>
<p>官网配置教程：<a href="https://nginx.org/en/docs/dirindex.html">https://nginx.org/en/docs/dirindex.html</a><br>
变量应用：<a href="https://nginx.org/en/docs/varindex.html">https://nginx.org/en/docs/varindex.html</a></p>
<ul>
<li>用#表示注释</li>
<li>每行配置的结尾需要加上分号</li>
<li>如果配置项值中包括语法符号，比如空格符，那么需要使用单引号或者双引号行括住配置项值，否则ngin x会报语法错误</li>
<li>单位简写：
<ul>
<li>K或者k千字节（kilo byte, KB）</li>
<li>M或者m兆字节（megabyte MB）</li>
<li>ms(毫秒)，s(秒)， m(分)， h(小时) ， d (天)， w（周）， M（月，包含30天），y（年）</li>
</ul>
</li>
</ul>
<h3 id="22-详细配置内容"><a class="markdownIt-Anchor" href="#22-详细配置内容"></a> 2.2 详细配置内容</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">########   Nginx的main(全局配置)文件</span><br><span class="line">#指定nginx运行的用户及用户组,默认为nobody</span><br><span class="line">#user  nobody;</span><br><span class="line"></span><br><span class="line">#开启的线程数，一般跟逻辑CPU核数一致</span><br><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line">#定位全局错误日志文件，级别以notice显示，还有debug,info,warn,error,crit模式，debug输出最多，crir输出最少，根据实际环境而定</span><br><span class="line">#error_log  logs/error.log;</span><br><span class="line">#error_log  logs/error.log  notice;</span><br><span class="line">#error_log  logs/error.log  info;</span><br><span class="line"></span><br><span class="line">#指定进程id的存储文件位置</span><br><span class="line">#pid        logs/nginx.pid;</span><br><span class="line"></span><br><span class="line">#指定一个nginx进程打开的最多文件描述符数目，受系统进程的最大打开文件数量限制</span><br><span class="line">#worker_rlimit_nofile 65535</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    #设置工作模式为epoll,除此之外还有select,poll,kqueue,rtsig和/dev/poll模式</span><br><span class="line">    #use epoll;</span><br><span class="line"></span><br><span class="line">    #定义每个进程的最大连接数,受系统进程的最大打开文件数量限制。</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line">###数据库的负载均衡</span><br><span class="line">stream &#123;</span><br><span class="line">  upstream mysql_nginx &#123;</span><br><span class="line">      hash $remote_addr consistent;</span><br><span class="line">      server 192.168.18.128:3306 weight=5 max_fails=3 fail_timeout=30s;</span><br><span class="line">      server 192.168.18.129:3306;</span><br><span class="line">      server 192.168.18.130:3306;</span><br><span class="line">      ##last_conn; #最小连接</span><br><span class="line">  &#125;</span><br><span class="line">  server &#123;</span><br><span class="line">      listen 3306; # 数据库服务器监听端口</span><br><span class="line">      proxy_connect_timeout 10s;</span><br><span class="line">      proxy_timeout 300s; # 设置客户端和代理服务之间的超时时间，如果5分钟内没操作将自动断开。</span><br><span class="line">      proxy_pass mysql_nginx;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">#######Nginx的Http服务器配置,Gzip配置</span><br><span class="line">http &#123;</span><br><span class="line">    #主模块指令，实现对配置文件所包含的文件的设定，可以减少主配置文件的复杂度，DNS主配置文件中的zonerfc1912,acl基本上都是用include语句。</span><br><span class="line">    include       mime.types;</span><br><span class="line"></span><br><span class="line">    #核心模块指令，智力默认设置为二进制流，也就是当文件类型未定义时使用这种方式</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    #下面代码为日志格式的设定，main为日志格式的名称，可自行设置，后面引用</span><br><span class="line">    #log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class="line">    #                  &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class="line">    #                  &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br><span class="line"></span><br><span class="line">    #引用日志main， main是log-format的格式，在上面配置了；后面可以加上日志缓冲区大小，写满了就flush到磁盘中buffer = 1M;</span><br><span class="line">    #access_log  logs/access.log  main;</span><br><span class="line"></span><br><span class="line">    #设置允许客户端请求的最大的单个文件字节数</span><br><span class="line">    #client_max_body_size 20M;</span><br><span class="line">    #指定来自客户端请求头的headebuffer大小</span><br><span class="line">    #client_header_buffer_size  32k;</span><br><span class="line">    #指定连接请求试图写入缓存文件的目录路径</span><br><span class="line">    #client_body_temp_path /dev/shm/client_body_temp;</span><br><span class="line">    #指定客户端请求中较大的消息头的缓存最大数量和大小，目前设置为4个32KB</span><br><span class="line">    #large client_header_buffers 4 32k;</span><br><span class="line"></span><br><span class="line">    #开启高效文件传输模式</span><br><span class="line">    sendfile        on;</span><br><span class="line">    #开启防止网络阻塞</span><br><span class="line">    #tcp_nopush     on;</span><br><span class="line">    #开启防止网络阻塞</span><br><span class="line">    #tcp_nodelay    on;</span><br><span class="line"></span><br><span class="line">    #设置客户端连接保存活动的超时时间</span><br><span class="line">    #keepalive_timeout  0;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    #设置客户端请求读取超时时间</span><br><span class="line">    #client_header_timeout 10;</span><br><span class="line">    #设置客户端请求主体读取超时时间</span><br><span class="line">    #client_body_timeout 10;</span><br><span class="line">    #用于设置相应客户端的超时时间</span><br><span class="line">    #send_timeout</span><br><span class="line"></span><br><span class="line">    ####HttpGZip模块配置</span><br><span class="line">    #httpGzip modules</span><br><span class="line">    #开启gzip压缩</span><br><span class="line">    #gzip  on;</span><br><span class="line">    #设置允许压缩的页面最小字节数</span><br><span class="line">    #gzip_min_length 1k;</span><br><span class="line">    #申请4个单位为16K的内存作为压缩结果流缓存</span><br><span class="line">    #gzip_buffers 4 16k;</span><br><span class="line">    #设置识别http协议的版本，默认为1.1</span><br><span class="line">    #gzip_http_version 1.1;</span><br><span class="line">    #指定gzip压缩比，1-9数字越小，压缩比越小，速度越快</span><br><span class="line">    #gzip_comp_level 2;</span><br><span class="line">    #指定压缩的类型</span><br><span class="line">    #gzip_types text/plain application/x-javascript text/css application/xml;</span><br><span class="line">    #让前端的缓存服务器进过gzip压缩的页面</span><br><span class="line">    #gzip_vary on;</span><br><span class="line"></span><br><span class="line">    #########Nginx的server虚拟主机配置</span><br><span class="line">    server &#123;</span><br><span class="line">        #监听端口为 80</span><br><span class="line">        listen       80;</span><br><span class="line"></span><br><span class="line">        #设置主机域名</span><br><span class="line">        server_name  localhost;</span><br><span class="line"></span><br><span class="line">        #设置访问的语言编码</span><br><span class="line">        #charset koi8-r;</span><br><span class="line"></span><br><span class="line">        #设置虚拟主机访问日志的存放路径及日志的格式为main</span><br><span class="line">        #access_log  logs/host.access.log  main;</span><br><span class="line"></span><br><span class="line">        #设置虚拟主机的基本信息</span><br><span class="line">        location / &#123;</span><br><span class="line">            #设置虚拟主机的网站根目录</span><br><span class="line">            root   html;</span><br><span class="line"></span><br><span class="line">            #设置虚拟主机默认访问的网页</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        #error_page  404              /404.html;</span><br><span class="line"></span><br><span class="line">        # redirect server error pages to the static page /50x.html</span><br><span class="line">        #</span><br><span class="line">        error_page   500 502 503 504  /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        # proxy the PHP scripts to Apache listening on 127.0.0.1:80</span><br><span class="line">        #</span><br><span class="line">        #location ~ \.php$ &#123;</span><br><span class="line">        #    proxy_pass   http://127.0.0.1;</span><br><span class="line">        #&#125;</span><br><span class="line"></span><br><span class="line">        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span><br><span class="line">        #</span><br><span class="line">        #location ~ \.php$ &#123;</span><br><span class="line">        #    root           html;</span><br><span class="line">        #    fastcgi_pass   127.0.0.1:9000;</span><br><span class="line">        #    fastcgi_index  index.php;</span><br><span class="line">        #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span><br><span class="line">        #    include        fastcgi_params;</span><br><span class="line">        #&#125;</span><br><span class="line"></span><br><span class="line">        # deny access to .htaccess files, if Apache&#x27;s document root</span><br><span class="line">        # concurs with nginx&#x27;s one</span><br><span class="line">        #</span><br><span class="line">        #location ~ /\.ht &#123;</span><br><span class="line">        #    deny  all;</span><br><span class="line">        #&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="23-日志"><a class="markdownIt-Anchor" href="#23-日志"></a> 2.3 日志</h3>
<p>在nginx同级目录下logs文件夹</p>
<ul>
<li>access.log  正常日志</li>
<li>error.log 错误日期</li>
</ul>
<p>需要在nginx.conf中的http模块配置access_log</p>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>Nginx基础篇（三）实现虚拟主机</title>
    <url>/nginx-03/</url>
    <content><![CDATA[<h3 id="1-虚拟主机virtual-host"><a class="markdownIt-Anchor" href="#1-虚拟主机virtual-host"></a> 1. 虚拟主机Virtual Host</h3>
<p>一种在单一主机或主机群上，实现多网域服务的方法，可以运行多个网站或服务的技术，虚拟主机之间完全独立，并可由用户自行管理虚拟并非指不存在，而是指空间是由实体的服务器延伸而来，其硬件系统可以是基于服务器群，或者单个服务器</p>
<p>使用域名访问虚拟主机，虚拟主机会给一个文件路径，然后部署自己的内容；访问域名时就会访问改文件夹下的某 个资源</p>
<h3 id="2-使用nginx配置虚拟主机"><a class="markdownIt-Anchor" href="#2-使用nginx配置虚拟主机"></a> 2. 使用Nginx配置虚拟主机</h3>
<ol>
<li>
<p>在nginx下建立一个ygb的文件夹，里面新建一个index.html</p>
</li>
<li>
<p>在nginx.conf配置下http -&gt; server块内配置</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    #监听端口为 80</span><br><span class="line">    listen       80;</span><br><span class="line">    #设置主机域名</span><br><span class="line">    server_name  www.xiaoyuge.work;</span><br><span class="line">    #设置访问的语言编码</span><br><span class="line">    #charset koi8-r;</span><br><span class="line">    #设置虚拟主机访问日志的存放路径及日志的格式为main</span><br><span class="line">    #access_log  logs/host.access.log  main;</span><br><span class="line">   </span><br><span class="line">    #    这个是域名反问的虚拟主机的文件路径</span><br><span class="line">    root  /usr/local/nginx/data/ygb</span><br><span class="line">    #设置虚拟主机的基本信息</span><br><span class="line">    location / &#123;</span><br><span class="line">        #设置虚拟主机默认访问的网页</span><br><span class="line">        index  index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line">    error_page   500 502 503 504  /50x.html;</span><br><span class="line">    location = /50x.html &#123;</span><br><span class="line">        root   html;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>启动,然后在浏览器访问域名www.xiaoyuge.work</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./nginx -c ./nginx.conf</span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>nginx</category>
      </categories>
      <tags>
        <tag>nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>Nginx基础篇（四）Nginx实现反向代理</title>
    <url>/nginx-04/</url>
    <content><![CDATA[<h3 id="1-正向代理和反向代理"><a class="markdownIt-Anchor" href="#1-正向代理和反向代理"></a> 1. 正向代理和反向代理</h3>
<ol>
<li>
<p>正向代理：<br>
正向代理类似一个跳板机，代理访问外部资源<br>
比如我们国内访问谷歌，直接访问访问不到，我们可以通过一个正向代理服务器，请求发到代理服，代理服务器能够访问谷歌，这样由代理去谷歌取到返回数据，再返回给我们，这样我们就能访问谷歌了<br>
<img src="/nginx-04/1.png" alt="正向代理"></p>
<p><strong>正向代理的用途</strong>：</p>
<p>（1）访问原来无法访问的资源，如google</p>
<p>（2） 可以做缓存，加速访问资源</p>
<p>（3）对客户端访问授权，上网进行认证</p>
<p>（4）代理可以记录用户访问记录（上网行为管理），对外隐藏用户信息</p>
<p><strong>正向代理即是客户端代理, 代理客户端, 服务端不知道实际发起请求的客户端</strong><br>
<img src="/nginx-04/3.png" alt="正反向代理"></p>
</li>
<li>
<p>反向代理：<br>
反向代理（Reverse Proxy）实际运行方式是指以代理服务器来接受internet上的连接请求，然后将请求转发给内部网络上的服务器，并将从服务器上得到的结果返回给internet上请求连接的客户端，此时代理服务器对外就表现为一个服务器<br>
<img src="/nginx-04/2.png" alt="反向代理"></p>
<p><strong>反向代理的作用</strong>：</p>
<p>（1）保证内网的安全，阻止web攻击，大型网站，通常将反向代理作为公网访问地址，Web服务器是内网</p>
<p>（2）负载均衡，通过反向代理服务器来优化网站的负载</p>
<p><strong>反向代理即是服务端代理, 代理服务端, 客户端不知道实际提供服务的服务端</strong></p>
</li>
</ol>
<h3 id="2-nginx配置反向代理"><a class="markdownIt-Anchor" href="#2-nginx配置反向代理"></a> 2. Nginx配置反向代理</h3>
<p>在http-&gt; server块中配置server_name</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    #监听端口为 80</span><br><span class="line">    listen       80;</span><br><span class="line">    #设置主机域名</span><br><span class="line">    server_name  http://192.168.44.99;</span><br><span class="line">    #设置虚拟主机的基本信息</span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass http://192.168.44.1:9096;      ###最重要的配置，转发到目标地址， 也可以配置服务器组，然后upstream一个服务器组</span><br><span class="line">        proxy_method POST;   #设置转发请求的格式</span><br><span class="line">        #Nginx在header里面增加一个自定义字段 Host， 用于存放当前客户端IP地址</span><br><span class="line">        proxy_set_header  Host $host;</span><br><span class="line">        #获取客户端的真实IP地址设置到header中的字段名为X-Real-IP里面</span><br><span class="line">        proxy_set_header X-Real-IP  $remote_addr;</span><br><span class="line">        #获取所有转发请求的IP信息列表</span><br><span class="line">        proxy_set_header  X-Forwarded-For  $proxy_add_x_forwarded_for;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>那么访问http://192.168.44.99 ， nginx会将请求转发给目标服务器http://192.168.44.1:9096</p>
<h4 id="21-location-匹配规则"><a class="markdownIt-Anchor" href="#21-location-匹配规则"></a> 2.1 location 匹配规则</h4>
<p>匹配规则从上到下，匹配规则越宽松；</p>
<table>
<thead>
<tr>
<th>模式</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>location=/uri</td>
<td>= 表示精确匹配，只有完全匹配才能生效</td>
</tr>
<tr>
<td>location ^~ /uri</td>
<td>^~ 开头对URL路径进行前缀匹配，并且在正则之前</td>
</tr>
<tr>
<td>location ~ pattern</td>
<td>开头表示区分大小写的正则匹配</td>
</tr>
<tr>
<td>location ~* pattern</td>
<td>开头表示不区分大小写的正则匹配</td>
</tr>
<tr>
<td>location /uri</td>
<td>不带任何修饰符，也表示前缀匹配，但是在正则匹配之后</td>
</tr>
<tr>
<td>location /</td>
<td>通用匹配，任何未匹配到其他location的请求都会匹配到，相当于switch中的default</td>
</tr>
</tbody>
</table>
]]></content>
      <categories>
        <category>nginx</category>
      </categories>
      <tags>
        <tag>nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>Nginx基础篇（一）扫盲</title>
    <url>/nginx-md/</url>
    <content><![CDATA[<h3 id="1nginx发展史"><a class="markdownIt-Anchor" href="#1nginx发展史"></a> 1.Nginx发展史</h3>
<p>作者：logo Sysoev</p>
<ul>
<li>2000年地洞，c语言编写</li>
<li>2004年开源</li>
<li>2011年成立商业公司</li>
<li>2013 发布商业版本Nginx plus</li>
<li>2019.5月F5 Networks收购nginx</li>
<li>2019.12被Rambler集团起诉</li>
</ul>
<h3 id="2nginx与其他web服务器对比"><a class="markdownIt-Anchor" href="#2nginx与其他web服务器对比"></a> 2.Nginx与其他web服务器对比</h3>
<ol>
<li>Nginx与Apache HTTP server project区别<br>
用来响应用户请求的web服务器</li>
<li>Nginx 和tomcat区别<br>
Nginx是HTTP Server，主要是用于访问一些静态资源，可以用做代理服务器<br>
Tomcat是Application Server应用服务器，用来存放和运行程序；</li>
<li>HTTP Server 和Application Server区别与联系</li>
</ol>
<h3 id="3-http知识"><a class="markdownIt-Anchor" href="#3-http知识"></a> 3. HTTP知识</h3>
<h4 id="31-ip和端口"><a class="markdownIt-Anchor" href="#31-ip和端口"></a> 3.1 IP和端口</h4>
<p>120.77.38.160:80</p>
<p>0为A类，10为B类，110为C类，1110为D类，1111为E类。D类地址供组播使用，E类地址保留。</p>
<p><img src="/nginx-md/1.png" alt="img"></p>
<p><img src="/nginx-md/2.png" alt="img"></p>
<p>端口是：0～65535</p>
<h4 id="32-域名"><a class="markdownIt-Anchor" href="#32-域名"></a> 3.2 域名</h4>
<p>协议、子域名、顶级域名、域名类型、资源路径、参数</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#https 协议默认端口443 可以省略</span><br><span class="line">https://www.baidu.com:443</span><br><span class="line"></span><br><span class="line">#user：子域名， com为域名类型（cn中国， us美国...）； 3623252831 为资源路径</span><br><span class="line">https://user.qzone.qq.com/3623252831</span><br><span class="line"></span><br><span class="line">#？号后面为参数</span><br><span class="line">https://baike.baidu.com/item/测试/232323?fr=asdfasdf</span><br></pre></td></tr></table></figure>
<p><strong>域名(domainName)和IP的关系以及域名的组成</strong></p>
<p>域名：<a href="https://www.baidu.com:443/member/query?far=adsfad">https://www.baidu.com:443/member/query?far=adsfad</a></p>
<ul>
<li>http/ https: 协议</li>
<li>baidu: 顶级域名</li>
<li>Com： 域名类型</li>
<li>www: 子域名，可以有多级：<a href="http://user.qzone.qq.com/232323">user.qzone.qq.com/232323</a></li>
<li>far=asdfa: 参数</li>
<li>member/query: 资源路径<br>
DNS(domain name server)将域名转化为ip+port</li>
</ul>
<h5 id="33-http协议的特点"><a class="markdownIt-Anchor" href="#33-http协议的特点"></a> 3.3 HTTP协议的特点</h5>
<ul>
<li>简单快速</li>
<li>灵活</li>
<li>无连接（一次请求，连接关闭）</li>
<li>无状态（每次请求都和之前的请求无关）</li>
</ul>
<h5 id="34-http协议的请求格式"><a class="markdownIt-Anchor" href="#34-http协议的请求格式"></a> 3.4 HTTP协议的请求格式</h5>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Request URL: https://prtas.videocc.net/v2/view?pid=1638687363047X1327470&amp;vid=8c8d9388d0b4c16f41ef557fba23dede_8&amp;uid=8c8d9388d0&amp;flow=0&amp;ts=1638688553584&amp;href=aHR0cHM6Ly9rZS5ndXBhb2VkdS5jbi9wbGF5LzI4OD9waGFzZUlkPTU&amp;duration=1278&amp;cts=789&amp;sign=fcf19468eff088e983796d5826268f2d&amp;sd=1190&amp;pd=788&amp;pn=HTML5&amp;pv=v1.15.0&amp;sid=ZDIzZGM4ODUtNDM2My00MTQ3LWJmYTktY2M3MDgwM2U0NDc5&amp;param1=&amp;param2=MTc2MjEyODQ5OTg&amp;param3=&amp;cataid=1591268435818</span><br><span class="line">Request Method: GET</span><br><span class="line">Status Code: 200 </span><br><span class="line">Remote Address: 221.231.81.238:443</span><br><span class="line">Referrer Policy: strict-origin-when-cross-origin</span><br></pre></td></tr></table></figure>
<ul>
<li>请求行</li>
<li>请求类型 Request Method
<ol>
<li>GET: 请求指定的页面细腻，并返回尸体主题</li>
<li>HEAD: 类似于GET请求，只不过返回的相应中没有具体的内容，用于获取报头</li>
<li>POST：想指定资源提交数据进行处理请求，数据被高喊在请求体中</li>
<li>PUT: 从客户端想服务器传送的数据取代指定的文档的内容</li>
<li>DELETE: 请求服务器删除指定的页面</li>
<li>CONNECT: HTTP/1.1协议中预留给能够将连接方式改为管道方式的代理服务器</li>
<li>OPTIONS: 允许客户端查看服务器的性能</li>
<li>TRACE: 回显服务器收到的请求，主要用于测试后诊断</li>
</ol>
</li>
<li>请求头</li>
<li>空行和请求数据</li>
</ul>
<h5 id="35-http协议的返回格式"><a class="markdownIt-Anchor" href="#35-http协议的返回格式"></a> 3.5 HTTP协议的返回格式</h5>
<p>状态行、小洗头、空行和响应正文</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">HTTP/1.1 200</span><br><span class="line">Server: nginx/1.20.1</span><br><span class="line">Date: Sun, 05 Dec 2021 07:24:45 GMT</span><br><span class="line">Content-Type: application/json;charset=UTF-8</span><br><span class="line">Transfer-Encoding: chunked</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Access-Control-Allow-Origin: https://ke.gupaoedu.cn</span><br><span class="line">Access-Control-Allow-Credentials: true</span><br><span class="line">Access-Control-Allow-Methods: PUT,POST,GET,DELETE,OPTIONS,PATCH</span><br><span class="line">Access-Control-Allow-Headers: DNT,web-token,app-token,Authorization,Accept,Origin,Keep-Alive,User-Agent,X-Mx-ReqToken,X-Data-Type,X-Auth-Token,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,token,showerr</span><br><span class="line">Access-Control-Max-Age: 86400</span><br></pre></td></tr></table></figure>
<p><strong>Http格式响应状态码有哪些</strong></p>
<ul>
<li>1xx: informational(信息性状态码) 接受的请求正在处理</li>
<li>2xx: success(成功状态码)  请求正常处理完毕</li>
<li>3xx：redirection（重定向状态码）需要进行复检操作以完成请求</li>
<li>4xx：client error（客户端错误状态码） 服务器无法处理请求</li>
<li>5xx: server error（服务器错误错误状态码） 服务器处理请求出错</li>
</ul>
<h5 id="36-通用头字段common-header"><a class="markdownIt-Anchor" href="#36-通用头字段common-header"></a> 3.6 通用头字段Common Header</h5>
<table>
<thead>
<tr>
<th>字段</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>Cache-control</td>
<td>控制缓存的行为</td>
</tr>
<tr>
<td>Connection</td>
<td>控制不再转发给代理的收不字段、管理持久连接</td>
</tr>
<tr>
<td>Date</td>
<td>创建报文的日期时间</td>
</tr>
<tr>
<td>Pragma</td>
<td>报文指令</td>
</tr>
<tr>
<td>Trailer</td>
<td>报文末端的首部一览</td>
</tr>
<tr>
<td>Transfer-Encoding</td>
<td>指定报文主题的传输编码方式</td>
</tr>
<tr>
<td>Upgrade</td>
<td>升级为其他协议</td>
</tr>
<tr>
<td>Via</td>
<td>代理服务器的相关信息</td>
</tr>
<tr>
<td>Warning</td>
<td>错误通知</td>
</tr>
</tbody>
</table>
<h5 id="37-响应头字段response-header"><a class="markdownIt-Anchor" href="#37-响应头字段response-header"></a> 3.7 响应头字段Response Header</h5>
<table>
<thead>
<tr>
<th>字段</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>Accept-Ranges</td>
<td>是否接收字节范围请求</td>
</tr>
<tr>
<td>Age</td>
<td>推算资源创建经过的时间</td>
</tr>
<tr>
<td>ETag</td>
<td>资源的匹配信息</td>
</tr>
<tr>
<td>Location</td>
<td>另客户端重定向至指定的URI</td>
</tr>
<tr>
<td>Proxy-Authenticate</td>
<td>代理服务器对客户端的认证信息</td>
</tr>
<tr>
<td>Retry-After</td>
<td>对再次发起请求的时机要求</td>
</tr>
<tr>
<td>Vary</td>
<td>代理服务器缓存的管理信息</td>
</tr>
<tr>
<td>WWW-Authenticate</td>
<td>服务器对客户端的认证信息</td>
</tr>
</tbody>
</table>
<h5 id="38-实体头字段-entity-header"><a class="markdownIt-Anchor" href="#38-实体头字段-entity-header"></a> 3.8 实体头字段 Entity Header</h5>
<table>
<thead>
<tr>
<th>字段</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>Allow</td>
<td>资源科支持的http方法</td>
</tr>
<tr>
<td>Connect-Encoding</td>
<td>实体主体适用的编码格式</td>
</tr>
<tr>
<td>Content-Language</td>
<td>实体主体的自然语言</td>
</tr>
<tr>
<td>Content-length</td>
<td>实体主体的大小</td>
</tr>
<tr>
<td>Content-Location</td>
<td>替代敌营资源的URI</td>
</tr>
<tr>
<td>Content-MD5</td>
<td>实体主体的报文摘要</td>
</tr>
<tr>
<td>Content-Range</td>
<td>实体主体的位置范围</td>
</tr>
<tr>
<td>Content-Type</td>
<td>实体主体的媒体类型</td>
</tr>
<tr>
<td>Expires</td>
<td>实体主体过期的日期时间</td>
</tr>
<tr>
<td>Last-Modified</td>
<td>资源的最后修改日期时间</td>
</tr>
</tbody>
</table>
]]></content>
      <categories>
        <category>nginx</category>
      </categories>
      <tags>
        <tag>nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>MinIO简介以及Linux安装MinIO</title>
    <url>/linux-minio/</url>
    <content><![CDATA[<h2 id="1-什么是对象存储"><a class="markdownIt-Anchor" href="#1-什么是对象存储"></a> 1. 什么是对象存储</h2>
<p>对象存储服务OSS（Object Storage Service）是一种海量、安全、低成本、高可用的云存储服务，<strong>适合存放任意类型的文件</strong>。容量和处理能力弹性扩展，多种存储类型提供选择，全面优化存储成本。</p>
<p>最大的优势：可以存储大量的非结构话数据，例如：图片、视频、日志文件、备份数据和容器/虚拟机镜像等。</p>
<h2 id="2-minio"><a class="markdownIt-Anchor" href="#2-minio"></a> 2. MinIO</h2>
<p>MinIO 是个基于Golang编写的开源对象存储套件，基于Apache License V2.0开源协议，虽然轻量，却拥有不错的性能，兼容亚马逊S3云存储服务接口。可以很简单的和其他应用结合使用，例如：NodeJS、Redis、mysql等</p>
<p>中文文档： <a href="http://docs.minio.org.cn/docs/master/minio-monitoring-guide">http://docs.minio.org.cn/docs/master/minio-monitoring-guide</a></p>
<h3 id="21-minio应用场景"><a class="markdownIt-Anchor" href="#21-minio应用场景"></a> 2.1 MinIO应用场景</h3>
<p>可以作为私有云的对象存储服务来使用，也可以作为云对象存储的网关层，无缝对接Amazon S3 或者 MicroSoft Azure 。<br>
<img src="/linux-minio/1.png" alt="应用场景"></p>
<h3 id="22-minio特点"><a class="markdownIt-Anchor" href="#22-minio特点"></a> 2.2 MinIO特点</h3>
<ul>
<li>
<p>高性能</p>
<p>作为一款高性能存储，在标准硬件条件下，其读写速率分别可以达到55Gb/s和 35Gb/s。并且MinIO支持一个对象文件是任意大小（几KB到最大5T不等）</p>
</li>
<li>
<p>可扩展</p>
<p>不同MinIO集群可以组成联邦，并形成一个全局的命名空间，并且支持跨越多个数据中心</p>
</li>
<li>
<p>云原生</p>
<p>容器化、基于K8S的编排、多租户支持</p>
</li>
<li>
<p>Amazon S3兼容</p>
<p>使用Amazon S3 V2/V4 API。可以使用Minio SDK，Minio Client，AWS SDK 和 AWS CLI 访问Minio服务器。</p>
</li>
<li>
<p>可对接多种后端存储</p>
<p>除了Minio自己的文件系统，还支持 DAS、 JBODs、NAS、Google云存储和 Azure Blob存储。</p>
</li>
<li>
<p>SDK支持</p>
<p>GO SDK： <a href="https://github.com/minio/minio-go">https://github.com/minio/minio-go</a></p>
<p>JavaSDK： <a href="https://github.com/minio/minio-java">https://github.com/minio/minio-java</a></p>
<p>PythonSDK： <a href="https://github.com/minio/minio-py">https://github.com/minio/minio-py</a></p>
</li>
<li>
<p>Lambda计算</p>
<p>Minio服务器通过其兼容AWS SNS / SQS的事件通知服务触发Lambda功能。支持的目标是消息队列，如Kafka，NATS，AMQP，MQTT，Webhooks以及Elasticsearch，Redis，Postgres和MySQL等数据库</p>
</li>
<li>
<p>图形化界面</p>
<p>有操作页面</p>
</li>
<li>
<p>功能简单</p>
<p>不容易出错，快速启动</p>
</li>
<li>
<p>支持纠删码</p>
<p>MinIO使用纠删码、Checksum来防止硬件错误和静默数据污染。在最高冗余度配置下，即使丢失1/2的磁盘也能恢复数据</p>
</li>
</ul>
<h3 id="23-存储机制"><a class="markdownIt-Anchor" href="#23-存储机制"></a> 2.3 存储机制</h3>
<p>MinIO 使用纠删码erasure code、校验和checksum。 即使丢一半数据（N/2）的鹰派，仍然可以恢复数据。</p>
<ul>
<li>
<p>校验和checksum</p>
<p>保护数据免受硬件故障和无声数据损坏</p>
</li>
<li>
<p>纠删码erasure code</p>
<p>纠删码是一种恢复丢失和损坏数据的数据算法，目前纠删码技术在分布式存储系统中的应用主要有三类：阵列纠删码（Array Code : RAID5、RAID6等）、RS（Reed-Solomon）里德-所罗门类纠删码和LDPC（LowDensity Parity Check Code）<br>
低密度奇偶校验纠删码。</p>
<p>Erasure code 是一种编码技术，他可以将N份原始数据，增加m份数据，并通过n+m 份中的任意n份数据，还原为原始数据。即如果有任意小于等于m份的数据失效，仍然能通过剩下的数据还原出来。<br>
MinIO 采用Reed-Solomon code将对象拆分成N/2数据和N/2奇偶校验快，这就意味着如果是12块盘，一个对象会分成6个数据块、6个奇偶校验块；可以丢失任意6块盘（不管是存放的数据块还是奇偶校验块），仍可以通过剩下的盘进行数据恢复</p>
</li>
</ul>
<h2 id="3-安装和使用minio"><a class="markdownIt-Anchor" href="#3-安装和使用minio"></a> 3. 安装和使用MinIO</h2>
<h3 id="31-linux安装minio"><a class="markdownIt-Anchor" href="#31-linux安装minio"></a> 3.1 Linux安装MinIO</h3>
<ol>
<li>
<p>下载（<a href="https://min.io/download#/linux%EF%BC%89">https://min.io/download#/linux）</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget https://dl.min.io/server/minio/release/linux-amd64/minio</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>运行</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"> chmod +x minio</span><br><span class="line"> ./minio server /usr/software/minio/data      #将/usr/software/minio/data 替换为您希望 MinIO 存储数据的驱动器或目录的路径。</span><br><span class="line"><span class="meta">#</span><span class="bash">或者指定账号密码启动</span></span><br><span class="line">MINIO_ACCESS_KEY=minioadmin MINIO_SECRET_KEY=minioadmin ./minio server --config-dir /usr/software/minio/config /usr/software/minio/data</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"> #</span><span class="bash">后台启动</span></span><br><span class="line">nohup ./minio server /usr/software/minio/data  &gt;  /usr/software/minio/minio.log 2&gt;&amp;1 &amp;#</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">或者指定账号密码启动</span></span><br><span class="line">MINIO_ACCESS_KEY=minioadmin MINIO_SECRET_KEY=minioadmin nohup ./minio server --config-dir /usr/software/minio/config /usr/software/minio/data&gt;  /usr/software/minio/minio.log 2&gt;&amp;1 &amp;#</span><br></pre></td></tr></table></figure>
<p><img src="/linux-minio/8.png" alt></p>
</li>
<li>
<p>设置启动脚本（建议）</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">touch minio.sh</span><br><span class="line">   </span><br><span class="line">vi minio.sh</span><br></pre></td></tr></table></figure>
<p>在sh文件中添加以下内容</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">指定登录用户名</span></span><br><span class="line">export MINIO_ACCESS_KEY=username</span><br><span class="line"><span class="meta">#</span><span class="bash">指定登录密码</span></span><br><span class="line">export MINIO_SECRET_KEY=password</span><br><span class="line"><span class="meta">#</span><span class="bash">指定端口以及存储文件夹，并启动服务 9000访问端口， 9001 控制台界面访问端口, 这里0.0.0.0可以设置为具体的服务器IP</span></span><br><span class="line">nohup ./minio server --address &#x27;0.0.0.0:9000&#x27; --console-address &#x27;0.0.0.0:9001&#x27; ./miniodata &gt; ./miniodata/minio.log 2&gt;&amp;1&amp;</span><br></pre></td></tr></table></figure>
<p>给当前用户加上执行权限</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">chmod u+x  *.sh</span><br><span class="line">  </span><br><span class="line"><span class="meta"> #</span><span class="bash">启动</span></span><br><span class="line">sh minio.sh</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="32-安装客户端可选"><a class="markdownIt-Anchor" href="#32-安装客户端可选"></a> 3.2 安装客户端(可选)</h3>
<ol>
<li>
<p>安装</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget https://dl.min.io/client/mc/release/linux-amd64/mc</span><br><span class="line">chmod +x mc</span><br><span class="line">./mc --help</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>使用命令给客户端添加一个服务端</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./mc alias set minio http://172.21.0.7:9000 minioadmin minioadmin</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>创建bucket，并查询所有bucket</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@ww xiaoyuge]# ./mc ls minio</span><br><span class="line">[root@ww xiaoyuge]# ./mc mb minio/mybucket</span><br><span class="line">Bucket created successfully `minio/mybucket`</span><br><span class="line">[root@ww xiaoyuge]# ./mc ls minio</span><br><span class="line">[2020-09-02 03:02:36 CST]      0B mybucket/</span><br><span class="line">[root@ww xiaoyuge]# </span><br></pre></td></tr></table></figure>
</li>
<li>
<p>页面查询bucket</p>
<p><img src="/linux-minio/6.png" alt></p>
</li>
<li>
<p>创建用户</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./mc admin user add minio root rootroot</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>给用户赋予权限</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./mc admin policy set minio readwrite user=root</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="33-使用minio"><a class="markdownIt-Anchor" href="#33-使用minio"></a> 3.3 使用MinIO</h3>
<ol>
<li>
<p>启动</p>
<p>在浏览器输入： <a href="http://localhost:9000">http://localhost:9000</a><br>
<img src="/linux-minio/2.png" alt><br>
在输入控制打印的默认的AccessKey和SecretKey：</p>
<p><strong>AccessKey:</strong> minioadmin</p>
<p><strong>SecretKey（默认）:</strong> minioadmin</p>
<p>使用AccessKey 和 SecretKey 登录后台。</p>
</li>
<li>
<p>进入系统后，我们先要点击右上角的“+”按钮，创建一个文件桶（输入名称后，回车即可），在上传文件到这个文件桶中。Create bucket（创建文件桶），然后输入bucket名称为 <strong>test</strong>, 创建成功后再Upload file（上传文件）。<br>
<img src="/linux-minio/3.png" alt><img src="/linux-minio/3_1.png" alt><img src="/linux-minio/3_2.png" alt><img src="/linux-minio/4.png" alt></p>
<p>现在我们去服务器，我们启动时指定的目录去看看，可以看到一个新建的test文件目录（文件桶相当于文件目录），这里没有使用纠删码的模式，所以直接就是源文件了。当我们线上运行的项目已经有源文件了，在使用minio的时候，可以直接指定该目录为minio的文件目录就行了。<br>
<img src="/linux-minio/5.png" alt><img src="/linux-minio/7.png" alt></p>
</li>
<li>
<p>分享文件，也可以设置文件分享有效日期<br>
<img src="/linux-minio/11.png" alt><img src="/linux-minio/12.png" alt="img_1.png"><br>
访问连接会出现如下界面：<br>
<img src="/linux-minio/13.png" alt="img_1.png"></p>
</li>
</ol>
<h3 id="34-mioio常见启动问题"><a class="markdownIt-Anchor" href="#34-mioio常见启动问题"></a> 3.4 mioIO常见启动问题</h3>
<ol>
<li>启动报错“WARNING: Console endpoint is listening on a dynamic port…”<br>
<img src="/linux-minio/9.png" alt="img_1.png"><br>
错误提示很明显，需要to choose a static port。<br>
写了一个shell启动MinIO，在shell中使用–console-address ‘部署minio的ip:希望通过什么端口打开minio console页面’ <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"> export MINIO_ACCESS_KEY=username</span><br><span class="line"><span class="meta">#</span><span class="bash">指定登录密码</span></span><br><span class="line"> export MINIO_SECRET_KEY=password</span><br><span class="line"> nohup ./minio server --address &#x27;0.0.0.0:9000&#x27; --console-address &#x27;0.0.0.0:9001&#x27; ./miniodata &gt; ./miniodata/minio.log 2&gt;&amp;1&amp;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="4-springboot-集成minio"><a class="markdownIt-Anchor" href="#4-springboot-集成minio"></a> 4. SpringBoot 集成minIO</h2>
<p>项目源代码地址：<a href="https://gitee.com/xiaoyuge520/minio-demo%EF%BC%8C">https://gitee.com/xiaoyuge520/minio-demo，</a> 下面是应用主要功能截图展示：<br>
<img src="/linux-minio/14.png" alt="img14.png"><br>
在minIO的控制台界面选择对应的bucket可以查看到刚提交的内容<br>
<img src="/linux-minio/15.png" alt="img14.png"></p>
<p>同理，删除也是一样！！！<br>
<img src="/linux-minio/16.png" alt="img14.png"></p>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux系统下查找文件命令总结</title>
    <url>/linux-search-file/</url>
    <content><![CDATA[<h3 id="1-which查命令绝对路径"><a class="markdownIt-Anchor" href="#1-which查命令绝对路径"></a> 1. which查命令绝对路径</h3>
<p><strong>which</strong> 从环境变量PATH中定位/返回与指定名字相匹配的可执行文件所在的路径<br>
<img src="/linux-search-file/1.png" alt="which命令"></p>
<p><strong>原理</strong>：执行<strong>which</strong>命令时，which会在当前环境变量PATH中依次寻找能够匹配所找命令名字的可执行文件名，不加 - a选项，返回第一个匹配的可执行文件路径，<br>
否则依次返回满足条件的所有可执行文件的路径名</p>
<p><strong>适用场合：</strong> 一般用于查找命令/可执行文件所在的路径。有时候可能在多个路径下存在相同的命令，该命令可用于查找当前所执行的命令到底是哪一个位置处的命令。</p>
<h3 id="2-whereis查找特定文件"><a class="markdownIt-Anchor" href="#2-whereis查找特定文件"></a> 2. whereis查找特定文件</h3>
<p><strong>whereis</strong> 命令用来定位指令的二进制程序、源代码文件和man手册页等相关文件的路径， 该命令只能用于程序名的搜索</p>
<ol>
<li>- b   #定位可执行文件</li>
<li>- m   #定位帮助文件</li>
<li>- s   定位源代码文件</li>
<li>- u   搜索默认路径下除可执行文件、源代码文件、帮助文件以外的其它文件</li>
<li>- B   指定搜索可执行文件的路径。</li>
<li>- M   指定搜索帮助文件的路径。</li>
<li>- S   指定搜索源代码文件的路径<br>
<img src="/linux-search-file/2.png" alt="whereis命令"></li>
</ol>
<p><strong>原理：</strong> whereis命令首先会去掉filename中的前缀空格和以.开头的任何字符，然后再在数据库（var/lib/slocate/slocate.db）中查找与上述处理后的filename相匹配的二进制文件、源文件和帮助手册文件,使用之前可以使用<strong>updatedb</strong>命令手动更新数据库。</p>
<p><strong>适用场合：</strong> 二进制文件、源文件和帮助手册文件路径的查找。<br>
和<strong>find</strong> 相比，Whereis 查找的速度非常快，这是因为Linux系统会将系统内的所有文件都记录在一个数据库文件中，当使用<strong>whereis (或者locate)</strong><br>
会从数据库查找数据，而不是像find命令那样，通过遍历硬盘来查找文件，效率更高！</p>
<h3 id="3-locate缓存查找文件"><a class="markdownIt-Anchor" href="#3-locate缓存查找文件"></a> 3. locate缓存查找文件</h3>
<p><strong>locate</strong> 搜素一个数据库（/var/lib/mlocate/mlocate.db）,这个数据库中国呢包含本地所有文件信息，Linux系统自动创建这个数据库，并且每天更新依次，所以使用locate命令查不到最新变动过的文件，为了避免这种情况，可以在使用locate之前，先使用updatedb命令，手动更新数据库，updatedb命令会根据/etc/updatedb.conf来更新文件。</p>
<p><strong>原理：</strong> 默认情况下(当filename中不包含通配符*)，locate会给出所有与 * filename*相匹配的文件的路径。<br>
<strong>适用场合：</strong> 没有文件类型性质的模糊查找（你只记得某个文件的部分名称）。<br>
<img src="/linux-search-file/3.png" alt="locate命令"><br>
<img src="/linux-search-file/4.png" alt="locate命令"><br>
<img src="/linux-search-file/5.png" alt="locate命令"><br>
<img src="/linux-search-file/6.png" alt="locate命令"></p>
<h3 id="4-find-遍历文件查找"><a class="markdownIt-Anchor" href="#4-find-遍历文件查找"></a> 4. find 遍历文件查找</h3>
<p>语法：</p>
<ul>
<li>
<p>-name                    #按文件名查找(find /etc/ -name “???” 查找/etc目录下，开头是6个任意字符的文件， *.log以log结尾的文件；&quot;[1-3].txt&quot;指定范围以txt结尾的文件（包括 1.txt,2.txt,3.txt）)</p>
</li>
<li>
<p>-size                    #按大小查找（find /etc/ -size +1M 查询大于1M的文件(find /etc/ -size -10K)，注意：如果没有+ -， 则是精确到1M,加上+ - 表示范围； find /etc/ -size +1k -a -size -10k 查找1-10K的文件）</p>
</li>
<li>
<p>-user                    #按属主查找（find /opt/ -user xiaoyuge 查找/opt属于xiaoyuge用户的文件；注意，系统要存在该用户，否则会报错）</p>
</li>
<li>
<p>-perm                    #按权限查找（find /opt/ -perm 0644 查找/opt目录权限是644文件）</p>
</li>
<li>
<p>-type                    #按类型查找（find /usr/bin/ -type f 查找/usr/bin下类型是二进制文件）</p>
</li>
<li>
<p>-time                    #按天查找</p>
<ul>
<li>
<p>atime n                    #将n*24小时内访问过的文件列出(access)</p>
</li>
<li>
<p>ctime n                    #将n*24小时内状态发生改变的文件列出（change） find /etc/ -ctime +7 在7天之前,属性被修改过的文件</p>
</li>
<li>
<p>mtime n                    #将n*24小时内被修改过的文件列出(modify)</p>
</li>
<li>
<p>newer file                 #把比file还要心的文件列出</p>
</li>
<li>
<p>amin n                     #将n 分钟内访问过的文件列出(access)   find /etc/ -mmin -120 在120分钟内，内容被修改的文件</p>
</li>
<li>
<p>cmin n                     #将n 分钟内状态发生改变的文件列出（change）</p>
</li>
<li>
<p>mmin n                     #将n 分钟内被修改过的文件列出(modify)</p>
</li>
</ul>
</li>
<li>
<p>-inum                    #按i节点查找 有一些文件的硬链接数量很多，有相同的i节点，查找其中一个文件的i节点号，一次性删除。</p>
</li>
<li>
<p>-exec                    #查找后执行命令</p>
</li>
</ul>
<p><strong>原理：</strong> 遍历当前工作目录及其子目录，find命令是在硬盘上遍历查找，非常耗硬盘资源，查找效率相比whereis和locate较低。<br>
<strong>适用场合：</strong> 能用which、whereis和locate的时候尽量不要用find.</p>
<h3 id="5-4种命令对比"><a class="markdownIt-Anchor" href="#5-4种命令对比"></a> 5. 4种命令对比</h3>
<p><img src="/linux-search-file/7.png" alt="对比"></p>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>分布式消息中间件设计</title>
    <url>/message-oriented-middleware/</url>
    <content><![CDATA[<h2 id="1-消息中间件概述"><a class="markdownIt-Anchor" href="#1-消息中间件概述"></a> 1. 消息中间件概述</h2>
<ol>
<li>
<p>什么是分布式消息中间件</p>
<p>利用高效可靠的消息传递机制进行平台无关的数据交流；<br>
并基于数据通信来进行分布式系统的集成；<br>
通过提供消息和消息排队模型，它可以在分布式环境下扩展进城间的通信。</p>
</li>
<li>
<p>消息中间件的应用场景</p>
<p>跨系统数据传递、高并发流量削峰、数据异步处理…</p>
</li>
<li>
<p>常用的消息中间件</p>
<p>ActiveMQ(太老)、RabbitMQ、Kafka、 RocketMQ</p>
</li>
<li>
<p>本质</p>
<p>一种具备接受请求、保存数据、发送数据等功能的网络应用。和一般的网络应用程序的区别是它主要负责数据的接收和传递，所以性能一般高于普通程序</p>
</li>
<li>
<p>5大核心组成</p>
<ul>
<li>协议</li>
<li>持久性机制</li>
<li>消息分布机制</li>
<li>高可用设计</li>
<li>高可靠设计</li>
</ul>
</li>
</ol>
<h3 id="11-协议"><a class="markdownIt-Anchor" href="#11-协议"></a> 1.1 协议</h3>
<p>协议是计算机之间通信时共同遵守的一组约定，确保计算机之间能够相互交流；是对数据格式和计算机之间交换数据时必须遵守的规则的正式描述</p>
<p>三大要素：</p>
<ul>
<li>语法：即数据和控制信息的结构或格式</li>
<li>语义：即需要发出何种控制信息，完成何种动作以及作出何种响应</li>
<li>时序：即时间实现顺序的详细说明</li>
</ul>
<p>消息中间件常用协议：openWire、AMQP、MQTT（物流网，快，不能持久化）、Kafka、OpenMessage等；<br>
不能用http协议的原因是：http每次请求必须要有响应，性能不高；</p>
<h4 id="11-amqp协议"><a class="markdownIt-Anchor" href="#11-amqp协议"></a> 1.1 AMQP协议</h4>
<p>AMQP（Advanced Message Queuing Protocol）是高级消息队列协议；04年JPMorgan Chase(摩根大通集团)联合其他公司共同设计</p>
<ul>
<li>特性：事物支持、持久化支持，出生金融行业，在可靠性消息处理上具备天然的优势</li>
<li>优秀产品 RabbitMQ、 Apache ACTIVEMQ</li>
</ul>
<h4 id="12-mqtt协议"><a class="markdownIt-Anchor" href="#12-mqtt协议"></a> 1.2 MQTT协议</h4>
<p>MQTT（Message Queuing Telemetry Transport）消息队列遥测传输<br>
是IBM开发的一个即时通讯协议，物联网系统架构中的重要组成部分；</p>
<ul>
<li>特性：轻量、结构简单、传输快、没有事务支持、没有持久化相关设计</li>
<li>应用场景：适用于计算能力有限、低宽带、网络不稳定的场景</li>
<li>优秀产品：RabbitMQ、 Apache ACTIVEMQ</li>
</ul>
<h4 id="13-open-message协议"><a class="markdownIt-Anchor" href="#13-open-message协议"></a> 1.3 Open Message协议</h4>
<p>OpenMessaging 是近几年有阿里发起，与雅虎、滴滴出行、Streamlio等公司共同参数传里的分布式消息中间件、流处理领域的开发应用标准。<br>
是国内首个在全球范围内发起的分布式消息领域国际标准</p>
<ul>
<li>特性：结构简单、解析快、有事务设计、有持久化设计</li>
<li>优秀产品：Apache RocketMQ</li>
</ul>
<h4 id="14-kafka协议"><a class="markdownIt-Anchor" href="#14-kafka协议"></a> 1.4 Kafka协议</h4>
<p>Kafka协议是基于TCP的二进制协议。消息内部是通过长度来分割，由一些基本数据类型组成</p>
<ul>
<li>特性：结构简单、解析快、无事务设计、有持久化设计</li>
<li>优秀产品：Apache Kafka</li>
</ul>
<h4 id="155-openwire协议"><a class="markdownIt-Anchor" href="#155-openwire协议"></a> 1.55 OpenWire协议</h4>
<p>开放链接，ActiveMQ自定义的一种协议，ActiveMQ默认链接方式，它提供一种高效率的二进制格式来使消息高速传输</p>
<ul>
<li>特性：结构简单、解析快、无事务设计、有持久化设计</li>
<li>优秀产品：Apache ActiveMQ</li>
</ul>
<h3 id="12-持久化"><a class="markdownIt-Anchor" href="#12-持久化"></a> 1.2 持久化</h3>
<p>简单来说就是将数据存入磁盘，而不是存在内存中岁服务重启而消失，使数据能够永久保存叫做持久化</p>
<table>
<thead>
<tr>
<th></th>
<th style="text-align:center">ActiveMQ</th>
<th style="text-align:center">RabbitMQ</th>
<th style="text-align:center">Kafka</th>
<th style="text-align:center">RocketMQ</th>
</tr>
</thead>
<tbody>
<tr>
<td>文件系统</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">支持</td>
</tr>
<tr>
<td>数据库</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
</tr>
</tbody>
</table>
<h3 id="13-消息分发"><a class="markdownIt-Anchor" href="#13-消息分发"></a> 1.3 消息分发</h3>
<table>
<thead>
<tr>
<th></th>
<th style="text-align:center">ActiveMQ</th>
<th style="text-align:center">RabbitMQ</th>
<th style="text-align:center">Kafka</th>
<th style="text-align:center">RocketMQ</th>
</tr>
</thead>
<tbody>
<tr>
<td>发布订阅</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">支持</td>
</tr>
<tr>
<td>轮询分发</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">-</td>
</tr>
<tr>
<td>公平分发</td>
<td style="text-align:center">-</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">-</td>
</tr>
<tr>
<td>重发</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">-</td>
<td style="text-align:center">支持</td>
</tr>
<tr>
<td>消息拉取</td>
<td style="text-align:center">-</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">支持</td>
</tr>
</tbody>
</table>
<h3 id="14-高可用"><a class="markdownIt-Anchor" href="#14-高可用"></a> 1.4 高可用</h3>
<p>高可用性是指产品在规定的条件和规定的时刻或时间区间内处于可执行规定功能状态的能力；<br>
当业务量大时，一台消息中间件服务器可能无法满足需求，所以需要消息中间件能够集群部署，来达到高可用的目的。</p>
<h4 id="141-master-slave主从共享数据的部署方式"><a class="markdownIt-Anchor" href="#141-master-slave主从共享数据的部署方式"></a> 1.4.1 Master-Slave主从共享数据的部署方式</h4>
<p>当Master收到客户端的消息后，放到共享的文件系统/数据库； 客户端访问的是Master节点，Slave节点只做备份；<br>
<img src="/message-oriented-middleware/2.png" alt="Master-Slave主从共享数据的部署方式"></p>
<h4 id="142-master-slave主从同步部署方式"><a class="markdownIt-Anchor" href="#142-master-slave主从同步部署方式"></a> 1.4.2 Master-Slave主从同步部署方式</h4>
<p>当Master收到客户端的消息后，发给其他broker同步。<br>
<img src="/message-oriented-middleware/3.png" alt="Master-Slave主从同步部署方式"></p>
<h4 id="143-broker-cluster多主集群同步部署方式"><a class="markdownIt-Anchor" href="#143-broker-cluster多主集群同步部署方式"></a> 1.4.3 Broker-Cluster多主集群同步部署方式</h4>
<p>一部分消息放在broker1 ,一部分放在broker2<br>
<img src="/message-oriented-middleware/4.png" alt="Broker-Cluster多主集群同步部署方式"></p>
<h4 id="144-broker-cluster多主集群转发部署方式"><a class="markdownIt-Anchor" href="#144-broker-cluster多主集群转发部署方式"></a> 1.4.4 Broker-Cluster多主集群转发部署方式</h4>
<p>转发数据或转发请求<br>
<img src="/message-oriented-middleware/5.png" alt="Broker-Cluster多主集群转发部署方式"></p>
<h4 id="145-master-slave与broker-cluster结合"><a class="markdownIt-Anchor" href="#145-master-slave与broker-cluster结合"></a> 1.4.5 Master-slave与Broker-Cluster结合</h4>
<p><img src="/message-oriented-middleware/6.png" alt="Master-slave与Broker-Cluster结合"></p>
<h3 id="15-高可靠"><a class="markdownIt-Anchor" href="#15-高可靠"></a> 1.5 高可靠</h3>
<p>高可靠性是指系统可以无故障地持续运行。比如一个系统从来不崩溃、报错，或者崩溃、报错的几率较低，那就是高可靠。<br>
保证消息中间件的高可靠行，可以从一下几方面考虑</p>
<ul>
<li>消息传输可靠： 通过协议来保证系统件数据解析的正确性</li>
<li>消息存储可靠： 通过持久化来保证消息存储可靠性</li>
</ul>
]]></content>
      <categories>
        <category>中间件</category>
      </categories>
      <tags>
        <tag>消息中间件</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux安装Apache Http Server</title>
    <url>/Apache-Http-Server/</url>
    <content><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="Oh, these decrypted content cannot be verified, but you can still have a look.">
  <script id="hbeData" type="hbeData" data-hmacdigest="830044a9d07e530cda652214b82d495941b8cc481dac790f77c45eb837059df5">91b4a72afde41933824d9b47e790ab2759c7fe391c65e762bc3007c35c45f1086caffe7b80318e3c40829704b37dca71e8e874a1c8a2ffd51225482d26c27ea76feb195d461ae0a79c943b93634d1e428050a6ff78264040f1238c33deca7832d08bce6d32266effba5aef03218ca1cf0cabf42467853f693f1db5603489c1fd127853883df2663a093e95e9d26e86ec085622d61c489fc2ce3be87fbdc6c30f24f47e1823769f7790068f76fcc9a0b837daaff63cd37541aabe2239d9335e7626fc337eef4c13e4837e627bf9e3ef3d0945a1cac736ff8fb9ec49047965e7f43c229e024cddb9da1367c0ed3e0c9aa9d1ad29c1574cf872cf3da53020a60515327ff815e9c7e17f02fe7e350fb6abbe92496689638a9ae80c8da9b9006398c3c30552b3fb2383dac614a9489ab2983a050408f792953e53bb1ad7c96ed284bffd518614949cfe6be0926e927221c891cf3147d80466c389aec9162680753c31cbc0e82b1b5f18292e030323b186d77a55be820a24015b75bdee2e73130fcb004692db55b8d9cb2ffb27a06f99330c965f126e9f805135471e11a2fd8e8f8f943431721f583f33a08abdecf3483e5a9305aa8954df2b940f8960b28145a7dade5f369ef8fff987bc885bcd6ce87700993a50dcba215cfb337906a38176ddebadc3ac909a0d500301d6195a1704a245d467c1febebfe00028bbf5e90f70115780d5a793fd61019dadf28ddb3e77a817e271a9f3694ea21f1c4c17766a2d89f63842dab72fbae256ecd051d3a616722a1ea3b04e5f52c307a629b795ddd46276e63294874c8604cf2685c7014d20a9630df33c287e3ec57b832e4def36754b7c32c88a9c297855b78ac365c2c85074425ffea4e06fed07ad2c37a9399188183615708f0e136f2c97ae51afead596f3b3b5219624a50ec9746f7aecb42c8f2bcb434e6e27f10c39d1ecaeeab9657732b341e30442a2bf82e40f4d08c5fd923d93ae5e365e382003fc269018c96363d896a4fd4e1cc5660b5bc0b896ce20b7cc4deead9570267e61d6683671c6306672e34d3ee60dd3161a4ce632763bddbdff4ba57a8d76751772f7704d5a8c8979d850fb2fd0d294c179774af95def649c73fac453d7235e7e8f71a6e83b13b831683367a5957c1a203b986b1ee550ab66d91de02159885146f86a9349a5a1bb3c97948a6bae1748291f550e463e963b78865b230310f47301250d351ee338d0b3b50d82fd187375c67cf5ee16f906e168ba65661361b785063a1f8319221004f2dabd2a533081a4ecb45e0e2a019bef9475f65dc616beb85ba8ee8baf8d91263dcaaa6e817cae56b8ad8cbef9bd24e58b0cdab04bc1ecfe385272cbdb6d064c3ce783ef77f8f7045347e831b4dee023f2a8c3b23375db19dbdf5676edc5adae9cf189480ff64c6c7301568541085b75764a82cf5767357c3170043c0801cf40ed30c644ca126be73ab1f6980b406374c73fe54077ff335b43a4633037a852dfdf8a01f7f31be6d231494b2931c43cf5230864e7b8b2c4bff45c0a380247f93ddd369c8189ac342ee106eaa20861e64d025012ca4c27ab975f2fca72b7be7e6c767d74e12dcb4a16e56316151966d1abe25a10a80ca4c0b02fac66a9170d713d905cde6839dafbbb8cffa062c6aa8afeaf0d90c1b97c44cd0340065383e5f7f6bd117fdee7e91b955126c7775215ce27ce980defc2f2ddf35d0d405229bf405efe8d3686cdd63b39fbdedaec48277b264efd3495fbae1addffb4b3a4bd30a918122b382dfe1200f1e0e3e1994d9fcb27a1e2f36c389a4a6299c7f12d1a354a8580ae8888f36b3878a4499f43f2f1b1575da142525823b480ca85f6dd9e429cb061875f1b8a689dd9d92691ef3b0b3ea1e630e03a77cb9066e153e527d8b12717bfc32b6b8dce7e1b1622527483c499e07d180de997b035095a2193671fbd945ef811c5d03b58f1f1980b26e9adf8514b2203184fee8c4cfd34cc4406d55d3b1d1febc49f4d26ae801796b9fa6e88426925adf26390acacd2275005dd456ff7365515d92eca169bf89996549e13178aa79f0ef97e7aaff1ac04f1214922301165c1c451904333465ce80a06e315e2a2f065255cd75669861bd9e6897f332a7e67b43797c283570595b5e00310d919874eb55039cff1b3295cca3e1a343756f12c956b6b601b24deb373c6a476a83c21b5fbb7d522155c557c8324ee3034b47f71798efe559dc6a6dad50acfafc1f688c46fb2c9b21e8f64824352e95a9958e2e3121429fc0d7120f7a5c43acbf6150d11c78a3c885c54493809eb7e6294ea5912667619c1d6f121cd6a5fa6ca100335ad869448166d99521c4aefbae716055b814c55547e59eba795f4c36a3c2e5156815ebe0b06e767fc9ca7e7956bdd3321bd004a4d8210023ff405c851e1b506ea6b6756080dde79331305abf443e4e1e98661ebf6950c81831c20de6fd6f68fda6926aea303c89e03200f2407e049b7e684c603d5fd83b40cd7a95964dac021735b3cc6887a0574cf311242dbbca7ace599884d3882e99650199bad3c63d5193b216cf82ad034a3fc0849e224e73de289359f8faa8a393d07dd3de5b0543c126897046dbadcb87224e3edd6fe62032bf340f365b08a4e4efc3c0407fa5ccbf3003dcf507e5cd5ac2807f9936214417fa0273fe19e8ecd339a48282dab0d4d627dc8ac198ae3ae6f2c2683abc01e03a74489433ae5bc21a43fd7c2744fba6ccb2a4869deb1bf06704b8dbeb69daa18d70a6ad47dff4727cb3ff30b2653ec680e17bfb12a730591b7b55c02a4664e5bc9310c784d8f4033134aae41ec08a50b58ddfcddde83042af7f1bae51fc61005ba9f025aa5feb6bbe22126d22a4c549ed19f60ff141b1dd1038b53e74cdd2d5ec470e57c9d80f93f5530ddfdc69b4d8ac4987e1cb7376dfa1536ca2530b3023391960bef84ce715a7e3f41bcd14846415d17fd57d5326281759351fe825817937c817e24e62ec4f2e6298966cdafbfcda4abbb9271432494c65a4b06a6aa417901bccbe8777e26583ae36f90f5f1d0d7eaebf05841276ae8524cd2d860aa7420b54f71cd112afad38574d389adcadce5b10d48c8894a119dbfef653ebe7b0032cbe6b75c0462aa51d29f4ea8fd1e11b0fe20ae45c5d5f86ea7936fc420d772c29368cca99e0a6b66f607bbc4cc5e69aed3d01e6a6353b7bd24f58609ca3a47f5295ce844af3f698fa1ab614642b4def872fb9f14b874d7306aa59310d77f18fb2a95d2e5b68f55b6cf8190627dd601a9762ddee9aba196b5ccf300e831f1e2e1e9fb654355e486ec969182a87c86eeac47a61d1cb732fe494345b251156ea26197a0b3a6965b5094da06693ce82d2f0433443a3370192befc93601171b0d6ec155ac688dbeb24c4145029135512077a66e61d48e699d500ba636deba322e3770df0b7a95edda62bde5cdf3df12c13903fc8afc37b4e11661705aea558995b6bcd63ebf988751ef36aa895cfde050ffcaec303c0cde507c09062fce76d653832b5be0f2f0a9a5117e6d96d98993c3e4af20cc1ca1de745a4f289f5b9d8a2dd392bd57f2ce8ea7f386e7f11e92409692bfe26f29f7c9f4b551dd15e2549665a9871e9d2d5ab80daab5455a8fefac3d66c97f537df1af35587f32d4cfb86ef18c2dabf7e8c7392ecd553c98997e9065f0ae452bde2445ad235d6d29685f6e26a313f4a44b996d4acf0c39474e55d90c16e6005aefb0b14632f66e0b9049c602191bdc07184b7f487a3372743f79a2a581a02949236883cc18dec3172e73438d0990ffe6acb3c81214a18442c4c3204b69aafc228c269687e979290e587d217d66e70f7c79549de178841fd5a932ea3fe9dfee71c3812cb60809fd8459462ec0ba8625899306223c76145c4d74f34bf2ee81c901c06ac0058ae88c986b41d9aef13820158fbfeeeb038d0e590d4865968f198e7d111498d132d5d57c94a43147f571f9e35b4d382c6876af9c2352a2cd3e9d3f02a1de8e81279fc62a35bb04fb95380809954b192a36f01cbfa5dda526edaa89767093e0d874325a6a90eaa0e7e634dc104cfe4522cf6bfc62953cc993441569ceaff75d09404533b7164656b49ca79e67a858fe9b3b74a343196fe4148afacfb8e83590ea333a5a155d625265e25d76401cfe47f42cd73fc34dc414d6049bcf0403303d1c536f83c23fb16d41f74fc2cd0d9c3c18a338548791a54c269601bb78f7a29ddb66f5f9a53d8f96f9246275df3bd372f794e241f52890a13a0db23fdc282d01b64b0f23086357f8885cda4bcfe9e568480e84b3153db2755c19bc36e7784b5a967fb659bc9b2b8c28171e8b927b8dcd9b02be1ad3c5a56c17d677fba0362dd452f8a97e38a750ffea3185b20fdf60e47d5c9ee2e30567b8796aec971cde2b73650d6d65e6c87709601e96b9c75657d76113fbb4620ae19ed3cbf8e1c1b1af521ca73307d8756add954d841a90d34257cd42e299d6b2819039db4a3263a16c70db2b98a1ffb212ab0e9d9389f737b0050212bf4a558b535abbc17bdca01a35c3ecaca1f099b173e8700b4aed7016898159f2c4d3dc81096be4e03ba0dd085be949a48f1fb2ceeb8943b225b4b123e1f9848373293d230636d885ddcb6842922c74dfc143c174b2507d8a20873cc68b4c9f2fe18aebfea38330479dbf76d74e615d54c0730279a1bbac2d08e401cf53a7e05bdbb5dec1f8a9b5d969887fbebf0b08dd54e6dc0c1aa93cf68b48c68b2fe1fd9facbf2a4c6673bd3357efed897b15782cbde443ed8436f7aa9684ebb70ba7781324eb3856e78a83f17d6ba46f0c9701767265e3047231d1a3c5398046b2c2a2456bc84a64402009fcdf54e4ace737229e1d8b8c1bc18aaf38652c447417291db4d6c9683cf6b10503cb4334182f2520ac4c1a705a6a8c3f7e888387508e78996c62c49d1b984a92b3d3aec292e33ffca4ea0a1a3cf067e7d655f8efa64af3012d8fd9cdaee48d9ef2702389ce97f4e2dc85231ea91d5befe0713543f701b07f3ed42a20f110a15b38ce8fdf1e046313d22e127898ad5a2ffcb2118962742000f4531370bec65b5d5657f00a60e6b302f5462fbe2055d48ed7cf224611382dfbb61ae2336d9c9540137bba31aeabd74aa30d939f6523d6ce7d6d10aa7eb0bc8e980d9130752b425a2878e26af0d4095761fb273e702462c0a7ee54f9011bc737b766652ced8ae973a2b8c94af61410b0d9d41d4839224e3bf71e70ae1f73e867bb2cba70fab7a09900a76868cef35458978f02dd38e9811402290be2d090bff93ee913cd532ad34ac3b1d27d370f447b1ea445e87c6959db8a681cf48b4d2ae6e66347c7eac565a010c8dc746cbbbc0f2bfd5f3ebbd5227ea7adeeb678a7f1740990297057701f6dd6b7b64c026aa83076a2ce2c07dfee12eae3b5167b4700dad6b01167b42da30f70367d2068c4e1d4f072bb582a93812c21f47b18dc92d1f9e766fad258f54d188e812274e7b2c97301304ffaa815186706a98abf4a8600f66ed2a435e8e526f6b7a0f26f64f757841611a8eebc888d07314685d4feed4b97e6a8d7308b54d38e5a2f636e5e542a6967115d3a9a91835f2df39ff47adb26978c5d8663804922514b73897c793d72af0ccf0e8856f6d3347c912e2be7a2ee7b3eb3e272c285df798411b1879f568305f937cb3411f5d257306f3d1a98f203306b74aa75fc19cc4a422ba424f52a4707fa624b4f5dfd541e0635f7455483f39ce79b89cb957ebb39fe18de82d17f623f63f677902d4e30b044b0c8c6a12f268dbebe611230600d4cc68e6e0d2401f0d9e352a8820d6334799528e5f71687b20b79f88a669a0c26b2567a2b2e6fd183ef1526cf1c6c1c3437168dd6aa83a3257d1994b89449b3d548143e9f45ee20d51d301df6aaa64b5445c9f2fef276c5c816fe45963f66fda2147ef2b628d9f8fee1fe126960fb22d4a62255c53fe0105aa079a2a7cd595d35034513fd82a73e1f9654bc22ca20555d2a2538c62f9935d6914a3cf60bff503ff8dec50fadb5592ad035b0a768d81a8f38f9b8d115820517e7a1642d7c3f8d26cb866bfc28bd6c3fbfac8e58718fbe5a77aeea4e78522b4d9bc15c530dbc944d5e07c037f6d3ee9c171073783725b982aa94b837e74dd02d7ac2859e1222c53f3628b7f6ae0f365b676b6fa170cfb415c231c27b9bb9c315714e189ab06790f5f36b21b3980c4bfba0b30e7c0eb34aa3a0a081c7fa5b9b526d279e16014159631c322e84258adb0510740a353fe3db51d3c698f204ba7aab0a89cb83700c2d5f3cbef07f995abf13ee226d2d27b10329e123e4751eb4c6b1c22c585a24abba7ef9ce39f8c01fba4ed588e26c169a926cd6323546b5c5c327e9c85ba105d4256460eb5683465d50af0debad689953bd2b23872efb04062e405533357453688a2f8e137b218f971975265506524ec6907150546fab57835bb3ac158f20a78ee4d61193b0bd73651fcce415b420368a96b34802a0a92613976e3b9e16ea0ae9babcf2bc517b2fccf372c862852d9782b3b2401775e8680f4b2f62a805bd5f85817e8c30fba66a92fe04a1b0be1252ee685c2106ab509e39df67dcf3dde8158b8497172c281d6e8b537d66b9709b309a4d2a082e8579cc0811cc9920003e807803e804ed259adde885c95323036969303595816ee82bf1222435d30b0eecfea011983a312b676a0c63e65c73e798bc20902342a5c9228b6d188523b031cbac4b62e43138cb1852dda0330cd4b3254743ea2e241e0bb6c138c145491d924695a6b6286e8b4676c7b940ef7d7b621bc720b54e9a7d46b9b680dcd352ef4c3a0d09c35b9cd95a333f73a203adbeee59419ead642b64bae0a2a6a9664eddba6d07479f105f855cbe950fb2743fa91199e057694e6b9e3d57361d09f09e9387b4bee6e26aad07a31ce542c2fc348d9808ad824824e672d251780a023b972fb4734e39c9f74e8100ca8573601a722fcd78dbc217b6216479d08254e9699e7bc571948c085d6b49ad9c694fcaff03f0cbe656ad7ddf6e2b2dd303dd8734e34d29e25afebe36044eed35216ff85050cac077e0fa7d68816bc9fdb88c835ae79f09f99914b9315cdc8194b8e5fd039c353be1f5b5d09a02e44a3900abac39cf04cc1c2d8b95b17b39df27f6b46bb3a52a8b152dbbbced3ec7317d76f3a59752351a6c8e8a13d39e7747a2889882663c17f1b22ba3f69b8afbe4a2ca69481f5a4b925eeed94b004822d8300811333e86c28ec0e974b15bded0972c0e8d341bab23da9d42913646586db43ecf2cbc6f4cd42c66ff3e533c14ffbe453a7364c2e806e98876d8dcc2badd7441bc882cbf497e80150eb9df11ebc894a607ebca508e49ed7dedaf0133969814051cdb3a9efa434a3da2648719a311fb3f0960d3f1f15d2c511ddd27d424718bdfe56c1b1b5022575d2511bfbad05d0d354e8f7ca3ec29cf54583a6cf279832b10c993fe6bcf605de01763ed40f3ceba1df6aa3920b38745f1a38d9e2befe2bc668592800f24c8512df49dbcf2ab2fc9465d31f24bced88df4b1315ce873ed21e5704309cce0bbe83d9d589260811a9c6487c119cbc6d27240724e4a55c4226e096bbc7c061caae64ac66db639e914ba4995a3e51be6ac6a2db016edc2180216ee0f4c21fab9366b35b9bbd338fc29bbe6995bb5d0095aa6697d2954f9c0cc42079f3be4f1db0b8759a1523791102667994e291142a0840740cbf0918ca50fc2c08e1323e86be3f4081c3426355cad31f2405d5e09e1cec14aa815ebe57ac0b67d3e148079d8ec0e88dfcdbd33cb83ca0904f4d5447eb885a85efd25ed195e8e25536962562079f1680e1c2d7788f732ab4adcce01cdfb149615861bd6163967c1e940f7198244d4faee21ed674d7c519aed625f12e4f717fed33e1ab32480f95598da507e6d0dfaa9f7f65d94462bb6b39484359fe81e4ee29e845a47c373e51abd6511108afb2933cf34ea342d6a948fe403269b4a6f92f9224172919f9f13b37078a3e51fa7cfeb72a7ea47c455fff82f81e67e57eb111c648f8bd9b6fdff18afe5d9dd1a89da240f546890f8e92e22543360f632445c965bb8caf31fbc6e0d134b629ebe9b46565e24f08b3cf8e454af7123e37304def49a13090bcb4941764b9e0b0aaed5ba3611b314adee049a009e25d9d24109eb228ee423fd5bc04863fce62e09174b010b9213823d393aa35c861a3545a8728ea58539e39b29f5927f3a99d00cf348523a8cd6333de9ec3c663e99adbd55d9ac7f4349a94fbd750601a0d799acf1a01086c6778f241aabc119569650fa0be78fa1bc2f1dcc3f5dbd79d752a7c1ac0975ce69303f6014552dc8d68f0dc4d07fc1ceb9d570c7dfb5c8b5ebd68f10788075a66c0cd327b40e0c9e110c860b453748e7d48755a2797e1db47c3297f3d4e7eb8fbd9e82025d0219e2e6daac04ac157ca3efa3c7467905bf136c4f5b6a6cdbead3e8bfca1f1062454d0ad57cb7930009988f641666c59536152a232727eea79971575af3cfd803b73d71e881f399997f88e2ebad066515482660ea3ec8ba6cd6ff32e2d119b468f0539d7a53fd6ef8f57873b687106c90d8475c1993287c1afc60050cc4d258d89a469880612b95048bf52de09c9ba02a88e4fd5eab9c63e09a705e0148f615c8eb9aad859d8e0421b1e160cb5331c18cc1276c2c5b91675c4f8a57ebcac4b43354716cfbe28e4a804c38976685f62e95ca945ef80571dea1d24456190bd805f32da6947b10a5d7752d02ce8aeaac60cf147967c4184a34a61e4752748ffb3ca397f0f65327f99855b525331588dddfdc4707d0148fd0ee6550f416e055bbe76cdcb9bfdae310c1e9bf8df8c4d145ce5bc3149cca2b9d97c6793da3118494e51fd96423aadfee68d4e7ea1204e27b8398e28f26d34a4912866ac89d39c3bff5d0625690c0eacf3b677683c139e01cf1074888f37e1e928d8adab59d506bf1fdfe93524727684bafed6a859c0e5f62b90f2e01cb4ed48fa871bf4d60376663526532820b635632b1c288769e3066c3964cd992c7c8788992665f1fda9d15464b832f9562c3780fadef5b3ee8dc6dc1dcbd798c63d5f93c252854a83a9d876e18299822dd71ad781544c281684bf15e08d8afe8d54e42ee76664cdd0cb21d8ec7969fc7fdd4cc0f54a4e9369e5345dc31e4a0b1b9ce81c904b2b9a7c476fd95002e00b4633e8824a7433de5d1e9c635dbc304e8059a98771eb7765e264940328121dc3c6ec2963a1ea4f4e18b6c13633f9af6b7ba5137420a5f0ba696695a61906674eb0b31f786fbb976268c16def14631285d1866fd67f4fcc3668cfbdc8f719c399c9c32a6f6396cdbfea9c553e72ca33edf68fc44b25b8e63f7ddafc7c1aabd5c0f71b2b69ec5a084462ed2634de1724302499f4523a4bd8e11bdd250943055052723f7b0ef46e04d6e72d71ed97081de464ef6acc7971373c35b3680f1681b836baef14dbf666c3016ae15735902469260e63ed67775db1ec8e5c914aa4f1b8b72c3067b4701834a99747cc003c5f754aed033e28f6159f037e71a7dae5bbb3497f19d4ff59efd4f16f9ce05961a1e49eabecae63894aa28e47bf849623c32cd97a465787e95f3a563d9b156b23a5dbdb9179e457468ea445c7791c3aab87e909280620df7c25e59e9dec4bd0c9b89090e1b3ee347c6f29695095e00a9cb10960d78adcc0f73b211d72d3bb06ba0ceeefab8e78804325221868443d1377ed8a1b203cf35aa4fbea9f6ad4250719b11deeeaa9ea7c124c5b0323006df7de8040e9dcf1a40bb49aa94a2a599329a23dfc35d141d90e6ffd9fa7b40dab9859a8b2183a98399c19ecf8063361069190ac6c0d87ca652d1419bfb6410366d8d9501c9b051b4fc1ceec7efbeb98a31e0975fff853b38434114611829f8cc580a3e21cde48f0fc979dee477bff5887d78e390727eca63e6db34c5a2fea0820314c53afa5e54f1f32bd30ca2f9da1e91f8d9eabcdbda10719888b96d16ef1079de6e9d6b34a9349c59ebb48adb7e39756c6c6a450c052fc8c029d4c583d6cc2cf0620524f981700d9e8006f21455866cd82ead950c5611417c3b8c1e4610110ea634e0f11a267b0e9aebe2738374cc47ec6ae6fcf5a8d36af661f3c6365b31334b4283d48e7ba2055a1f370c519624556a2e5989be994cb89bc2422200dd08fcee841951aec92078f4824e511e33493c9c19cb5dde7c17a2789f699073eaf61c2a6a194aaaadc421fc57193b64212cdccf4c84ac8216bd8fd33c53d0111d77a7a6cfc67496bc35d53e7bbf92956e5d0efad79eb588a737b6543cd0845e8c0f7f683141465a0fa5c1ebecb6b7bb13a22f13f2c5afd19e916be7bf475ffb394942efe8c7e229f1ac36b6333917fe7ae75581d7623db7ac6d916010710032ae3a4cd971b11670bba842228b9cd38187d844b3a94253999955016958582dce61f3dd8bea29672e6b9602d72b82054c93e49846313898ff8ed9e89f1957fa19afbac1e032a4f9dc0a0ee9476eda59fd927ed9da9ca11a438d3c461bdd743ac2043b0dca39be3117f2d1a65a6f7c9abe9d6333a250d97dfc7537a90ca25da8d3807e01c71a3b093fd66b7ebbcd0e351ceae77f8b75a7a1dd6aca6e290f959aadcec88bb7ec03d57376ce5cd3043745dd698846491474db097279c4f2a7b289b00e53cbfad88e8163b746f44d167c266084ca68266f698097b7d0f66cf88abc3405384ca9450daddd044feb9135a93adbc784f42d5559d443801d6ac069f3cb1054e4a8da09991ee93b290df16fc16819991742fa27c810a5bc64b14fcddd4bae50b1f1bb3c2ee7181f04c951f086e38a8b5c3c203d20135fe540b3295e85d5d0dea87b8199e0108b1c86a6f4aa371837a2a98d14a09acfeb3fba3b67a109060bff12b76653b5fd904e4a715de77812b42a7bca271567e144ec20318b697f3d106ac945a38e8f5143698366b2ab21ad701f407a4481657a9dda7ab6e68ead530fc98eea38909eabaa8be289ab81a9fc73aa036f83dd519587eaf447ddfde623b4167518f2274ca63f9e769f98217cda9e0667699391383ca0d19d46d9655e64a104c2989f759dd5ceabfcef2af2b3d395287c95880bdb7a2d373bceafa5c924b404b8bd3dd665036d35d43d935867409b5553fac597f49811f78299bc5d8a602c75dfec703cf13eabb2181f486f0c50bf2b250be7ea7b1f3fbc3a6341e99210a1de5344f40cfa7c4ef2061e5e636629134cc9b8c10718fa1bd6fd43e9604ab47fb2591a0ecd4fb831a7da7d8e0cc8007fdaff790b4cd3b5c4a18450e2c805b7835d98a4a0298d4669a1766d4eb40e0d31e1957568584a1f1cbec72549363583ade0917b33c9ee8b3e7397d7b8e8bf77b4f17ac57155d1b6dcc53928ce1fa9b78983ddb062e68dccbd61317ede82c399d7db537e86d7651dd7747a614189f0d31fcfbe9c42f772187f63677609253ac30fa1b262842d5f3f138580dff2ae5c40ae6cfabe426bb76d7e7e1fe1dcc1cd84e0acc5277a72e89205b80546f05cd527d0d3e818d0db1dae922ffe41dd28dca3629ba2dc7d3e740b6c809f9858326aef0f95d46f0f894ef7ef9e5533f335b59dff78e8accdaa39a5fe165bed0f82126970f2ec848ec0c4b603b871961b4b1411261c2aab6c8b88f22b710a3ad4dffe4e35bf18a3bf54ccb8856ee71a051db6919ee98bcd3dbf478798dbec570f00eed3ec278debf0f00478d62873146596b4f08ea966242426ce38f167389315b4e95a1b2484ff41688980e18133d535fb43dcb7807464279214d5958d5fbadee3de9a6e091416cf6004ff6ef544b2dd6bd043f51d9fef2b6be02721f76001551aed04e8a440a91953a722ba51e2a88e01ea16b7f979ced54d21c691ad4abb26c1660db46e548f80a5e539c65f3849f669a8b5e2af298fbc889e08e217ff4b63c8e6917954dd6ddb7d4968540d8b36580144638924e6e1ae4f2424635fa6f6afcb9146bd329b2ed83b8e74dad7e2fe7994d2678c3337d75c6ff9377e4d29519b886fbcf8cb5508fd9b20a03b0fa88ed9f55f11b91c83ba6f1f1858c78c67103483ed73013f9a4eb2ae51be1a7550321473630f5a9b5fa1f9e2adf9c8c570d76445f9d701c35e4d3c565e14c8eb59f171dca3ab79717852b75ce12ac7b572f5dfdb057ccc482619865e06d3bb8dbaa0ecd3ea45dacc99dd977298290f0a157013066c0b1d2c121071cd694b076caf4dd0d6c1db047fb6507cce3dc6efa2743f5fff2a4e2c25a5e0c444a4b91bff975b21eb11e72a493ee58203252f27dc0b52a1f907d553a7d09f43a58f7b866b5759fc98c4ec82476f07c3fba78a9c7eb608fb18073b7adf4c177d6add20b5776bd1ddef42fbbc85dd56a0818e7fe0768a4ba3d1eed668e0841eb6bd1b15e5022387fc92c79f4c6fdbd9665443702b748d054a5cfd361ac80302eeddd675ef637e684f5bcff2d1a7af580cc1de9f30a1b729fa8b16e1f4a69e7cf001e2348bc777d620cb9cdc17a65b1b4fdac69bb228c6d394a799357ef5201c4129b3cd1f648c80743edc06bdbe40b487dc4c8a36d147af35f29240f4cc8f7b5c4ef0ef400b8a3d5643ec94a55376c5aa0b6f4ff5fda6af919e7bbfab63e9548f9dc7417469e8f9c466a77f095273849bd60bd1116a942baa4da3ec0dae370647467b1a9bb798944ac72bec9eec51eaa6f2dd026794e33cb7577b7c67746e8ee66c95dbef8b38f06e9f5043c934be511e6df387c87e303ae7f562a2e4f0082a58e56ac9fb0c3096a43eedc45c8af5299abd47b64b466c3ba861d61c910c1421ac8269dd14089a362cf4470d4008521ee47866759ba2867100c90467776cf8b27f3fdd011fc297ce57839c808fc84732c003eefedf0e9a6bea15dd992ad06db90635fec89e31a5bce6742f8fc136bab98daacf0a44a3dd44d0130e4156d7555d86fdc476b418ff980ff0935b8478e83c544bf3bf0494b25818a31abe41c17664a338468b540260125385068d8739e0d1f571b8f5a17d22f15b5acb2e8ae799e4edf4c184444b6cb1a14f9ecf0f26aa31e42d32a99255b6329994435662ed2f68fc25096e2f66ee9c466126a64856760a10ed566561a4991058d306b9ff95b794c0e3f6c79d0ea210c40ac16e4045ff5336794e18e78b0769c8b77ba5e854d0772f1b7ce195235b63d00d802016bfb15ef7f7482530585d732952f1a2f4139c0100b4e677f06e4ee7e76a3f0877ee8e50192a2af7bf6323525827a6e68bbb0f0fbe500a857989e95bb287e3afb1ced606230c6e2879f6fc2844e9f4993d69b90cc3f8e49f6e1ed271f87e1b859a0dd38a8f66480de2b71ab3a081c9a7813a8f45aa08950e2ae584d39f16a38b6392c1765a3dc3859051077768fee0fb1ea9c4ba0e8ea24c2a93afe2a90768167ad20f3e2c3aefd98407cf71e04a1cc2bd009c444f5a312b6bd809c36fe65d528e3fc021aefed2acda0163cc1998734e84b10028ea52dc1cff06cc469c0496ec7fcd91a1a2382b03ba067ce48be3080979aceff785b9a3b1c97e98de60c6daa870ddbb7b6f946b72db907a279b26148cc8da1971f09d7108c42d08b97a67b75b33246e16750478d2ea3afc641180ba224dc8fe014c6aae40a50ad05ceed567120a36d80e7709f908818794e3f202efabfa13f7f3577a2a798d26024ccc35ed52603269c56ebff51f62d0df7f3bb42285424915ac8224319b4e47cee53554163c00b9ccfada8fb9812e1c4214605ccc996dbb9131344f1d36366ca4926360cc723aa59c3522e29bb921c8911796b73d7aec244f471aa11334fdefcf5214bc555d93841493a47943fd9539d497495196f38ca0311d711963f22e5c4504b2e065de819a24af8a4bedfedf9afa42c855c8df6e1759458eabd8096a94cb2f3150d6f3e38457f0b748e910de30261aab42f97cd80012593c699560bee70482ca41f31ab21cf4978b322902d8de9b1a9a8495d9735b7d49421a2a5db3e7ccb41b70c12a79d5c284dfc8290dfed44b6255268d04187220cac8c263ef25a4d437362e28e1f2762bfb9eb0d862ba2543c73c4a3750fea95e8a32e2b531b0d7057419cf7c9dc9cb1211b5dc6e145cc3d72a348a6ff08efb9787d3f9086f2eac0ea936b1aa5014e1e39becc1938a27fa771110d38a715e11a61713cc1211fe825860be10551e7c4525766ab1da3b9498f0443a1fda325c58543d5ddc0a3b521dcaa86e9b2d6bcecf492c9d481d3e14aa6dca7ddcfbfb0eb31e7dc79e5424dc27d026539667f9784a86b179acc3bd6af169d629d0919873b59138820ea3cced759bf176cabea09a5b02e70968fc2d4a5b0fea72b0f6cf5ad10b84cf639732dd70ade99b6ad6f79eb4d03d4ad80e43f4bf0dafe24456e00dd9802a5399f5cbf617c4995938b1e860f4429a165c39996dfbb282b4cd1c7ec1c253585cbe305498f9f980cd8766ba1be96ed83996e1a418f2a4ecebcaf0e0793cf471fe7cd8e220e23ff71e1fa674e118640323ecc6acfcf3c9f5c824c05dbde567bfc041b611e2d45743e5bea65ec608a6593176f7e90ca61f310ed4b9b7a637202f987ca62c1ccc9e98a8351c3571a5ed7f3037e278c7ead54cc9761871f7e0bf772498c18f1779dc8d1e64720fe7fc8496f39d4327812496fbd537aecef52de810039d32ec62b3b7688bf8676a759a9c81cc23316cc3aa84611abfa81ec114bf2d85e3a1008ec9565a8bdacbf40b8538933ed9c62356643b2b7a8f732348886a48b53d0987fd8ad6324932dfe54bcfe34c2b6426374e81defe69bdc84e823ecabf3c8893257106f8ae3cce210679e1836ddbbb02f45159d35e3cff5c74957955175373b7f48a7ef3c9eac78b1b4523aa68e07656da23dfd68c70a3d50d476f59fb049255de4c695b441c0be8b772bee6df43b8c6627b6c885e035d4a9ea9a836ca63475454fcdf77d97412959221c9f15c22f414bc8e862736c3f5b3af6dd835c8cc6c766b530b5e3be25743f5225e4f4b9fbe7dfd5b1c7fc548c11d7c50982642e36e92fdb2ec086c5f454f9207985f9e9d831b8c233860b598769174ef25833c0c5dd4edf36c170431203c466b18b94bb0b81fb7f172c4950885927bf402720ddf0436a79e33f0d687db526822762afae4119b777c23ee382f368a0329fc2988d6b818b25f1ab18ac39cb839a1b6136cca64184e6e4c3cf33196f9612d1b2d76785cbab2c46958b8e80487d6788e020cb773f78298a1de44bf7be8a72253017d58eaffd70506dae283e8b769c2de6b7847c69903229bd8616a9e6a65134b047ebeacfebe3e75cea516527060f6ceee5306e6f54f7f2e4c5a5872f44579fc0d6094377988ad9e0749ec839f4b3241d3b554f748c1d8cfd002e4817cbb8cccaf7b274d74a2386849a9ad83acfcf04f45c8c592e486a6b7c0e7d40c937a981f8cce063859f84c4d46190394c07a8d561a6513ee355086a1072b95a57cecfd4571ccf5623527939996e6d2f0d4416a4312a3bdde95022d09b38087c4b8e4bb736b274714e263ab39c3adbf6aa89faaacda54aa6bd76e1ff6c60f4a2323b7c725211f9a02859277f52b01d2e7a1e1d901b9116c08f5bbee91639f9de8a6748fa3aa5e8ddd19f3b1bfa6f7e5df5b8fee60b53ab6680c6777b13c7cf8084e171df60551fc26cc8f6e8eca5e5378ce2a5586e779fa6a47de8e88d36533c519453078ba7eb1b0c9306f88b0a6826ba276245b16b4129e06c73e75cd97807691f9f5e75d8e0ba2ea9ef97d857d49ec13f1f00d1b471ed1979fb3f3ba446120d0d64aa6f49b3ebab2963c74f6fc49962fbc3f5688e36adc69b71643bdc9e1bd2c6a1ba6c0a5bafd39694c8e243f56a26f2243649c3b12e6cae26c7ed9337b099f1a82b8f4cff20499a51c2a71fdca540c174f14c7865ef3df3cea185e68e48906035edd006070c0fb858d598d5db7f80ff5611e585886463594ad5b4c1673ea4bf854e8f6b019db9c2d40ca853a3bf0aee2ae0e5008cc881c60de0291bcca5e4f95669935dbf15bc2963d01818f789ec64e8204d6f783215dd1da5467b3974a9a74183ca08f41baf49c3cd147a2f79d26d4e2c48582fd8669ba5bfd116b544c23064fa49a5165da9045f18a4e246c71a0d1a1ffa0b043f72663a2ae88217811f5818e7daf04d31f32654df33536955f6fa57a3ab8a6b52a121716d04e4a1fdfbe4efd68471a56674fde2ded018de287b7dc934c329555282775073a2b4733d7a659037243e10e4055373e50917392a56d8097cc67fc0a876fd47176d1277fe4d5e8080bc08c7f9ab97d35f822a594e479bf0ac7be6e2d39e6b37b8e29d0f6e8fa0e44bb3a539c31237fcb82b5a32e991bba739edfaa40373567752ea6d8929a68d158fe0b2a1497df01a27b732b29665d4f2b18bdb9419561096c0cb2bb70e0ba18f5631dbbc0fd54bb4144e5d698de2fda987b4c0a27663142449ac1047fb9221e607c856ef7a46286b0e0938f0902810d8a55302a32d6ff69ac1df8c3dc1edfe2063fb87c6a6a8267b6a23e90bea90c1906cb78f8a47ead68687a66f42c31371a1189a504157d357c9f8c758ef4be9fee6afee6ddd679d4a6c56a71ab579e64012b8b305645425a6454fd1fc7fd304419320e0f5321885f18d26d64ecfeab882e7f00c991ea66faad2f98221e2639bfec42f80526734c37ef5fa44b17f1d2130e646feb126cfbd11f83b5936c98ee027167858ae2398c5ae5b1b85cb029c6b7c5a6e83b264f7bf84c6106134f098096abbdfd8afbf418bc42a6a0705083469b54625335487a43ffd030b9e1233634ed3d02817f6c5c45b45e71faea60273880ab7b5bf226f6a4bfe55cde1027a565de4eb01bd4fb6f48109596322d881e13ad6419a4aa5b5f3f55e7c4600eb9be3c86dc186eee9ad0c2235d056935c4582926c8da25b8da9c73c403bcc961b2c04c450866ac133552ac138eff165046e0217d3b084b5d522681395b186476fa68f37d3cb988bf3a23f093172b8d350ae44dafc46192dc050793a2f226a0c4da84a815c4cc1a908195d41de5b98fb5413615648eca13783236fc5ee94b8ff0e9d700852bba9046c24833b49650d4f2d36aaf34cc380e0148d2d2c126b86ce985e8c7804ec5645f4a60ff4cc7170d4956afd7d7608691f52dba8c6d0e1e95e86921b20dd00f294026222986549e596db98893a1dab0866fa987e37a098487d0ca68157dae92e358f66717dc60813f019a4379ec1f0e7da31226c5de3d6bcaf649a9f448019d72b4df5b03e5a4c70efbe57c14756ece450db74f77c44d35043f3a5cefc2f834ec5138ef251b4212242ce7b5e831ed83d89f477f86debeb35a4373e418624011a5cbc57dafe79a831d66734f89707c038f84129994e83c54d15ff375f0d5edf4259fbadeb07ecaec6d3850a79fc23e8d1fe0930626bc120349415fa34a505d608f77c7f9340b43cc3280c82da5c1c4def3d74bcdbf5e100b960988e4390a9ab36a64575c0f3466288c9e6bba65ca777eeee625cafadbcf5d50bf0de7d923ca7f46eb34f355c22826871cd0751036062f1ea9c4732ac490964e3ef7ea4b3f143077eca13eaac944b0e894d08c1c6b69d3b52053d4067307ffed0f58e7f2a2dcf684b0b82011e519cdee027b27e377a54cd2f777cbb0b17611bf7991cbdd7f1e2d971b875ac3ffc33cec02b95c8de2182785cf4d051ee88213e01c5db82e52993fef44c1a1ac447f5125734ad68334b6706e7498a0d8e436b08ae35c77b058b758df8d7ae755a52facc074a391cd96aa93576687af8339e16d658a6a606d2cfb9ea1d89b539a6210d96c9dad5a3e3d490b028307579b61b7c100df1fa80177e1a78f0d0163e2ab0024402b04ed91df76d9b3520a70ec4aae6e11eb2cf39bcb1c9fa212e858c62a6bddcef99fb426a344cf62ef1299589bd4bf3ba41815c60970976abbbe01b57c0b2d9fdf74fd8bdfd9f8f2879b3064bbc290f20230dd246f7172a7b2749358237d8a70ccbdaf89144d013fb4d4be32f13577adfd9fee5b007d7c6d5342ee228151c2d1068ee10fe1957387b5b241ec218da3654f517d899e69ad3b2c004eb68d5e6addd03ad9f4de5ff7f8dc0d1c9d4c571d5647867aba97698f5955467c26aa46b738b67911e46293c7e9677f47fcb6dfc1afaee3057f46382392ecaa26a2a921ffb7df9779e698bd5fbf481db5d9a9d8f572f3e92142faae12c1e840a83e8b8de983e787ff5b687891ed5096f9b9851fedcb65bc850e9d0fce0bad0a6464b2d962e3b878650d9fc92ac05135d6123adb5655fa23829f48ab230835c57677c8ca5fe0f063aac20c9d39d9edba930178277f2365d9fb771496b0d0ea517540026cdfb2088cfba7936e72bee1b66a28e768a222545fe0ac34109c265dcd951889cb46afb60042bf650707fb0869d049668ecf881cc9fc249ec4993c373ae485642c3e5ded728ea8919e5ec6ee78cd79b097ca524134ff1f9fdc5ee6f2c65e8dac717eaf4527eacdc7848e27e794dee8dcf9d3696c98bc14d766be75789b28ce480f5aace1f6947a0b0b6f7e72f0334bbc82e7add076abf625ca24ef529910fa6fed6c031536bfe3155e23175c9308c961c71a9d01edc6215b096cd9e42e807df1f3e15b095e01ef5b3eb0aa6dfaf2fc02715097290185b406a2bcdbf25ca6b7965549ac40a209a653aaf32ab7a635887cbdce56259e6b7fc68a8d05703704533d5056abe7b20d4b31d7dfa9af055c9a933d12b3a091bd4a767556e297aebcb14094a4fd275b1349d97e109265b5fa7b9d2e38ed14c23c8ec71732937ee6dc062f6fa1c05b9416645776d82e046ab9120d7b3959fa31153f708cb5a2915bad1c86eb554ed706fa5d026eab26acbb1be71d64acc53c7370a83f66c5582e026ddcf5fa4340b1a80fbb2d390cceb72ec4b8278b05349b904209e20262ef6d51db5cde794fcf866b4363b824a79ef72040e1eb80f2ab2d18b81a45bee36dbf67f12946254670dd7df7f8febd004180ff74c64e9f318c70f840530dd08b67a7b3ac78e6258fa254458d902c43a15c2eb39150c9ff563d24327ea30234b464d3f4ac394f1b4347fbda12099e147b0f4609993ad0328c64779edfc0b5bc3c3c52865aa16072817bdf7a9cfc075d64fed37e0aa485768e4ed94bcbcf415388589f87911445a31d77f8a1f3c9a60f849c3273c223dc39c56c1f34ca88bf9ac220c981ef0dc2a22ee8460a43b395358fb6fa6e345107c5fc7366091276a854c4f7512ac35f125622d5fea7398693ebb09c3ce638990f0b1ac96777ee09fd10a6390d94aca8f4719da76d124523caae35172d59355de159a5e10fedbe35130cff2c93a588b450e7e60d699b5ff29959f25a89f9af94a051084ac55c64e1a8ac36496af2c672a52f0220cde9be568d32d4a478ac1aeb01b88e5f8a8d63f93ab962faf508916fe2da99dc48af5822638101b990cb6ddc7903c7f4094618bb0190e146d356757ae4394ed4383b52a87bf908f37744b578b874482fe774214dd59dcdb5aac9609b4e93f5d913546a64f88fe082878cefa48ba21e62c0dcd04d19b09b0460f66deac40b5d8192ad95fef86d26f999cc7ca45952dd6a2056d3ab3af25a1977dd9738effda6c35711ab9ccb023b19168642d8db059d6dbfe0cf6386c52b6bfa1f6d7bf3f62b0bad3e9de9337aa3e5970bad3aba906b91a8b13b85784586c33fa80789d4a5e040690d2ff36892986e99d80d33a4648e390cefb86fa26b245d027429c51841d559e13517003d00e0381367432d5235c2e20801a396ff2e875d1f88aae6ded4e01a885d9709132ed7798c2521b3a0f646a380eb39ff8bf8856197e93cf92790229ea47f8c13f5703ac912e62f34ec2c8d746e662a610cdda93d1cd8d61c9c3cc25e2a63435b6ed9cee66f3c65eea205420d672f2f9d8bd0b5f68ed54513a1736c25a0234e19c773d443ba1e85e4cb296964554f192ab810a18b2f5ce4aae752e9f5e6c09ca069657e7956d6ac1cb2015204458e666645a4e08cf4391c49e0944e327c5f7a74198ecef6f2b2ce0e6a376ab44a661c6492eba9dca64c9968f84e947be5e72d6317a4217e4cebd4ddd221de6a410e0384bd9a366ad4c290a9966904311c5786cf30cb7f1ccfc97dd08994496524655925c8633354c5d61ef9e9ee2b7f46d1ca7bab68c1b656ad898c24c805bb22bae06693ea9671791fa8b854d4ba6f16c6b316536bf6ffc8f778ff646ed440af194f647ea5f01fa2c156f1fa1358263c16e84d7dcd2d3a800905a3224009dd2bfc3f14f0540cd407bdf3b3b28514092408b14434406e39ffa2696bad8636c2fba48682b85c1e41b90e19389caf67bcbd4e571ae4001bd20c2e3c1eb443f22dd25fd427ad6d61a5b9ba3b29c178dd3af96d39a8aafa4b5a5cb498aa606af6d5f7421ca763a654023f0d93c827a839e8e321fb23b1831179af55696e55f6b31457b2c67870d92753de59c69120fbe9edb4d3b6f3e1ad5986db85c3500c55e20d923bb6480f86831d8da488fffabbe197ec744d268ce7098c6ab7e53df3f7ed315be28d97e63c7cce89751d38ea03d04e6da030bb130bbfc5a90abbb43bdaf6cd1c9d614f8c70440269f30b360912ff01334a4d09418e0fedd00c6e69db4d891d3396b4d5a1f3dee3e56edaf9e125966e45aa9aaddecb20bca7e58f1543795b2c4b46320acb1754e4b64d21762f7fb9fabf04c359f7633516616b645513fe39a2f2173ce57a00c886a00cbbdf8477dda1b5059e87932be7b2b5346d296b56e8d92796cd275b5d47e25efe4fff201bd8d9aedfab8b9724f52f5ea21a011c84abacac8dde20eda8442fa6bf21e4b6d73d62f6767adef618a61e310b05ce74262e19aac722d218c074441287e1aa53f296e6c41f8e5ec7eabb5f4b7b7b5e7dffc59579aa7c1e0a55576167dab1194abf83337c420953ce6c9fb7e288665608aacbc19dc3e3ae47877087e04d1fb8056fc3687a5f7fda044a04474402a9ca0f976f568f9c5ce80813b9706c9e5a259bcde6340b24d542af9b11a05b24481ef3ab09bb264390963a99b05669b6c678c06f81b5f89c54fdd25613e9a3ab20ccc4d077a25cacea3ce4fc2c4f201cacfac0ac477c87b66ce3624b924b78d16e1cfec9a6d7f4bc6377b797fe64e8bd5a75216a25faec376c48de7e6f8c3844fad0c3d7070029a6acd890671dd7104a1420bddebc6a87c1f21d27a796f3e5f9424fc60a5d311dfa927b66c9a5ec73ba5a0b0994141953e910857ebe08d4cd3b4283d1658837f537d2cf951bec327685deb34290b8c4debc00b7ee92b240786a0c27df421b21250f4f8b7b2e56df475d11561f6e648f2274b352e4be17cfbbe7705feb2ec6db184e35228cc50afdf9508ff4033fa4049ef80de717d9713a2d89874a1dc56c20430223f0419b95fa71d936e26a299f4c3ce3deccd7353f47568b334772e25aa8d453c1675419b9dfe81feb3e1b8d6a81eaa134cdac523dcf8462a067954ea1e6d53bccd78bc5faae51d8c9c8710f830c031fcba0098602a3b8af2f2c917e496ea2579cf4ac98ff6df8d4155d453872a0f26082e25ad76065c29d6f1715829ec0b93403ce0296aeb1b816adbd6aa9c39bec2c3ee9c5251bf6625f6fb82c82d774f9ddc189dd86f744e9c6c9af905723c7b5081b0140b67da3c505d54ea512e02a734782fc333810cff16d037214eb64e99dc4966025b44efd2f28b43f48a412403f79309a37397b62dd7bea2f6c8da13c6625dcfa08fccbddbe6a16a2717de0f9fd3ad20692f97074557bd74ab677c042277faf63d203e6b4ed84931d2562216cd6db09c2af57c4a622a93acdd7f3952a5c9a20820c679cd8dd2f7b686d1dd99c795eede5c36e92397ab8fb4eeb474ced9faa06d6322b4e4b921b211cc174d065e8a17a3d9648da6b95c5feb48ef08af73a12ef59e63c60a24a6beb46af643b93bd098e82b3119a164a7439f25367bddaff274fe360e1bf24da549fa43c05e70613256285433d79c9dba2f222872cfca43a4cd59be2aa6540e442dca4da215b19573f9380d0e4322c5d5e93cbf27283c52f6fb52e800a9f2ce3e8fc2b641e41aaedf4868c9cf50f9c414823b24eb8e58ea27eb9584ca83f32522186629912051e505fd47836d0bf76862775e53a2e912cd54ef4a2ca7c5773475a4b09a34466c572e6a8200774cb8c2014877c160237c5e652205ffb2e897c60b47b3327695c9fe471e9790ca86c7b1233904cb2d19fead84d24b503ec69facaf2af6ea8aaac9652d34d76f7cc802a2f7d7d54cf6586ccc8cfef01960fcaa44b59acf6c24ecd9ef56e7fc0b868c5a198dfd03fff9b6bb98ea559b2e603629d5368d9c48ad4ace242fabc7e8da3358bad9d7a591020fccbf25df1b1cb7135f99421c0e4a373a1b3a25f24f4ec4a9637e79f10dc9f308dafa7e5ae59c0231dc9950c5d04ac6ce73e63b26985df68eb5b632db3d570d5ab85f8766356138893e868c0691bb062ae02e866ae38b82190508a5ae31d4efee3a06cec24b569ae128daf02647da90cad2bd84352b4b4f747c83ccd5c64df5c309f6993a789e2ea8f74852f79b76468022449d358618587675fef5b0ca9e3cca6919cabbba8c076efeabd8e16ccb5e107f4d715db69012ae07c2ac243815f7efc2fc528d3b93e4c826b729156ea41b5ff4c2006a2ac7a40490ab5dc3a47320352f4ec7cd680200b82667aee41109975031d5a18ea7bc3b52d3b0a31bd7d190659d140bbaa38b52721514067377fb9e2a7c22c277a5e5d0d40067bc75eea95155db46edfbd5279a1510ecdc962be440c9e761b796ab2848cd5f865ada69224742a8135f8bbab3ef93f6e2e6b4b1d118afee6c8e47b40e5815f1979201f5d8a180515d0952f395f4bd830de8da03a32c176e7631ec38a724ae5842dfe00664724903f9be7ea2da1dc5132d52ccd135f25a4994b0ce01012274428a366fbfe22557ef84492687ec41802e1c4371070f416bef28f8b005312fe45defdde8756fe23ad93938c2b22a0d208ad08d4488f41358693d24492275029edf8a0ad0e2049274fa1f961a166c20789c1213ac71f7b800766d2afc5a376d6d759c61f366169da459514242c588d93a2b49de4c01427b070d3280153604596f4affcf4e5676becd48145cd745d53e4d4302d6eac0fb2d75f7f2bb5bdd4f35956f75cad5483868d8b6a557bb6a366aae1cb5a2e3c46779ac4007e16e0ba36052192d54978053e206b473541573bc8c60b4e807fe31437b658e22cd74b4d8906eb662fb6a709abbf190575c0ebc13d2f23523043cf7086ee53dbf05142f245c4c0339ab23d9c4f80e617b8d05c96f2be60a87b6ad6e3d44339c5ff231471d80b073aae8ce46d89eb78059d10139491d8844976c1ca4ab8b65ba54486768472c1a1909e5864a28e789ab327701acce78e694a8eb5950c94b4adc9955f3d4cef3497babfed1b121f551b35e4022aa0efb159feb3d66b4f264b9e170557b3f7fd9c604886d87aa3082aed59fd8a9bdeb4545c7c0e04e6f03dc68e0193d7f4afe7d7e5924600c5443d60449bd9864a2d8f55c57c22e2a310e69a83b7e0148c7f8d0c75036f0d0cbae04b8def22a3297f24f79c8a951a34fff874f3f95b7abb5d2378718ff777665e61ec27047733fb6c80ea91efde154f08a5ca0ce109d7772a943b5bb4b293277560ee6f460b75fa5b8e5a5fb682000bc377a816c42552f82aee2625c5d9d53c316b1a807b007f03b6ce961e859f4090a38d7cc54c3185e64fa2a6d5a33259dacfd50f1289a31174dc26f3299101988787dc7ff5b292d8435c79fb7205829fe04f40dc3e1a9f80745248e9bd4d7ec567510c465148a0af251f54d16b7259539ee6052c21b5ab56fe9708e301a6e6bda090cfc7c29e41adb309f6695def527ad64efaab29d47396bf98e039ef1cff2708ed25127945ac0dd62cd14c9341ef2620a4ac84c8e1130f92eebc7634f80026b32b13e918c44a4beae8adf7e9b0572ca53c6bac9ca13d03e48557fd9d412748a6c833cde25c81e0d4f5ee075f57cdaf5f3685f4ed8f530326e3658f484eee2d19863e49d77c692c80702ccfc98c196f039ff0412cff38ba0ac95b26d1c29e6a2296e1fef68b2f6f60deb8d1bf2a9ef5c1a86712995855c2d39db333ff2ad8853394b7a675d3ad784400f01278554d6a5f792759f214cd383216fbb0b12f6f0113524d96951350eeb9aeb18e507dc5a04f5372fe7eb157f22fb9f0b38fd332c2661faee29b8f7bf154b930ffcbdd4b25289d618e24f4f1340147bf87b6c42f81cb9db6c8c69ae3587cdb39cbc49afc52ed00fe8ac6a41cd831163c8181ae7c96978e47cf41e8cf0b682b9ea6ab1847152f4504c2de20efb55276b3b934aae6e104dbc1257d0452c36b1fdebaed76370b39af58a61372de2ed82b4b3f9592ab2d10e9105e9452ebd105288b085368283a071d000956cb88ee7489eba5b591b0d737a5e014576c9e051d6ab992d5e58e61d12216f46231823302a32b4f7a379f5feba9043d6b2954c68b753322847dc4d06ff6deadab296a2bf879196c2f7a6f55e1f03028c29367451bea35374f5f5c2661d016aa3666b47e45354da7e1612d2aec76b27f3a632f05cc3fec7a058bb02fd4f42a02c2c1811cd2060b65fd32838ef9df33fadb055039ea7d366d77f729bc1f3270c0fe9a59707a7d85104298b62b2c98417264e00386d7ba415798db2a9a54ae9d08f4ac3041d64a7b0a86bed543c456f80e604f835767f86bfccbc660031a773eb2a424ae81665fd48615524acc6607ab6734fc6d17818ae0697e59ae5dfea1ab0a4b3b18dfddbeae271fb13f821549f688e1b0950236788cd286870640722130cb5c0b1087fe21cb18a1bed9919f6f06c73fccdd7ced4bb03434efe9ae92a6a7c1fd4f76e2e908396cbef61d733493fd833e63d2bb9fdd65be470c17fdc9b93bc16c9007718a8f0c2da873bf81886a07763d7c521c3f9e9ca737c040632491a4ed5173480dcb74040f3874d39bb3ad08b403a08b1af3a3d3b1b88995c2bbedeabb12b817a2550b932c95331ea41d8a2c009b15d708675a9b5f378f52971faae89693d0ff62155904e8ad3eac19b5b659ac2a2c07d5ab16b9e7a4780ccbda331c38e0b5889316ebcb4408f0d03eeb85e8913dc30c28f72775e6bc4b9cefbf10b05232985be277fb82c70f880339ff12c8925279e778e8ba0b880b9e56d5508c9ea37197558748e56d2ae4daf7e1c5cba67506235882c717eb462aa8a6834cbdbd79953a2e6408254feffc05a7cc8fe5f2086d0465354974574e5d9bb99590c70c9f9ba5da9361d5a82d7504cea6247dca94ef77740b77612f39d2012968e8f37bd39ca3cf8d928b56862398eb8c8bd1a8be300dbf00b62c4f9c62143983bb978edf0ea5a8163419bdcb6509a15aec97c0d0a8977b1543cba141e95c9a06505bc4b700a88370fb31bf8efecb7313f29d5a587d8d8d740775057fe435da213fb1d23635a2953712342605415a5966806a8196f56cc17782ed1ea5bf7060e7393c46bb94fc8a4122d3613e462697e0116381fc5fcb806c2f26826c3d90744910b81a6f142edaae9b50c34e2f9b2c4c9d94d362459584f1d50e8796af6185aa81be3f13bdebed621c50e4d8570b54d0a59c416d83bc180197b0a05859e3dd4055e8aa6fdc311226a4ed58eae8e6805fbc3eda49511de148ce3789867b353b652a451ef298346dd8ea9eac7e72d3a741730620a9e21c39965689763033c2713a61c0b071f223c7d9f9960328291742a0b39358016b75b3b7f597f6dbfa297be674ad4eca391586a982804df08e825bb39d957e148815ec1299fb46a67f5c88e0e8fb5bfd745c83a3e6adca92c3efec0f4cb9dad1d0e9205917fb8d7f7d51dc8d32019c916dbeff9688f8370de58fc9148b3de990aab28ce8dc1f9fb4a68200a2dd393f3fb4d676b2451ae192ce2c14af738ea4fa570049678d2975b4111c8857589519ba387bc33264979db924b9b21696ec1527c982fe6c038f8f141941d4d9407557bd30979d3a58f0c6adc97897bbeebff9eb609257ea8727a0f59f666b0181ed09c91a3f9ce4bcc39fe66d91361a050fabd2399ae1baa1d55cd8ad744e1620441761adfc0b7ec871338330903bf5e0aadbfbd5c0e0a7e0831c21091dd68952fcac8904ae35c375aa650977f846a338e0a2974baad96b65497547840a0973a3fa0a288013f04d0bf4d98fcc676d8dcfb952f2fa8e05c986bb94b46060af41bf667c2dfd4e841884b251c0221c93cd4b1c0060ce9140e69265fd721d723571098c71ae9e053bdf51b03cbb76afffdaa4755d6565cf1547075e6a0c4d15ddc17ad5295ff8790bef7f3439d13bf43f71556e408883684bae8c45edbef334bb18e6e927a74b6eb58a9eb92bd3fe3603d4a445db0412059792321e472be552ce0b0fbd999e470861a1e82bdb7cb259c25ed159652829c34317baa549f9d5a09044f1dd1c1961233eb808fe3b48f904e8a6694b242c30101b28cc9add3fbb1704b02ad421d6c4748ce49784cefb13f0b1ee22cd8ee59d1d4c3d43aaec0a8efa6a16b27b967ddbd62b54e45ab3e62296dd1a871244bc49cdff695e0140833154f15d70748dfe4950bff5072593a413c8494aca30ab4123dc7a5746bfe8683e5ab0ebc876befaa4512e53d88260aa9d46fe624c4ebc211d98b1b00f52d949a4e46708f4477f923c15209d120ffc963b0814974a1eec2fc2a927f3f50fd90424bbd284e5d1c8e7e125baae62413c04c95c9070747c3d1ed002a46ebfd214923661c01066078e7bf582a5e39320cdc27b0dcc5a9db3b5113756183edd3fa05099b62be53eadb2286cdda281f9186b33103e2eb73d6166fa1678f012466b60315c1429f101100ea6754989ead9523f7b797fd3d27c4c3a9f844ca76df2e67bab5109bb5c884906c0587f25679960794016be3b82ad71d01d62d1d7b0f87b76db34200478659ade42df1a7ca9a1841598acf42b858802b4ad3c55de9bc658f7511a0f061ca37c1138ce8190b1e0c3a900881d4e839bdedfb19dade6c23b754ed7087ec7ed5c292b6e8482d3c569fe6ad4d46a13b42acf5fa3f88fee2b58e871b4e63a44e461ab4553173947ed07e17d65233f9e5d3180c49ddf2c0d343270ec36df64cb304f3db200587621331f7c392fc3a36cb6ffbd00cfc9888ec7663acebdfd9266b8ebffe33de91cace7eacb26552166af98f7622b69143c0724ed6d7eae0c09631368f768982c5d4a78c55510b701c2150e46e781b6520ccd833ee9525fb163544b422e7e71bffaa6ed2289e7b439adca698ba57ff259aa8ac8d56efd721534ca9934627349877f08f9002131f1dbd1ad54839a5f62326f65dd71003b5b75ffe30789198ebb4b3fb8085e80149eec4d1d3bebc573af7d50634f6e1b750135f7aac01502ad8ac57f7bfe271ad693aeec7df4273b197d0721da3dacaa9a2def9b94ef0b333cc2c1b172c8d69d8e2c2465cefb1e4d759b9509267d34c2779250660ce61701ccaf16082687b5493276284f8752900b00e0ba2a872b690604947936d0beb44cd773552805fee37c5dd7febddb6a93c73c9b50279293b8028bfc4fb0b5909b188c7736d3620ee6d7b22319971274dcdacd012b87c0898151e6f781396f3f503fd009279000f2424e067bb64bf42df25b4b8a6c97b811b6ef2d28dcd3aebf0b3d5381af612e6309a42f8b0049bcfd51f71bbb01a1f0f2530184c0a23051f828ca4c0ee71baa35012bfed6712436097a280437b2df34308967bb1b443818716e7ac72c8b25980567d6b5f07e2ae0a260b1b77d81ffcc4dc07671bf00f3230e76c6f93bd46c1ff962242a6c70a6676f653fc40b1c8f412a1b17d478c46baa61f6161786bed8d886a8906c88116a2c7731c29419af8340944132f89146cea853f025398d418a2ebea1d34df69cbdede35831bc927b86e1aa6bd73e369c672557412711591f54397baa4ee8dad07731a88f445c207013589d882ab3eec68ae33774262296ad47541e3425fc3da54d51c9b80e64c6d637ad284e8cf249221151ae4f4580feb778fff052906c30d584612df565f2cf6e142eb5b0c476f84dc49dc81591414ee9b09fd7e7691b272ad35a211e27657b9e3d7eb03e266d8b2c2133796e342291510ba05fddf61a0bea0109a118a82c992b0fbe992354e4677b83f1c7e9f80b479e44b59dd02e0d5fd623ba2d7772ca5d891e05c9ce765d6a91992e23e81ea2bf13e5e31ad07eb7362851230fd1c54230584a4976d922929f57fd36c86b5fd492c2da685626eabfe1b56cd179966a05ca47a55d873b3fb757319055e165457221cd6c670159e4abe09417f23bd1044c662234c05b50d762f34d1c8b89d28b43ea48afd5af75199e3140d89a4149665037dbc165591dd3cf54570358395cbae52bde2653141f0fd5adc7f6c0bc1b5d3ee8b489f680bd29e4e2ada3940336cb54adc7c8da0daefa34a9c0810a98ac92a3802262fd172a969bd3484b543c5dedffad926a36c5d648c38559ea00a5aaca788f96f3012b788b39bda2259e01b331dcc77b2a9756566fd38a334e45d36f97ad6490876ce65b6bdb3b2253a689353cfee2ff7ed2d120c20dfeb1b23f26233c5cfec1d621bf9a12f4a4e51b411d124f434a9dc3904bb2b06e7c43c878c8984b0d9dfceb986f65b147d0c4eb2b2fcc16f141dfa4b7fe31afc0d2fc5c4e9b2743f696d9412277f459fcb7d8d74142d2ba7e4537780d68211fb19bd4fdf6eae087efc9564701ede774a692edc7f66b4aaa9ee87c21847be203ecbd1dff6a53742d2358a046f22ba2bbfd4db8d068f8529c4319347260a513a6353bebb50902d37b44e7f3e7dff1d42acfdb5019b4bf49af8477e9b8c2a41f9ee547933dc7d8eecc0437cb3bc66d81d9281e8b317ed0d955a68e261e64533cff2c5838fec997f5e66bb1e0157a91b03592a0c7163cddd44dcbb9eb1bb26b242417eebe3d7f3c550d23ed5d2da8d7b2486357514f95d0e84daf7f60f11becbe54b5d91d66fbcb91a14ed2aa9907d17a9b2876f21fb6bece212ac13e6dc226cd56ec795a93bc039bcb588a82d94dd25246e4ffb3bd992ef64b6014bf5294bfbd391a491856ed96055546e0ba556b4370048292ece0bb37075033655e250a5c83b98e353fdc4e864236b7ff93a91a99d7e2da4e06be928bda52349ecbaaf0857937c4174678cd0605fac90e1684fe78439503c9181ee64dcce724835902c8d76daa16a4f7f95032b3c37dab9fc0c972493622465b63594a3a06533b0745f560ae7adb98e47a6ad51d4ba5fdc37a9f440377d968e29c35a5a9eb7227e9d757fa7ef1d08915dc8135846e91f60f2e7e071872beb394f9f14f6b7494253d04d143a2674ca063b0420f98fb2bce81a2ee867e4af166a9b00ae2fddf084ff8329c4e495788b5a39858de8c227df3ddbe0771937bb14ad92832c95021104d4008523c50fa076f3e36b35dfd807584af1c9c481281fad8884a9e0262c2d6e5c4c3d6441955985ec13501e82a99efa54f39497c3671c2d4209305d707b3210353011e54300af287b42b821cc5e2a11767c4072a65750620311e1c78168402a9c0adffce4bb29e54f5070ce2ee6c06e7a61aeaf775f1f115fde5945f60ffa2434d636223598cea8e56056488f80211e45b41ae7ef02ee568cde8d1dc67ea45811b6b9b9e8a5814f2e29d18dd68f085d4373b95974f94a4502262735e8eade29f38fa70d470f4c67ad68264546c22923ba273c1eaf3c6cdea7e6acdee4d7fd438654c78c2fd271d4f35b6254ac8ba53e7ddacc4a2ebf1c7e7fe67367d71da32f90383fc1565c549338d7d4b4d81542bdf6366040689d23264698d7d627e152bd8fdd1b244a0583ed332809a68aba070b866c101ee6587e4e887941118e64481899dbdcd64462332be15c411d288576f779026d5759e5f492483a59c9b6167a050023c0ee948dc9380ae37bc76306761cba419ac4b00b9872bbb1293e14b202dce712c6ffa302ee0cccad55093a6785c347a65319034537e58cb507464f7455f0b3bf56d133211bbc770f37d7772f6c4ed5015520225195ef3359f695db79ca0455f10acd990400275e9c008003e7461c2e12c90e8a4d2dae7db833bf0344520df3ac6c17c09c60119460e96acaa12767b83d41e658ebbcec4243f849bcc18495224cb930d99b6d77d0a41a6bcbef38eed882054944ff8fa7661368c48525165ba9b4ceaf4e34ea112ecafce14e9c36c704e73d656d1968583f3d45918f784667487f369829dcdb95478ed0df3e8101148945744065a3e351fac63617630de0bfc288b9e31f78a9941fbc9438f8ea36fd05e59ef52db82fce47fe3b61d02e5f43842276ddc9be1fc5f7c0c8421d4ce466d240517d3dc762a345cca4ef89439e5925855da877c74756babafdb4967bc27d283818baed48c9a9c1ea369a11e787a3c39bf3b1dfc56b80ec35d07574b26528b29a221b092ef0bf4b3e016835300839ce8f480b94152eb438326a4d925e07db5518d7a9908c3b0e92e6242565ac7e9d41a6ae594a1eae276358ee5f10bc6b60485f4404c83485bcab512578e07aea9252a7dada5495ebd4c01dc303534e9b8d6406d90782b435246dd78951d509421caf695830f09e840e2a58748b867ea3e056481a331804dd39c81f924139e5577c7d5a2682489e9fd22ee74b97647c374d11526f3611090b705f2b1bbe7e5c2b368ab03dbdbc90d9c4604c4a9476b81290d6950803d0e9ca7080c3b6ac80ba9abe2183d7f85be36db7dd13175a3172c7b0e427e4979c62d2ee304f88fc9d6567d27b8a549c8fb1050dc0e5ee4291fc54c36502cfea435c0397b4b5fd4d1c0ac4771a4b68e732410a95c29a5639c470006ce34496b15be5c225ce2c5c08e27e0d91ed04b4ca9d8e7c3e37b7bd9c0ff18c0c4cd911668dee8572ff90c45c5bf1c7a843c416fc8584a69c42b4738579a539414e291d46e7c50d75f7df903f9890d6ca90608222ea40273ddaa038534b5f39a1cd2bb0cdf5ee10ab64d5e0da77b201c48a0166d03fea98538677d7716a0b406eee0dc86b7113457b6c22ea6932f28f6daac82c42180b7e6061fb6d0f33156f06ddeb4d1685ae529347d540b1c041be9ad557712c0d21e4fb999660bc23b9db3ba52acf95eec86fa7c7e134633840cfc2171a5b95135b0e216f575ff3bb0775a98ed8146589e679c7d7359f0885a5a8b79be9181f941b483dd2063c7fa9810501ca69658e39329241db0e4ce7c5fb560bdcfeadc3ce8b428f2a4283c872e2308ae42752fdfefcde7ab4cb57ff4d67fba4e2309c374c31b3fbcaf2215f45f4f4f4ce4298cbcd25690fb76e1c2c1975ee8ae11161d957403aea34b3b395c35d0d502fa7469c315cd4037c6477121a5e971b7437d70a0e079a433101d8a433fcac36c5de2251372b7143d874c30dbbd1d62715c9baa0e520c7e7a53216997847213d9a1ffbdbba057e6eb3ce8f06f5a1470938c1e3f006135ec392b5da1fddf09829711319f3da3127d48f0031027f90c0da3a7736ac82749f0fc4ef44d5e18abccc8f12bdb41ed50e95110312883745ff0e8ca63918817ffe9ecf78bb9fdd46b835280374843dca38adfec70f36c6de98d2cdb565fe888e89317cb347cf039e7ec27bb3c50a9461df776da4f6c3ec98144e9114a698e70eb4704408af22d6d0fbad098b32033d62d7dc8562851ab78b57b117aa6ec44a4704768f366e04e9cc9d8f3c86202231bd071a62e81fda607913188be1c939504a7006eff985889e7bc0a8c2fd7fb8cd30d4f6ef42b111ff52c66ee3b2c66bc5443c99cd5c7d1b4202f550398169bd7ff7319d4e7c0aba8674a3062d2cef75615a7482b570aee47bebf2978ede909ef81175d24985c060c55cc91d2a8c7b534ba94616c32f42c94eb09db76045b510716d00db40b499b63f3ce2e7469bd19c483aa5762b8f6212ef6da5266e9fa718d3af37c64d4a011a0553b9ea0c3c7949a78c1a2374af20b904fe534796040dd0ca9dfe947b448024601e64c46384cf842ec6b8f96544a8f4fea9967c1abc4b30fd2e5b2796f3a995e76bfad4e01ccd791a69a1ec01449083971cd1ce471b9e3041566f929abcdeaadda37fb7050d1df482111b6b153c30b56b2613f87d15a5546fb84b624ef36d55004fbc4f58f16e3fb56f9b96114fcd6bdd52bab811992722c34feb14d54be8b9965279e6b28e7d4df19caf414aaf306ac278c1bec3d8aa86c1f945833e63e12ab47a6abcc835aa4560c4d222fab52ee2e705b33b0e2390e7c46235bd737439cbb1ec3f20dcf7e1330b430310016179c8da300a9c6b3b434d54195d50e11295603b4201153f9b944e79833001c579c3f26eb3878486b00bbbae2bd5db88bb4a856f789aec38d69c84750b60c5a0f18df728526aba385e954299efd944aec18a53e2f901660d03b5d99b2d894f9159738c33e951d240588feaa0c0d919bed603a9df0050da6b06d5a693fffa5ab3f6cf1ec8de429aea08f737105827d72ac8acf1d91862d01b35d835acbdd6a1f312a1fe132e8b73e8c4ee71596a356c566ad174afec25442812638c62681cf813f0128cfb8ee37506308477096e988830a916cacbdd7d934f76fa60191083873d75df78a9c81c588be3a059ec38df9218bc2485c2e3d8f6ba260ea8ddef1e83b61b45b7a3a592d58c8155002e1ff7902fc72309b9890a2cb34496f2d30967b638613eaacecaaa63ba517897096142fe00fa26e6498b8d25cbda33a728a8e94e14197639018b45166a979bafb45a0c7515408715bdd3b49d120841ae4849608b69efa476a60338de5d425fc7fb7dafb0351fff2fe67e033c00f1d94eb1a43040150a9048622c66d02d210b927d6d3e4fb47b5143ff17ff9919d7f6e103378b51cf83cee4d10ed271960af22bf2275bad57ac5384a83d04cf285d9255b7d10af96c2f8a3d1d5932f0d22fa38e55ed3d52e6652da9fa1d5bab8cf33d691c4cdf419e0dffe57a213967b083fe74c1517c9ea08cabae25ce3537f81083a161e950dd66a359fe67147db52cbbc81e7d68015d4b5550b8e97684021c3e92927ee8965b31fd2dd2224e1d4b9e6ff053d0eb993f19b514ab488becbaa4bb09d1752164ae8912fa195fd51367c92357dd05ef9574b6a8b27d212cf1730bc244266fa5f0ae72236817bf6669467b8771e0d5c4c4ca224353623441541c45d63cecc1fd696b0d1644bd68c3d7deefb64246785c79c820b9e57de9d7a0d532d8864d4de5b90210fede84e36e2e651c3ca41e740a067f663cde03ed76a90253d6bdcef663610b2713f11e9b320e927bf3a489e92780f4e748865ec506c14f9bb82a3a00bd755b55a9e6691a85e4923af4ffffb7815f61da22ba0891e0b1fb7459db518cb6bdc745e38a91b7b4a029cca8801d80854e78475f30b0946d2db509e1507e0045209309a6302e48f9a958bbe315f9232d5b38539d0cc8ce7a47f8dcab5d439567fb1b3a17aaa9538a4084f6a9ccb7ed7c3c4b6d3488e4b912e607f4e04a6b245d5a53f6a7041959328b689bfc4f4f8db671eacea61a93879f8fff284a42ea45dbbec8a2cc72440f6248a809bb51dfd67e2e65153b25b5d47b85f74258b4d294e1127436e80d1ba8d2dd9b7f4d701eb698331ba709eb39e8dfb1ff320e7adbf8aa2cdabce66fdc9e75fdc0e430e984e6b7643a7591f86689bd881c2e825e713af648bc1a54e1794c5871353d2a3dd29d4aab72690887266558922aa35c64461bbd8e8d2857b2fdb0c983452c46e015046ee742f0fc8bc50f24ca9ea62fd553a9bd5f738b612a199df5686b0b94cde1bf5153e98ba8de3405abfa3062554020721d3422a1557d9684cacb0ef0e8824a0b0efc9977fe3df04ca32d4eff07cf896481963c990dcc751149f1903347d0d3b07b3b2a3563de8d80a8402b63078b8ee67f935c8e0257f3fb1e18d305cd458b0fe5ce0123dcbcf919dc775c63351f7c274731ad77d88ccec889ca1aa4293e419e6a2c6b7790352d2bc7f768e558b0331759bf537a3d3dc4f4a33ce5fc7c84830a23a6bd9154b72939fccab038f8ea2ae2eac51cdea7528c405157f7d4d1c7974eab1ffe2ce8f465d6614192c86bbf26beaca5113268a35c14ebc4d595bf2c9440a79cbdd15a9956fae816322a4ec96792084ca0c5b743d54baee417cc4b3dc451c069cbc6214c434c287947852bda93b77ce84193dd682b7e5e28e89a93b8fa3eaa5da10334337ca2a13f99b877a86e3a38f38fb3e24a353377966d3d7c719ab2a163b2db8fb995dbe489f29bf8cf3bcdec9905257fb4d3dc47f9f7e58db755a93d0df9d82b242062f06838eb2c09e46aa592ae89d962ffe70c1d1e8da6ff8d8e0bf8c3f396439c122d0bbe8973836430f5b594984118df51e584e6e885e3c46e6800ba57b893c87007c7cdcec982cc85151ebc3a571ee6a7487078b33df9734e632067d9af79d6f5e73bbb7855080479e9f081722c5c3eb304bd605f0460fdc929d0cbfe9cd1d403d388125b428d1faa8284b1f714f714fdc715d8b9f12e2829714fd335b3261786327f7228615c30ff994ad3a9c0aa3505a462898f8d59560a2568aab459d9b739628af46714548548b15e55ede39b0689c3898468b36f1a250690c2aee67c510785d279da792dcf116eb544b8be3f08397a0614727ddcdc35ee1f8298922bffaf0bc03bf3b8c67f60a0101526c2ce6d821779ec30dded4fb62148ced12705eba6b699084f04833c2c666b84e257f52bc1cfb6b7326544a7102ad7f105109a28aabb44849be9cad239877e010a04fa6042b71103a91f0a83507c75bb9d35ae83d61f59ed2d5ebce5d348493e0a0096019fc9155bd02a3c74e3259c1a658aa0cebaa68db4e0bf6b6b216b257e3d54291665edc2187ee110da9cd357d0ee6d21e473ac529753734c046b850b7bbbf383ac8a88dd931d7d49d4711592f5e7aaa54153bfd405c19d1e716ee1179e3bb151d81ecb3f78c6d01c74f5002e0bdaefd32254c13dfe62371ca21aa24181d23011cccbbb99b368666e6c7a96fb707bd883aa055480f90e9ce31e44dec698913053af8521b2bb04beb2dba0d8e5ca62741b3cf4f7a11b1feafcf61feab558f29ca3d9d3c2f6bc9b613b4d17d2fa329660771491a60fc68107ebaab12d0e8c10cb023b73042a89a50cdcf3951b9be97e190ce79699d3af824c46c7b782c74b7a9d9ef418061990069583af6c39e5cb6c3cac7f22ab9f6390a2238e502de2d88b997efc05f717f5bf51fdd4168ccafb5bd4fb5285b6c265510e0d4a9141d6f65fefb0b5f36fce8cb2bd7292d0c29d238741def786ef5a3458fcd5d0de67e74c6182c12a0900500c751ccb3c55f4ed0421b9b0e9f1ce73e41437888a0f2cdc56970b38c6ce88d155523f9957b38f5fd5edb03be2f5a007ec2d44c9529b2774999fc6e88959d1322fbfb8afc1ec2ceba07e7d038384a483c096679c910bdcd0bdaecde61cfa3ee0f49bde6657e6151b95b58fb5afb12c7498dbf91b4f21814549080b484e5d1a4d27281ed26272946372cf4f4f66895cd7aef3fc29b52b76b14f2d021dff9595107c14d301ed68083fd44e9190eee26f0ff0c081df0ba6b97d3dc0bdc6784a5dd5b7d1fc23eb3aea8c086cae8c2d84cb82b5bb1117c8fe3fd968f950bc8b202ce8ecbd3d900c58b98019da4cff69b60121368522af5f861c8c87d4f5ae1bf44b625f2de6c3d7ba3cb34bad467cdd58bb91cb6a22d3d89f8e9c066da50d4c07e3518b8219e8017a4a90150375570bc50e18f7baf99fb26cf66f3bc1df2d29e612dd42866de413389cbea938c012b939971f5124f0bfa38beedbe51d0ce5512c145e98274fb61b279a364cc87e7967a7efc013ac13410f738293c3b3cf9179cc401634204a952b38e20d0ca6a5e189f3b2c4e4badd76ca1f39246464a65e5b2d9e7e66d92726c1c4581db9a9e7610c37ef2f61abe269ad24abe82</script>
  <div class="hbe hbe-content">
    <div class="hbe hbe-input hbe-input-xray">
      <input class="hbe hbe-input-field hbe-input-field-xray" type="password" id="hbePass">
      <label class="hbe hbe-input-label hbe-input-label-xray" for="hbePass">
        <span class="hbe hbe-input-label-content hbe-input-label-content-xray">Hey, password is required here.</span>
      </label>
      <svg class="hbe hbe-graphic hbe-graphic-xray" width="300%" height="100%" viewBox="0 0 1200 60" preserveAspectRatio="none">
        <path d="M0,56.5c0,0,298.666,0,399.333,0C448.336,56.5,513.994,46,597,46c77.327,0,135,10.5,200.999,10.5c95.996,0,402.001,0,402.001,0"></path>
        <path d="M0,2.5c0,0,298.666,0,399.333,0C448.336,2.5,513.994,13,597,13c77.327,0,135-10.5,200.999-10.5c95.996,0,402.001,0,402.001,0"></path>
      </svg>
    </div>
  </div>
</div>
<script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>Apache</tag>
      </tags>
  </entry>
  <entry>
    <title>设计模式 - 七大软件设计原则</title>
    <url>/design-principle/</url>
    <content><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="Oh, these decrypted content cannot be verified, but you can still have a look.">
  <script id="hbeData" type="hbeData" data-hmacdigest="2469a3272bebae8655a7d05b406be1c43dd6f908e544a9bea1e409364180fd6c">91b4a72afde41933824d9b47e790ab2759c7fe391c65e762bc3007c35c45f1084db16bf98c5c85c104b79a5f2c9c800dc0c2e6e3cf1ad7c831761a8c33459218f7384535a719015572289c91e79602e331094b64eb94b528164b7952fc6f505dbf8063e27f32f6ab630fe6ceef9e29d13eeffca5b8a76a3135fec27cd49eab035e1957a62f995a9645231b3fc22a9109e812f849e00e25accc6b8a0e6081791fab25245d1a672f0d0437894c7fe03865d9f536a9357d9b630179029447522e9a6bd274eb3c90fd58ac809617a89eba0bd3e530c73245fdcfb4a1de6e8dd853951e8d0023a0ddadaba32deee6566ddbbf7c4c0849526bbffe9b56f3a7d293bbeb9aaeb9cdd9f246e022f668598475cf3f22348a0bea7d6e4039b4285edd95a25b8f16059b8ebcf78f1da57c4e59cd082a8ffe852b98fb723e6c4482b979c8dc565ce12399da858a9ab00f5679ee7b17b17ad2b5700bb80e38744dad13a1d2c3a640ba379f8906b9bbb3c850bddaea4725d3265a44e849e835db77dff5fd95180e4fef6a78772664a89c35882a958d49ceda435b3daba16ce6b9cd7e08a3e8256c5b7ce2472db3e641c2b71e673a24a1798f5d21d792467da600f998c540ff0c7a6604b9566f8a93535202ec057ecfc310777d712b3037b4179135be43a2726bfa68f8180660718a2065359b21045809b169a9a51fd552ea1eabb6d9b03d9b0031555e2b2c613d1a04bdd9d6cbd60eafb0bdb96f1bcf0698c97d9581dd007ec2dfc9819f64fd62e9b4d7ed6d39fe1166adbe8d371ca295351f9cacf9f7cb25dede900f52a72de04b1a8bc3ea12197c799905e85032260ce83466c908358f5129bf46d3f0568c5158ce78c80af6abe6f92e86505a75522df93d17ae5e3d90c7179e1a53d057e0b865ad7ce65f8646831c305eb922198b6f527ab79f73424c933784906e04bad61ed173b22e2ce7bc26c3d0b3b263b52096bb5fd9f3e4f0b0cda4b584ff366a80c78fb04c00d458e9b7f6a0c1a1416fab90135e1819a18d1688568f5da91677b9e3f8f54e06c6498c2f68f94fe7634e2ee4b7174b3c2c230dc195fb6ff91be9fab2fc8e06c178771b0dcde54d2215ea211ee0c7eba2475654fe312f42594463253948aa5f4c9f824fd14f1e79ad9531ef0753c38beb269d5c8db296ad3561529373acae644ee740f230dd55ed7d5b95ffcfc8c639c447e8aa0d92e25e5db14a6b2925a5dc3b745c21bf14017ba1d9763f7368ee9d4efe544f1b79fd325f1a4f6b64d0823e2d2492b344144295bf34d8874feeb3b08d5e817f4f1fbb968d2fe59852c09994546254ef518d7dd17ca31b5e9341bffea901952159e6aed99354115abf3f898a7a3cce4e0a9ab646a5aac83c5e5084d65b7e4161c5f80b0169db3106ebdf93dc8f2346939aaa17c7ebd967a0a8b67dc0b26d1cfbc50dde651c6ce45600989f3b34256345afbf6a95f28fd11db6c3746977e906f8a23fea07988c270bb6c887568a8eccd64c9b6b87a0d72b5d96756fb7f77b8edc00edd76b8e726b454c5a4386837057f7319cb2e4e7161246ab3db64b61f9109b0baf3f84fc5c997f5422155ea1e6aa74f9b88a54851e3f88fee042e38ef152a7c6ac5372c0d4a3bc7834a472015a195afdeb3a09c320138af126a8e9435d0b456fbf223a659b715c7279db213f82a63bf7dabac61b2f408a05cf1318ec5e0b84a2a5d852a32dcc8db83ddf76f8d6921d512f43a67501c9da76e88eba35f8f19c188d44f1af34309e339a7901c9d43a15abc7e8329f47a3a23cf71bd437f9539645979bd57898ecc41738a2d12134ed300e56243725916ed940a31c2ed0615ee70fc1d64c6d470d4d7e82d2d2f254979e82866e70f9f172cb1d469e512ad5079f23518dfca4bc13347b0a4afda42392ce3a8e51cd794e3591f80f34a8a9f817d0f8a44708ec58b7adfc4c674f1a9a82762b049c790a41610082a0fad8c3d57bca601268a8079a3cffc769f6e7b16932d16be96653b6ebf684267ff1e8b8c231f9cbb4035b5b29f0017df0359b7cc7e9629fc40215c4a1820f4bbbdc776397a45ed3a996c9a5a34aca31d23bd9118e7872323da36836089cdb8b8f5944170c5f9b1fd61d86dde5670a8d6eab1103acbe100067da74d135fcfde850e796f2f1aae39d7ad062d3311f79d1ff85568eb44a2cf9d1ebd7488c2e0fbcfb0cb30413e518554bed743f05477ec968b045255d206e872c584be15c87ed24e776f17f935b699ae952bc0734a743db04d6c42388e9b083cbfefc8f9b83d1f25af86cf59d821bd30b4175bd878a9f98f2aab0fe05ce0e9690fb1be6f274bba9f526f93e04b2d28cdde74b8a080a1e8d891aa7a292f202dff0bfd58e65df50553a7010c22d362f1188a36d6a04f9bc2306efbca5d0c58d2590a0a35fb19b59d8e0fbcd8a648448f16495a953f6fa780abd262476b2787e7410a41d708fe071e679a0b5cb51eb5bbad015986e02cf3f6a2a1a60036f4e30acd552943c16739c1d4815c3ebd3f376471f0affc7636ac201787e6fe6cf18823dae483381a92d3c1b98bc9d6c1c986dba48353b84529e511737fdfe2d8ec346480ee6e6357f3a5101d71e1ea5a36eb4f001a6b0b47182fdaf5999541ae7f2c475e913a4f43b0ba76aec33cf72a4240164d07dfad2a0f09063bfc3e40b4944820b83bc52f2c6e657abd7f592fe4afb9e667a9f89a6e95947f9e3139966e551505a5338c03b7f714676bc2eb65a5940b302841f0c92c25aac87eeb9c6831e0df62ba5ce6dca74ef8e574273a4820a1368534dedaec0e448d474cdd0e8bf1743ff6bc76a5d4335beacad2112853d2a5eea6695e4aa4964f767f97f0ad083f705a0d3cf26c0f0758472522d72c5b9d0f781a722e57bb63b2cdd9cd8042bd97af5d6feac6753c88cc55be7e6cf3489ed295ba72e09dd3f0a3be8c980dd12f55135af50a7f74ea9e55335718793b32d04c087ebe771c8a36c9e276da92e2821b09d7bcbb0a29f8a28b0ff22864cadead8d7430dc1bfb6f82ccac6f208cd2f55b94471f52f9f78c9378f523e66c768261430dc974ed77ef65365cb487d2ec9fb673d72dafeb29f47f1e9d34b1c5d9fa712996d4ded6f0811412df5657bf80e119ed4ae5fa3d55954668d7782413dcb445880d87aff06dd161920f312b3ee05aff679139f7adceb46a45447045efc42d31586cd6c9716cb535d63ee08be147bb07c066fd20ed67dfaa2896b8943df54ae6e246a15a121052164b6132376236a7b44b4db8fb2a291668b9196f69abbd67d985aced87498eeacd10fbc443f9d140076206d28178ad921f2aefeae02f6909f42816be06debf420a7d18a3ddd31904ddbe4c148f1bd08dd4e4611b7dae0031e982950343c078a54aeaa165ecfd1a89176d0c6bed32e83de528371dc7a7e6f9cc43dafc5083515dbbe45cd49af1b55ab688399deb73dbd62695009b1b00c699a3be60018c1ca36bf9b167f73f3751d0837ca1128c8f33e1ba313e15e609c79f679b6366f81646d253fceffade9bcf508550e2f62dfbef838514f60573ccc45e7e8d4811fd9c02ead011aa294758e24af865f991ae10bbb053c8dedb948c25831f17dfc1838c90375968533a1efddca7a9a2b080b2c67fc9da1c52cf414e7521584b7e0b3d55d3c527eb1666f4b575557575e7d64aa7eaf316d64532d0f2e4c1679e0a231f228224e675c37cb7746a096e08a134217955311653607636f937ed823c46c0d67c551be6e6d9be0b0b6be02947652bf19f1ba2efd68d170f33f1b92406b01895577548ae9053898172be59503d47eeaaa3e5198533eebe78370e1c03d4ac571ab5ff3325ed188952d837cb57955b795c9c707d9559416b37c11f6e69a2ecbda9843672ad3bf5625a54968012a036b7b4d0eb08e0386b0554f5ca5b2b76086afd8ddbad2e5883230bc1ed06607d9ffd464d14ae56c11ab5c8db4028163abc47e24e0501dce5759eda2d28e50bac1138c678ab58153555840626092811c2842eef7e3e2a53fa6ce231769f152a901627d672737b883848f90db132390897908f8f9e3e7b142cef360dc4d6ec47a9668827479d3ac365a8a9fa06ba24e06f4eacb37292f94fafa7650d5d92a4962f2b36bd062401ca1abac512fb01868fcfd545ad0536f277ed7d4f1617ec380fe2e765f26632c8d912e72330868e7aff67bda2c2aa0e458fccb29a09356ae898e1afb639253be499efc334ce74f5aa5d575795647c4b4822a99505d49608b7151cee8076c38062f82709fb9b9ec97002f8d0a77fed2ea9d26f97d75f632e0453e40efd53006b6de0423f8a2c86c419fae50c2730dc14b24293b08b9d8bc75ebd777561e1d0085857c1cc0c74b6c83e0bfb9f06a33c422c33a5d072b792e150db9c3d58eea0db80fcabc80180973191138e780e6195c8ccc741352fd76e680847ae1a624bda2e0d1f7b4cb7350cc92dcb9b774c6bc2c6819adf7487a4a5ec33090922ad0703c31ddc2f65bc2463ca80c9935a89b8303b1b93a43a5aa24e0095aaac7792a4d787fe867b615387d9f0e9574f5b0c399c11257aa65827696fde86be0b4ef60410fd784f729a8c44930abd7f0eb60d6358749a9464ab5cd01c54dbd7596fbeca60cc7069f06fcacbf5bada87f049726884b6d163bbaac44dec0de9ddcbe608e9e8a8b874154d749cf96420964eab3d00ab0961d6bb33df0fbba60451317cecead519783529aca125ab19bbe0c542488602e322bcc9c7bef9d9c4332fcd5eb412a4e45f06300540df64927fd58f3ad372d5f01bbe557032a4871c512b5320528f4565195d9f930abc6f124603ddfde95e6dbe618e02468163f3dcf4d3c4b55be246b88ecfce66484739ef1286a11ea5358db436bb774950dc1daa6ce953acec632aa6856e9aa90f29fb2b6a4298d7b90090d072d13540cdd459dd97400feddbd7ec85c81e790cd4cf22cdb12a277c010032d82611b31609bdfff193d8306fd1a1c9b022938bc58210cac8a315b8cb6c4d5b90387d96c79bd8893c40f08099903b7ed401efad84c9d4d425fbe1daa807d0ffc43a7dedd2621c6839e03d2df452f3dd8aa29abd7069e49329fcdb914f43e7c2efd906b97ae6bba4c8436d4fa0309faad082162fe5dc3191b3fd9b61dd4f696656ac7466335f0f3035d18c12985ec79cffce05bef0f03fb6f08d0a022d2ddd499ff505b3560d315a5e14b69a076cba4959f91432f6e8e16cd8d14398ec13fbbd29ac6ea74af51bc24f8a7612db63331379c6067749f6f82a373cf3fd106630e53e6a0e5592f5c9be4e1114987d1b93923e2d20f71edb9769ff3d0da74450235b09a03c0488a0ea8e89c91cab43bdf1173d468aa5dea6e7412857df424520595a40c77a334080e946d9f735c80c6051cd798d2bfc0394be3502ab685126bb4550dd130bfe13073651330720463c2f1375e357e09da24c6d1cae1939034e89266a70341c60f3c6c4a303f2cda3290ea2391ce1e684e6ddd19446ac79a928fb9856096fd39e762283da7360c55d55b4876bf01a03612ccb42fa0930e85bbb0fbdaf597639c52cd969fc3a774b4dccb04a208c0a4b74121dde309b70d8f2f55cab1e11e11afc7398d8bd0faa2d8f89fd4cdc4f979dbc0796a711741e8b09ca9a59e27156c0269a445888427d78fe7be037afc05282824a6a6da5195ae9d283a62d395f5239343ac525b982c57206f5090040397b1fba494eb0c2568a49c1a4d99d77b328b4653c46bbeb3a3e17b26ca7abd2fb0470cfd7f40392d1245861274bec44eed2c738e3d69f1d6c5eb87008689981064aeafda70dcb43f4996cb1190cea158ecfbd4b03d647bc3b65455245cddd40e5b417adeebde614b9239c67adb295d824cc037d71b24ccdc45c89f4b0a7cc13cec856b3cd01a75ccb680cc9e7d27c8c1cb7d77aadf2263d687c2865cb14c73a447466162735e4e9b6473e8f3b483790475d72178c2f36b1bae3d818dc6608fffdb81f5770fb428ff425149ba0818cc42ca223d0e791d761fb1de8b7bce414393c4a58a169174317bc931af33a197cc690f10d2c38bc8542457a0115bb7285aecbf0b5682f9bf69b9bb85bf6993d1a029460d92b3b73d35ac0a45c62ac1b0e3e81f26122731a5728350fad7c6554467e7760cd9dc76070e0b18ee54dec016c414e627e603defaee53c3ca586eb36fa6b4d9d385ccd6d4e9156699966037001230ed558cb88802dd25e15cfcc0769f0a47ad5cf439b4fab53a5cae4ea6a4c9e50868f964bc473ead04a26f86d40cec78cfe5c5b86d33395de4f309240dbd0a82ff1c070ba62d8d0dc2e6b0e0fb5eb2c97e2f33365681b7828226aaf50bd9e3e4e2138dbc1781882687de38380feb5f0e38378d4fd844b0bdeac517b57c46c168ed8bd898e0d853c022ac1d25a0731818da732597034356d42338190501203f71e61b7c35f70a70d4a440e7860536304ba6db57fb4917e60b235a06b260d51b67d75fb51e074300323f7d73bcd11659f41e03998db9fb4138d4c045fc00d17f020f7613c48585829814e94d0a7674abaf3ef8fa2079607e91b5200f3bde23f183bd9cda22f8841ed27450287e9d28b7dc84c7f4f03b0ffb036c38cd9fafc0cd716ebc668d218eda61810f93f0930414ad6b24eda329e3e3c9e76bea10fd86d95c999c69db4c2082812b518998cf9b659963999f651fe3d91cbc00ee7e611864a77cf5ce44c7487f81043b4a5516225c7b1a80ca8d2fda522662648122aaee207efc21dbf968c2631550ba0cee5f07cb4dd02c27e282e19284dd698d93583613e8aed787d11285b26e6502c61651292b20ba75a448a8089357162dddb09311e250353c046583f86a9cde03303e5aa7b1180203b41e13bcc001ebd5466fa23c88f492195ebc108bccd34f83798f785508ff8f255938a4b1b9b70ec676995c07d6cb34bb56778a49db58d5f29cdafd4c579a3966270add8089a4f0e6ded063b9147b2cf1bf79703911f4ffd3e946c06b5a01e431a94bc9633ef748386c4eed8471edca196506f45063c4c6e9cc8d93c6a3af2dfd808966376ea79fe330d0cc787e92f921e1a00672479712bfe415cac5b959f27674e42fb1a9999d09455411a9f7fbf4186b2954ef6109b9c06908696ce4382cf8c673ac11b75ac75e49023a422edb64b855acc8ee4f29b3ee0e287d6f1a4e48bae46f1ff35abd6628c651e1c2f92d36366125f8c90b935b1322a86eed73c8d9d1afd80f8848e4a4ba81543d2a8ec39e6362ee7e3afd489790f53012a97c77f51375380913343b38e99658b9e750f5b037e46af5588a130df71fe42f000a079ec5f5b9457e23956c519d623906b831eb82595f0650900c064595f2ea60f2a676095f43dbb1d3e214620fe8cb069b2a022a7b92ac755365b1ff59a7e58db936074f92e44c91a215537cc90a7c1cecf59e56642537b9dcbd3e5eeb2ff8a5039be4a11b70b9fad0295ff6860c850e22071e505fe0c1d731bb2f9cb476cdecb23ef7df32b1ce3d6e0edfe849b754c401c722b6332a3037223ca15664d20467ef4511b57f723f6579ef6cfc11457826dcb633407a225aef150377670d072a7f369af0c36a1bbbf89b7e2250bbf0c31a4c209e163a89378696514934a4862064bceca3649e1ceb9ff1dd719ab8ea3cf5cbdf9e2dbf4f635bb10f213da34d1f35cc68a4de06337cb94b68fba7ecacb1f51a462827e77c781ada49bc069c09694d43ea636e36ab58157c4aa6c645fe326f9e337a5fad5cbf3e5c9df6efe204459e1a96ac7ce40d1600117e8a1ccc66c428874349961f87bef6e9037328f06cb724c7d997205882a3581434e1b43bb1dc2d45337c5c731c5328231ad7170f58318a0aeb26b5a71c7e117857b78f4d81ae88ac467eceea9aaccdef226de16a19233e6f78a720957cfe30d7f6ec2872c8f8241cad553939530b7dd18003e6228434765e57bf6e4c415a2f9ba9f6db94a616454e004e836e5e6befc487a32e91c06c9d1bfae482c2276b04c132d4a80d098021c8cd57f5f2ec4a7104abe6a4bbda2d95047494b68374711016543fd7876bf3d01f4dd35a3887f68664f63b8fdb42ce30b5a8cc6f4e701a5fb49d6bdddfdb76fc3c1c74a95d0b7dfca09510966df1f783fdd31a20d6192627b85618c26e02395144dbd840c8f49bd10613f7fd44b7970c45bbd107b9c223e50b0d6cb8fe403daac3bf4f9d23edf1755519b946f00e6af2177286887cdfd68f7d9eacba0d740f6b6e940c8ffad90287e58e78a956ac6096f9e9dd2931ad2544e5e8f39a309c1b5151266a8ffd078a849934d1306a533e570c3de9a9e4d74c8ba931b880709b5234829a8c8630ebb9e7527f57ee06a507f780f6982c8bb0f5510cd302b0180aa4119405e4bbc253f6cfbb7c5c5438750cd0ea62c44b2db398e4dbc71ff41e084be0acbf79f9f1fb755a4b194275225f9c57c487a5b11b2798e62ed2fa32d75947a3d3d338f58ca81811a83dfbc75b3d8b84b944f8be470233b033acbeb7341123366a3de75ecbb8c2e0092f2db28831e66dd5f3bb433b6ad4e9e11dbb288f84da6666728832ee961f4da91ccddc0cdd7cc088f0d5956e5decf946884a1055b872e0f569604aa6280475edce1f08e971f7cbdcc9def6b45f5c8998c02c31d8f0ce08cf6d02cd219356f30ba4a55b7265c0fc9985f4127c1fec522a716bfc2643d923151f4c57093726e3257cc81b8ea561b987cf3f65fecaa9a3f05069a98dbcaada85fff2cde803e26726222e776c807190667be3f8207e92589c269f09dd5cfdb00826c06873607a95ef1824a949c344f8db8f40931888961db79b0bbd274624cf8b9d8fe40f07b874578e8ee69114dd2b704abdd37e2572fc68d1b25d776ba4497592a06a440f8ef36e2065ce8b0d527fea9ad7f4e4170de005b7fdbd7219ccfa860a2c7d0f82eeffb7e369a1c77ac78c9dc1804fd359ec4a6c5978e44ed99330d824f6b53d85f3dae279648f952506f07e448e1008f2793b0fa962ddadff171a3c6b978b21ceb8816080f939d7852c5658cb546e91a95a54ea1de2da437b77b57c700af2ec7b1557c53fccf39059915642c4612bd32974c40df30dce20da1e935c3487c7a1a8ac3ea064548a88a57f6353055b67cac46ba0e204de67cfab1770c233992a385cb1717c9765990652f12fbcf29d919fa50f837a6f62b0a96d65d807643f90e89206045ec2223afc2036ac98dfc7db990335cd9833fcd2140491a32ff9abfee75e9d13092d9b0e23eb0782610451eabb8816939ceda9e9ca59c6c0aae3f236b1626ab11ea4eafcfbf516a05015eec0a615bdbbee7101b8d67f99a614bdaa522140590178d7028f42ee06f4248029188b78fce0c94a2b1eb5dbfbf44e13c64324c38d657dc51a707d32b6132a5231b0d10db86ebb9ce25224ec4aea10cc5a9ba08faa094e08b96fa849f64aa20d932dfb7d5e1e03d5abf51a851fef703d9f7156bb196e8a4aeb4fb8e1138c2aedf67e6a5da681f9d0c2902a8cb6a15fb80c8ca571fc53ca8ba862dc772f8d0378af7085799ac4aec60a5ab93c246f129eb552b8ccb82b3088a4048caf199ab472fad97719fc142edc065b5503613c188c3c579342acd226df1fdd37c2c90a58b578c813e90f2d7c839265f1a5ad6929e914ae296332b496fc598cab6185a47b5dd9d39ea055e812d867b5eb87fe1794920fb2efb795113c644cb073d63d7b23594a3f1f05d52b6ca1b70d84c2fd0c88bb18abca81cdbc7940a53babe7dd852510e5aaf65b5de69235a4cee1fd8e7f4e61130fec8a45d0d3f199056c420f2b3aed6a1b1265b78073053faacfde5158eac2b32cc47b680be31944f136ce535dc8c14cb0629de6c44575416036b0759c35a1ee6dd8d163a1563e0d2dda85293e84897bbdba664b687339608cf905e4b53794bb2ca8eb9c35274033b285d98dcbde8ea7f0b45cc129d8543674aa5af48dd9c67b0876381ec5bd326c184f4024200048b5606cb7f32b3930687267c593c501bdc5f5139a3cafab83f874bd87c0434e619886c72677240b6b3adc1476040f72a896c72ae133f2c37e8e06797233870c6d8acbd414b866f3b553f90165cc3487ef813dccb6d07e78c69f2f355a85ddc93fb51fbed9152c9a495fbfc3c4579c00efadd5975885f0f595afff1e7c9bad11263e5f1a43d2f6c9a5f6df4bb5f80bea3ba899a9f9d04c667021f0a045447aa087a4caaba444e884d7c9788e2ef9806b086bce2cf6a1194bb7189bf50eecfbafc03925a00e6a51c16d43828a53df42f2469cda1b8cf4629150ddff6dd20e829014e299c54c1ec5609462290cbceddd829abc5a3bb04d5d15b430e52e373e63174774931558e97581d4c6aaacc54d45f86247d2b1fb7e68d5b95d94ef0e7b9caea02407ba882e04e8dfa804e4dc10fa630bee94345fbdecaedf072765d89871aea973c417eecd0e6082da81aa648cd640cd2bb191d3ce7ba52b89676ed52060b13eb1edc2a3343aeaa7bf45ab835fb69152e55c8dd97fa0f1d8a892eecd599a0f53e236e16f3251b6ffdacbd47fbc91edd5bf3fc5f7ddc9371d7cbcba86519e69652623ab3d62d11119adecc049c7350af4e1e39344a37c16c1f4d7e78a244f898cd9242afa060dd42904bb4b2920e65fdc93cedc55c2e4a940f1c7bb003e0b3915b7a2337fdda0e672a3d8def17c843a889141aec99bee96ec0ec9f9f244d4bef7214fbf94711e2c0685fe60f0815a87c05cd1932c24c6b1606631a465657fc3c0690304d4659d21d3cf9078b448dec691ecb652958591000b50267304e5f09c24d1f4b6f27f4cfd3ccf2b5538d7bcd9d8dc196f65b4bbca279aed3838a0d9e947fb3996ce9a74abcd3344123f63278e2a14d47a23635b26518e0708db5be5f91dd9f1087c8ffe92935a2b5af9db72aed4264e1b3bacc1772b8099947eb4c0f485872e0c96e9441198f7dc018f90d22c1ce5dc04e7313b487f0dd79bd263d156c6ce7aab612e25c126f78424ef855acdfec6ef305fc35ef2bbece6e566a5a88f6e5d67c22c0ec911e7d09000d9f7e9cdbde34e92f5c494e04961ae3f33af440062a37b9144bbca343d04d418bbb6d7c94cfd4d621795cb076554032e38b9e5af9c4dcfdaac20f4475b2799e54302eb3057361abd3055c142957db2fb20fe3a2121b5159d1615c1960748cfb0391fe3e77851362fc5704e085b00091653fc830b9e922799db44da8f847d290253a5b6d50c6977e3635debf358741296336f91fb1cf9ee7c41286e418c2e116ca266d9c5583f467f3a8779bc174765f536bde4f996a87e7063a627ec1c5a1d38f6913f7be19be3db2455e5df594e7d17b79ca8b9a262e156453503f76ab139e505a9064a33695a9a89d9fb7917f001e96c3600f668bdab7ffa98eb37846caa515fbda41003b87ea889b67105d73cfdc301de26574d875963b06b488a65b378541868086ff3e5b385e2c8840c214e9c06a62b692195130fae4a3310e02d4f3369607d59598421855fe7ff3fd047d15ba2798290cd6a46c6d759a635e99f95161b0de22d272929bfbd1a6afd5c5d2480a63d4709454579847821e674d5031ccab3c23a80be9bd3bcdd58468edd71df2adff1ca59fe845de838f91936623817b4e2701d64aa719eb959b54873d13db912830fce3bd12ece43bcdba5f2a7d345e89830dc769a0b4c89ef2c45b107cab1fe0a67f20d7295fbc2654630e5017199dbc3988a1832ff2095ec41f8d8f6000859fb7c550092fb101f93bfdb3751e18e15d716309f9e0a2adabf6771eb28878ba52c967ef74f0959e6069963bc5fb5005610c9a4b941c08a84498b5bea42122d2b99aa15b70e1f4c65ddb7bf92794256f43a46ac3db6cfc6f6566830453a0a6abaff93968dd021facd3cbd4416f7156949202456ba5c505f6ba9ad38ba041429ac333f7039563a3cf409078097c0d0d28a82a6583a9359b8d00571173f3b35652078f680bc73aa5fdb7324d0e6498c843518a115cd4a64f027bed73f248236638fc1d8437f44daa6964ec3112b953cbbc91cb08259fbbc22c055b028b384beb295a3b843aae9ec338e8a2c423f681664375297c32bab4df743a8443e79c0a36b268abb216ce44d61207f561fbaf72f84382678d706d47abe5d3d2702f4b81d4b73e8e52c7416f9050f8b2296529018c3881c10eb78ca3f52d3e86be22ee1d0b58f375d58894a514abdb44f03088e8c29e2bc6bf3732d752651dfdf7e78c455b0acc5013c7644634c4c92e6405242e8b847905783cc2ce7f1c572aadab280fe956c9a8e9841df3472eade115e207e915edac6051d980d1ba1ef7e2bd3abd65f978a656760a6ff70297890ede06b2a03c18b765ed9aa60009da84b675df5528e3cbd28c551d10289852f11637208495994a4e81f4aa0e4896cc188d4c1d22e21a64041265b933b2eef9734c879f8ddc3dcd51932fcaa4bb962760a7488b199078cc647ad366dc7473cf2099d60353cfdda9e0ef2ac89aa71ee577039c94485fd3ca97c692cda9ea1a6273902f812550d5fcfdc60f434a7de6e3f5ea614a8934b2e38d27d018d9b4e651a9d98e7694f4b6ad9c77361ad85124ce3d5cec4e68abf13e94279f1b4735026b425887146653a41ce0118f7490002020ac117a31df7fe4c6d6f4be2d1125067f72026a77b17e76363353508a18e6948492c342b28071dd4a706c3c393f411e79824ae9145d002d3c20d97cbfb07c5c6e215402c4467527df7826fc6bc3d41610e157cb2f3b1c86dd28b1e26aaa62ffdcbfab14f60509efd95ff6926dce5e3fb4c76e50dea0f087767da93e76f2b5751d7f12bff53319d0430ec3e4ed6790d686590807901ceac881c57d7abc5487cb5859a2d4bb8060171ddb46e979d62e4807dcf1ce431a89d436fc229d69f2777a6892103afa15483581a8d415faaf5d87655cd19fb1fd842a310bc9ff67e8ac19a40120e7a8b08cc875217390a66132902a505f6c96f40060f49e7fbed0c4b2d1fc7ffaf3e4aefe46db0106aa003b9db0bc0608ffc060e9e2b37d951d0dee49c734b4e18e0c249a42d3b59366466b68a990e9a7f7b34eaf690022fcfaba7ed9af06a2db5f5c30b2dea9ece211dbae5d603f3c8ccc57e6ead7d571f0a542a7b032f0b373384acf52f0f33de7985fa6fb9b83b47794ee72747f296320a8d09592a9120628db252d6fbed06f48faba653084cbd461f946404b52316e909f8c7f66d084697dfa4858f6853f63a8d6a4f28ed684c587824960b4c75afef29132cc273ade7566e635875226b82b045b5a1a791c4673c0774737d1f4c60446d88f2b782b2b9442a6bad4c97dd7ba0d4e6eb992717c12dc439a68a0d69d06bbd33ae3b46d3e65584b11c63e7d442e2f2dc5b41422ceb6486db701f339748e61897e92efd557abac160efe42ae0dadffeff2385005bdb28eb9b5a27bac2eab0c9d4d7e2456ca064e1ebd67d81830991be582cbc596c0b04477d540ddf8556ad5809f695fac6647e02fe720514ed3ff6c26a8586000c27028179184f4955221a598b99cdaaf597c77ec3454f104b7df17bbb98cd4c0a3ae537936fac142116921366d33d1f57a39ad1cd0ba2266d3193e4429943bb3abeef2b00240d045e55d8645858e800ef1856239f916453bd44322a6a66216db2b6961b238017175762daff9bb7ce977ce5af01fb458ad072869311fc5502a76ff5426f2bbfbe32883a47ba656f5d280e6bf546d6b63a79c0a5368dac523a63dbc9509f134f146d06a83496c4d32946d79cbd2465c68f5210b669879df9c27510908e3b337320a1d8f7327e94dce23b81c34d2c013fdde4d880ec869104571cafddbcb76ec9da1b61a1a1d626282f513fe50b8555beec7b80c024140036b0311377ff4941192fa9c56fcbcb49d46d577e1f0026c7b64fdb4b3adaaf1105d5ce7551f70d27a0d7db5f6ed18bf7d187582549fc3ae15f7aaa8ca97e411a99d37b3cee0e591ba784aac9c9981ddc841c8c858eee52323e06485d6a2f66911344ebf1263b4d0c5962bbbb10156b454f6f6f9a8f6aacedc465f5316b5917001904c34b59ff212522236dc48b26c85809af9874adefc923f03f7d6fda8a00a004ba91492a6b553a0e492fc0cc8b13ede1e680fbaa772ad2cd8eea3a01ba1d8c6af2fd70e750afa97e95f2c4af3198d7b94c1cd08efe8b4a211615b8af94e8342ebd5da7b813c0cc3a3b7aa54f297e38c3d6745bb375efb40a977d0179309cf6cf8ffc8cf0a48f1084ebe4a4d0b833fe364d1c91fa0b2b0e1797e5802f4db0ea01482e963eed64daab98ae5faa2ff175b41ed20b87245c8a11a98254ae523a0798a50a8f4516c342e1a8a4b4253d025d9e613d8dfaa884ae8ab7375f0a20121b86abcfbd3b4164eddf6824783641deb5733f5e237fe79f5263c647d9f4bb278de4582a3475efb11d94862f902dcb9c52b9f35228c0f0db0503b10665ef5f814c9087240596dd85930c44655edf47d2e35b867bcaf86edc465110fbced1e3d07d8884860ff4306075cc568eac80447957afe7a8421ba5dee908b7753f32861d9b3f75a26a0b864f8b959e116b1dacc50a3e0ee67182cc8d2fd838d70c424ef833c965ee0cb73a5dd5ec79d68a4026e558e6987f0752e0eba4cd8ac32c064277da0b529b9bacdc2a85c3ba19299522d7eeb24306d8466c0270b95a677700e3b62123bc6bb1305bc5d10580d5f5b396015bcb8d8fb724802a5545b20e3deae744e66092465e587777900d66e209aedda48e9b4762bfcf431f44eeecba7b06f5d926cb2cdbdb3c7cebd9aee52aa12a72bc6bce4e40fcd3a49cf557194b253a84ad60e2d7fcdd17a208ff2f29489a0ea8d8c105ef1b7ca35fe015ccabe5725b98069cebc123c8809c0f2f04fab4af9b33f8d124b1a79a71f988ac7c8981e1c8cb54c6644549b1a374c94b90ce30b8d0ee6e2897ba0559c3b8e988aafefed0f98009d61ce4339b96e2be86769a5a4cb4806b199a76e2bb00c8c5f1bcc56c4615db81ab253b113d78c1b0a4f55cc95e191a7a44f8b249c6e4d90675115337467b4f7b2bd9afab3698e904e16ea9794595c78de0956cf2a1bf6508260d4d2c50527d88f6fc3a0ed37cc781894b98d9630bffc79a4f3cb2c8c1a07bbd0a5763391e8583a6838c96ff44bb9649e63e76d5623ea8f67fbef8218d57d4d7e5ec5bfabfcaa7b0a2010c06ede6ab59f4af24fcb61d480d3f3a664ffdd5de83c97dbf438b7cc3589fb3cc9b50e1566f063fa786697130a60e1ba9f005207afc988bcd0eaa736c80a0df100db1a4de21dfe5e1071874f916486f8b414bfb7527c671a74aaedfa7a6d76cc483af8650af0b9af178f6a2a5dbe35b40ab1cd90ddb2c2c9a1166b11d6fdd81c083f8bde5ef2f6f97b04dce149f8547ee128f763e0efaea5b72582151545abff1209a839f28351acb4144d46b8b0f5573493dc2bdf43f29af31798f3390cb4135eb0971dd2f7da87d07a01f29eef3976f1568aa41b2d4a72a01e7be7b9bbc7f2cca1de23626dda46ba4458b32dade988c24afe03cb67b3f12fa4cb2ab7ca58edf004e5683ec46ecd6865aa45fd2c4618d53530ba6e4e436600b97516f16c869207f5b6c8ba49c216170cb49c15b84cd202ee0fde8f34881718ee3eb6f8170e71275db4ce91e1032340e15bae486ba7cd7ecc20b1b7ecc23ff2b94d95b5fe88573f4ed4128814db76045d96e7a81a3b0148268a1622e29074522ec3398603214e3c5c61915fde5ec5614cf2de44fcc239537eea61a6f3318cb3944e57cc47c5daf8a11bc5d453b513d6e10730248198b0fcaac8a18f5e48c1620bae116d397f8588b42156a10c8209d6a4bfcff2a3bec2e743faee4b86f2ed8e259c1012579fe4153fe999d7e2f7ea9ec8b07867683569a502b55af457eee62d7206aca229b841b6d81254a07b2d991b2ed02a306b09ee03fe0aeba91f85ce51a1da9cd23eb4a60eccf4e200162596b8f4c79f7e459fed849330fd59b441d8815f625ac840c9eedf8fcaca035a658c6a6794c99681d9af33e3d4905d93a11e18535c907ee8f9b851f4ebd4e8a282c95551b4fcad25c31d7a077d951c9111b4520788527f89aabcfbf458c7024bb6c6c3ecf793780384205988091b80ce354e949f7435c68c76cbcefbd576397321539cb4b22e10479c8aed18ecda79d170c6b3f173a9072d3e70c8b4c17e4f5a24cd1642e4a653e209cd5b79a7fd99914659b6f9692e5f9483499909098630a2a94157ed825df122a530ddc9fac3bcd6482dfec97a714e02d5a75cfc1c47d51caf98e3ce217896c849dbb8b759a8e57f7593399e3cc1bbf8671d6be652a33f2f7c932aed87bd61d45452b28aefeed868967beed481339888330cbdd2d583ef685a158ac8c9426c84aff3c1604e898a6fa92709b2c5b1ceccd0601217d1295c336dae8ea62f21296bd6064818b6a6079a5897e5e57d8391f96711266bfd60d155e6aa966ef181a74d1b1efb668a268e03f62082eef0ac989defe24f0486719419fa3aa9af15344c05d9140ee68c41a06b82f856dbe20feaa574cffb4ec7a8a6d025fec2e4481a9e3a30220ff857324edd621903fec2aea4cbfb998293fc6852f0f45eee6f583c43a029788d928206602405390ca79bbfa2ac745322cc8e9bd2ef7365637779144f4e2e2f664336d2b0ca27dc84fe26ea31bd3f6ae17f0b36fca34987189ae48d1ad4a70ca7f6e542722683c003876f02e65627c0d15cdc35d6b91135c59f70e8dd9f2fb8c966a6d8a1cde90dca34e56bb38b22e2b4416bc662320b95ea24a530a199ee29120757d1eda64231153933f79e0a1c7647a92f431e5634db599002a632c375b605f7e745f1ff3d1a25eccf36f1a57ac6f7019724d883eccc52cdfb3ae9afd881a2b2058a4cd39ee043aa087516dee6805bb0da80a8379913ae53849d4fd024cd1f829d5c5a4032b8c6c5059d52267ed66b2e33b9f4f8b1175733513fcfd7e9b88a4fc4c859248f7b7d2c96dd72da6351e04f1d314e743a72ab6663d17ce7b7d59b4cc3d614406eee8221df65f446de6902599160a611783cab656da997b02ef355b18154e43ad85e00f388278403b97323c2e726663a7175032171481ef737a5471c73276a8ae43aadd5a563efad4ba1aec611867f07625ade7e74300c5fdf88044c04effefa478e9cf1c3eea424bbfd0822c7c08dca7e523b127111bc2944e597d54cd592f96943ada9c8a81672838aaad01a88825970fbd101eb2364475314fb0fefa330de30d46c2e520c58f1f0997d5ae69599115ae3bfe254001ef5d2e1b763df968ada3221abfc17747a3a175a4eeb6a79f735f9fcdb797bd1c71d2fb2a84d8a23ec812351aafc0976318bf9876caba26f1c1c334dbd025ed2ec35bc07e8c2f80b61fbee985cffe08ff4072c95c4f612be68805ecd8b7de8b1b901e71ca5b8297463c32d7cec5cb94158e31641213017c579797e430fedf798d3378d768db38cd6eabce39ca375e839d1dfb4c1145df0315003691d1d871d2c0291e0db83d259e105d1eb5b87136227a4d03825ff70d1aafe5a3ec3328f6ec020a0623e3a10010ee7beb625ae7f846e2dbde68d6cfb9b4781521de417994b8a4a005dd59d207ceedeaf75ffb8a0f7e048f47b2447bd1813f697ba9c4d8f3f62db1f68cde2fac5fb051343457ba404894982b6f727800eef4c110b8eedd26db1a9675948cff5640fffa1e106e99d20142d5691ea72e9a1206a417e3e809a92371aa9549f485112bff355fd02586a70e2ecdc8ec06d88adc2e146009ff60fb7b16504c81ad8240735a71976db27aa7320a73bcbf012f819f3538b5ae18879a6123b5b988dac57cf2d69d0ed8a13a7f9aae4d7ebcbee528729cda9f4613ac6d0231740d287d225511c6016e9896aec1b4f208c4183c13cfaf530f519f8519f2bc0ca20c315961767a72f8a75d13bc5a40cf26f4e761f95044c8c9375fc0ff7ca1d68a7445786e3429aafaf8015bb83aef4cc34b72138e7f9c99040ccdd3c438a85ce887d673776222b2030c829b72cc48558e29da10a27a84b713c559a79f89e845aff00f220c8098146309fb943df5905e500459363fc38a59dd9b78a1e733597aeb3b9a24402d5499034cc23fb9231434ce3c4374f9f5216488c6e728fd27506308a07c7713d59e1839f0567a1b27fef8303ac80c75417c684e4c486118bd3dad2fd319a7725649acfb593abf1dc7cc1f61413c54650e78f998d1201359491e266a0e84e134d55152d5042e1935dd49ce91b697efedf46d92de9d7f97a104599eda068372f355f11613670a459aad6908f68700868ffea13bbc827f0488bbfb861a1a593fb650b912e2beb58651b4b64bcefdd3b653b1cb5ad90eab7138b686270fb71be55b3860616f79e570c272988e05f1e90bcddc7e3dade5b9795dde2c7747fa33de3734bfec232650251e04cad038f603b6f26431e7794b0a10fe877c757075a3566e49ec50868400f3cb13b69aaf07b6eee9c6d95bbee846433be466f76c5480197c8f9fc3d81bc193a88815ea5c24c6bc4f32f1ad456ed13f9c21af7bf42933e9a8dc996221e9251f0e8e90462efb4641acf8e1e7e30475a6c3f9e00ad774351154af8d35f84a43d3126395039f72b4f6feff6fcc29b02a56b66efa3e92c86657d47ea21b371393ec34603f525902e938a2dc07a4b650757fc58f1aa3a4680d5e106658a41c35e98fb00dcd70e2300c305b6a4ae67c918b83895bbf48cd14f3bc77d8bc4769fa196ea30ac05d39b4c940b7b643244ec8447cfe4c164fcaebdae729277dd3efb3c692db2bae11844be435a2fd24c1d6afff0948fff2908147461b7765748516c6f0788ba48f8dbb0c09f90a10a0464a4798863f937490ea9d649242dc22c8fa220155078bc94db34895bb48cd27e0ce17cc74bbf11a31003a2f1c00df1ba275baebe5917b2ea71123d5993c45ae5b8d78d4cc5c3c3f202c68ee6bfed16d705b0dd68329913f08da2c73c9607564ecad9d7c759b931d13e291c6627c5b57f888387eb78e7057b654c6c32fd0324a2cedc11caf42a35f9ea405fecd0a0dade1b26f2b7abc22bb96610704564410731659eed44a5248c6af36bb409b235493ac7dd53e557e827115268140bbd690d77272ba2ae02dca601210fba4ee67833fd4eb77edf5c21e5a31fb992b6a991db3f09ca1b6a428f74a0e78e01db81a5ace44051d4c1d7400177e272c777d05da73b0a2df779b973a48e530e9745c98e669f3304e10398181de1f0da918f879db275c81db94706416023ade2139fd098e480d81d473322b44cf3c55e7af779172e0f7cbd09374f98c3aab0de9957212449b2dab9ada9fe08255706c770cf95bcfa269700388c177028b20fd8685ace70efc738ed1f8f3c15a9c2b5aac1f68fa92209fd9ca91217971dd566ad4266381f50e2863a3c7a6ac0db0ba7fdd69cf74eb0a3c38ad75f10ffa92477525bd1c3f8c4b3f6d47350b16e07015dfa8a53d0c4ca39dc5403ca921d2d7c76e56ce9a6eb2bc78492c7c88ebd8d4ab296bcc4a9d3cca02ad50b2cb2d1244508ce419c4f03c215f1ccef569882e9b24d4305d7566bfb338e78364028ab0a351ee0ba4ed7e0362c047b2b9b3087a2f898f6c1fb17ad8893e78c2d984043b68bad720c0b315d268f3581ce859ec0ad86bf4a533ad81da6bce7150fced896efb23d489445b74a1954a27cd9c17dd07f491bf3e997a7111e97998b9ec27de0e4ceec4f9ae5932686417d5352291453fc90534c16e39ba0e35b70b985b9151b5c4c26fff7d9613040004cd920a97ce1243fe8edf70d7829fcb26ec8ff7dfd8465f922556709b091c74379cf4960a3d8d7b1c7b952ad5f61d3fed5f8f3057d972175f53a69ce518fdbfa1191ac418a6450791a4296eb312d4fdbe946ad7b2a81a912e7e353d03a7b247eb3395522773f1618fbf73d3a8f512c0bcab5f0f84f557617e07b9d89b640e621a0c96b3f28048ab8d41fcd9a2bb0eec16e8555af6d30515b9b6bb9f82bb8e9682387c146bea8ca38bf3e555a74c8d81f2ffbd9c24c9f9b36a245c3ee6ddce8c1a87c6177895cf2dd902c6272bec3e14f7927d588f527d77d7ab956dbdbd72f63114e641feda1288fe65f865fd525f3f429e229519de0a426c57408f4e20047b97903031341005184dbd0e6521bf140f8522142755e3290d54669c56d02a07e7886a286b6871ff8fe4cfd8c90cce02c3b694def7ab64a72ea94686ad736ab6491a59de3464a6e5c38ca065ca41e5ce9769719e6cb7bc38c97b9432085084e4d75d8bc230d59e0882b2cdac56dc838c9cf2b9fc789cac7c914fa01bace358b3d383ab62b65d31e4db0049544811eec8f6898dd57ad44ea3453bb14ec789578e9e586120f116d5ef8e4b6f3df44de9724d2fec9fac2d7e273b854aef450413c02ccb4fb34cfdedc8743784f3017e17fb0267f91cf7f99093d29039249383acdfc97cabf42bc72f4f674af819673550267fa5716dce27fd6809403989dc0f71e1f66df2b4442096fc269698a82e5c96edcebf1de18dc736cc9e1adc034364b61f7f9ca047683b938f936edc801f4ad14cb872a4fc731dfb2142c6b25fcfb95cad7d0f7d1d7709c975e12f2801650a3641ca97e1496fdfd06ff7b7267499c53bd393e73d84e400efd535b67ff67c1bb0faf8ae97217655e40cdde36ccddfcbcbce5d5b3faec7daa78b95982a42afbcc5f924e1ce3eada9e7bccef8b374254fef0a874b2b321a02a3e3c3669420252f45fc9d70bd90ce9d85132a28815f8271abe8cc333593bf2b526342f56876b91d6894901679de81a2b1cc4bee55b2c33608ee173491a3af43a181e8ddb330c680fcf8fa0df13949f133299b94964d813d604dce2ae346f774d225794d890299e15a3ea115d03baeb1c8f7b2296f6a212514a53d34fadc60840086f126ae02aff5c00860e07e68c39da8bca9a1c9792212d651e94fb3fc064d2d1722544cc7e38d5efb64417fdb5728bd041e0eecff392abbec2d28001e1f579180c6731943188f3ce0c569abedea7a37ecf2e72ab4196e9ee5f0e3724bc9308362512921cb2c380827b9cd064708708406f049fe0d86f9c2e3127a9cfb36886745a811473e25a48132660e3821a9694a28f82ff81e960e410ca1afb0ce710a5a172f4a06485638d522f9df46e4bd7cfa3f938974c2d4b1438937f1f27b2d8ce73592f78a21c5fdfc5c2576468e42dfb641f0e2669fc0976f9236d9fe8f3f705711347de60db4f5014ea51c87ac079c487f879f0c6d40a4bc36761694f32d8cf2f1a4abb79dc94a05cbbb257e31b6316cfcad28d407c6e887987a64679faff6873aab77b92ef830593e68d1d6a741ec681b25687154ea51d5837b7a3464acd163f85b9c4ca40bd24fdb8fe6b2032d2f68dc17a361a0b41b7ec64da74ca8f2091ef031fe737626ee3878e5480860e4bcfc7aab1908b0c32f5a40d653d912ab26cfee07b1005623d5d9eb170211b45e41699638477de5aea34ec4440b025084b6f4998abb6f39ff7ffa3c20d90a6c784ac3b4b5dfe813f0194fe0ae3cec721e11844ce8035869e759e4ee4906432923f812f21e9c01df6736a674df771ac382c98e9d31d41ce38bd515843a5ee516162c2e4da2c8fb42b1c347baf6f75fb8010399924cb4b67c0bc6408d47a0c0f38f687f9867c10679ce0a47f684a78a7560218f08142175924ffc874a3689a674f65819f0f0d987c61287083c3a7f5ce6d7ca90820e3d5ae23c12b00a17eb160974aa1e3144870be3220dfd084ca17a342a59ddc2eefcfd307c58276e1cdfc4b32547dda0b79b73c3a90cd12329f12845dd04dd104658a77a7ae93b5d10f0770322d44542de05ef085d3f5f9141597474e218f93a3b47c4e201c4fb97d047f4e4b1f664bde1eab3228da284a68a4bee9fdd59f83ab9b34f4f078a345b517f3bf5c4aec7d801c143fad0707fd21e629541a6f32c1ebc9ff9c6c66ed9dd07324b4dd28288d55b2ec7f34d0ceb30fb35c757f89f5982044bcb3f6356002f5f968a3776f801076991ce5af9513584d5c1dba2cacd92fcc5f45e3719a5b83bf4bda0b3f26614c288325f7acad025bfa38296e016b2fa280e12eeb09bf269a0559dc68c3cfea74b8037324437d1bf64a254398388146686505d601f3ac2c29c28e3322d2c4475a0c3591e6773abdb4b59f20844e78d1cb70d6a585b79cf773c10b14c1528e722138053dc2172f91ec0468a0c599aed3ee82759e9ff007d9ef38f8ba8a6abba2455eff24d74cc9168ab288f6d4306a0b1d914f59294d1edd89b0dae5e6b0c8e6f36214f1c1dbb4207ce8e45494c2e7071536e56e013f7dee891e2a3efcfc92cbf7f7cb607ba78050da3bbbad9d0f060b0e3279dc336fcebc4910fdbbe0af16713324e80430d28b67c00653c211fd07aac6269e3396f0824842ed5b260af541540197774f9448fd80b874dcb49a288f15dd8253cd22c6c61d78329a6b2be154987fa5a6cf46071c3a5e71534c2df76ca26705422a1019a155822246a517ea1b63340885bbfe745f4dd42422ec419a31dc7e933d3d7e7a48ea6b01186b73093bb30b2ebb8c0f7f5daf654901af8b7c8fbf82e843d95ba9d000c9bf4a84b87756095e86d76ab1d99b8fea194afb3a1767866835a532c5286de92ae7fb595fd9e5e76d57381bc942af1c3f76710d4a5602acbb559271ffe4440d8da26633858e771dcad5ab40ea28aedee532646413ea1f4823abdc8b1be36d73761a88784260adb488097a71896fd6395d421c5837d98d645201caf9cbe29d5e477d2ea1c20d0211846e788f4272c14a0618e25fe74f06e641ce8dfbed206df9512d5fe4883112c64d3265c2faecf33796c79772ac65e5a380264096918500b8b4307b7e03d6182bf7d45de91bf38873eaf67cdd77702ebf3803a8176e61d869219fbea8864dd76b5653f404e6704c680e82c4f53cd8133874011d1871d90b361bb71db9f3b8927caafa0e8304ed3b2612c76cdd78323b081597b91afd1671a03d81bd30972b8e8ae5ae5fdbcad54b747f04ad269fc5b7e7b758cfaf2182d4808e9b2fed1eb226b73c9575efba4a87e319ae00cedd8371035550d89028a14a274672d0874002935f1f15cd3f1b705abcbddcbf496e249e1f915e89314c6d76194b03ba82bfc4c0a280f61d00c77674b38c92a56a523fe39a4a4ac2b6bd2131a887bd7275d78ad6d71f0af0838e9e6b2d55a49dc0e42f5eb715cf3c5fd2c0671ad213d968f50c2952b6f8b25ed31f528466bed9b2d78667c3f8299b4c38d5364f7b97eb76b9e1ae8376ff02f3cb1b9ff883276c6ba266bbbe2ab011efb6d5b5b8eb15dc0049ac54fb13fd5852bf9565ac6163ae1b7e2da63b32ac620b73488e70afd1718f7773d3c834df165afd554e7c32788cf5913d62ada8c2d09d51eebb3c47d4be0f2de88012c1e49b6c5c06dcef76e7ccd664963c64bdaa4dae3f4097475d9cae8ff045f28f187c7b50bd40fd265a87785b6a5ac67c0a7dfc26cd94a5dd495ceabc0da0587176c0c347bcd96ee099808fd415d5d4fabcb5659cf22dc62ad29e76f84401af88787f59008ab05c7b548c63e13d38e13841b86b8b56d1583b2ede028fe4f7499404f4f2253218cef5c98f996c48826072a5310f05b747af270034828b9249db48bcd35dd1b209b74546cc6cf9792117aafc615f0213c717f536e317924144690a9cbce98fe367cd574875896e1478b8d76d2b03f9d03b5a4e5542214238fed48a2f5f2bf1a09c29684bae9f004e81724e8351214c20770d82e714eec994b68868d79b6822fe7c39757b913a6510619893e71bd89fc69bde2d75bf0532ff0597b34d1ea9ac791f16e94046987ae79802f796e1a644c5761431c305675b9014b82c734791fdba2581f3c9f79931910bd4bc7251da08bbe352dc838ec50aa8793324617300657fab94cfe79e512ea5f4a2d7f5415c0a3e053978769d70fc673e5916800c8b9fc6e18215786d1a247697c8861193aad62fd8ed580b2ed4b85fe1166c25de38f27b8ea2a3de6a0e35ef44b2bc2b76420679174043fe8c4eec0f2feaee56536e73c678149da229c19b9c07ea373b5eb8d397ad63f956369a8efab86873362d1bbc1485df119259399c2d7fee130278282a2072a4822b2fe85734fe246a81b9c6efeeeb368d9f6e23603cc69dfd2de396e7de8cb395e4f774db44e33bbcf2d592a90fd07de14a699b6ccd44b0eadd7b2252fe483cca30124a70feca35a787e92e28521b00fd17e5d1e05f8e4b205b5d3aeb275ef76ed86926e4d2c73daca0312ecfc6819801288b0dcfab40f1ec6f093e96f6bb93201c081a813ab04344ab5fe964809ea6eecd8414b87017e793dc223c45ba6a01aae6d6a6d308116df3d938211030e484f26c754ab3768172d1ce8cabb295c8655885339d36ea0c974e72f9796e8855a95233f3c48fe36ac72e01b02d354d363b357c15f72a7d7a9afbce39588dea5c3b00080426fb0de2c14fb1d289c7ef59f9c928dd4dd6b82774d1b5b2dc91fabc622731133a1be6eb8676cfd95cc56028353e587551d3751eb6f0da935c246fba473d5f88d5b688ba8f407ae1112d468c623007e4752f5c0d6dd0b891c843e478876abefc88d63caefe6d998ef6a591633edbeb41c09d2472aa6a71260d9e527ec70e5e4569c155509ce3a8690581ca6f017e3d574aa649caaa7f975b5629ed6c4bc9e95b253132afd12984e461146be6be07f10ebbf0ec0db69b6390b76a3d4e451bc4a0926ea4669027e69154555df42789b4f14d2f128e9717d440a8bf5c5b7a6bffc5d95f97828fece4acd64d8decbec39ee8d17c50f35f52cb9b1e59f93c18f54625c8b9cf5ebe948ded0c768b9d1b4e8228cacfa8f5a06a2de35a6fa55126a1f73ea6a158e59561343a18ffcf4f3ae6ed939f33d68c81264306f9c6cfb981d844edb83b8fb7a0a14570d04f35820065a9ea02e319f6c95ede3e4e43c448d717799cb6f460ac30ad22952a6f4a137d06f2ba04400cd3c7f52694e9925ddf4c595bfa3d74466fc46c8ba9d079468f4a4d83d9f329d207a8b9527fafb7d578bfd5086d7d903a0a15b3d13a632d0fe653bca73afabc51f4d43801168a828f0703e97c168a7f482889a8557eb2de1696710511ebc8e01f485c3cf5ace8b5fc8b79323363a1f996ccb709afb577afaebf814b4c47e2b56aa76d5f7ae8a25702d486c39d3c947e0ce886eb47e5076255067407333b078dfd288cc88748554cdf92a9a5dcc75e0150c3d8f62d82048ff387ad1c3465cfa2a2084d88f96fdc5fd6ed344cc106a7ad106538c93222fb32bc9f495cacdc923d447bc4d9dc20f306a8c562496770e3d65da30b8cb811e8e4df0a0b056e13dba85cb26c6d0d32e46347393c9f19ea6d6ae4a0839b1ff63492a4c6ea94d2f30b55a937c5eca0cd081892aff688dc7a7f53c404fad0cd01ed057caefb80a529388693209c87db137dacfb69d02cc0abce31acddddc3b869a3d1d9fee24fe1739f4d79d01f9acdafdcf767124072ae613966091becd6a4c93aad72f8dc41012da8a951d170e50f0e8afb2ecfdd6be7e4cf1f285dc7430c58d8d44363e3c2ff2a6732581752af40232dd62f6eee37497eb43dde36cb56b9d1e19d8fa487bb03e2999930b9625629af28a85f6ea734f499799c81ef4a502379cdb3f78f9697bdf28f7aedc0287cc200b58209cabcbe479586fb44fbdaee87f13de70fb130415525be7ae235bce5cd21d966380f47d54dcb8da8ddea2f6be70ce76e41ada26de630091f24380decff1fc039402451ea475a525b97fe34f4b4490ceab639c13c8e8a29002bf77e2d1bb39050d58b5a23a9d2c820ee63e7d805761418fdbb66963b1e3dc519ba33dffb0b26aba72eea05cdce4deb93bd13aa9ab318fb75d8468edb73ee034441d0fb02bb80321f0e37134dd0e4b42270c309e6ca91966c673bdb6e3fae0966e6a8ed1e48505375a650bd2861375e933f20e36944bd17e8158c49c0e83cd0557c023fc3adfa43f48b0f3cae3d484391e84dcb79481d87845b4754fa71546c9f9acddeaf951710784246b3a6151e914a55b0840b6e05b9a0ec1e78943ac54b56049facd2a19bffd6868c2f30feb1e063c186fda2a15ad778c0eac3727ad0d4f2992ac1382318d30d97c21f1ec010000b97683032ea82fe1faec3a367ca0e40a6fbf4646ceb5785a7511dc3ea20bb15fbbf088e4f064e1b13e41d2d9f9bfcd47bc5b3863c9e4d224caf76c99e81ef76fa6d51d8c38ea6e70071db262aef8de6dd4cb50396bd61f9455fb00dfc96227193133db54a4459d8b8226e959c61baa5b8e91228897bb6850044a02e0cafd0c883669b5122358b6ca39815d3259e14d284fbe0c5c69787f5e81ad7e78632e5cdd5e2677f257a7b9c87131f8b86c3a16cec0655b6cec952b1e62dfcca2184fa01c91dbca391316ab4fe439828f6d64e492e9a8bef3803a1c751bef087ac8b5d7d1011c7fea59e6292ac6df0b74461974d24b2fb1f204c7f919ecaead1fa1d908da0d3717375312966ece1fcc6fe2bfd97319f822f15a685dc14a810269069bb08565874089784f1ed81f07f0514405802066451af3b6a91fd1646b7cdc10db040b19bf40dfc314c1919f3d995784892a32189f538bf3aa9cadf318a9fe43c6c605dc59306e58107405f96e53182a5e8be97ebb5a045312d520baf2825b2030f6c56badff7a1d421e04a2ecfcac54e65a51751ae76734e7a9a7dfd1db57ab41649ba9ae03800695cb379ac5728b64c4ff40488a68afb0d22c542f7ebc528141edaf89f68c8a2279a38f2c8e40c306739289daaa22bc12024c8923e19992be8ed7da1ee88d747448e7fcc4c87ee539a2daeb8f6d121a59bf493cbacf1c6995dec38d045bbf7347f3934592264a5778b09a130b177c40c6b036b84c6cb7ba247f5993155dc1576f853e71ccc41a2c45a6e668614e7423cf21f64e57f02de442e73fa5882f5336ef39ae8b8e833e1365e047382e9faf11aac2eb3d1be652bceb90bb082e6da750f6357d5c3221ecff19968b9ff34ccd16871c62b45cdd63c124d693b870d9fd014dd4f0b51241c6b7d2c1fcae3d89216bf94cadcde12cc36a5ce85fc27b9d33f36ebf3f91fa7be4729b065a1b0627fbdbda03b9cdece521217d1f76e0c8cb514e398bd08aae54ccd001747f9ce9900a27221b69e47feaf28c49468c1f4374a9bccb04034b33d94e00fee5d640ce082c4db6fa9086b81d60079341bafb1c8ed40cfa97574f549bf3ea28f15270f7691bbb48cc25ec8f90c5b7e101dba005817a0ffea9fa0315eaa64e944017eead79642cbaecf104bd7cdc277ba4844887284a00cbc73ba060b84c4ec5c8e57f662603bb4f67a6c5c1aff55d60fd133722dcb48256512ae540a12144a0d946592f15816fd288313d6172b00104a5ffb08ad22f361df88ad370254da5fc5c683f5352f22e3c042e14ac29afb6a95ba24a3f03fceb589707f2d8b62d64b57b2cb9d9cd260ca3c0eee15e7e51f85e40adfe73e1b842aede4bc408fd3d18fbb9032dae9e864249d639e7bcd2b84a004e6de56deaf6f6d26bec746cda147c34da30259065ee50d6a5c5afffb2c41eceae5f9dd49a96ae08ce7967ea07bed8eae816d1147b5374484baec3623f417df4cd144f10dcbeb6d909a39aec3099a622e2bfd4bd89837cbbb42bedc276ae4d3bf0f61b3267ef3c7f329cd1564f60e2859b8abc8b1aa5cc5c6f11c66c1c313899b067bc318906a50a6bad83732e89287fae30fbce13e169a7d2be933451913187cf22f194b86a1d2b6fe0f7cdfcad422b6c91a8c2cd43b6e476aa80e9d4451cc8e85159cc0f0577449b4b46a5b37949edcff0545d4bd4007f74269f03ba95d1b461c58ba55a903de980641008ec02bd1453494a88af2c238bd0338bd131a92ae6de9ca943fd1eb7d46dfb6a0b303f93dd2a65d0ada9bf4620117ad24a577879666b7f92c60f2f901cac9032fa680644983b54ed4ef848b1e39da131c0fcf1d4d97b38b4244e41702c128f0009f671e78e19fbc24acc2cb516a0cf7036b1969d83beaa25de4dd55f746fa99f02abb44c5d8887a8eef405a8ebdb35ab1316ded667ae646bc90fbcb3851cfd2a46919811716fa9fa97cad771ab012eca383b329acd0d72e2c8b9fda2f0ac10ed1035ec6b32f2df1a321aa6559c65571f4cc86f1540802599e537663bc2fa54f94a8a8ed0c1240daf8f8c5e05943de968484558ab654c02d77defbbe0264c207b5e5cb48fd99b33a760abebfbd5251262eb8009495152badc2b189d4d59fc12a1ab315487b97d2cdb970a8801f2dd5d4d8a02cc0d7cf1847c11ab8d8fe717f1662c23a9d98b58c0330c3b7d27b984e5fee104460f5e1e4b1b25bda217e6e83b57ec3784a761330be5213b1b60a4f92274ab936430a88b49ec31145d37c980a0447fc1b896dfa33c1f98c7dd28a48892ee7fbc3f124f7d856bac4b0411582bd5f52b6a2b7dda51ca3f4d276af88d1e9546ed0e32cbc6ff3405023469ce9cf1f5b3df7d46f7ce4642ce8945cbb0b272ee700030e7fd9c60fb3cc3624de26b1f2612b7f21bd75c88318a2cd1e639af8e5cee1105d735379955b9a51fde704029d9429ed0ae77ea7e0ee04c36732b5d567be56d74214c6d2705d920067ed177fae477e1740eee51a40c88de787cc8aca1099e34a916d4207a8b2432d058a93232e25c1b3b379b61a5d9210d730439b16befaab6b39625785ca878b73420521f917dc4944e48e5819e99ec5925ea85f495fa06609c24a56a2d1840a8e2f8f9b5687282a718fb2dd8d0e4cde486083a6de8651ccb299507f2da424fdb11d7d8c22faecad1714bbf39bc11440ddddf7cbe22bcfc282dc51c91da17ad394db526c147a5dd74079fb6d323197fb9c669dbc8c7e81644c509a7067fe1b7712bbf7d6afcc32afbe9cf9076a61f7f05e7b81457137408c3c8282215f889d89f161734bbbb93a58651b4d236b6e082ee645b5b24fe4d47d07f1009444426aa7d8d2105d0d7a6b0f3f9cca70bf878983db3c22018c1b6216fc1ddf42e5b8338ef65d24ab67ede39b6390b1e40714fd6f1a78931b5b64e130848659799fa5fc8ff293d6139319304bb55bb67db7a9ed2f648988a9b624d986abb63664889ec144c333c5ede0ae2454da54f2449c3b238ebdf179a1045f19b881793e04ce56a5a63b0094a1034bb8ae746fcc1ef79097669beba94db884734d5b0c7cee19bac80d50c62f25ef870bc1f3bb2ccb8d63580b8e1d1217203ebf2a940f1decc122407a6861a4f1a0767df92b1f122faa4666d2a0e3963724f28202cfb661836ab1664df89422594d4d52d307d381185eb021a4393757c0addba555927edaf24d00dde6032389cb1c375febaffeeb5acaca99896ef760929fb6e88e7e4e7fd9225df61be1a970dc418374cec21d4caa4e92cb8bb4665f668ea6dc43738dd16f4277a3e2dd6a42d8cd6c1b4dcd8813a64fc8a8b07bbde8820075fc79ea42d96682d35b6c50d68bba81fad50cf59d2c131687bc13eb8a644d3aeadfddd5a4e9b993a4c3f31f856ad2bf5a9a75b50a333e72de845b9623ad775fe879030544adf0876382970aa90a7326186013e2fc38b98bf7480c0751552b55889aec816d6af6206d65f0169ab7aeda45e72f784f9149fa912b80d6e50bfcc359f540dcbe4b93746b4465ae6bdb7cc3a49ed74cdd85a726d590891b4b91d2ee79924cb80035db7639074d257fe51a661d2374484205c1edb3b0aad53341f9783f012d039cacdc44a08a3fab18549f564a27b866b9113947e95a0c96160dea48935bd5648bdc53b9c346bcb62f5d7aa67e7710a6264e047ce12e9720caa4e8e1d5497d17b62307134093ccd442711638f405815425cac0f6640a83543f584f367e03dee39321856251a5ff66607a82e538a54d57c9a7748ef5b6ffe5a49ed1db784c9244cf16ebd8ece611c088a52d64157643f5e98b7435f96b7ccb481b2fed61462477657bae69b88c3cbcc7e1689dcb0fad12b7cea847b631985255204667b86504fbbb47bc8c4c6434f0917e9acff699e86aa38d14ecef5a802085bcc9976143bdf5dbe2312ec31ef93ede52c06199b1ee05fc342435d4d3c8fc9658bcca74d00435b9cbeae5ba360a4994333454114c3d04c5c49de3d042335ec29caf88ba95a978887f81b8d1721394be16a9cb1a0a87cd677a937699d93d4cac7b98076848a1bce5adeed91ef80692dd670adfb4b5776de108d526e73cb5bfe4edc9b7c3a04369e668bbb9a386a60db234a98164f96a49c74c2c1103c4871da7f307a7c8a2b80931376aadf4cdc59aaf8f8d430019105d0a5e635347d05995fc27c54ddec18b947b813e063a899636ae18cbfe25bc836a61f966ee45f850c21154da045b477530132ff51d08d88be40b1230bfde63a905b59de98631698bd0e303e5af703a9ff070401b36fccfbf2404d7d6af736311e7c7f21be2e82d987e2dc13741c03b0ef39dfba955bd91fed85fbcc0311e819e6dd1e094adee87dcaeec2f7c664d8c8e0f48325901867cfc6a88cca57daba9748a6be8e2e02357d61baec0ce5d7e42fcc5b3a4f4f089eba62ee11120c5f6533c11cd1fce1614713fb30ca4d46fa025a37ae842df03b93a7540d7eea7e812db919542659321925b64982e4328c92419a5ca33f9517c3ea06a34a31b9c2a096e9f6021278e3ffd648ec7efff178bef9d1871f06bf9b4df1a7ca210306c81f5a1b2e5faa89432774954218e00164a5e1a80311fcf8a4b4da56bda18962132f03b2356898b244d18775a8e8b967567d10166196191e40469260f0180c103f3f6097e6a81ccf8a6dffd5e9943a7bed75d286bf35c10781585d9afe417eaf58660c1710e8bc3dfd32389f510351bb6acceff3621d8d012ba12b74c48a515a02d845ec7b92c2bd5932311d8ebcec428ae7a7cb31358959fd51c945a7aa8fff0db40b704f201634d1e37e54669ab824636d8ee61f69ed8c5f382444f76170cc22e51e8074ad28ed69bdd0c414ad1ccde594d49942440f5d645caad0d673e9a156012c348d9ebdd3e71d3ef7a2391417251e00a5698b52e206dcb3cd1bd43e15206182661d5f734986ccacea00062529f31a6faea68371f18d0d58941fe1021246f31ab1ebdb804451852a943521ac5eda8a52883cb73cff13a5af177d9b85270de8ceb5a0b36ed8592fbd9bbc56f680c1a353af6250b0e43d25854516f3000c659ff3c587b5b6abb4ddab5c07635c906f0ff0bd14e86c4c7b71838edd24993518555d796023c934080e11c31c936090def1db330a7d6d583ea883e8bdb3d976054feb24dde9cf9e0fbab7395a59c146f79644ad1f01801a500ad2ee21e4d21bb1de9157131b30c57e4d0e1173775b03600fc8af2ee3424d8897e16ed5d097d1d222fb092ec85b9daae2b534791f20689e4dbc2293c5e34072417487aaa0bb26e5fb41d91d6d4b3e0f64dfd333d20a32587cd65a10f7429e910c66d753ca90d2a8d30de0b61b4efa52ee6fac340122905dc81a7f089e1354332e7eafd169c84bd31f0ff511381a5e441ec140a04ae08646f7be7db4f8e2ed9dc69445673d4c9b7bec468ded49f0d3266b0079f2f961abb9087898d70f6fa74bf524a4508a3a4000f9bb495acb74405e49ffe697cfa69f96e835757aac02da289e3b9d08251373e626ac09bac6a61e2ee6ee5b1967a8f5ceb4a241f6a8c393917ffbe7f0bcdcc49fa7b3396dbaa45ca6fcf5b5e7f5c7ba664e1d0ddb08633d81f227ac565f4dff547a6980bd3e0dfda9f2c8a00b32e42c7019f922894c1c5e4c441bb39d569ec765de03a4eafdb026bed38a3736588baf5a18ebc3cd2159151a02372c122f34d40dd4811fc873511e6682fbed229ad54f502bc333585bcf8f72458c85c5a99723a4687ed14c201ac4f2aab7e340bfc5d4553697789c8be426e4db3f2bfca5976151f1b5e005fbc128623077b36abd7ec38067d20a3ef46af9c25c163e43b470a9426f1a4c7b6e0b9c2e25d6d94d2a689028aa6af8cffada78e85d78b307f44218e17c9312af53159c92476fda2595e81caa2bfb6a9534731179ae657c2d474c7c238a36d0f4dc21e5c35de8bcb6081e66e280eb93ab8beb0e62524627559f51764c50ae6e22ae4bbdbed779b4c0383c1c4ba23b9f69ce9a1addd425fc5952756b40160043705f7a29f1e61ffd45989cd256618f500207b29afec8aa222eecb2f3096c0d6da62b8025956a74db8a03480783efb606e290d1f34f274169bc79a8bc0e65a81812049f0a8ace1d836ca4f2abe8ebcc5896c6c7024cee6ea1a97324a9696f63ea725e96e7327c9406391fc60946ac081227479d61862cd2171a1473afd121ec457bb68dcd2e21ed275d21c3aee44967e74cd820454437c0f171c6ca69e92f1ebeb50db803418f15fbab190f9e7f23c394e1da0efc723fc559812233d0552779bbde041d85f66bead73a0600d1036fd4c56c96e64b2feeacc02c5aed5389ba4a48eb4199743f3167c2257457f3a8774908404f2ced536ded8c7e6bc49cc9d7baa961d1e99f87332ad104694206c6d8427c45a42c15178d0ff40feb6f575d137dd0173f54532a9d0ad7739232e22890169dc7a1b4899d579acfff2298e48e5d113e8f24a496121c9d8eda831d1342ed3fdda71abc8bbd2315ae6826c9c491d0a4af1576b3faee9bc8f7e795b710579085fe39d344e45f8463f8cb404abfe3ef6792fd903327e3fbe50f46e9c111cbe81db05e3f610a46d5a1e143bc0c7e93e29609d55e4d94519426ed27b4d096605c08c77126b80998e9a5fee07512fe043322445c88a2adc3561a0b9aa6573ff1a308ef0ec9d7fd99e4343a1592973d3ac378c7fb7a30532283513bc13568b84b7e413e65f2fa43a2c0088497813bfdc9b01323fc7cace03af4bfb593fdd7ba56f8c30cf06b6a13190c3cdcf5b3ab104f71d849039a060e58d2356c77f56463bf3052f6b730dc0a66848e3c13e2ba553db8348fb0e7dbc85436e32da4bc2f6e194511ee3813abb0d6755644ecbf04b651c03bd64ce305082fdb92a7c2de1ecd75aef401e6ccd4fd4a6761b44e4a070e0485039adc1e4818a2d93ce3fd6de2773ba318bd8aa02ad17e91df39870d56a40f848f5a7c2cc8d5c8885867248dc72ac48183cd934e058785100b9216e795a6128928bbc9adfb941937cbf4599b60eb96fce77d62b0db5047a44be09b11b962f6585ae7e80e93d4e5460ebcd8032a5bbdbdf0821ef2c4e15ffdb701366936100b46a02191700dee87e1a889db66ea9c175a3f13f59bfe8f897ddca59c7d1b6fc9a829741d8d2c53322b87b23812ca73491f6c2e27ba4914cbb3d03fe7a633a03293af0c76399aff04ba672283fc4e4e31bfe36163764f39cb71ed646b3e1b1fdf6aba8296a80358ee7b6c3275cba650baa69408742cf1341e1dfa55aab59fc55bf545af24d343b6740f0be5dc2b5b23c535786e78a0a90cc465ac079b189e1d278133045abd790c6e1f9636b42081daae39b34d46732f37a4836d11f04baa02a819b9185b5b319065a5a568b0b0145c3b2470da9784b98015f7b1e1a08ff1677915626d0eea5059e5f3e99f369f6a1e27b9ac4636dc1c31cfebb6a42e7aa0afa278397f5ad3a46463bc049581f23173ff821b81199c200c420110d45b8540a2a123bb08293a614a076e4b07e104c5a31a02e567007dc2b552084910a09d043837facefe3592085bb1c0ca1260c7c2e48e16d05c59f2c54c032611cc56863c13a798da72c4cf5c0a5030210a34e7be46e066d81670269cd9534687248ffbf1d6bfd6e771f7c902bad2f1f86c096023f2d25b7019ddf68149a6b8e9f43d0409a7cb3f76270d0988870e76a42498b2bc8c2289b7bb4169efbf08c0ed1d0ac5b199fd664222e5ea3bb8e33a180a0da8a5d332eee5c238a1e1d105f6761c0ab808fcef502116d4b064b1ab742bc1f5fba7d9a68a325e77bbfa268fc2713545904bb68e2fc855ec7b8fdc7a396a56bba0cbc7d68a34cdb9ce6157bba77cfd003eb38e2b90f7c0021b141b15790f1ae325e4c0d700e6da26f6ad0a6f9a321080b2a0a42d44c44a32022140b2a8b12e919c2c3e1f055bcec65ca3cdab7844a2466839a3a34e67f318697d063d5a6fdaa41bfae4826728b8e04c05f13d3fde4c8ba76a24ab6b75951c8936b020765885d8df254de60cb34baf2725865976c6940d77da2128ca6e753d9991351c88808d2073b80b91cd63da2f4bac01878bf6f7896e9b6b788e6de52cceae0f90ee916a55b1ff17b98f942648058ae68b48b175d8f4dda660aa3e133e619a721c29f9e1946a0ea88ac3ce2f9f95d13844e895f0a412e7fa8167260bb63ecfc949e9cf0a542a657451628bde593aa08e82fe23c9d903934f36d2c7ae2a72932e9af701524e0b5fe85f0088884446dcc2238005aac0259cfd32032f60348e3be99ed1b9318680d77af48ae05da4aece533044dc6d65af63a556e4a530a88f8cbff2ca9b18b9968ca2d7d2492797288ae67b10aff28a68db8ecf59134035453718ceb70afbf0baf8f35194371829aac109f6df56560c8f0a638717d9ce859ae70f0db67a46258feb31c5a4c4c816c1f5b53749dc230fb18423d0ae214cfe8a4d98f612835c373f8626496fefa8dcb1661b29b86e0bd2fa011de8bf52b453be29830255b04d4f9485f8b523553d2bbfa8fec6c30d39f2a2019bc4e13e915b9fa4d0392f7c7d06d83541bbc8e6e3d6f7b340789847c2dc3cc2b9bf5834af2924d8a56fa47808fcc8d248e878a15399eba6ad95fdfc3dc13abc3adf73a1aeb34f51e6bf424a0d7646fda493fe365bee961f54b283e4947bc66ec5b74179d48227be2df859a6cd7443544825e11c9d4c7bdea0a7cb9ee32926a039af7435d7a15d0f156f872e7c737ff4a0093e48657d8b6a2b16c1591322dec7aa571dfba42d5f59ba6eaef30e09b25ea5b79d01cf83a5bd4a474fc0b2b57dd4fd499bed9ed3d292eb</script>
  <div class="hbe hbe-content">
    <div class="hbe hbe-input hbe-input-xray">
      <input class="hbe hbe-input-field hbe-input-field-xray" type="password" id="hbePass">
      <label class="hbe hbe-input-label hbe-input-label-xray" for="hbePass">
        <span class="hbe hbe-input-label-content hbe-input-label-content-xray">Hey, password is required here.</span>
      </label>
      <svg class="hbe hbe-graphic hbe-graphic-xray" width="300%" height="100%" viewBox="0 0 1200 60" preserveAspectRatio="none">
        <path d="M0,56.5c0,0,298.666,0,399.333,0C448.336,56.5,513.994,46,597,46c77.327,0,135,10.5,200.999,10.5c95.996,0,402.001,0,402.001,0"></path>
        <path d="M0,2.5c0,0,298.666,0,399.333,0C448.336,2.5,513.994,13,597,13c77.327,0,135-10.5,200.999-10.5c95.996,0,402.001,0,402.001,0"></path>
      </svg>
    </div>
  </div>
</div>
<script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      <categories>
        <category>架构师笔记</category>
      </categories>
      <tags>
        <tag>设计模式</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux安装gitlab</title>
    <url>/gitlab/</url>
    <content><![CDATA[<h3 id="1-前言"><a class="markdownIt-Anchor" href="#1-前言"></a> 1. 前言</h3>
<p>以前在自己服务器使用的是Gitblit,官网地址：<a href="http://gitblit.github.io/gitblit">http://gitblit.github.io/gitblit</a>,  这个只需要在服务器上启动一个tomcat,然后将下载的Gitblit的war包放置在tomcat容器里面运行即可访问。</p>
<p>但是由于gitblit没有CI/CD的功能，于是自己就在网上找了一些博客搭建gitblit，在这里记录一下搭建的过程。</p>
<h3 id="2-安装步骤"><a class="markdownIt-Anchor" href="#2-安装步骤"></a> 2. 安装步骤</h3>
<ol>
<li>
<p>配置yum源</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /etc/yum.repos.d/gitlab-ce.repo</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>增加一下配置</p>
 <figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">[gitlab-ce]</span></span><br><span class="line"><span class="attr">name</span>=<span class="string">Gitlab CE Repository</span></span><br><span class="line"><span class="attr">baseurl</span>=<span class="string">https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el$releasever/</span></span><br><span class="line"><span class="attr">gpgcheck</span>=<span class="string">0</span></span><br><span class="line"><span class="attr">enabled</span>=<span class="string">1</span></span><br></pre></td></tr></table></figure>
<p><img src="/gitlab/1.png" alt></p>
</li>
<li>
<p>更新本地yum缓存</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum makecache</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>安装GitLab社区版</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install gitlab-ce                    #自动安装最新版本</span><br><span class="line">   </span><br><span class="line">sudo yum install gitlab-ce-x.x.x         #安装指定版本</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>更改默认端口配置(默认为80端口)</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo vim /etc/gitlab/gitlab.rb</span><br></pre></td></tr></table></figure>
<p>修改如下配置：</p>
 <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">external_url &#x27;http://ip:8888&#x27;              #填写自己的主机ip</span><br><span class="line">puma[&#x27;port&#x27;] = 8888                       #如果gitlab是13版本之前请求修改  union[&#x27;port&#x27;]=8888</span><br><span class="line">nginx[&#x27;listen_port&#x27;] = 8888</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>配置gitlab-http.conf</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo vim /var/opt/gitlab/nginx/conf/gitlab-http.conf</span><br></pre></td></tr></table></figure>
<p>修改如下：</p>
 <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen *:8888;                   #和上面保持一致</span><br><span class="line">    server_name ip                   #填写自己的ip</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>放开端口</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">开放8888端口</span></span><br><span class="line">sudo firewall-cmd --add-port=8888/tcp --permanent</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">重新加载防火墙</span></span><br><span class="line">sudo firewall-cmd --reload</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>修改配置后重新加载配置文件</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo gitlab-ctl reconfigure</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>重新gitlab</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo gitlab-ctl restart</span><br></pre></td></tr></table></figure>
<p><img src="/gitlab/2.png" alt="启动gitlab"></p>
</li>
<li>
<p>修改管理员登录密码</p>
<ul>
<li>进入gitlab-rails控制台  <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo gitlab-rails console</span><br></pre></td></tr></table></figure>
</li>
<li>查找root账号(默认只有一个root用户)  <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">u=User.where(id:1).first</span><br></pre></td></tr></table></figure>
</li>
<li>修改密码<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">u.password=&#x27;xiaoyuge123&#x27;</span><br></pre></td></tr></table></figure>
</li>
<li>再次确认密码<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">u.password_confirmation=&#x27;xiaoyuge123&#x27;</span><br></pre></td></tr></table></figure>
</li>
<li>保存  <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">u.save!</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li>
<p>浏览器访问：<a href="http://ip:8888">http://ip:8888</a><br>
<img src="/gitlab/3.png" alt="gitlab登录界面"><br>
至此，Gitlab搭建完毕！</p>
</li>
</ol>
<h3 id="3-gitlab常用命令"><a class="markdownIt-Anchor" href="#3-gitlab常用命令"></a> 3. GitLab常用命令</h3>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo gitlab-ctl start    # 启动所有 gitlab 组件；</span><br><span class="line">sudo gitlab-ctl stop        # 停止所有 gitlab 组件；</span><br><span class="line">sudo gitlab-ctl restart        # 重启所有 gitlab 组件；</span><br><span class="line">sudo gitlab-ctl status        # 查看服务状态；</span><br><span class="line">sudo gitlab-ctl reconfigure        # 启动服务；</span><br><span class="line">sudo vim /etc/gitlab/gitlab.rb        # 修改默认的配置文件；</span><br><span class="line">gitlab-rake gitlab:check SANITIZE=true --trace    # 检查gitlab；</span><br><span class="line">sudo gitlab-ctl tail        # 查看日志；</span><br><span class="line">gitlab-ctl show-config           #查看gitlab配置信息</span><br></pre></td></tr></table></figure>
<h3 id="4-邮件配置"><a class="markdownIt-Anchor" href="#4-邮件配置"></a> 4. 邮件配置</h3>
<ol>
<li>
<p>修改配置</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo vim /etc/gitlab/gitlab.rb</span><br></pre></td></tr></table></figure>
<p>新增以下内容</p>
 <figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">gitlab_rails[&#x27;smtp_enable&#x27;]</span> = <span class="string">true</span></span><br><span class="line"><span class="meta">gitlab_rails[&#x27;smtp_address&#x27;]</span> = <span class="string">&quot;mail.midea.com&quot;</span></span><br><span class="line"><span class="meta">gitlab_rails[&#x27;smtp_port&#x27;]</span> = <span class="string">994</span></span><br><span class="line"><span class="meta">gitlab_rails[&#x27;smtp_user_name&#x27;]</span> = <span class="string">&quot;发信邮箱&quot;</span></span><br><span class="line"><span class="meta">gitlab_rails[&#x27;smtp_password&#x27;]</span> = <span class="string">&quot;发信邮箱密码&quot;</span></span><br><span class="line"><span class="meta">gitlab_rails[&#x27;smtp_domain&#x27;]</span> = <span class="string">&quot;xxx.com&quot;</span></span><br><span class="line"><span class="meta">gitlab_rails[&#x27;smtp_authentication&#x27;]</span> = <span class="string">&quot;login&quot;</span></span><br><span class="line"><span class="meta">gitlab_rails[&#x27;smtp_enable_starttls_auto&#x27;]</span> = <span class="string">true</span></span><br><span class="line"><span class="meta">gitlab_rails[&#x27;smtp_tls&#x27;]</span> = <span class="string">true</span></span><br><span class="line"><span class="meta">user[&#x27;git_user_email&#x27;]</span> = <span class="string">&quot;发信邮箱&quot;</span></span><br><span class="line"><span class="meta">gitlab_rails[&#x27;gitlab_email_from&#x27;]</span> = <span class="string">&#x27;发信邮箱&#x27;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>测试邮件配置是否生效</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">重新加载配置文件</span></span><br><span class="line">sudo gitlab-ctl reconfigure</span><br><span class="line">   </span><br><span class="line"><span class="meta">#</span><span class="bash">查看console</span></span><br><span class="line">sudo gitlab-rails console</span><br></pre></td></tr></table></figure>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">Ruby: ruby 2.7.2p137 (2020-10-01 revision 5445e04352) [x86_64-linux]</span><br><span class="line">GitLab: 13.7.1 (c97c8073a0e) FOSS</span><br><span class="line">GitLab Shell: 13.14.0</span><br><span class="line">PostgreSQL: 12.4</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">Loading production environment (Rails 6.0.3.3)</span><br><span class="line">irb(main):001:0&gt; Notify.test_email(&#x27;xxxx@midea.com&#x27;,&#x27;test&#x27;,&#x27;test&#x27;).deliver_now</span><br><span class="line"><span class="meta">Notify#</span><span class="bash">test_email: processed outbound mail <span class="keyword">in</span> 1.4ms</span></span><br><span class="line">Delivered mail 5ff2cb5082e2b_e45eb53d484754@devops.mail (673.8ms)</span><br><span class="line">Date: Mon, 04 Jan 2021 08:01:20 +0000</span><br><span class="line">From: GitLab &lt;xxx@midea.com&gt;</span><br><span class="line">Reply-To: GitLab &lt;noreply@ip&gt;</span><br><span class="line">To: xxxx@midea.com</span><br><span class="line">Message-ID: &lt;5ff2cb5082e2b_e45eb53d484754@devops.mail&gt;</span><br><span class="line">Subject: test</span><br><span class="line">Mime-Version: 1.0</span><br><span class="line">Content-Type: text/html;</span><br><span class="line">charset=UTF-8</span><br><span class="line">Content-Transfer-Encoding: 7bit</span><br><span class="line">Auto-Submitted: auto-generated</span><br><span class="line">X-Auto-Response-Suppress: All</span><br><span class="line">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.0 Transitional//EN&quot; &quot;http://www.w3.org/TR/REC-html40/loose.dtd&quot;&gt;</span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;p&gt;test&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;</span><br><span class="line">=&gt; #&lt;Mail::Message:199260, Multipart: false, Headers: &lt;Date: Mon, 04 Jan 2021 08:01:20 +0000&gt;, &lt;From: GitLab &lt;xxx@midea.com&gt;&gt;, &lt;Reply-To: GitLab &lt;noreply@ip&gt;&gt;, &lt;To: xxxx@midea.com&gt;, &lt;Message-ID: &lt;5ff2cb5082e2b_e45eb53d484754@devops.mail&gt;&gt;, &lt;Subject: test&gt;, &lt;Mime-Version: 1.0&gt;, &lt;Content-Type: text/html; charset=UTF-8&gt;, &lt;Content-Transfer-Encoding: 7bit&gt;, &lt;Auto-Submitted: auto-generated&gt;, &lt;X-Auto-Response-Suppress: All&gt;&gt;</span><br><span class="line">出现以上信息说明配置成功。</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="5-性能调优"><a class="markdownIt-Anchor" href="#5-性能调优"></a> 5. 性能调优</h3>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo vim /etc/gitlab/gitlab.rb</span><br></pre></td></tr></table></figure>
<p>新增以下内容并保存退出：</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">unicorn[&#x27;worker_processes&#x27;]</span> = <span class="string">2                         #官方建议值为CPU核数+1（服务器只部署gitLab的情况下），可提高服务器响应速度，此参数最小值为2，设为1服务器可能卡死</span></span><br><span class="line"><span class="meta">unicorn[&#x27;work_timeout&#x27;]</span> = <span class="string">60                            #设置超时时间</span></span><br><span class="line"><span class="meta">unicorn[&#x27;worker_memory_limit_min&#x27;]</span> = <span class="string">&quot;200 * 1 &lt;&lt; 20&quot;    #减少最小内存</span></span><br><span class="line"><span class="meta">unicorn[&#x27;worker_memory_limit_max&#x27;]</span> = <span class="string">&quot;300 * 1 &lt;&lt; 20&quot;    #减少最大内存</span></span><br><span class="line"><span class="meta">postgresql[&#x27;shared_buffers&#x27;]</span> = <span class="string">&quot;128MB&quot;                  #减少数据库缓存</span></span><br><span class="line"><span class="meta">postgresql[&#x27;max_worker_processes&#x27;]</span> = <span class="string">6                  #减少数据库并发数</span></span><br><span class="line"><span class="meta">sidekiq[&#x27;concurrency&#x27;]</span> = <span class="string">15                             #减少sidekiq并发数</span></span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">每次修改了配置，都需要重新加载</span></span><br><span class="line">sudo gitlab-ctl reconfigure</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">重启</span></span><br><span class="line">sudo gitlab-ctl restart</span><br></pre></td></tr></table></figure>
<h3 id="6-gitlab使用"><a class="markdownIt-Anchor" href="#6-gitlab使用"></a> 6. GitLab使用</h3>
<h4 id="61-创建project"><a class="markdownIt-Anchor" href="#61-创建project"></a> 6.1 创建Project</h4>
<ol>
<li>
<p>安装Git工具</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install git</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>生成密钥文件：使用ssh-keygen生成密钥文件 .ssh/id_rsa.pub</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ssh-keygen</span><br></pre></td></tr></table></figure>
<p><img src="/gitlab/4.png" alt="生成密钥"><br>
<img src="/gitlab/5.png" alt="密钥"></p>
</li>
<li>
<p>在Gitlab上创建一个project<br>
<img src="/gitlab/6.png" alt="新建project"><br>
<img src="/gitlab/7.png" alt="新建project"></p>
</li>
<li>
<p>添加ssh key导入步骤2中生成的密钥文件内容<br>
<img src="/gitlab/8.png" alt="导入密钥文件"><br>
<img src="/gitlab/9.png" alt="导入密钥文件"><br>
ssh key添加完成：<br>
<img src="/gitlab/10.png" alt="导入密钥文件"></p>
</li>
</ol>
<h4 id="62-配置git"><a class="markdownIt-Anchor" href="#62-配置git"></a> 6.2 配置git</h4>
<ol>
<li>
<p>配置Git仓库人员</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git config --global user.name &quot;xiaoyuge&quot;</span><br></pre></td></tr></table></figure>
<ul>
<li>local（默认，高级优先）：只影响本地仓库</li>
<li>global(中优先级)：只影响所有当前用户的git仓库</li>
<li>system（低优先级）：影响到全系统的git仓库</li>
</ul>
</li>
<li>
<p>配置Git仓库人员email</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git config --global user.email &quot;xiaoyuge0318@qq.com&quot;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>克隆项目</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git clone git@fase11h12dsa24fdv3Q:root/test.git</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="63-git常用命令"><a class="markdownIt-Anchor" href="#63-git常用命令"></a> 6.3 git常用命令</h4>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">查看某个命令文档</span></span><br><span class="line">git help &lt;command&gt;</span><br><span class="line">git &lt;command&gt; -h</span><br><span class="line">git &lt;command&gt; --help</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">初始化仓库</span></span><br><span class="line">git init </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">添加文件内容到暂存区（同时文件被跟踪）</span></span><br><span class="line">git add</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">添加所有文件</span></span><br><span class="line">git add .</span><br><span class="line">	</span><br><span class="line">git rm --cached    				        #仅从暂存区删除</span><br><span class="line">git rm 							#从暂存区与工作目录同时删除</span><br><span class="line">git rm $(git ls-files --deleted)		        #删除所有被跟踪，但是在工作目录被删除的文件</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">git -commit -m &#x27;first commit&#x27; 			        #从暂存区提交 -m：注释</span><br><span class="line">git commit -a -m &#x27;full commit&#x27;			        #从工作区提交</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">git log    						#查看提交历史记录</span><br><span class="line"></span><br><span class="line">git log --online</span><br><span class="line">git log --color --graph</span><br><span class="line"></span><br><span class="line">git diff 						#工作区与暂存区的差异</span><br><span class="line">git diff  --cached [&lt;reference&gt;]                        #暂存区与某次提交的差异，默认为HEAD</span><br><span class="line">git diff  [&lt;reference&gt;]  				#工作区与某次提交的差异，默认为HEAD</span><br><span class="line"></span><br><span class="line">git checkout -- &lt;file&gt;  			        #将文件内容从暂存区复制到工作目录</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">撤销暂存区内容</span></span><br><span class="line">git reset HEAD &lt;file&gt;  				        #将文件内容从上次提交复制到缓存区</span><br><span class="line">git checkout HEAD -- &lt;file&gt; 			        #将内容从上次提交复制到工作目录</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">对状态的跟踪:git中有两个状态：内容状态和文件状态，</span></span><br><span class="line"><span class="meta">#</span><span class="bash">内容状态标示内容文件的改变，有三个区域：工作目录，暂存区和提交区</span></span><br><span class="line"><span class="meta">#</span><span class="bash">文件状态有两个状态：已跟踪和未跟踪</span></span><br><span class="line">git status</span><br></pre></td></tr></table></figure>
<p><img src="/gitlab/11.png" alt="git status"></p>
<p>分支操作：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git branch &lt;branchName&gt; 				#创建一个分支</span><br><span class="line">git branch -d &lt;branchName&gt; 			        #删除一个分支</span><br><span class="line">git branch -v 			                        #显示所有分支信息</span><br><span class="line"></span><br><span class="line">git checkout &lt;branchName&gt; 			       #通过移动HEAD检出版本，可用于切换分支</span><br><span class="line">git checkout -b &lt;branchName&gt; 			       #创件一个分支并切换</span><br><span class="line">git checkout &lt;reference&gt; 			       #将其移动到一个引用</span><br><span class="line">git checkout - 			                       #恢复到上一个分支</span><br><span class="line"></span><br><span class="line">git reset   			                       #将当前分支回退到历史某个版本</span><br><span class="line">git reset --mixed &lt;commit&gt; 			       #(默认)</span><br><span class="line">git reset --soft&lt;commit&gt; </span><br><span class="line">git reset --hard &lt;commit&gt;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="7-常见问题"><a class="markdownIt-Anchor" href="#7-常见问题"></a> 7. 常见问题</h3>
<ol>
<li>
<p>gitlab本身采用gitlab.example.com:80端口，如安装前服务器有启用80，安装完访问会报错。需更改gitlab的默认端口。<br>
修改vim /etc/gitlab/gitlab.rb：external_url '<a href="http://localhost:8888">http://localhost:8888</a></p>
<p>如果就想用80端口，那没问题。如果更改了端口，后边可以自行调整nginx配置文件进行nginx反向代理设置。</p>
</li>
<li>
<p>日志位置：/var/log/gitlab 可以进去查看访问日志以及报错日志等，供访问查看以及异常排查。</p>
</li>
<li>
<p>gitlab内存消耗过大，频繁出现502：  <a href="http://www.360doc.com/content/22/0130/08/65839659_1015422932.shtml">http://www.360doc.com/content/22/0130/08/65839659_1015422932.shtml</a></p>
<p>gitlab-ctl tail #查看所有日志</p>
<p>gitlab-ctl tail nginx/gitlab_access.log #查看nginx访问日</p>
</li>
</ol>
<p>参考博客：<a href="https://blog.csdn.net/yzd524850313/article/details/113118193">https://blog.csdn.net/yzd524850313/article/details/113118193</a><br>
参考博客：<a href="https://zhuanlan.zhihu.com/p/338882906">https://zhuanlan.zhihu.com/p/338882906</a></p>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>gitlab</tag>
      </tags>
  </entry>
  <entry>
    <title>jstack命令</title>
    <url>/jstack/</url>
    <content><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="Oh, these decrypted content cannot be verified, but you can still have a look.">
  <script id="hbeData" type="hbeData" data-hmacdigest="25a456382087122b9b26d069cacc63a0a2dcfef1a7907a4edb1c7169340e2b85">91b4a72afde41933824d9b47e790ab276fb896cf66d88c172d81884618061a3a14d23f48e34794c2d5b9ca2bf97b3726902bf2336847b101af8c7e8261e6d67c8e59d628adedb667973c60ec37bbc2cdffb7f8d04b3d1d825bd3062cf82a274973ed1c7371f43108214c93039f7e4e274a4d1bd8439d65757dddfb63e6e47dae1eb5efda77db30a6ee62afb664570b18ee9e13306ed0a869affc86ecd40359b4e43d4a167144f5f84422ada232fa83dfb0bb3baf9d7827480c5564e4bdd6a0a6d891786bba2b3ae02b3be67194b4d12bb200929093710ef95ddff0c4c667c31faa7a28a726229f38a47b581219e641bef4778689f73337138719f9cb5ef3d57540090d92ff58edbe88654368eae5e9374d0b127e1613f1135c53d01218872af043c24a97573e478fdcfe3b6ed62468f333566bbafc43b29e0b9e8a7270aa0ee58f5ffb149c506bd20107336be72ece09866e971181e7c8e56cb609cb90ea996e2435ebc86dc511361deea1d2a6f93068aab54876e73a0ea016893fa299d5acfa250f3d8d4678dc50b8a378624296d1ae412d0c9d9f3f94963d6aa019691cee807d39da07495a3fddc51823db3a3f3231de789a10e8abd5041dfa10c6bccb62d74cf08a1026d708eb191fa7a872cb748ee8992f8a632ef4c6ae62c5e558fe736bda5a3102cb402f3e0d92b22f160ce937012a08fa530045d4c63855c419f65140c51803ccbbf84e43e99c88cc00342d0557535cea96f96849f4d6090ffad94be900038621ae4b75f5454859cfce4bb54dbb87bfbc30cf5b5b8a611f81f8104636f201ec5e246d362a4ab1ea9f10cab04b8473cb358a40ce6d12f9a3ca218c3339c523a7139a645f1719b7e793779899d8e1550ef6b48bdc857241a3d67c3300c2448f01cfce4f95971dff92dafb5e255ec61861103f718fb359adc52e6cce69258ea19c05c098c3112683ebc2b4e4fa518957d7f70eec5b8847ce7ba9a366fabc857a0355b6aec656b869a586c464ae33d495921d8061895c33bedfebd8951e169ed13484938d65cf50b86c55ef30115c59ece740b53ea93a08a8ac3af003251e7a30cd03f5794d09137b7fa2603cee591e56c96f42ce27ee777b47d3a5578df44892a1d64d2454fcd1b989e65d96484069205de39abadb7b69883e21c601e4e70a95a269a9d60735b9908c2bd3fe2c502f8aa5368ce84614e9b67e68a242a760d867ef15051e6c19fb2b3d5486da91f4b64293eb63f0268a7513a64778974d1d5385ddddb3fa3fd4619f1ceabbba16eb48662f4d62df3e04a23d68bbad838ae50b85f48d5a5ffb9789928a98d6a6d7812af67896507c095d62715b3652191bad60e06f2b8bb67985fbc253e70ae3f414077988262e64dbc57215c43b1baef7972fd48e3d3de094bd391960c12e5ec1866e69f4c0d142d08cc433fb52e9247cf6005020a7165bd3d48dc4cfeaf77263bfe606ac97219a60e43f4d83000a11c618e806149779332d12ca7f580b9143556c95c0154f2f083cde62fc811030941dd3069948b6bc118e2c45840f71ce99f71db6919433b63740f250cf540a050303e69cb5a00a11fb2d19e0309964c56c8b12f4184c5feadd39e01a0a19f4cc46056b6b6d4dff774de6bc10e991366ef02d0725b9a622023143567ead0e853cfb22d49c4d8d04716889ab0eb45ebddd2a8188dac09c75f899388eb9d9cccc655c8842d3c6b7a1f4ecc4565ec7db3529534affc3296775a1cd59f7bb8bcda92e0ee3ce5ed2fce7e3d3cca7b1aa949c6c5a087e2b36f6b040f284c7c0701376b21b8a0601b3b012ee02147756489a4496ae34762a8eef5b6df084b7bdd909923bc31165dfe9422bf7a8400e0235db291355caa8989e3c0d2043f4b27bb18ad98249dd57872fc8c8f7844a97a2b0e148cb91e045a86b24b6ea9dd6563cea3fa99b928c85afa306bb7e7cbd96a4cf91787d2274755a8ce0bbede5c19b7a9be154f09f3b5453b23a9f00a64c7a51124da6c8121d87959ad347beb4fb9112051b85a54f9024a4f0037fa2a967ea9b168b9a1c4ca4c5c4b08a81c0824b650b43466370de4146f8f06faef537b71fbf578443b026ff70b5fed2ded6a8235a1c24154c74bdf73dc42b184b0765cc580a4c71fad43daa00c28f89090e34503383cb5945757cd1de4a45d5df5a7e659064348bf2519df11e539d77f11dc3aa312017cb8329e2ca6c8c8e9653f895f23940881ef0c449a1989e43c6825bdcd7618e09ce835df9de44e37cdf05bb9ff89412d50eb21e7aadc7fbd7d72226894a4dcfc5a051932f3e99c638d7054f076b4f3845fbc70ed7ce035779fabab9f225b9d5accb12e4cfa42eabefdda8208ed22f63bb8e95b7a931d0448c3ee210d861c16da1dc2c5762ecbe150e258acedf0563ce48e731629f6d4073f076293492b9fa64085df4d124a051eab22049b31f0447e5ccf308bbf505cef48dcf185974b44a52ac249ff29642bc2228bf0fd9b3e66030fe8d3cb4111684ae48cbe2074dd43105b32e490373f135f7c676fd448ac6c19b25ac47d2cc6a2b22b1d441354af61b49793a99798f9f982d842b908207c1294faefa39bee084a39a8e4bb35e16a92a74c2fdc704d7cd6a502c3715d613606e4c3e214f8a18983387f9e44ccb0d261d5bb09aabef8d37f40b949cc83eb34dd354b246f3c7b77537623c36a5ba0cb8dade334ad0e57fdda825eaf61191d4d4ed74ffbe3e925acc74db46fb66aae1f346684a1e018fb0789249c8af94d6aa431ba984748a1b5870e020d566a75db08bde6cdbe415723eac1f12896a4f42fbbd8dfec007021e36adbdad784b5ff78f2c26d51c53dcb2ce123e164490a6155572fe552bd3290d5a88b2290241ec41790172ce2d1a62cedea220ea4232da57240d6113452a723047ffceb89dfeccb90c3926d3809071896be19b26216756b5a9ceb495bc984b19f2b6319b0749c99be6f1d963134ad9947731916b385d927fda18c42a60630ac4f1cb93f30362b795eb3bcbf8187147d237152bf3b15b2ba6e616607b1459337b5cb6ddcb83ac6aaf3b3ac14f6c29d99f6e390eaca7830fcf6b65ad2b4103b025b15e1a628cc2cfb094fc0fa7d79cbc2f3005c5c87cfa105e19e7843cc396874f500f8bb40df8d027c7327efc58e83fcb23c394efe183ba34011cc60e9c8ace73aeb9cb53bcfd69d839f5eea3df9af68c37eacdd686eb101aee0b2000257fae59d3f68884773bae26f91327ab3d50405b84676ac8eb77d42d298e5b94c40aa7d393e22965a422f01e5bed4b4e10562536f9d8ef4b33502ce5fe63ec85a4b9cc57c8211c91fb6c428587313ac541b5a899819636a4db0f860426d2eca1df8991f6eb2f8a0373f121367c60e9125a5938d361276777f4ec0c0ba590801faf32b06355012096a1a5f4cebf3929bfafbc5d3a96b58ca3eaeeaa97fd94102de9c7e972d2c415c6d510ce6db8a6b61c8c10234985cb2d915d9e14b8d9c8af011935b3f1d5dba48ee848fca7ad43da73d51b41bf848460a7cd483950ce7198605bfb89d4189782acc117ba94ebab3a068d760fde6a333a5de4ccf06d82834fef4662ae01fca2c0012e0c8ab853bcba6c188388acc7a1fd4c18eaf409df6f457c5bed5e543c34d4637186b4ce37755da149850d4ec2693c2d0c4163dc03b1aa77d7f38078716dded1ae00c4b4ff56fd4ce8d04e30a822b3ea06cc639bc5d48d784b8c54ef970461f07eab3fc44d1f84e2d48da6d2c6f15a4f3d2b8d340bb802fefbef50e05f190272b5af4a968c1f771ff3751dd8058b9f975fbccfc3dc5acfc4fbc62c6489cd5ce1bd56270d069148db48e5788f3ce96b9829eea0d86a4aa0f2e0c3663fa6fd3ceebf6a38700e1857fcf6d048cf2faa2bf9e398008e143baa51c4b7af6ebaa8548e19835ecb8fdc3f0c794136b72c8c7b97aaa139c9bfee4c65b313a0f1265ab29bf6b4e7df859e58870191e5075305ad662b871839239d52e29f2997c3cfb01c1fd8d9c793fd1ec33a60227e5a11ff2ad13765535f63ab7dd9351e1deb3c116ccb6f1ff5339e5301981ac4443a3308aab97cf3fda6d389cdd23a8745b61264f0ff00bd90164a094f5f306c9e06a4c04b743c68a9f7f045bb9c96a1521bd4de22d6ad01db55522dd3efa81845072309fb01f596a739149b965c39e8b6c4552812932ae20bd966b9bba24ad91863e7e77bce203ec4f9bd3e603bf2456c70f001a0de72e9b62e1377fe42f8b359ff37d0c7b03b53b04c4102168990f01b7442fb3b16199fbbe1ba699a60c78aa90d9d5eeb03b54d59b75b63fc13777a64046f43f08094c1ed09315ae9561723ec35ea3a134002c4984fbe30f2019df2139cff90f64799aec8f5611d0c486b6230002aebd52ec7abab027530b9e98e43324e90a846b48db66d48e0558a6fd945d7f0f9896068e3c35cc0e872e39c33958eed85c524802fe4be689ff686d2211df1cf50bb820130930ce2f348984489599bb1d739ea0bd4d4e9b60a16072dd63f0729afc5cf88a9c50b3310b37db9c5e4eafb5b738f8c38b214602c9eb7a2c0b7bc04c0a35474773ca70a49996e0269c408d2c7e38d300e8a1dfa669f2f331b805aada608c8945ce1160afa505b541dde1e4695dbcdffcb5bc9cda96cff865866e8625de925476b5642fa79d1d3e607e44807eb0de1242d9cee1d05dc8638725f1580918e4c8904e3fbee091dabbdafc958464cf2db0120211f289a7195855d842fa07d4d401ffe329856a13545a7d4d1dcc363c57e120fd7e25a440cef764df1178992deb7eb46ea60174fecb75d884596ccd5288808c19ea7c9062c7039c5ffe6e641b382644a0646083a59f9b4aeffd95cd8a315feda3b16b7f264d9121758643f614c8c4c8f51de8e2b56789102fd08592fed5aa71081729def4d85ba384ec87ae6e9f496d5f1654a30e8cd22d40ad759e00f7dfc44d3d3c1e22216cb26a7add4a9afffbf86cf070eb531602e50b7deaba695167dfeae53963d8c683330cdafb6d3964a26e708e78627f9d194abcd457c9b1ebe26afd006bec323cd929a448bbf1d3fc5ace11ac3e7bcf87f3f980235e41b9f65189240445d18af288b10445b965fc517f6502d33f6ec7a426960de6d62281040fd8a4fd6407533d78eb2250a442d220598d1f3cb0b95e7c4c7b7d6ddbfc6bf0148d3fc6bbe061ec8eca5badfdea6a39e7f1d61439b56abb798ca5cec73833435d08823c81aae10b30140369115e0ded0f602bcc27cd6109bf8bd0920106febf2be3707bd44bd4288b90bf3322bebaf81513704aef8c2f60aa73d6f1de7fe8cd44aae22a3c8672c2ac372ce8a6d206a7470407db72b31a3f2d39498713872b7f4ae4f1139d437d2ff11281052feef99d53f69d444d690ec4029de2eca66b10dc97f32d47f4858ec4af3c3f280094f96fabf52a6dba0757de620d0d8b0fdfd913002fa03f7af27486f0043d5e831192556046b8b25571f332a3696101ec08f585edeb1161282755b4c3d9382922df26a8c870cb3ba4dc1c25ba1c52186e5f992ac3afdeaebb52a234e48f8a0a2e11b03ec8c56202b16282adc0b97241ad6a982b9610b919f2271b2f4de7dc67adb86a9c08cdf2658cf1bae83bd70f0217cd1ac2c211cee4b28d24338ac0e0e7ccabe4efb8ef22f056a0681e7c99c4ef274132c37137487623a90215afec9bd5b86a201544426c5fb3be1704f932b6c1435d1bec5334653945abdb1041283bcf1a3218390aed47463484e67b82382754501edbbb301e4166a012ea86476c466dccab322463ce8c4dfa18b21f53b467681fc4220a0c6314d412217bf52c2f9df379763eb44ed7c34776d6f2e36d03303b2571662b6243ecdc8bd2205ea0a4c0ca95faea7c8d2976ab499c9e35802f61af8f4e228e50094dfb0d6349a52a8f0ebdb257c8d74a71993b562f740c9867540c65c3c6e125e2560c169cbf1d457c743074aac1bf7ace9d741dead5f3d6220a9639c24bc3903c997d19545d312e7bab1d99d0a4c222776b99d5173fd5cd2735c86c597525f4c71278481a0d442b70eb5a9bd48fa6f18d640564b6bda13701554e1f93e99e37495e96a66566829bb0089ff1f0b1e5bfa7e8e6a0d900e60389993a755c2ac0936b7e817d87f1c9840a0e8712fee0a0e1e4a1a081cdc702dde6cc4b8bac70b271b43fe0810d6115fe9fb6c44ded726c594c20552e2121925621999a381bad83243958fc00e4634b438d0dc57c045e13540eaf47e46eb4f4660189471417e18f7b170398a1e250912c60f35c1084fa3f9e1aded45aaab275f991af848aea54718ef6ff4a654f2f269b01eef7f10c704f3b6e66500988789d23daed260642a5036ece9e75c61f32579d8529113aad35977060473a8b135221204b13c5a3383e5ef5ccc5a03ad2d52631ec68fba5cafeedcf334f5240e8f03e016036a9956876d3676ae66b508f5e851a6a576ef9c72c5f202a70926af90c09d4b4eda73e58efd224544d2648face1ec6d85cc4f2af346533d817deb6e476cc55b400eacd80f5b67da7437c4cf59c3cc47eae44d1648ced1f59a973883a5e10309b090300da0aca8b6638340ac3cf88b1a3bc1849d3bbb3f51859c318a5761cbe35746659fb8ad955ec5af92354e9bdf4e349e890bf65bdb786d9a7fb6d442cf38dfae2dc9639dab48064f8cb8e30d503207e55d47f87534da93ad6a685b4b65f865d4521dc0bd8d55c418db23c46e263eefb594ac3dfce5bb6880f26aeb82d7c7f27c6730a80cfb37a6b059397c1232f71a24393e1683d9ddf3976c0d2992b6ad31b8fe7aef4b058970bf00e430edc084a3ff877abae7abe5394877e7c140c4c423839c250ff65be2423030c217e6d12eb3766d362555743b38a6da23e78daf343d267a810effea271feb8549916d6cf52886056c7b06977a29d462850e9edfa09f38e4b22b409bfd3855d7cd5e32f20069c1aa90f94c491dfd7c2859f7e7617b52867fa66fe4341ff70a40f6f1e75b8a449ac3fa369d4f00737fc6997819193a66cb1a26f05fd27668592fb3fb20738414497a6cd3eeb976738efcfd18c6ca717324d651b64f6f2fab015513057e861a4812560b496e3e9d6a8a13cdf6e0782e570a762c5c3c3bc1a243215df38cc5075766807aa162f1a17ddac1f2c1d7cb1136d1a0a6c5c0a5174960501ae1fd494839b150b51e4ddaad73aeaaf274fa53744a0e9ddd30ab56259e5bb629cfb234dab68915191cb7271a23d95a19cc95e5ddb36f846e2d761eeb4451615f514ebde0d9ea495b7dc58b94597b17cc2f062b225c02b0fa0f73abb205be456b3496b5966b11051c57d653f35858191ae9782c260279d03689b5cbc370798351f634fd49b6101fff134b75fc324a28d6945b7c578a8774ce09f4efccd61b52c642c164c77c8bef6574e49cc4c00c784f96a1f98e312ccdd90fecc64161660866cb424a8d67099d6ba9bae5a10c0bd65c8a16c5092b9e6403b3247bd4853e91f8048160d9e335463742eea4488a36dd8c81a016bf50ca2b7b7e4fb022c5d72d607e11a82eb134f54d18758641f7ac13da936de3829a4575c6caaac21700e5024ded7f50aa3921dabeb0b3b7ca5df99af74f9fc108ced1dd212d0956bce67da74d675a6d3a158331b0d8c8f003bfc6044b0d35f119611af2dab55c912b0b05bc2db54f593464089b07a1c4e580404616f5fec58761b3a6db7f768d4553cf6102220f1c085458d7ec061ba5aee285739913fbbf3961b9f7318deab322df2686b6fbf49f133224b1b6aa193a43b2acbc02f0b8ad6e2d3941105e6f64e04980a2e73231cb10fa8be7cbcc595b621b5ea4f5bd50b3239c3b7663a7e0ab3a1eb346d1508d48c7817a1cfc9a4cd1b8e8160ba2abf59f765b5e8af7147ec0ca36083065630133a804d97e73af4e96e9f0712688b171a6b442d0a63e90e3a93fe626e0710441fc8ef6a453f1d159a0187448b4da1659e9d7e624380e697c665ce131bd4b59000cce0c35964cc9a0ab6213ae9c950ee8ea4ffe97a2fb7267e65b6fdcd7f40b72a9af0a2b069144f9ed2208772d0650d72e055150095f4322e9c2184afe5378331b8c8a1ad1f3770d639305acce23d468a89fc967cf1f7c3021a7db01c2fdcd4a38ee45caaabce9a8cc991649376d799392e58daa3d32fec3d13800ba5b6ef04b3a2bddbffadc5d8182172d0833cafec4a6330b609857dfb447362400edaca966db4b5989ec22f4fe3cd3ef58f5eb64f0e64ec3b719e853388d1929ec9560ce35fee4a39cab595c3350f5c83cc27d2f1b2c069306bf427116f8e0b93e7f6a38ded001bbe254816a5b83f7ff528523df3014ce3dbf4a35f416d86bd44c93a6ef0ca2ff9c7f7531af31fb5641f5828350be51f95088829e4f7f8bc271dc4481772892f5f4dc91348091d557f5602e6ba6e11989e3fdf27d8f805933496272ebbb894aaf05a33df18a1580abb213a661773aeab1acc12b16982230fdd55f44d1b6480880efe7523eb0e4773af8dc6d9a0efcd56efa53ac31a8187e4dfda3377f6298741e96df7c6283dfead58c2ebeffa79cc1b16a604228c9e7f1725e75147b5b6f54e5accfb7e95422eea334ba23bada6125fb3059cf97d5f132b2d726b5e1f0f347d465737b67e30cd7dce860b8c88c5dad3c1dd09f3fa58197f5f407552b20378b6b032f3e34e16345e804b1e0a27dffad81509dea5ab597489ea8581fa3b8a34c848fbcdbd9902fc0e6c534fcd67d8c70c1c067b1e66638651b2032d02b2858a1634bcf5d9423ebe4cd06cc1836acbb6c67a527053a41a2bcdcc56313336bb1ac54dd45f58f5fb15c9c49fc7cd7ac12d4a8e3033c9024609bbe90d8b59c492c901d91a7963be74f6e8b0c30f0928a88f46434981290e4074c0049380cb804d4c46cb92659e796659641a24a01f041a15ec1dde2ed3943f549272955bba86529fce77e093ee272f583ff0d11a07b837b1d673d13fa99a4db8096df1f96b1ed59c435e0c9c15cb90f55d5789b44b80f94dc3207c9b7674309c7045b0359fec9b5022ac63ca2bdf88e8115b61bcbbba3e71e9a9af1b3189b587f2fc802c6e38580678ba563ad0bf3d3b7fdae177c701a8b28c0aae2e409f7631e8153fdfe2d29208a723e7c564be102903649e7fedc06be2f20d7be9e0d9e0bca8cb6895a66ccfd703fac52fdf51afcba82ca36f604cfdd8835c7cb081c393654e3e11d09e22fc8f453fd67397ec2782c8f4b0c959fc00b309bd0c41ca5c207fcd696e29a129981e1bccdf508faaceb980756fa421f9f7848bf5e56fa26080a3e98e3a64f849e686302b818a47637ab91d4dcfae0f6cbef1d55f9e2dd0fc594163d2afb8b3669693d9b3f6deb42812c0c2e35427c8d62c53932ab1897f45960a3e8b7a551b88d0aaf7218f19f4d5539ee92940627278dee4002eb3c93b19d627cfdaf6f6a6834a1cf6522e4022603563a60919b51c6136c3522b8ca0f3ffc8469e1026995b70e00a97948a84e9a5dbe3ce5606a1c6083ed075c0776c8166e2abc00355fed1b221bb4edf856a3bade1e44ce9a81bb7b0ae82b67f43cd431be8e03bc2f807384479e151e8f8271e69214e20c60cde7d5cadc9a626b72355d7878ea6f383514eaf5492fc2ff1245e4e80de19516f0938db171eec110c08ced955a85b717da4b823a4123401403ec4fb8790cb6869c6d11125841dafabc3d91d40e7235417e823fe7a37a4c0a408a202e769939d7fde2ad5b70ccf427c1daa26f3d78e97658c34fb354e0f1e36384b2352726aca9cd2e24fd50b40dde6d8d180eeca31530dc957bd236258db1aa081751700d2c58e309eacc75d942514df600d9442abdbf1b52208f39081577d7c5222ef5963d9d8f42940b52db38e1e9cce13c8084c54c7b34c3bf9fe7dceae613e4927af13a929ebb30919d727bcf96e2516267ad58e8b9a99c92dd7d190a7b920ed3eb58c834711861e5b332732a5f3e2fcf0a7aa1090980a0d094ab5e7c0981391ee7f920d848e7433f62ebdd5bb5b5815cb7a387dc538f7e2db937c544cdd408abf48451ba0b6890cede7a9e66663ae21f419789a89108f031f3149bbea77f5b5965f025ee074faad44be1e84ca89198d7baa94e6caef090d6fbc63619dfa7acf887a1c93b6b2a645827094d571ff1b5f86a0d05df3f767eedabd1601418b6da5f91b2f2974cf5c127c75a8ac50975c41bc5d817b5da09eaf1a00fe1aa7eaf78217be63a8d23d80ad8658c26512f1c38dac74d571d2c5cb105372c4e373c1012a43e65b7c901665001dda8a1893cba913fe2285e419ff7da23e62d043a828beba9d41a3d850889b65b3a940b88e67bd3dffda2faac74b035ecc59b429d94638d1a1cb4379651ebce296aae0f2d494a071ddecac06ce56e6e573b807eee935fac77d1a81e50ecb19feb1783bc52fa9630c6751f18dfc6849d4462edea443b787579ad6aab8a6e0f67c1174d8579e9d9771008adeb7d6a2ae21f376abf1198f9b46c8f3c649fcfa0243c674138ab1a9111fa289648ca355eda73a781a5e3751ba085abe195fc56771391d4484fe343f0547e91db19a6e2e7bfbbf6f04d798bca92d36e1afc01601fba30d4b513b7e85bea349f312a77467a5e86335399958cee496885289e201caa4a4914b493d9f70420f5d9a1126984b32dc22702013c1525481f6357f1ec8a4368f848361f1327928ac5f6c194fd1e9b9f3239aa50cf512b7c2b647a73a08dbfa424d56fcb9e42934d960eaf0759e882e3a0d6a79d688046aca5a5c6b41294224da86893a5c622b7225cd317a07d556f30225a876deb9727259c3923448b9a071b0c64c05124ba0dbbe0e0241fa735eea1a0c982ca94643b7493242a4709b0f9dc68c468d7d61609f1f865c1569967083f4fc22907028299db9059c0ca38afe09caadfa8b512d079f0787116364cb70c205631ec6001f830daa1999a1ba04e316ce62b0f5111853d9b3f789bc6be80be86db6ab50704d5adfe857ac934f7fc13bca4231944c6e3a19083c5cdb3d013707f9e5f9c66e9efd4a75d97bc1ed0c3e9d4c0f23f99241cea109547fe122aba36cdab11e43c4bbad393bc0065c55c0a44df15942411b8727e540f7875fb394f8633ab4474a3e708c7ce2a40cf41375f088c53083ebdc59b021062884fdeebbeb2e6b11c1b408bfeba5c50f25d0cb037d66f469154ade6bf317471c3580051240d631b72211daec006d3c12f8aecffdb2fc2d4f34bf016edbaddf91619b4a7f36aaac6524c65c6952eaebd02336ea63f96c1d3a4f7a94c8cf745050760d7a240e150b8f020d3839aad18d793dd498347bb4e755508ac8b36cc2173f030b64fe6e62acc332569d94181e575f6e238b9750a394a10a2a1c78998eda7a07d9f70634569c21b59fb256b434cff92ac13a617c3943a181f32e384dc70f050397d64896fce87f8fb049b1684fb192b67c04394ff4ab04a9486e0aedd709762886ee8b05a129c72af0996a56dd9a7827b70e9b2f0b2aa44d5ea9e14105a477f3f5cf8ad46345a91366bb1cb65eb4650abdb0035f286c878f8559d5a5215d08ef0c2bc6c10faf2ba8c8d9f96cd5b47d41f1991d590d153f062b054a5312ea6b4ff77f4c961825e61692b30d5fa079e96200bf8513f8309a1430489caf27f996294d6fc5c1024f1589089b036a6216a661e57c86c4389651e1cb18b7da1bcba4879625293875e9da8267b1ec20cc1dd31e4d4c0ad6ebe18a1da08939b1378aaf6bb9ce05db51462cef12f2e1a3ac2b5f9baaaaf18f9c5ec508aef9504dc7999cd451366269723b5c08b0e44d6f6beb9d96d33e40a79295e77ce27a7c62de84cb946ee890dd3fef58da04df44b7740cc1f805d79222705ef4fb01ec999b95ad3f28ab47f28627981006572b23f1f394448d5af5128ede11e4023aa618b17bf5e325400926f6a488791392497a2b2bfa763872a9c91b8de8a12282f5138982c18be03842dfdfb1a80085da8c101ac1199c2536b206969a7db9ae029229fe1e94895208e71cefe8666c8d00ffccc42ae933faef0b3f372342dd3bd31bca64c03ab302ca161a032ac88c832126def38d77e6075998b9476eb9781d855ea1d8358d5322b80d97a609eb9b52a109999e4c84897113975452ba76f5c31b9e0e57e9577f0983d645a9bcf7fbecd79af41c329d621ff662fbe8a60104f8d76a49ae58171d0d9fb367f17b3c86525fb263a6e4ee6e96e26764416b3fc0e1f9db53345124a0e137ff9a3ca2b14f1f5ac1dedd52c9c7353d3b569641a83603139bb5a38b3e299f1112f328185c412c41637befe2cd24f79fbae6005f740041158c64de3ae686c0fb232ca8a1c0431d60c7007a63d445529ae7396c76d0abbc59f57afc5677c276233ffe780cd9e70744ef195225148a0aa63cc44e37269ec7a58168fea52c3856bca100c4e978fd3b683aa98db65857cc61a74401e87c1d757145ff6dba0dbfe8d8ccb75d54216209c621bec04659dc80361151d6a9ce489b37b886ffd7508bd2cf198d75b3bce413b3373ff3ff0caabbf6bddfd701d1b791018ecd8e0ce054204361b7d6d254e9d34a5b0d92a97d0616ed0314c84c339fc4741bda7476246b861c4198d7a6ef397ef75168508c1ecd5b6e69d9039b39a9912d904609f167a22ad7f6f7266e8232d55e595f74551810c62833ab326dbc8c8243e95ba1a0c067387e4e367cbb74988b76dbd9bc0c8e37882bf3304f644bf75c807874c0af15d30e365634324135f3015148e315c96ea42ca7c2c866b944de3d1351a295aaff7e8e7c2faa0cb8f75cbd4db75d5a2035eca2c1dd8cd01b078c31bb2b2659fa87699c29b9c32241489c37ea8b6abb793fe36c3832e383f6ca9a632a5b725fae70f713323c37a211e62b1ef8554e641316220b3ee4d6c9be7614e6adced282d0573e6fc76317c1058d2e1fb466da0be18ab2310deedf724f3b27bd7f85350ee9c6ac1f67a85f92b650c47bdb3f7a748b4900195b12ff4da37b6b5c38f2e22d97a58db03691c1efdb7af09576d97ce1b67a7922770e8cb5f70521a2ec39f3611f7d79843358b5132dda3a5f2709c63c6fe893cf6636eb23f67d9fb74e903fb0713976436dfd48ff732a14dbedb37d342a9471ffc6e7a2e6da39b8044dae4841936dbedcae0cf28e8ffd6060749c0992a9797a3edc4abb0cdda9678c1462d36de35544e74c7b5cedc71a4fad5da9630385c6ca90d718046e706cf62506c3bfe2d5c164220b966ef6e98ca3a4d6e9f5ac6cfce4f66a623b9f41c0f7cc11b81e360491b8da9be6cee3d94cd4f84b4351b4af134afc42ef639babb6050027a537d1859758137f5d3b32b8221c3b4ce21d6f1739cb983cf5d39ae4583bda8ad73c29e0168d4756d4164e2e4e2649f6e5f5984683d46915da0a62162e5fac98aeac1d2c71f61b887f9ffe9610f2e4c65ebb9498fd8d6efcda0ad2afd166434ccb21ae156acbe95a7be18de68ea74131cb9562442ebe8e7d858a289187cf76144a65e76b16cc7175f837f4afaa562815288ccdd578f626db2b879e676883b92f80a806df8344a1ea3f3c870871457b955cd673cf0f2c130266ffd0ccc4b283ed0be497ef1853bd9d5ff5365f1db8e7cc269a8b2fb9b0a6bebda181d237421f56aa700e116a78506beb2866ba7eca7d2d23cebecdbd1cd009128d578447a08bb5cde5d54f77dcdd33168226c4e5031ac1d52187c0a0eccd4085cfb9463fec60e0b04780575184e8e030ce0788cdffdd2a732c175cf9e5fe591b44236e10110c18c475065619796a546cb5f5701bea3c36bd0f245a394c4352d4bd2671f8a01a90f2bea64cabb9f285dadec6f7b28e20121c463c07e69be5d888c77528db96f65178bc3dc05e0f6491ea02ab2c9bc6de4a84315569dad0a462dbfac82bc4f6dc982c222756cf2b7becadc7f6b5d921cc361a135dba77e2b51c4d97db13ea0ae9a701de5b57a414c9a18bfb4ac3ba70e9237bc37b5c3a460676b27ecabd378e625b94ce11606d76a41109946598d43252bd7639f3610b7361471e919ae4b5ddaf7e8cb2165c526d45e99e2deceaa2da7ad6803bd9d1d0bc1c2686f4f6d07da1b2b9bac53ea096193ee10f9f5d838e0099a177d1d2a23b30d32179b835e4182013765eea55da672ffb17fd0b3a3b065db6e742f042e6e1a6434a801935495c88338b68df494e2e0ce8571f12bcf6bd6e366366bb5e7344e14d1d3ce6785c597c333abe853c83e17b88954578ef95c84e2ee4664cacd272134fba47eed146ab0c09cd864d10104ba079be71db5b397e91d433d2024dcc2fd0161a366d39c87b82484394a09cf43dd93af65ee72b6498754403b273c10413f4df766da6f33a903dbb89e120dc9adc70610356d647d70f08085782de1264a69d2aa0867f6f85e1983f3a02e5fe9656a2ebbd2d06fabe2aedd15e472b9baaa712bc21f02003fc23eb864e457372c844469336e81ec25102246ce22e67dda9ea13cc917f1298d3f515d0bb07d02112d70efffb54c83c03b9a4561c5711aa79ff9a575919380f24d385b9947cfd9f54039d9e693bacb809516e996f00bd469e5d9ef67c1e98153fcfca5c3aab3dc6b485bcdc074337792271b956e39f62a2879f634365c93628f7b8a46a69e4f0efd36a258e173427245428be61d297b243364dd105881e5145720663f80eb40b703cad03946cb816c70bf1dd4473be666adb572e22718bc5d3aa6a3a18753c65a673e1740807231fcf1c2ed2cefc5fa8a398c914a578c2eaa067bbcf92d78a378f577780841f1f1f6730097f414bd3335733013af92fa4e4b7b15ba2dd4aa824587a1d99330e868430e992946e606c493c8486ba7ed9f010ff8f5086fdffdc1ca21f4d4b6e779d7842f981687885b500ed12cb1c622a69972dede269eabb0c2e3d6eb3404886fa4f73c1d2ec63ca62b86d0a72718298173105fcb533ffce382a84877ca08ffaa5285b94bb22278966dac01953a7c999d5f1ca34c5cfe30f266af34bd941dcfbf336636dca3f6946191b2f7f49d5cf6d92c63cae64cd2d5af75beff2f241742ebe92071e489f40f1d4702157b9b3965c6ac5163c539a96754c20cbde0ee633190a7b1c25a2e8945b5d927f8bddb03c48db882805f500b3211d47b7b2048a64036a15b7312112a0875792607bf455841cdf7a434ae5519a40cca4f6c8a43b0da12b879ae586d22e399291a0f26c6610849e69cdc11c1069e69baecc41db2be41701817715b1196c6e2388b296b61445e5e1f45b9fc45fddb91f4ba41eea2e9e0b662ac5564b7f353d0a34633258e450f3172c66293dd3fd2549d27e79f4a5fee5e2cb3b98f905ea1818cc4c5c1dfce46732a16680ae5aecdfe82eaab29b264626e140dee5e2d670bf463e5de7b0cacf9bc795d161972f7a68f8b33290687e0dd1cfdc6bf73d6d5c1ff3577371d6f15e6934ae054b9a0cdd7255b8f4eeca499ae1e22d8d39a06587d4b04f2c55dbfb9ef61451a11acb99520924815715091f2e97fdd4ea960ffd39e33462517f7671805e55a87fcfe665e117094e37e0f82df06191a45006b1162dc2ccc728cde53b1e779bc3a764f7a65f56856aafc76288f52ccf858cf6d60e395336d2f4d2af0c4479830fd83e84ebf1a64616782cdc31f9521b8c9d5d8cb7779ec0430a191ad091ae80a322b475acdffe942a2b3bff2d318a45ef7ce21b4ec683fe6a90ebe867b0ea6bd3fc5094abd170af85dc3c425014a2b32f946ced30a2be59f424eb81ea669543d6936bed19479864a8cb1609704e10147ca8496f69221f0345188a1907450e373d9479cebb9f2a74b2fc821a935e08d075a355e7479c762a4912f92a9e2b2a70c8c9897c22b54ef270b3df0a766d2b9ec6773738ea49df4b77d13b2bc610cf8745526e4c3dcf9d9b6ea869e3e51c3e98bc30889b48fd9c0d06c9f9b5cb24e8f1f2dcf808b1edafa09ce7c63e49407aad3c6cdd9e5a2de33413663650ff2ff6b3ce87d42c681c6f0f377a6a0d66a85ce57182b6f20da19e8b2bcd74dabbee705240c603d518c03ff31194fb37759f2095207ce546e00597b032b629a71f69536cb58fa9f80012259c0e3a49a42909a90a54de24f36635f670a2e7fc1048a4059e98961af4c9a32c6002ca2b203d0e7223f14192069c979fcaf605001f3df21d0ce2231c3c0b7a7645e56fe190092f3c1f6dc32ef40c45cde6a9e34eb11afc72c1dcb6fd5516c1a7e4949b76960e3de089f9171229ed58e50740f7784c263409c07dea8bc06abee9f58c3676293ae50e89aa95802e232080e7858c4cc4f36e6a718a66f666307ac27271d9260fe9a39871899f2624a491749b5be397809154884b1899fb6a266372861a5acfcd44f98a7e3fe0c642814f0c21a6d4d36790ff7277686e477ffd7353561359c3bef9051d5bcc55f174b24e2b8bf804630614e0b4f70b61a945eb1b103c61357c5fb8a334d8c9c62b8db7d91886b85cfb5ce225adaf6bf1007e4c947624c46a03dce31fb7be8a0a398cdf0679c04345742e1b61469e9139bc354d310220b36283e57dfbb771b5a363780601c7efb6e5b2883341f6d3eb61cee000b740ee47d1df85a3f776dce499531d709e1d9017a204ac9687679bb8fc1ff4d150462e9a0cbe3749f4f03d5b8764747c8fd69ccafc2cca44265b45a366eb802288649a11178eaf3f99b21893f3ecbc216c73c2f38e803ca76272f2c21dcaff320787c258a523e8b2cc8aee1425e3f9a40d558586172ac2c5cd995d670887f4339462f8107ad3ee49f205d7453ff86cf33ae9f3c7c90b41a1d4d9cb9751d7efc2090a58871a2aa9323aa195a3aceeaf8846f093008257c569b62458667dc779d887d4cba4404d0cdcdfc2674df7c2b607bab1e97ce68d229ef99c9e23303eaac42e539b7dc7906b7016d21f7d292ed01949889e1cc3ccf1c51d4b86f48d16c248d3ba13446b10be1716fece20a5399f3016aa2fe0106757e45ec70aa03786897921eab9b073dd9e66ffbde13931b6f8643beca2201fde0f68172434f6bae679513999189c7fb8665ae56e07e2275fc61649b15dc6416fd9d33a92ef4789e0bbcb7e3b69ba279437f0627da9de2c17ca09d754d2364d068a8cd00b0c4e093afc3a59f4a3a33942f689830d8f2b0b094811a5f8a7ba74cfc33b3fca69c72da7172f2fe875f0b5256c1ae568ff59982b453043d86b818db4c1b9e30e84f796de84508df5c5f9321026f72f5c8470c085b85830315b36030be829f7dbf036b63da109a35463fec6e52f30387043ba0a3adedd4cec6f75ca3caaab810d78dac922fe5756ee77a80f8dadc0b0def52ca6725006345525b105e147b5f43828fcd4e369ccba96ba06290abb6bf1c05465c7e3b7c694c8d1cefea9e18fefa358856105da7c0e6067d2f0c7a20033878e1b5c97b4e58cd3d9b4280257e11b571cedeaef6343deb02bfa6530d6725a6fc8f7d99501f349741274f0e418967b6684d2b29a1ad19ebb2b7370bf81db889d04f8d8301bd20081bfd38117bb299610f74c6fbf639ddb0056be5c47bde43496f32527690f98c37dcac1eb90c22a072583b1b23a048bdb6a3db692ba7cc57258911b9ecb75fd928fde34545460e90e58d3d259f1e7bde0874d1d449ff1e80f7475d8260462a6c46e25ff7108f4003494da9da2ba1b06649f2220acecb0cdffef13a2e655ed18347f2ddcd1f27b3bbf5c0c28719459ce08754c4a89847c0a6b4ac38a75250d5b8f0d3e0d236414537f9531318fc6e10deaa0fa536f01fbbe0eb30a31e4fae042a52066ea43511f59724c0cde2b1c8d4f2f76cbb8befd10a98d273f646f6420f8c59549babcfe0842171f5ce17cb305facd811614c530b0e70408da1738c35135b1abedeea31b2739727741cf37fec2ebcbc547894c704bf7580627037d4762c9d5d2859dc5d82646557b3f35dd9be60a4300f1116ff5358aa80c85393d62ecc3a2216ff17ab4faec30604fff207935c9c50f912a109d33dd8c8f066df885a308ded8bf778aec4e74b580d6fe7e3271aeec0f1a4e68f6d1224ab3cadfcdd0834496bb65bcd6c38b353941aa26cc231771cdd5f67979d27b1d46528c765fbb8918f4565231d4a5a649d79b3f63ab2cc0b58535d625fd9e50a8ca84e5aee1a75decd881941de29bf712e15b0ff5ee6015e56318eb39437f63f0c518d44d59024c76a93f4d0119a6aeaeb24c46bb1e4f6ce0c88523be91fe13e69a418ae84b998a8d331db6ddc3a1a6f9a28d2751a2c851441f9ff63b4047c54fa3d2b96df1ba5d7afe6294bff82f2d07f93c408cd1f34252bbc284e904b4ba78a5e9d28c21c27a87b8eb4fda191a0f57a59d1bceda3d1a1de50a8cfc0b9c2e96364a5415c8435f017f11520096172eaa022cf5cceca1be10d60a6467bd80286057cda0c80b68a34475d4e5c56e294696c67de5dc1b8320a999ccdbc3bb3ffe99c3721d2cabfc4a5a7716621dcb266903d878f5f2b2ab9175d6905477428088d6c6c163b29a2278e35abbfd4168de6e2fadf38696c32a192178295835f72da0bd9d3847fae209552226e37121ab9acaae35f65bbe5b23cc02c5818558a02496b3177d0e542cc84bd32b06eff515c1cdd35f9f2d7e394810294eacffc88e5732504586b40c1f61d5a773ab2221dafe739237ef53fffda56a7e57d12918ddb5e71ec87f7de9325730bfa9f8ae987d4945b38ba56904ad06c5ae7c104f75bdd7a5f7ec38abbf78e7c4b77a75bd3f3eb48fff3292308994be2946923419f252ce60fd200ee5f13bfce75a5f620f0fa35ac28db3124060447e9f2b1cfc65ec0cddb1fc90cfb24fd61831a2edb700d03c0a4391affdc08df6bd2db611efea7e2227de44c5a32b5a9b6d45d19df1c7cc08b7224e142b248f240bda45daa06f330ff3914fe792b61959993f6142922b32b987ba431a0c97ff2ff54df188134a1216d10c180ebd178cc8d626a002ee8443f7050a994f6dbccc671fb9246b976d70433b9baa0a1b03b0484cf6d8c5a35e301ed7ae489688a6426a9d16ff9b3e3ac0fd1d9ff5489788ebe434dca78936f1349fe80bc23946d95aff6fbeae42e57f3fd36194d9e2f39e15b7d9c035fc0bd0837a94d5e1e79349a7ea8602707d725936b52dda42bd919ef218c89a1066185e5b34670c03a95e9914dab756041541e17d3f77fda4560518f6f310aa7232090e7a4a1d50e4d8bafbfee4d82724f046bad6e03a56c2652636ffefb0e7d2196b3df7b25f9d55c88f4842d15956b6ae5b31351395c3aa44aaf7fba9bb680e9b11a95a9974e5e530c5838bfe9b34ea29425a93ce5f88be2b74d04c7852a7816b943da66ae1a8fafd7fa5d7c7341a863128f41a5f5e11d9e5cf5997ef529d003223450e66e7a051ff47890cee9179a7400a48a64c9daa31d064fbc48c38efd3155bbf18498bcea7a1c6485b725d0fcd7dd07380b8bd0724b45ac4eaea67211ce986feb16cee2991d8389bc778d327760972f825c3b4e61f5a3c32fbca483506696b6608a73518a0e18a809ea551444aa373ce51d1136a501aef2900361a81ec21c74f34f48c46017114f9148db2648bd959f25fd360688adb1e764b462f030a590ef463f5c0cd1afa26507cafe6d9528ff21b84d6dbcf17aa3f2216633be10d378f7d157c0455db1d63930a310d0b6a670f9cbcf5f101c33cacd6103b692f9205f7636e05bb99d0836d2ec103dbc2e6608ffbb6526659f582faeb5cafc484968875e5514ce29532f056220fb9cf8b2e6d7a0359be69af5061d790187c4fd2ad4e12059ec0b4fdc1d1ec5915a2566589dfee2b6ce3be2669767df62c34a72a5f0e4fa36d0457127786f2c30865bdc710e99e88dabc932f705b342b52a90f8cb2dfa55c4e1662d55563c083204f8e66738a484608761a61807efeded8cebda0992111ebfcc634201b00f51d030c5b9d51627c3c732d45ae94ce32ee5e1a4de4a14948157a0b3d70f414d0fba6ad62f583712abd6893730c11ddb4df8c216a9aad1fbdd82a7c9fd87a35956d69356ad2e47add62b19e44b029c665d05f8356c6050569911ef69c8f53e72156e1247d4297050e3e42cf9fccc66560474ee0920609b52c8ecb00f1cd05ea3934b08365a2b3ec401910308dde83f957d6be00853aba2793da4b6cd93314a0ccfaf0b66df446b571111a27ff7f54ae899dc911fcfa6c714ba519c2770c3aa2d31b753a024041e6715c6c8a835cb0d76287a95fe037d9cc7f159c58d0dc3d42f5c34c7fc755c16f4e667b210d2dd360b96919b45ac576c600960ccfe951aec7673043bab254b561d5299260a96925a0aef429027dc3c9e3c44509cff0755af9de85dfbfcf258e9c2d5e686992734aea56a4ba445bebe7a9d5d0f2fbe200ea1ba2b98d11441a28c8d852184c6b1e483bc9c71e4b9270d73d14f15224e957f4358b29bce5d5806d5f193a10b9cebf2e61c3d93183f9b180a18102c090eda40b7858747ae181dc46dd94d930a5a169965eb7c9bd4b7505325baeed0b8c58dc637d8e4a8908cd24e3c3487e46bdd31ef3e64ca684f8c3f10acfda09138f182b75f4ec384b57ffdf1464e494361ade132ddd727293ad3d403934f4db282e8c47eae0be12dce6c0c3ef5eaf7820301fbe78592926f8e5074440d144267966f52e43243509333dd6bfd12896d3cdbe0a502544187455a16a11dff977e8e18ccae783a84a6774573302a21c8df1957b7535a5041dddcef76188dd4431a0b9ea19a3db72c5199fcc83033417a4df575d123c81c09d2450ff75c55f6b3ed6a89a375d1ef1645c74673c9742a896496a30f9a348127249c73d79b7209a36af18c1c6e2368e5289c8e39df48562fed400cf9280077ffcaebda7450929c7c0fdd87a710bedc48f898c49a91232dc4852c39cc95d8a3972cf06da07cb64cb5335834bdf22a38cd4b19383f67010e0fde03897e03215ce14ed4c1605e56d8239796c1b9a5fc3ca9664326bca8d15f68ef35a04542a82d4d1ba8e4164f33d7a2dfe14afe971fc480af959f9fe04cb96c4b58a5e25a2d955bbfdb59945476693ec7d89d8e4be62b2544ef7aac664bd529f21d9273554afd08a6744dc30221cb66fd4a097981b50fe3570872450333ae567a5c9958bffe45f099cdd06ca99deeabd0dd33e05d7a6449f2c65525de689cd6554c498da5edf4f75594ebde53734f3be706fea954d3d9907fc3e11b6a585ad56021cf54a3a8b337629d26125817d7130bdd18ec21d3ca0e23a8e22ef557e3343e0ca411b2f2b6e374bf7f275718bfbb19ba65a2fc39928ecc6888d216c0c40398d2c232a2d558435737afd874cdbdbad72462ea62d09654a6a5e33fdac835e4caafb410daf98775c2d560d5616cd387e6236729aac06bfd533506497be4a4b6213f25feb96e1f4079622d30bb19613f7b736d7c1e5142103764a2f5e8a315cb070b2337e1726253837baea20f51c9009da3784af7d06cb68f16a82929b0f0b8d23ed0743865cdd705d9be92a4e970c4ff39f8fc3258b818e69479e50c1d29b3f9a89d74b8413584370a4a3d8fe29d05f83b5ac8281594942e2776386670a47e6e71efa80e8a34abd48b94480ff2603699efb392e0a984b65263387dd845abe7ee8f7dca61d0814773b2cf7ec6506dae40d098c733444c0c581c60ca2ace7f325bafe9b3afa7823d04844380d51da5cf8f20d4de57515f5949360e15075b838a49cbe07e4b052b47fee7eff3964831f33a01a99ee8cb7b592bc90e02176a76b7aa2ac7e1bb72e341e68808ccee9939bd2e12aac157c9d1b247677bc24b86b1bbcd4d3d76c1094c1d74e36071d5752d875bab3421178a7c4cd9a9e32ed72a8ea405645078a135687e8fc73b91ed5fd1f44cc902e4ee9b8f9f3fdd0cc4a1df3a3a6d65f393d7097bb54ecfee946ab9c893d87b8e01dda9ea8a93f83d7c167884adef37242eb3ad7b1b788e6b45128eac7c8c832736c6b1a2a5a43b865df81d8006bc524a3baf9b0dc9cc0746b3ce7c8de7a137dca4e531e4183813cfe1293ebdc595e87775bb3f89b56d64a9ac6c27bd05470a8ebd32abdfa6d4b9401dadb1d7e154dc262319b194d82161df2b3df046bae7b75b37a111f9f0c1e4b25ec271bb076670692f487cd093579e83708183c87357bb9633acdd1afbd7fdb7f373f287d7ea375ab76a2caa369eed63d26475508ee4480b35dd4f16f814ea4e9ffa39080454149b5f140e42cbab5ff53030d29db04e4a549159c09f6b4ad650c4aca1a7ec1fbdc384cc57f14d849489e36f80472676580e27fb3aa8462ce779825f28bebd4d5d8ffae86fd030d9d49d4a070a7d71f21587654e7dc2cad3c1fa35e7b74e0c2583b01f8e13a30ce037048056252919c2559ddd08f26e2e8df06a2654d694eb521f0e3e1246ca234bc56cc280ac5cb6def5a3de06ccb68b2aa01e5a192c05e348d0b2ee2649af79ceca19d9b6ecbb3222f3b2c11621ba3878a42f4c88e86f0d9bf442fae6011e5ef23abf308c67205b22edeb65e3c9f5f786c3757ac2c89c075b09971e6c1b52b0908750ea460cef99c731a8ed49a42b3eb4d93921853875375e2da384bc6d2249c3e1e7c5e6fd615c28f2068f459a0b0f640b9d71dfc1596748a5fb4c0a1584000f45d219b82f5c16369aad50ab469014d494b2303dbd4780c0db336cd4b362f882b867d016ca2dad03341e0ef47d25abc06fd6953c995e0f9ad51f41a2d648978ad7970fa5dd3840398700046b0630326793dc11b51c42d2a364a15b6a10b593859ebbe2e46bbfd1ba64530a2913aa897a742893bd8187abb08be5f3f811dd8532fb8c27e8c791f49a77dcedc9a35a788e34d6e06dadebb01cae6593c91d406f3e349ad4164b97a36b4670d091631435f844c63d368d4741b9558e86feaf040d337ff5e7c09038c4de24d80321afd428201d711375070d0321efc28d8036a5e9b564b6b305c606bb299954e83e85288660ec3f710279ff3f517e5af4627e5533ec94ccef8796d7519713bd6de98b23525d0c27d1fd1b0f15fd24eda22bf8f84856f4191793f688bf818d65121f44a5f0b18ab4d5df766e3ac44c48fc94a6fbd95d0dff0c8cb89f6f3e0a023abbe3211a71f24da0e4c35c0e9493847b2756fc18acc2d936667f51c12bb7fa804107fef780c434d867b46f764e85fb1927cb4b7a3dd57c6a02e1421b12d44a957518f60da06755dc682eb352b48349029cedecc0a49609632d1047d4d2f2a5f2d2a7156629088c1e74a675b81674a715165874708f2a84860f5a1675263712398310cff6e39921b99f7483dcab9d49e8adf980517e5257bafae2c062cf38df772ac9a2bfda0febe83216a7c00f7349b2a738660ebce56663e347367eca59bd5d3c9163c71a3dec05e700a9cb01d4c23c252e2ad3cedef982ed17b2616d7ce6a841541215d00c79911f9206e5597d7eac00e0ac77afc1d15d6d2de39184ba3a16528ec5db96ed639bd151f19eb265e35ccf5af06d3b1f3f57210356de4e189acdedc18b43452a251f451017807f820c4f2072c5ba3dd7f99e01d39ce49ea358bce14f0d13989deec8ad33183e3d37a082e00bc47f369b6c2f83f57d8027ba7d4935ead9fc47b52bef090b0d9dadb6ca40c07c576a21705a6af282ea29b85b90646a68cf3474594a94e6298ee6853a1665b01f00f1bc2d333023217a95f202afdf209dcca8f452c1eba2f94d979e57fd7b24f730564425c8a22111dd668dd736a4a60446dcd36ab146b8a556526e88f6bd23c6fb6ed9bb29711bcf6bfc98e36afb3b20e7db3af8d5ea5f0de5fbe31365fe63c72c4c1abf4d7e833d8c6b125a3993300a481098516d9539c37ac65be55f5db816a86a569e856a64da69667003e556161880cb6de0739efb8cebbbe268e118d650bebb828cd427510c6d0f655480609bd4e04e8c6303cc2603579e4adf7260e93706da8d78c7e20e4be4edf6de4a3dd8bcdd7a6521e3dc18c81d4662127806ecbb5cec33ad06332f9f32accfe4a23f18e3cf04e2fc9dfeb3893632040f8f97dd421f82c58c4847662f06a7e99ec75c39a6ff1d1060eaae0a15d4d14d7db5f48ff5bff9761a60487b406ba1fdb9de426baea6cf2421e9ddb4b0ba5526f3dcb62b6f4026dede1b71f7b7b2af5c65907c13c1a60140150586bf6f31345856eb7dd53fd409db1130fa1cfb4d74cc1c62b57ab0e63e4b212fe053a52453705238aef69d2a0290f5aab27c66c6ffb793e66cf055a372176486f33619e6114a039b73afc1f7b0b7b6a0c0349144041a805f62b7a96eec941cc21e95bd4486508d6773b355451cc173babfdae6b495cd6f9e33fdd470f7aaf3c0eca523ffb3f3cb22866e0e65bcb71f5a38058abfa9cfeef211170a4f74ec11538a667a977ef33ee558c38c466bb87e44a83d26c618196cfd3d2a675f04111a5be85bbb78ddae50fd12a644a121c64bfaafabe23e40266b8917864a8c7414ea5e70034e2d2f82043c6adea8489387d4e0b973a3390a669dd1287049488c7d703af0c5dad82e7e3870ab32792222ca803f6f2c45a86776bf815ec8d4b800dbe36e34cb61172c239f0b3e74a9e5fedf847f77f88ed895be08271191b6c12537127e7b2da1ba4de96f26ec5a3a4a7b8d098e59f9118cd72a876ad385e50ef222d717869e9cea06fc9e0819215e68880239359a99536f868d254baa806c4d3e1a964ec53908430d9bb67eddd893226f7aaaf64bcbff9775a2a85aac44a04890445d6bb33076df8fa354204b0084c7ed365480f835388e4487143cd1b3d3b5cfdd44a1531338781120b7c0bd57530e56580ec139f4d8e7ef8a641304c0ff042366b79b44c22fac32c98b93077ea109a11ba718d9d1b7084cba4ed09dfbf1bb8e52154222a7faa068187d1538780d5a47538ccf03d031e9a8e19d802a8803265b93cb15b8309f168af472f8134e763cb31d7a3e5dfe52008d3550b6bb26006daf0adcf9a9c1d8bf8a68c9f7b069cf1428c7e492707d03c335dfa56ea078a2b65d4304e3050c1100e658ba81cbe26c6c82e2fe9b0720fb22425d8d871897c1755e80265412dbed211e12830bb2d57321c704202cf9f8ed86325a79253ebe2a5a07141e3885393c313019f1f26cf924201cf6312506a3e88b74feb54a4b78b790cbe5900a07c618a1b2bc3f7d22326891181021414f7291d2e4a0ceffb5ff5af4c196562bfeb0e51ff35ac4ed461b65fd9ea8ee49a0ba02275cef459c80527df8efcca253d687d00f30d59b7518347da26f5c29a59f9762e83db8c78047397ef4cd299c0001d310fd42791cdf6876af4638af82296b910122d367ecc23409b8002cf926ae8b1f37995d536c262cee799dc1cbc2dbdbe81f221ea21caadfc880f079d65f624d55f386325d35b29141c1a412098230cdff21b9802dbd84f75842e55ab09cf6612c6c8762ec14a4ee70ad56f33b802e3c4d209d449e8c25885aa36a95999f713845c3d91731fc5dafafb3cb244d86fc0895842709ca64e20d992ab2ce360ecb4a442af3166a15700642678512409d2b98f10e5c350615179959a45ae32490915b6ff5eea67551f1238f3bb0a3740627b4169cf401fb646d8bb6013e93c783721912676eb3645672980f43f1497941d2c8c9f9f1e31b1778123e43635711e137111a88721a5c9e26c89e3870d2b73e02aa4c92e7264155770f449d99832e1a6a2e0601e9e6147990dca7c32190c5abf0dd9f7c1245a2d280c2de6aff225ebed3f09a6b9e8f47f95c719e4bd9cb76bfdb057bd2a24ac3e512a0bf30c7db0a269950c2ae053fd933948ac80638db5d5eece5f21d9d65a4f50b94da388e9dc21e7bf3fb8b33dd5eeab5c0835314236bf28067ac5508a15cc4b2f110ee1b5731ad9d8197eef75394c20218a2ef5aaa1dbe5ae6e53d748f117909bdd1dc7c37ff6b9a4aafeeef50b3737d26fa2423ca7b69f6d68efff5d93e7302248997c39d81a45af3d1571dc42c40ac192efee28e463c99581e3eed575dd0950428ca7245a5d1268b6f4a19f8c14f326095baf346653e13d4974a44b253f5e2b502439e4a990ba8a209664e632669d527a9f2db31cbf27dcc4b38cb9192c50cc6a005b5df1e25e6fa6f838f581ddf91651e903949fa09b01b76212eebef97550923e6a5051901348b0174665104bbd3f41d4837dfe0465b30a374ccf1f7ae540702b711bfbebd6c6424ec72cfbea5eb1b5185ad3fc6e0fb0e89d01843f1a8d5fe294abe0cb260c13bb501c6f26c1ef201ac9042886f6fa71ab22a11ae106ef2a336cf3843cb0d86d3f64549ed110bf875ed69f167555d40e85b4461d638c40fd94143ddd065e1ef610cd11db9b621cc4aaa187b6816d2922065a4b117436ecb0bf183586de45d6e2a846416b5428d897f478d64bd15cbf8d1478d54d8ba80e6e1f88c715c1aa15dc27222949b41c7ff0ba2e330e3811cdfc2b3cd8fba6263b68b69e8747808033ad96f9951d67e662fc8e17c72c0f8c084c6b91cbd895fd9faa3c4570772f0d50be40ebfd615afc6f476d0550a67e1ba03126c21f563c2b9321c88db5a244def8f01af9e9e76cbff1859acbee57f908f3e956560d7c59e1c76da067550a1d218f6a0a286fcc6c7593ae423bffb3b49fbb5fb898f055884d67a7a83befa60db6eddad93b88042c63d1936fb9f0d93c8136c0ea1bb8628cabc059acc32b156c51b42970c664a10db50c7f786653038c614b8208f58000907159f2d87a9b89b479192d9201dc067b8436fe1061babb85e9da374653f3691a6fc11126e9bc838571efeb621a1c3db19ce9265de35f514b47a53ef25f80c8a95dc611eccf2afb22c6c595ac94312871ce137f76a5b276821eb1ee00115857af034eb841b2783a204d4a033ada07dbaf75db96353fb1b4c53feaedba8f19490cd751213d0723aa8deaf6df6c50dbc5e268d073ab3f7f9a2b20b22e10cb55a7cdb5005193d7a1a6ac884bdac69def8698b17f5e931ddbe9f6831f0a6a0663ec0862a96a84e834d4c9660e88c6475fd4a8e2cbaa244f50002515a6e5a79a56eff5e6297010cc5c25b16100f51c268f723f32bfc777f1b82dc8e2c8613e7f7af3c9359931e3b616c2e0b5f524272551890a77c26c4e4aad35346b05e73c2219dd96353163dc8d466d17b322381e7b3d66645351810109d85ffaa23e05790d5f9132adb3e9e108e1e956af525c4220ce0dd050b7646c40d380ad9dd8661c1435e36efda7e4a03d0209c20a7d864a4a3a5a985ea624649a1c131ecbc3c7f60617e968667de5c6e90de991f1ffbaa4a66fae34805d59f2629363dceb53485c3bb60e52d8c6bbf8503dc531590d5a288a9a7179ccea7da7d4c4b73eb46a1ea560b748ef2ca70ed5b97bc48cdb4ed1bf1944ff6f1b34642364f9e74b604d2731477cb0910d69daa6a5c4158f5109f1594afc0036fd7c49f88cc42e3f157a4d091802e4cd1d42432615805954c2ac188dd829e84d8f9f43bc03ec0c9b62df7b180a378ab21fed5b0a424383901753ce5a0a118700577f120e692e9a9bd089d84e9b9ce1ed73a6cbeebc20a6487f8bf6959585e1f2dc204122991da527ebb539e145c9f9e36823d1ce171b41e53228f92d9ae816fa6579ce1e44604d6b86c8987140c9ec905325dcfca4c968757d16300581c9c83a452b9715dd197fb736c2edd2be81b74d552ced6eb341848e3c63bb57f734835a1e84b7f92f7504b8471b3fede76f1fef29c5c4dbd05b929a84ca6d23644ddd3fc2fe9437c4066b7befa0dcbbfb1f0bb636da19b914a7bef375690ab8fc2bd5c1cbd58470affdc7d4fa52e0d1d1ad9405373a7562c794a7d8a03202827e6e10ab1be09ab3556b173abc974c2542ddf78b60e7d699b20197a0aa9efc80df5f824ec9b8905bd3339c8b36a828c8c5d0723c32b7b55452fc065789f4ffbc5baad34105b5d85a4d758c06e44bc914786b6ec0457df0c748b6e29a2bbfb90a2db0ac387e1004adcaed6e3e3efd9198aa3fc05dd29f2aff1f85ef3436c4cc5a434b78dffc0587a639e67214c8499b6113c833e87e50f371e44199ae1197f1fe375ef53bb64cc78c0cc7dbab5923f82147695b83769bc38f2c3d408f9882fce7f5fb15ac10b5dad5047529e87f99a428045dbb23ac7bf6e816d4b54537dd8f87ed6eeb2bda0344bb08b1f23d6d88637de1a01d2d81d259dc46bd52202c0ab8b83a34a3243d7952b99ce82d9b8d3cfefb4c553f59e3a268736b0e1e209ee4e27154fa39def07d2e5d8e3a6f014b531574b42f13a53363ce1c1978085b6a48895681577723a6675f7fe438ea3663e108c28478bd245222f27c44e00ae3850ee97bd82695065bd01011e17028619fea119b1facd56b58c19e8c005b52e16f6f5311f61010bc6dbacf57af6f2e1b5e6965d35b2d5cad90a82b7a0be19ef232cf5458e1f629cfffe614f0619bd1fa8fcdf43c5b9306d5b599e76a80094139db2d336e726aec39179b33c12300b4aea52fbb20319636d80cf9e69bcfab9390faf5e603ddd07a8133aec45695b1f61b3318a50b9eadc3f2a6a2631799eae7730f78dc570974d79748d57a7482ac24c4db24f4e8c51a7fec51b6a5303649418142a2515a8c1b26570ee8738195c5ca1c7ec8ae0b79b5ddd2eb4aaf53b074f385d30483bbf02a5016898977a78a9cf6be9d37ad94812d858532a3d5e3ea53f9d03d7cb4573f3f665f6c5ec229f19799f3d82bc7c292b5aa08fb6c7df81cfc4baf61131b125e4aa7e94d2dd7a6e558407bd0ff3762d172deb1148b8e3aa4abda794c108a7014824c5fca284d787a4d689f683061f9ba35a0597345d05f9dfdcaf63151fc0b57bb932871bd2081d4503b19748814122ced6ff11ec34437e98539dc4e681a10c9eafefba4aabdef56378db6ba32fba77d9f8fe857530815a00d91b9d0921f2bd011e8b3c01b4a6f570017b3b053370c86038d245e00588abf8fa7f7b62d2bd3082cc6f62aca4900ae27c3d2119aa8fb3036d1ea8c3947374d3ee5e21ec3f76279b419751843212ddd7f9c294fc8b2fb7021030ecf4c84156659b6626f39d22d7efa5d5c5ee2bb00a04823db3335e31d509f02049bc60f316df1821f6d854486f488bf2337218d6f89f41a7561b213436af5e384e160aa8432a2532b40c9080f456083bc2aa40851548caac4c0532e2017bc0854df4809cc8216648c43029e9a1d9a72d74e834addf5a7d13ca061d76bca0ccdcdbfa033c7fddad830f05fbb54a0bc892a31e2302f780f4a6543bdbc4a74ee0a4ad2eb05b7225f5317bd8b73afb39c8763159a5247a01f6b1ffac8123f4d97235b9b672d569f67b71f3cd78deac182faf362950de99fc17c57fdbf22d0bd54243a2a15a6f572ffafb4d84f15247b8e9c12628b37fe9993ef950e6de4c6ef31f72e0cfa77f17a415734172f89b25dadd01d70683a4ce7520d4302fa191d304f09a3b78435aeffb415708cf852f077d05a1bb9b468d0d4afd4654922abd7f124112cedb949abb9dd772ad5dc34568953d0fbbddce6728d6334aac0f5fe8dd4fed4d7ad8a055dd3cb5b9347a5b8fb3b8a631c98896ec4a7425828983e2109f40447bf8324a2068817b104bbae0896aead9c2116037b84061ea0861fe43561ad21b611c17963a27fb657169bac1d9c5e341e83b51fda469f4e27ec38ca0b8e5fd4fa9115ac3d73eb2546ec852ef5c769efc620e55e1bbb10ebf99112e104e5cca78de29c8e55b02350fb77345b97292777019a10b9d868bfb182f4b15f431f766fd823d4a5138e2a0eecc0e001bafb7cacb9a3d3316bb002855f65fd18038a78b2bdbfa7dfb3a84d3387bd0627d56871ff09137b4a6ce8c648e8c94b53fdefb1beebfad8be3a361732108c9f64f98bff7fd1c612a7968311840d0cdc80b50bfe41b6c30efc7d84d8e5189033b430022001ac0bfb6da8fe9860a0ce472c9b89c1e392c89989476bf233f602a3022a3cd412b6e09b38013c57df68f4326d363440c3efc3dbbaacfea0b3dea4cb4974627fb5f7763bb0b10bdb8cef3aafff3c0f7bbd71ff6cb382dee51c3bb02ba12c947ea7c59d26cb4dc5bed0bc16fe259ea733fa2ad0f0490e7cd6709c5265d0174ea3f41a0a36252e82009c61583f65934c4c4f1409b87dc6a91ccccb6f4a191a5ad3084e7e2b74c207d4ebbbb34977fa0433cac1294279c7277fe1abdbaace7fd159b31730140573b1a03325c2302827c8a09ad288c8e918e026cd0ec3bc908a421b69267145a7d298f3d1cbf0615871238089d388d4509fbc352a76e03d2608a2f4463728de1c041ef6cf3ab3e7b11400cc5b923b61efdab80dfe1c4f81612afdad43bcc60f9ac73392de1d37f60421e4b6deef6df02c4c899e7c126fccf96755713a120e9ce15a13411c74e388671322b1f1de6e9f7fcad61f3bff4b50cd3fdd59c5e0e0ebfed54cceabab63a93210e8f980bc532cb585594b0edd50a94e8d97317b55b72940b542d2c8a8b070afb5d9f28be90c34668a9152667a831b56829afb5c369e359ba6794807b96463fe0ecd3f87425602abe3fb0225e5c0fcbe0285949d3138c0bb74ccb7c21d9d03b331b9b80ba4a7a02537e046d548508f92ba9eb3ca30d03604dca32f5f69a261a6b376d77f541065055da0e724092139f145fa84f518174e541037ad361fc82a33c82e2d6aedaf8efb624113fb310786edebdff4fd89a4983b3a6fc7a155891406fb4ef81af9bef4cf92ab89b16adefdcbbaf56f819f9f76a96388ee5aa5a2994f44a70cc9b741834cee6ac1413ecb84985a9868263462219135170789e406a313454b4dcf4af7c7d129ac5c1e15aff65c72003d825a8c2b08e00eced4b800f4220d00b751838e7b86b022fded380d2b11dd781d1f5ce4f8bb1c6086af1061c79777ec1b538e158aaee6fd1416925c9e776cac273986660c5935f26dbfa0bb00e363bd69892580dea52fb25cebce3cbb31b7c4f3ee9f93f9eec91b28768b156d5b50c2c96b55e6fed7f727312385c47f4320da6940552ff2a6bb2581a7ab591a327bf2d8f295a66546f7b4c7069a935f393169c6cff443a8fa436f88313213e8b82d80666f4f653e40a174a7c6773211ba213c88a208fa2996e6351d4b9e45e1360d18842f3b408e9630d950ee83078f5faa9ce971fb412043f054ab28f9f3e420ade286c29b38e2629703a95a52f6463fe5aa4baaaacac8885272534f94d97e89102815fc800f8c69bc9aad558b54f1b474b191df6a4e221b1067bec5b5d7e873d8c61480ec6a20236218e6a1923b14def8ce3c6fcddbd353afbf839dcd596afd029fded439ef0e65bf9d652c99d9c7865ce5f110056ceefd0f9d173b9f87ab980545883f5e38d1033c23ace0ef2e680c45dcdce39a632236696d4fd76afe74e8c02dbf4262a5f08e3c9ba0269752adeb6a73ff3f63462468d322b945d7d192370917567d0a14f19787cf67daf800b9aa270f9553525bf5b6cdce9919f6eb343e680179c1561ffad6a340948704b2c9c9ebf60b7af25b14f1f2e0638d97da969a82c7e3ef01d191cc666230cfb8ea780efd02edbf742d7ee864c6c64638f1ec417109e4391927fb8754f268323ef3cdf9c4849a16ad47890d37a3fb2d5f1c13e3fbdec8d0b6c0d41dd0408d061960a245ba8a1866f88178378980b2ff13e76c957a3e620e9a39186ef564515b2cfcf3c108b832ddbd9c63ca6e086746251488c1a09964455030ce3460a3a9bb16ee8e29eb976707425a7c45c14281eba115809066113d47bb82ee0909f80335e397f0900dfc970452cab190aa04d3018cec371da9bfe03251e5e5680cb2755e341d63bedd797b1200fab88ed33b75562d8f68d020c3b1cfd79e379c7978410c2529c073a43ff3c1aa647af9741a69d6304c1c3903f4969142f347095a70fd0128c1eacb6c2a817496aad4e4d00a349be0c31808b5b6a367112204ec8f8fc1f92b1f87091bee98faebc7ee6aed034f0be0e3f46a0e33219ca8bbad5e725a6788898c7d866eca296732eb3318a31709b0ea14c95669b2e6b0f326bc95966acfc3d3891802f87c211eafade48127f0f92cb04548fd1c85eb696612ebfd4a4203b39fc95fd9c4d2dc4812d22bc82c1f411a6d301e30e9fb8654e508cdd7e162096d3d5ab02bba0056cd2d1db3a545b7d110a56fb5aa00c57cd4cb26c3ae9323840bb59ffaf518a655f79a699766a38e829419ccede9843fd41d8f44fa90dc8801665b0212c0d80bf41912689c9d93cf2ae81f1a434a7c6652077deb2af77f989bd693f0f45712e1658cb3f827b35522338b7d0ebbb7a60f2c5239b3c122720327733317af09fe8348f571ff3a57172759aa289ccb67ca75706ee2ab2f3516b94877035445d52fbd1c350250031ceacb729f051622bf7a1e35042985ebc560416d93575a4a4550f8ecd7753559a6cf77512b978915c1e54999e42ccc165a6cb88725879dc46c1dc12bdb3b2e6e59e185a8c0fd352a3120a36f95cb929d92b4d7e3ec96faf43b4c79a5aadf7343f16c09e26fab72e8bfa1c0151398e9eeee3f872bc330e240216476511e3d6e7d0654e086ffdda40c268c84c3a159e8f7a5fdd1ba58be0f899962fdd2a2f978731b2bf4f8c01d2ee347832cd1e77f7825ffc150ad08493980fc5e29fa273583e23f8847026f71f43a063f345d43e787b56ab3a95a4a9355436084dbf6b13e10049e73212e215a7b96fdc4573dfec819efe1d07779d74ee55b90ef23f217eb4180196651a8993c0ec5b8c29a264655bffe97eed9952ff1339bc97a0fe799e89ee841bf3abdf5f853649ae9ca8f63f63a50bd2c88b63d24e15910a41ed86f9a5b58249c2a5d62c1e0ed9529b07d712c8d52a20145af5258e1d3dfe94e2e4ba03f517a1b1ecb73d809c1f705151497eb95605582a0b3aaf88b5004daf0766e380585348b571900a5c2db6e979972446159de2e6a3bcd4685de6e7e2133a452bcc2e9c9754d4c91cea6a1fe7aed67ce986a619dc512c5b268afe9045a6155a0e1681fb79ef678a796fdb60797a4f9b566e023611661effb7d84ffcc7530668b9d8f52b84d69424c98b80aa37a4ed019ee6a5b29faf48cb2308452224db7543964350947720a0d7d53b21398eec5f9d52375c29c40f32bb458e9f1796c9fd2831f75617332ab83f849c16dfae43775bc3838eff21881ceab3f8a3f03661ceedc0a0b166adbe001eba89b68a29c387446ebba40b3377cd06dfe91eb9024b29e679059db2b5381ac2f5810c8f1740d46c1454462494c9b5c1dc10490aa31c2d87a659f9c04cce2f2427ed73183684ab962f6e0e3375cd2f8af0c7c40a654489435a91511d71e2fe7b90c89233db636172998657d66e22d6f02b127d0f275f595148a22010eddcd59c09a9bd8b2dbb187123c23894d5b84a525f046aaf42897ba7aca0875c83347b1af5b9e77129c45f6d2e183693261c6b64e8bfefb31c0e8c3b34ecae08d87a019a83b3a3fd11717371d021a4d97d20a9692bdccf72e8c4eb6372cd5bdc33d63b8b73b04203da1ec74ecd7cc6ef84cb411870a59ff0699b13f328235da09b36efa53b4459be7d7dce4dc54072e302b1d3b8ef20481a231a0628953b28bc308fbfd3a621abc8e54e97b48a93f6052724c89fbd1e1281ae1ac5e9a5b8efe11a8d2ff8e7580f86aeb34a141d3dcba97000f05465888e12f236734711c3c4a9c5947ae63e59355a834b4e6b52e2ce58cf099b264b2007b448ae6869dc55849577d8bb2098dc7c5f920e5a90226420569375d73ca2f430cf9c21628296bf9f734c5978752109bfe74597182da8ab467f8c78423a6f092ddbdbb0dda8ada54ec089bab2a4132319d9c43f92599311ffa9a6201047d61254e47f53c190346d2bf8354a39b1582c5696e41f26ea43aa43770789aab38476a582f7d63f0f162111adcf196dec619c44c0aaa15690d09d37ec970ba82681a55b2f267e38b79d8c15acb606c2fd84a79f928483c0227564d40bc9dc8cd5c5c861886da7cf463e688bf3d060d25f0a1550e5a7550314d73b5505fbb6c6adee3ccb82e2e5509a54226651f5d9e178c42c8535c59f3a8cb2d27559ef5f8431b627c5c3ddd018663675eff4037ad9b4b9c6533aa6ef701d28f5891e55283d87e6c856ca78b9a6d05bac3cb96d50b388ceece496c175620667c81e6377a5b6f30f20f9e294a2b0b403ed253b4904f5afae70a3fb41b69eda7ba57fe9197c4ca42cd5bc14bddec7567a3653c003c12c67780b87559276151676e5c2096b1d9bddfe0d217e6799ed6c6081d3054b632501018b129823cba772351e4bc9be83122a8a158e55407b0822621eef90ace71a29e9ca70fb8f5a8999711aa386811e1d28256f7a05e70df860253401ad0ffae6554cd895206ef7fa4655921a1a5527e51760cd0e85d23550cb0e77934b189b01b7cc5945e152fbf78ee7c5301334598b85982cec979a57ec4871a0f5f0a0d894a162930ce3d53740f662ebc1a11d8da7dd1cdc3d4df9cc7319100c25f91abb2ba9fa52c576289799f75c24d667a547a4b6b0bca67fa06032cf69c116a538e385c98acc6d1d0331e8c49e24562c4e4c820791d4daa3cee78f3abd29029add81b01f88875396445f0224b110732b43ee92d4f941eb84b237af3da230d1f4e9395d383d22ccf20a70f6114bf3b3fa9fb973a16a8a62cb1efe95e95f1d8885550cd6cd924f6ec775233981d51615ea8b71991ec646fb980f966b47281ef2d9866eb0d1c515c68b1c1c504e90e90bc688ab341e707a0339221fcc8da50ceeac8a5193994342af4a5f08531d9ea0397913ea9087053b6dc9b5c8079a787a7f9414febd803eb591e8663ea83b1eeabed00db5047c27d8f40e56b23710f29ccd029a029430d4f40ba72ea9365537575a9abac83bc4fd6d45a4c10b0a92a8d7d003d6dad6b5456a34c6801c063a9b10ff460e5962e9450594c73b03f5e6f9dca2acc61dc27450c7d1cc1844704d272a5dc10eab37c7585fb0fb267a5510b43ad01a9f29101837f3babed7dd9c17c9f1fe80e7153b467e4efaaae9c2ec85c7d0694c69220c275e438faef9e63f603e62852fb02afd3ef4f9267ca90803f58ffb84611e63cac9399f55a8d506535e06ee88c324847404ce8bae96a6f47fc982999a3f2eea8aa731ef52ee56ddb693f4b5718875ea47df9ac26710a0a4731adb66eb4ebc98a46f189f2db4473243674abf5c6a378213a475c8f881b087b379d6dee4da9b7fd68c6516dfde21929b472b684d245da15f1c02d9fbae42a8e61cb767638e89872f20a83b53a3671956b47f7395205a25bf4052c597cdb1374c2df454fd5a61404857232a04d3ec290a34306e882846b54ff5192d18c02b3e479164a125c91e706add5c941390907b71ec9bb1d63ce55ef629c829bf10bae490d90fc267258b909ab9cedd656a598b1781338508e9227e534417640aa72731f99ecec7873b4f72ff759527987a3f8409b118344618c657004484dff00246cd4ca118022ef5ad95a25550d3e3a35edb9b2f721cde3978cf732fb0f68c4170ffe9c76b9e8c30c0109b0c9500ccf1d59de2eae880bda65b22d90476a6326f39504ad8562b7588b8d4465f6003df7b3256af391b6554d458c7b173b9bff6375eb6823ba7e480084130cf1f68bea90e3f417d3966ad15e50307dd4c8b003eba9377ab2457c794965427b0279201428ec0e907b646ee2b403cdcd1970cf0ced084e9836262ad634778ebcd822fbf4527dd5fb423b74ac07db469a912e97f2a405a6ba86b6dced71a83f267086b2cc40d0b63024fbf1cc655499b8cd9c998929e637ff07e7c2245c45bcc153550972b4f80f2a4eb3131cc9a65862d4b574473dba72301f1615dfd1921a2cb4497fc6d8f4df00ea9e9af13d4c321614ae93bf71eb15fa859c284ec18ad915dbba9fe9350488e5bb0a103e0dbbb396d95a3a96e589f1e302f2787442a04f6fc94f886145084bb90d1e54b5a0fdd95b33aec24fbcbf6ed46a4063fe9f2089edc9b9396061f3f4f2e1b1d1fc061aec05b8a1ad4e71280413262912d7e7e73ab9cbe66895ba902493437cecbe7fead8f7b783f4fd8279b7750beb818770088e8a37931ba75239e2011e4493442d32add3977739bf748b8fd1b9642c06019ca5e3a97bc028cfc653f7454e713c63b1574bde1ce641202e6bf2ca33b047d756b4c4312a90f38142e612ccd124eaa42a54fb3fdc3e1d870732edc9387e0d42a0390e5ec619dc306f33694d547605817b226bec999d269534ab4b497e6a05fbe1dbced07c38cb875036cae445bcae43b3960b56b01e563913b91412f72088f2696b4b3a03f501925a86b538c3a3cfbb8f7814fe6f4eacf5eaa5b55c47c05415ed186841f0e723fc31bfa4ef5d5523d85f86492d46362a93259aa77cf735a7c04325d62198b93d0597ac77f0e57235f9e0e3d7f5bdefc88960d4f3cddc975f3ee80149f1b318dbba33a25fe0ba11ec2e63518de59c67a4dd00459b472d5a06b309cc4d0bc0f7c4c76dc28feb8f5f4bdb37f902b7d75bc468a4b082a378c5813876dfccd768c9159a7b275b32f4b7367e30ff386580d5519b593dc425d20aee0f8c5e90f21c533db594003e6ca70f1e715bd049afa13ed24d2a240c74f61e62c562afcf2b8acba4296e7a177b5519a8903db32686e66cb3cf76a4ce63b5934e1a799d1d2b225ff5e14cb351d0ba5173fdb5a85b946cad77807970f7a5304da2a93eb9f88cc35b82f40a1dc402fa2c0b1a8f7823f6ca7a717b3e7a3ee6dd3c095af79147530c0ceb19b049b207d52e7b991dbb816f1fdd190707da9818cecfaf3212c46ef48e843a3097a89455233480caa0dd7c75afc7f3ef628ad518276d3f4a670edc746c6fc2bf84e608a7c24bd706eec6d318953ba2341c6531a4c30d31aedeae7a39d5545adbe50ac682ef50bde93b33c046d3c052d1a5d266971ff16ff1d64b089ef5bc928df0dbaf52a4ad66ce15bd39ee16378181dd4c5bd75447b274ef9d90254c368ef60bd5e99d2dbffb161c76127c646f75493ce9aada82ba88410e16e70a437d111e701002301f45e26f0053b0df8b3d886fbd8c683183d2b3b50c41213bc2f108519bc5f14e8cc98ecd9c8978123c3e862cc166a72b4afe04004b0fe5ba3b38f4a978d1bf7c05091f5459d923f4d512ab1da246af15dc1d7078da920a36fbce5d33ae91924cfefae298d09c2a7d74e86953d57ce2c8a054bf439f97bc7a5bef4f7f5cd9ba1445661560be2d80e540a119d4adf140d286c2b45550785440de6e781ab8e12b8a9636eac31d4b3ea51f3c38af2a03ac4bf6e91d20bfb5476d0c50d8fab8381292d22d242a8bb28743c948284fb20aa0a690caf4723dfeed9b06e20fed564227ed05053ba6704546846d0ce8cf085afb6eb049569269fc4a11eab6f8366175f80d34b8148be00a1a0ff3aa0295611d89983e655fb07c0d12fe561407ab86f317b0115b50b4447efbb5ed8e24540497d241b7e1cd1e60cf441d207b7d3b07391014dddcd06f534a3f083e4063ff2e56f36c5f13e120f1fc6d4830bb963a6b9457b8026057614f488480d877a3d85b3e4a13cf24d753cdf1fbb9e6cc81d3f66077313845fcaa318496d0a9aaa4adaeaff69d03ef99e308afc7c99d7b480e0a949ce484640cfa221dc0d67d2d21f0848b26d08b64815522d708f8c806601562a5b58f6ff680766878cee71bd5d034f168b5eaa7c55fc3d07b2931b0c640895996920292d516e2f494d5f851af3d5ed96a1493537de5e8a8a096a002e71c5506e4058c05109d9d196c06e4e36e9b26be843dcfbe2f6196d61c4b7cd94ed93a6d6e345581703bd42ac3ee82cc71060c4e0cf9ff41e1157c40307d4b059b0a3daddcad7ea6e5f2108835f6c5ba0850d6c50f1e050bc73919fa1b23e25d8da6e3a42e87e2d76e358392c2635d3497955790dcc97e458e4ce6f9e5407bb9c9323b847a4715c1dfa4eff6ac5609ee309433234ab3cc0c26a342e614562a124640851f8b61f1f0591ef88cbab9b2dc01e765e292582e5568c90233297d5c6329571aa981db4ae928a0c510a2f7e9bdd4bdd64b14d580caf6b518c73ea78d00431244f3eb9c0ad4b6b906ab35c60c933cb66d2408aff628878960ed7c3b71d29b410610feea1672bdebe5fa87e8b90b2f9f055d9b867e9865b0decdc60b2788262f79d34b752d0f517434ab186713696590d59cc0ebe71af6e748e48c5d84b3dd9bb592c7f15bf7290e1a176862d5e647ff501fd49c850d99ed75611aa9a4662b17e7d05b05ba9f5360987284044013e899e5d660173dc2cf2f3298fa0a2b506396ef720bdb278fb99802d9e009a1590ec21301a7978cc19b1387caae23d19c32787c406a0750db0bdda76a72037a0730e0b3f033cea9bb4aeb5973d13f921b34cd72f9d7f80609b00959d7b47f07451955d20741951e43b8259fa1f77922bd1dc175279c0647e71932db0af2a83bf708fa7c1dbb4458925ff2f55ab3dbaafdace0e73a9e5ed041ff950fcf31ddf66cc6888e0157ec6b5a766344937ff925c543537bbcd3d2f10a15a9f0144406a31611aea7172946e611ecba086d1dcb622a6431daa428a6c5345fe551c9c498fdf23ac19e8232648ca24869bb46c69acc2081994dc1d128d0306a997f58f308a3eae4f078c792c6d97ee186c4b4bcdb2f9c381976558ed2f42670229a78e29ac1adc56052992117c21db9988ba97732e27956f1437aa02a04d95e78ad5306b09e81ea71feaa05075ebdca34cb8af9bc0a1db8072f8b679edfe24ffa2b3221f5e3011e0c40a10092d5291c2bdc1df1a67f86bec6283a86df13daff9dc1af4a9241c74b5a3d6e5f2ac7df687161428aa07fdfb7f9b38d1bce04fed5fbe79e0ca57f274e4a46c7bf51a2a46c163fabc2868c55a97fddec331f893321106b2d3607915e1d54179709c9c34367cd325ad46884cc9b63f091349369012b618a308245438fd9e42ca9616b4ee5076c2388baca81f975ca91bfb48a81be458b9eb52c8e4f7d889d1f585af884dd53f41a4f549ca93c4d39a62cec2b232cec58f601941a428191f3d78ef2cc57e45e519378dcb6d05e3f55230944d049d8a118318e39aedbc58dc5fe8e93e608c8d4aa19cb8fee73f58edf65be3a63409adb8bf73ac3d465afc35a271b74221afbc010499c4ba3746d5384a71a6faa09df3362fa50c046547a15dbd41606a533c03d9ea3ede61ad7c6ce6936d6f46ef211039572e0df2b2f89a0e92586adf9725a23410da715663cc7dc3fd966bbdb2c17fd0c3c60bc66baf2e20609ec3a623b12bd42233541caf5587716b091762d4d07653318b4a2e3d8fbee377e140344eee1495f751e1ccb390af609fb66ccc79b36fd2b72de1d08a89dc7aea61df2abc704f1688267702a88b13f6b318a6901266555f254185a463951a23c3f776970f1a401ceb8a4570da845fef5b069f922114e2fd22fe7ba18b3281647695c4d71ca2e402bfb6c456ca151f5a0505e4f3e61930c55ebd2892f10581edfeebb1b92d2949c71a15fb1631d4b652c04a9ac798490b629a513e4f93d9d228ca769e2a5e11cfd1bd8270cb628601b97ae032e8b5b326b646e6ec1486868bf09656f8fc5068bbca80d3ceab682508e470edbe486567159fce083bd209f4141aba8368c131454164b343df6258b8475a6cea409ce59b8bb457409a15f625aab0f543b96cc13e7c1b50e500adc817e256b4af23ee9b2d99efb6d0db461366c2a2de687453136dac1e8922199e009f10055eecfed7725bb86f41a6094323bf0a3fa22815aafb8ef5812fba170867b6619737134ef6c8bc12cf2856acb26ba8ecff62bcea034878f6c733b50e401bcdd17ddc1a54f305b7588d404c3bb88df43c81bbdb46854e16f9573f7e7054be3a91e1153ad597ce96c47dad4cfc0d3d7af0c952748106e8c627ce875b9a03be476a9b8b62e8ad39400b3e81cf831100284553904fdee784c29ec311774959ff36a0167a594eabd94af3a5d6d3b35adee88e250fd82b7f7a49c0d64e661aafea68b6dfa219dfff6b3df1e051f264cc3612b63cea673ca96c46ac531d1572f3590d4b8a9331c7c774ec93f3a15a24ab473f0eb2fb93fc445e5445447b6cb360de1650fa496799174cd1187746507a2b5723b3587070826e303043e1b628826ec5cb66f072f090f1d625c0d3f823e0ad4a615651687481a8a2c16b665484a42aafac19234448e057b87baa37db67a8d184de1b8121fd8a09b597359fc51171b8d97d293865dc68dba459360eb7a208f6c3cf148c8bcf3ed47b2a9418017d4c2a63bc29a36fb50139156e8610fa108e045b85687790f389b408215282f0de7272da16df54107c0836d85912ffd71765e8d5f034c77385919779b12cfdd907da4d6ad06962eef3676edc6a1f0aa9467f325f90983a009d3175de4b4a174853dd015f1e75d8978d9a25aaa98edf839d94e3c0ca4746cb32e8e32d0852d56d8e62712fb7474d03a6df9ef29203f284cc84ab85ecbb6d489f1ae35ed062e53a680c9b8f09ca71e8bea9cb1c1021ae570eed57fbaa380e61e4c7cd0ea47ce63f8fa9229b9b8c6761082808cbb0fde982f51283725ea1fa3166f89dea6bd4a732ccd1ed83ffb6b217164d78d148116b7ec61307bebad03136e160db08aa80f4d3f05c23b3648f9af0b92263bd66acb3d7032aee8f74e2a7a52d6c8d9a3352426f43843b2d0a3fb2b28c98014fe0218a18c17f1d8257364d821d6ef8dd506b5782252feff4a92dfc060c0cb764221d79d4a7eab54644d4629c9cdba3d9a70a8342d39a343078f44d120cc9feceadc3855adbd65ec42d115e2152cdb2365b004f2ee52b43e205ed2fe75944a7b440703f045548b431e30fb813a192c6a87a3a8bf91d4c07ec17040efa</script>
  <div class="hbe hbe-content">
    <div class="hbe hbe-input hbe-input-xray">
      <input class="hbe hbe-input-field hbe-input-field-xray" type="password" id="hbePass">
      <label class="hbe hbe-input-label hbe-input-label-xray" for="hbePass">
        <span class="hbe hbe-input-label-content hbe-input-label-content-xray">Hey, password is required here.</span>
      </label>
      <svg class="hbe hbe-graphic hbe-graphic-xray" width="300%" height="100%" viewBox="0 0 1200 60" preserveAspectRatio="none">
        <path d="M0,56.5c0,0,298.666,0,399.333,0C448.336,56.5,513.994,46,597,46c77.327,0,135,10.5,200.999,10.5c95.996,0,402.001,0,402.001,0"></path>
        <path d="M0,2.5c0,0,298.666,0,399.333,0C448.336,2.5,513.994,13,597,13c77.327,0,135-10.5,200.999-10.5c95.996,0,402.001,0,402.001,0"></path>
      </svg>
    </div>
  </div>
</div>
<script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      <categories>
        <category>架构师笔记</category>
      </categories>
      <tags>
        <tag>jstack</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot参数校验</title>
    <url>/springboot-validate-params/</url>
    <content><![CDATA[<h2 id="1-前言"><a class="markdownIt-Anchor" href="#1-前言"></a> 1. 前言</h2>
<p>在控制器类的方法里自己写校验逻辑代码也可以，只是不够优美，业界有更好的处理方法，主要有以下几种。</p>
<h2 id="2-pathvariable校验"><a class="markdownIt-Anchor" href="#2-pathvariable校验"></a> 2. PathVariable校验</h2>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 使用正则表达式限制group 只能是a-zA-Z0-9_</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/path/&#123;group:[a-zA-Z0-9_]+&#125;/&#123;userid&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">path</span><span class="params">(<span class="meta">@PathVariable(&quot;group&quot;)</span> String group, <span class="meta">@PathVariable(&quot;userid&quot;)</span> Integer userid)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> group + <span class="string">&quot;:&quot;</span> + userid;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当请求URI不满足正则表达式时，客户端将收到404错误码，不方便的是，不能通过捕获异常的方式，向前端返回统一的、自定义格式的响应参数</p>
<h2 id="3-方法参数校验"><a class="markdownIt-Anchor" href="#3-方法参数校验"></a> 3. 方法参数校验</h2>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/validate&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">validate1</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="meta">@Size(min = 1, max = 10, message = &quot;姓名长度必须为1到10&quot;)</span> <span class="meta">@RequestParam(&quot;name&quot;)</span> String name,</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="meta">@Min(value = 10, message = &quot;年龄最小为10&quot;)</span> <span class="meta">@Max(value = 100, message = &quot;年龄最大为100&quot;)</span> <span class="meta">@RequestParam(&quot;age&quot;)</span> Integer age)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> name + <span class="string">&quot;:&quot;</span> + age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用@Size 、@Min、@Max等校验注解进行参数校验</p>
<p>如果前端传递的参数不满足规则，则跑出异常，上面代码中@size、@Min、@Max注解来源于validation-api包中。<br>
更多注解参 <a href="#index1">参数校验注解</a> 小节。</p>
<h2 id="4表单对象vo对象校验"><a class="markdownIt-Anchor" href="#4表单对象vo对象校验"></a> 4.表单对象/VO对象校验</h2>
<p>当参数是VO时，可以在VO类的属性上添加校验注解。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Size(min = 1,max = 10,message = &quot;姓名长度必须为1到10&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotEmpty</span></span><br><span class="line">    <span class="keyword">private</span> String firstName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Min(value = 10,message = &quot;年龄最小为10&quot;)</span><span class="meta">@Max(value = 100,message = &quot;年龄最大为100&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Future</span></span><br><span class="line">    <span class="meta">@JSONField(format=&quot;yyyy-MM-dd HH:mm:ss&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date birth;</span><br><span class="line">    <span class="comment">//。。。</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中，@Future注解要求必须是相对当前时间来讲“未来的”某个时间。@Past表示过去的某个时间</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/validate2&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> User <span class="title">validate2</span><span class="params">(<span class="meta">@Valid</span> <span class="meta">@RequestBody</span> User user)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> user;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="5自定义校验规则"><a class="markdownIt-Anchor" href="#5自定义校验规则"></a> 5.自定义校验规则</h2>
<h3 id="51-自定义注解校验"><a class="markdownIt-Anchor" href="#51-自定义注解校验"></a> 5.1 自定义注解校验</h3>
<p>需要自定义一个注解类和一个校验类。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.validation.Constraint;</span><br><span class="line"><span class="keyword">import</span> javax.validation.Payload;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(&#123;ElementType.PARAMETER,ElementType.FIELD&#125;)</span></span><br><span class="line"><span class="meta">@Constraint(validatedBy = FlagValidatorClass.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> FlagValidator &#123;</span><br><span class="line">    <span class="comment">// flag的有效值，多个使用,隔开</span></span><br><span class="line">    <span class="function">String <span class="title">values</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// flag无效时的提示内容</span></span><br><span class="line">    <span class="function">String <span class="title">message</span><span class="params">()</span> <span class="keyword">default</span> &quot;flag必须是预定义的那几个值，不能随便写&quot;</span>;</span><br><span class="line"></span><br><span class="line">    Class&lt;?&gt;[] groups() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    Class&lt;? extends Payload&gt;[] payload() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.validation.ConstraintValidator;</span><br><span class="line"><span class="keyword">import</span> javax.validation.ConstraintValidatorContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FlagValidatorClass</span> <span class="keyword">implements</span> <span class="title">ConstraintValidator</span>&lt;<span class="title">FlagValidator</span>,<span class="title">Object</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * FlagValidator注解规定的那些有效值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String values;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initialize</span><span class="params">(FlagValidator flagValidator)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.values = flagValidator.values();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户输入的值，必须是FlagValidator注解规定的那些值其中之一。</span></span><br><span class="line"><span class="comment">     * 否则，校验不通过。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 用户输入的值，如从前端传入的某个值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isValid</span><span class="params">(Object value, ConstraintValidatorContext constraintValidatorContext)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 切割获取值</span></span><br><span class="line">        String[] value_array = values.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">        Boolean isFlag = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; value_array.length; i++)&#123;</span><br><span class="line">            <span class="comment">// 存在一致就跳出循环</span></span><br><span class="line">            <span class="keyword">if</span> (value_array[i] .equals(value))&#123;</span><br><span class="line">                isFlag = <span class="keyword">true</span>; <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> isFlag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用我们自定义的注解：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 前端传入的flag值必须是1或2或3，否则校验失败</span></span><br><span class="line">    <span class="meta">@FlagValidator(values = &quot;1,2,3&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String flag ;</span><br><span class="line">    <span class="comment">//。。。</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="52-分组校验"><a class="markdownIt-Anchor" href="#52-分组校验"></a> 5.2 分组校验</h2>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.hibernate.validator.constraints.Length;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.Min;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.NotNull;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Resume</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Default</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Update</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotNull(message = &quot;id不能为空&quot;, groups = Update.class)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotNull(message = &quot;名字不能为空&quot;, groups = Default.class)</span></span><br><span class="line">    <span class="meta">@Length(min = 4, max = 10, message = &quot;name 长度必须在 &#123;min&#125; - &#123;max&#125; 之间&quot;, groups = Default.class)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotNull(message = &quot;年龄不能为空&quot;, groups = Default.class)</span></span><br><span class="line">    <span class="meta">@Min(value = 18, message = &quot;年龄不能小于18岁&quot;, groups = Default.class)</span></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="comment">//。。。</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 使用Defaul分组进行验证</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> resume</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/validate5&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">addUser</span><span class="params">(<span class="meta">@Validated(value = Resume.Default.class)</span> <span class="meta">@RequestBody</span> Resume resume)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;validate5&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 使用Default、Update分组进行验证</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> resume</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PutMapping(&quot;/validate6&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">updateUser</span><span class="params">(<span class="meta">@Validated(value = &#123;Resume.Update.class, Resume.Default.class&#125;)</span> <span class="meta">@RequestBody</span> Resume resume)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;validate6&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>建立了两个分组，名称分别为Default、Update。POST方法提交时使用Defaut分组的校验规则，PUT方法提交时同时使用两个分组规则。</p>
<h2 id="6-异常拦截器"><a class="markdownIt-Anchor" href="#6-异常拦截器"></a> 6. 异常拦截器</h2>
<p>通过设置全局异常处理器，统一向前端返回校验失败信息</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.scj.springbootdemo.WebResult;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.CollectionUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.validation.ObjectError;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.MethodArgumentNotValidException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ControllerAdvice;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ExceptionHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.validation.ConstraintViolation;</span><br><span class="line"><span class="keyword">import</span> javax.validation.ConstraintViolationException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 全局异常处理器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobalExceptionHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Logger logger = LoggerFactory.getLogger(GlobalExceptionHandler.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用来处理bean validation异常</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ex 异常信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(ConstraintViolationException.class)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span>  WebResult <span class="title">resolveConstraintViolationException</span><span class="params">(ConstraintViolationException ex)</span></span>&#123;</span><br><span class="line">        WebResult errorWebResult = <span class="keyword">new</span> WebResult(WebResult.FAILED);</span><br><span class="line">        Set&lt;ConstraintViolation&lt;?&gt;&gt; constraintViolations = ex.getConstraintViolations();</span><br><span class="line">        <span class="keyword">if</span>(!CollectionUtils.isEmpty(constraintViolations))&#123;</span><br><span class="line">            StringBuilder msgBuilder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">            <span class="keyword">for</span>(ConstraintViolation constraintViolation :constraintViolations)&#123;</span><br><span class="line">                msgBuilder.append(constraintViolation.getMessage()).append(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            String errorMessage = msgBuilder.toString();</span><br><span class="line">            <span class="keyword">if</span>(errorMessage.length()&gt;<span class="number">1</span>)&#123;</span><br><span class="line">                errorMessage = errorMessage.substring(<span class="number">0</span>,errorMessage.length()-<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            errorWebResult.setInfo(errorMessage);</span><br><span class="line">            <span class="keyword">return</span> errorWebResult;</span><br><span class="line">        &#125;</span><br><span class="line">        errorWebResult.setInfo(ex.getMessage());</span><br><span class="line">        <span class="keyword">return</span> errorWebResult;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler(MethodArgumentNotValidException.class)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> WebResult <span class="title">resolveMethodArgumentNotValidException</span><span class="params">(MethodArgumentNotValidException ex)</span></span>&#123;</span><br><span class="line">        WebResult errorWebResult = <span class="keyword">new</span> WebResult(WebResult.FAILED);</span><br><span class="line">        List&lt;ObjectError&gt;  objectErrors = ex.getBindingResult().getAllErrors();</span><br><span class="line">        <span class="keyword">if</span>(!CollectionUtils.isEmpty(objectErrors)) &#123;</span><br><span class="line">            StringBuilder msgBuilder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">            <span class="keyword">for</span> (ObjectError objectError : objectErrors) &#123;</span><br><span class="line">                msgBuilder.append(objectError.getDefaultMessage()).append(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            String errorMessage = msgBuilder.toString();</span><br><span class="line">            <span class="keyword">if</span> (errorMessage.length() &gt; <span class="number">1</span>) &#123;</span><br><span class="line">                errorMessage = errorMessage.substring(<span class="number">0</span>, errorMessage.length() - <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            errorWebResult.setInfo(errorMessage);</span><br><span class="line">            <span class="keyword">return</span> errorWebResult;</span><br><span class="line">        &#125;</span><br><span class="line">        errorWebResult.setInfo(ex.getMessage());</span><br><span class="line">        <span class="keyword">return</span> errorWebResult;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="7span-idindex1参数校验注解span"><a class="markdownIt-Anchor" href="#7span-idindex1参数校验注解span"></a> 7.<span id="index1">参数校验注解</span></h2>
<p>Java中参数校验的注解来自三个方面，分别是</p>
<ul>
<li>javax.validation:validation-api，对应包javax.validation.constraints</li>
<li>org.hibernate:hibernate-validator，对应包org.hibernate.validator.constraints</li>
<li>org.springframework:spring-context，对应包org.springframework.validation</li>
</ul>
<p>JSR 303 是Bean验证的规范 ，Hibernate Validator 是该规范的参考实现，它除了实现规范要求的注解外，还额外实现了一些注解。</p>
<h3 id="71-validation-api中的注解"><a class="markdownIt-Anchor" href="#71-validation-api中的注解"></a> 7.1 validation-api中的注解：</h3>
<table>
<thead>
<tr>
<th style="text-align:left">配置项</th>
<th style="text-align:left">说明</th>
<th style="text-align:left">适用类型</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">@AssertFalse</td>
<td style="text-align:left">限制必须是false</td>
<td style="text-align:left">boolean Boolean：not null时才校验</td>
</tr>
<tr>
<td style="text-align:left">@AssertTrue</td>
<td style="text-align:left">限制必须是true</td>
<td style="text-align:left">boolean Boolean：not null时才校验</td>
</tr>
<tr>
<td style="text-align:left">@Max(value)</td>
<td style="text-align:left">限制必须为一个小于等于value指定值的整数，value是long型</td>
<td style="text-align:left">byte/short/int/long/float/double及其对应的包装类；包装类对象not null时才校验</td>
</tr>
<tr>
<td style="text-align:left">@Min(value)</td>
<td style="text-align:left">限制必须为一个大于等于value指定值的整数，value是long型</td>
<td style="text-align:left">byte/short/int/long/float/double及其对应的包装类；包装类对象not null时才校验</td>
</tr>
<tr>
<td style="text-align:left">@DecimalMax(value)</td>
<td style="text-align:left">限制必须小于等于value指定的值，value是long型</td>
<td style="text-align:left">byte/short/int/long/float/double及其对应的包装类；包装类对象not null时才校验</td>
</tr>
<tr>
<td style="text-align:left">@DecimalMin(value)</td>
<td style="text-align:left">限制必须大于等于value指定的值，value是字符串类型</td>
<td style="text-align:left">byte/short/int/long/float/double及其对应的包装类；包装类对象not null时才校验</td>
</tr>
<tr>
<td style="text-align:left">@Digits(integer, fraction)</td>
<td style="text-align:left">限制必须为一个小数（其实整数也可以），且整数部分的位数不能超过integer，小数部分的位数不能超过fraction。integer和fraction可以是0。</td>
<td style="text-align:left">byte/short/int/long/float/double及其对应的包装类；包装类对象not null时才校验</td>
</tr>
<tr>
<td style="text-align:left">@Null</td>
<td style="text-align:left">限制只能为null</td>
<td style="text-align:left">任意对象类型（比如基本数据类型对应的包装类、String、枚举类、自定义类等）；不能是8种基本数据类型</td>
</tr>
<tr>
<td style="text-align:left">@NotNull</td>
<td style="text-align:left">限制必须不为null</td>
<td style="text-align:left">任意类型（包括8种基本数据类型及其包装类、String、枚举类、自定义类等）；但是对于基本数据类型，没有意义</td>
</tr>
<tr>
<td style="text-align:left">@Size(min, max)</td>
<td style="text-align:left">限制Collection类型或String的长度必须在min到max之间，包含min和max</td>
<td style="text-align:left">1.Collection类型（List/Set）<br> 2.String</td>
</tr>
<tr>
<td style="text-align:left">@Pattern(regexp)</td>
<td style="text-align:left">限制必须符合regexp指定的正则表达式</td>
<td style="text-align:left">String</td>
</tr>
<tr>
<td style="text-align:left">@Future</td>
<td style="text-align:left">限制必须是一个将来的日期</td>
<td style="text-align:left">Date/Calendar</td>
</tr>
<tr>
<td style="text-align:left">@Past</td>
<td style="text-align:left">限制必须是一个过去的日期</td>
<td style="text-align:left">Date/Calendar</td>
</tr>
<tr>
<td style="text-align:left">@Valid</td>
<td style="text-align:left">校验任何非原子类型，标记一个对象，表示校验对象中被注解标记的对象（不支持分组功能）</td>
<td style="text-align:left">需要校验成员变量的对象，比如@ModelAttribute标记的接口入参</td>
</tr>
</tbody>
</table>
<h3 id="72-hibernate-validator中的注解"><a class="markdownIt-Anchor" href="#72-hibernate-validator中的注解"></a> 7.2 hibernate-validator中的注解：</h3>
<p>下面列举的注解是hibernate-validator-5.3.6版本的。</p>
<table>
<thead>
<tr>
<th style="text-align:left">配置项</th>
<th style="text-align:left">说明</th>
<th style="text-align:left">适用类型</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">@Length(min,max)</td>
<td style="text-align:left">限制String类型长度必须在min和max之间，包含min和max</td>
<td style="text-align:left">String, not null时才校验</td>
</tr>
<tr>
<td style="text-align:left">@NotBlank</td>
<td style="text-align:left">验证注解的元素值不是空白（即不是null，且包含非空白字符）</td>
<td style="text-align:left">String</td>
</tr>
<tr>
<td style="text-align:left">@NotEmpty</td>
<td style="text-align:left">验证注解的元素值不为null且不为空（即字符串非null且长度不为0、集合类型大小不为0）</td>
<td style="text-align:left">1.Collection类型（List/Set）<br> 2.String</td>
</tr>
<tr>
<td style="text-align:left">@Range(min,max)</td>
<td style="text-align:left">验证注解的元素值在最小值和最大值之间</td>
<td style="text-align:left">1. String(数字类型的字符串)，非null时才校验 <br>  2. byte/short/int/long/float/double及其包装类，包装类非null时才校验</td>
</tr>
<tr>
<td style="text-align:left">@Email(regexp)</td>
<td style="text-align:left">验证注解的字符串符合邮箱的正则表达式，可以使用regexp自定义正则表达式</td>
<td style="text-align:left">String</td>
</tr>
<tr>
<td style="text-align:left">@CreditCardNumber</td>
<td style="text-align:left">验证银行借记卡、信用卡的卡号</td>
<td style="text-align:left">String（不能包含空格等特殊字符）</td>
</tr>
</tbody>
</table>
<h3 id="73-spring-context中的注解"><a class="markdownIt-Anchor" href="#73-spring-context中的注解"></a> 7.3 spring-context中的注解：</h3>
<table>
<thead>
<tr>
<th style="text-align:left">配置项</th>
<th style="text-align:left">说明</th>
<th style="text-align:left">适用类型</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">@Validated</td>
<td style="text-align:left">校验非原子类型对象，或启用类中原子类型参数的校验（支持分组校验；只校验包含指定分组的注解参数）</td>
<td style="text-align:left">1. Controller类  <br> 2. @ModelAttribue标记的查询条件对象类 <br>3. @RequestBody标记的请求体对象类</td>
</tr>
</tbody>
</table>
<h3 id="74-注解的启用"><a class="markdownIt-Anchor" href="#74-注解的启用"></a> 7.4 注解的启用</h3>
<ol>
<li>方法中对象参数中成员变量校验注解的生效条件
<ul>
<li>@ModelAttribute标记的查询条件类参数，需要同时用@Valid或@Validated标记，类中的注解校验才会生效</li>
<li>@RequestBody标记的请求体对象参数，需要同时用@Valid或@Validated标记，类中的注解校验才会生效</li>
<li>@Valid或@Validated标记在方法或方法所属类上无效</li>
</ul>
</li>
<li>方法中原子类型参数校验注解的生效条件
<ul>
<li>@Validated标记在方法所属类上</li>
</ul>
</li>
<li>按照分组启用
<ul>
<li>在注解中使用groups添加启用注解的分组</li>
<li>在@Validated中指定启用的分组</li>
</ul>
</li>
</ol>
<p>博客参考地址：<a href="https://mp.weixin.qq.com/s/0VX6lLS133CA4NFCVOHhhw">https://mp.weixin.qq.com/s/0VX6lLS133CA4NFCVOHhhw</a></p>
]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>springboot</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue学习</title>
    <url>/vue-1/</url>
    <content><![CDATA[<h2 id="1-什么是vue"><a class="markdownIt-Anchor" href="#1-什么是vue"></a> 1. 什么是vue</h2>
<p>vue 官网：<a href="https://cn.vuejs.org/">https://cn.vuejs.org/</a><br>
渐进式框架，</p>
<h2 id="2安装"><a class="markdownIt-Anchor" href="#2安装"></a> 2.安装</h2>
<ol>
<li>
<p>安装 <code>npm</code><br>
<code>npm</code> 全称为 <code>Node Package Manager</code>，是一个基于<code>Node.js</code>的包管理器，也是整个<code>Node.js</code>社区最流行、支持的第三方模块最多的包管理器。</p>
 <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm -v</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>由于网络原因 安装 <code>cnpm</code></p>
 <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm install -g cnpm --registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>安装 <code>vue-cli</code></p>
 <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cnpm install -g @vue/cli</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>安装 <code>webpack</code></p>
<p><code>webpack</code> 是  <code>JavaScript</code> 打包器(module bundler)</p>
 <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cnpm install -g webpack</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="3-vue练习"><a class="markdownIt-Anchor" href="#3-vue练习"></a> 3  Vue练习</h2>
<h3 id="31-vue实例"><a class="markdownIt-Anchor" href="#31-vue实例"></a> 3.1 Vue实例</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;div id=&quot;app&quot;&gt; &#123;&#123; message &#125;&#125; &#123;&#123; name &#125;&#125;&lt;/div&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">    var data = &#123;</span><br><span class="line">        message: &#x27;hello world&#x27;,</span><br><span class="line">        name: &#x27;xiaoyuge&#x27;</span><br><span class="line">    &#125;;</span><br><span class="line">    //view model 数据模型 vm</span><br><span class="line">    var vm = new Vue(&#123;</span><br><span class="line">        el: &#x27;#app&#x27;,</span><br><span class="line">        //如果要某一个属性声明式响应，必须在new vue的时候声明</span><br><span class="line">        data: data</span><br><span class="line">    &#125;);</span><br><span class="line">    //vm.$data.message =  data.message == vm.message;</span><br><span class="line">    //实例创建之后，可以通过 vm.$data 访问原始数据对象。Vue 实例也代理了 data 对象上所有的 property，因此访问 vm.message 等价于访问 vm.$data.message</span><br><span class="line">    vm.$watch(&#x27;message&#x27;, function(newVal, oldVal) &#123;</span><br><span class="line">        console.log(newVal, oldVal);</span><br><span class="line">    &#125;)</span><br><span class="line">    //修改值必须放到后面，</span><br><span class="line">    vm.$data.message = &quot;test....&quot;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h3 id="32-数据和方法"><a class="markdownIt-Anchor" href="#32-数据和方法"></a> 3.2 数据和方法</h3>
<p>当一个 Vue 实例被创建时，它将 data 对象中的所有的 property 加入到 Vue 的响应式系统中。当这些 property 的值发生改变时，视图将会产生“响应”，即匹配更新为新的值</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 我们的数据对象</span></span><br><span class="line"><span class="keyword">var</span> data = &#123; <span class="attr">a</span>: <span class="number">1</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 该对象被加入到一个 Vue 实例中</span></span><br><span class="line"><span class="keyword">var</span> vm = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  <span class="attr">data</span>: data</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获得这个实例上的 property</span></span><br><span class="line"><span class="comment">// 返回源数据中对应的字段</span></span><br><span class="line">vm.a == data.a <span class="comment">// =&gt; true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置 property 也会影响到原始数据</span></span><br><span class="line">vm.a = <span class="number">2</span></span><br><span class="line">data.a <span class="comment">// =&gt; 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ……反之亦然</span></span><br><span class="line">data.a = <span class="number">3</span></span><br><span class="line">vm.a <span class="comment">// =&gt; 3</span></span><br></pre></td></tr></table></figure>
<p>当这些数据改变时，视图会进行重渲染。值得注意的是只有当实例被创建时就已经存在于 data 中的 property 才是响应式的。也就是说如果你添加一个新的 property，比如</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">vm.b = &#x27;hi&#x27;</span><br></pre></td></tr></table></figure>
<p>那么对 b 的改动将不会触发任何视图的更新。如果你知道你会在晚些时候需要一个 property，但是一开始它为空或不存在，那么你仅需要设置一些初始值。比如：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">data: &#123;</span><br><span class="line">  newTodoText: &#x27;&#x27;,</span><br><span class="line">  visitCount: 0,</span><br><span class="line">  hideCompletedTodos: false,</span><br><span class="line">  todos: [],</span><br><span class="line">  error: null</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里唯一的例外是使用 Object.freeze()，这会阻止修改现有的 property，也意味着响应系统无法再追踪变化</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;div id=&quot;app&quot;&gt;</span><br><span class="line">    &lt;p&gt;&#123;&#123; foo &#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;!-- 这里的 `foo` 不会更新！ --&gt;</span><br><span class="line">    &lt;button v-on:click=&quot;foo = &#x27;baz&#x27;&quot;&gt;Change it&lt;/button&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">var obj = &#123;</span><br><span class="line">  foo: &#x27;bar&#x27;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Object.freeze(obj)</span><br><span class="line"></span><br><span class="line">new Vue(&#123;</span><br><span class="line">  el: &#x27;#app&#x27;,</span><br><span class="line">  data: obj</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>除了数据 property，Vue 实例还暴露了一些有用的实例 property 与方法。它们都有前缀 $，以便与用户定义的 property 区分开来。例如：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">var data = &#123; a: 1 &#125;</span><br><span class="line">var vm = new Vue(&#123;</span><br><span class="line">  el: &#x27;#example&#x27;,</span><br><span class="line">  data: data</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">vm.$data === data // =&gt; true</span><br><span class="line">vm.$el === document.getElementById(&#x27;example&#x27;) // =&gt; true</span><br><span class="line"></span><br><span class="line">// $watch 是一个实例方法</span><br><span class="line">vm.$watch(&#x27;a&#x27;, function (newValue, oldValue) &#123;</span><br><span class="line">  // 这个回调将在 `vm.a` 改变后调用</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="23-生命周期钩子"><a class="markdownIt-Anchor" href="#23-生命周期钩子"></a> 2.3 生命周期钩子</h3>
<p>Vue 实例从创建到销毁的过程，就是生命周期。也就是从开始创建、初始化数据、编译模板、挂载Dom→渲染、更新→渲染、卸载等一系列过程，我们称这是 Vue 的生命周期</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;div id=&quot;app&quot;&gt;</span><br><span class="line">    &#123;&#123;msg&#125;&#125;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">    var vm = new Vue(&#123;</span><br><span class="line">        el: &quot;#app&quot;,</span><br><span class="line">        data: &#123;</span><br><span class="line">            msg: &quot;hi vue&quot;,</span><br><span class="line">        &#125;,</span><br><span class="line">        //在实例初始化之后，数据观测 (data observer) 和 event/watcher 事件配置之前被调用。</span><br><span class="line">        beforeCreate: function() &#123;</span><br><span class="line">            console.log(&#x27;beforeCreate&#x27;);</span><br><span class="line">        &#125;,</span><br><span class="line">        //在实例创建完成后被立即调用。</span><br><span class="line">        // 在这一步，实例已完成以下的配置：数据观测 (data observer)，属性和方法的运算，watch/event 事件回调。</span><br><span class="line">        // 然而，挂载阶段还没开始，$el 属性目前不可见 </span><br><span class="line">        created: function() &#123;</span><br><span class="line">            console.log(&#x27;created&#x27;);</span><br><span class="line">        &#125;,</span><br><span class="line">        //在挂载开始之前被调用：相关的渲染函数首次被调用</span><br><span class="line">        beforeMount: function() &#123;</span><br><span class="line">            console.log(&#x27;beforeMount&#x27;);</span><br><span class="line"></span><br><span class="line">        &#125;,</span><br><span class="line">        //el 被新创建的 vm.$el 替换, 挂在成功	</span><br><span class="line">        mounted: function() &#123;</span><br><span class="line">            console.log(&#x27;mounted&#x27;);</span><br><span class="line"></span><br><span class="line">        &#125;,</span><br><span class="line">        //数据更新时调用</span><br><span class="line">        beforeUpdate: function() &#123;</span><br><span class="line">            console.log(&#x27;beforeUpdate&#x27;);</span><br><span class="line"></span><br><span class="line">        &#125;,</span><br><span class="line">        //组件 DOM 已经更新, 组件更新完毕 </span><br><span class="line">        updated: function() &#123;</span><br><span class="line">            console.log(&#x27;updated&#x27;);</span><br><span class="line"></span><br><span class="line">        &#125;,</span><br><span class="line">          beforeDestroy() &#123;</span><br><span class="line">            console.log(&quot;=========&quot; + &quot;beforeDestroy：销毁之前&quot; + &quot;========&quot;);</span><br><span class="line">            console.log(this.$el);</span><br><span class="line">            console.log(this.$data);</span><br><span class="line">          &#125;,</span><br><span class="line">          destroyed() &#123;</span><br><span class="line">            console.log(&quot;==========&quot; + &quot;destroyed：销毁之后&quot; + &quot;===========&quot;);</span><br><span class="line">            console.log(this.$el);</span><br><span class="line">          &#125;,</span><br><span class="line">          activated() &#123;</span><br><span class="line">            console.log(&quot;&quot;);</span><br><span class="line">          &#125;,</span><br><span class="line">          deactivated() &#123;</span><br><span class="line">            console.log(&quot;&quot;);</span><br><span class="line">          &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    //3秒后修改值，触发beforeUpdate, updated事件</span><br><span class="line">    setTimeout(function() &#123;</span><br><span class="line">        vm.msg = &quot;change ......&quot;;</span><br><span class="line">    &#125;, 3000);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>控制台依次打印：    <br><br>
beforeCreate    <br><br>
created <br><br>
beforeMount <br><br>
mounted <br><br>
beforeUpdate    <br><br>
updated <br></p>
<p>注意事项：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">不要在选项 property 或回调上使用箭头函数，比如 created: () =&gt; console.log(this.a) 或 vm.$watch(&#x27;a&#x27;, newValue =&gt; this.myMethod())。</span><br><span class="line">因为箭头函数并没有 this，this 会作为变量一直向上级词法作用域查找，直至找到为止，经常导致 Uncaught TypeError: Cannot read property of undefined </span><br><span class="line">或 Uncaught TypeError: this.myMethod is not a function 之类的错误。</span><br></pre></td></tr></table></figure>
<p><img src="/vue-1/instance.png" alt></p>
<h3 id="33-条件与循环"><a class="markdownIt-Anchor" href="#33-条件与循环"></a> 3.3 条件与循环</h3>
<ul>
<li>
<p>v-if: 控制切换一个元素是否显示</p>
  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;div id=&quot;vue-app&quot;&gt;</span><br><span class="line">    &lt;p v-if=&quot;seen&quot;&gt;v-if: 如果为false，Dom将不渲染该元素&lt;/p&gt;</span><br><span class="line">    &lt;p v-show=&quot;seen&quot;&gt;show：Dom渲染，只是通过css控制display属性是否显示&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;show: 渲染时开销大；v-if：渲染时开销小；具体场景根据实际情况选定&lt;/p&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    var vm = new Vue(&#123;</span><br><span class="line">        el: &#x27;#vue-app&#x27;,</span><br><span class="line">        data: &#123;</span><br><span class="line">          seen: true</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    vm.seen = false;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>当改变<code>seen</code> 的值为false的时候，<code>v-if</code>绑定的元素Dom元素不渲染<br>
<img src="/vue-1/if_each.png" alt></p>
</li>
<li>
<p>v-for: 绑定数组的数据来渲染一个项目列表</p>
  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"> &lt;div id=&quot;vue-app&quot;&gt;</span><br><span class="line">     &lt;!--遍历输出list--&gt;</span><br><span class="line">     &lt;p&gt;遍历输出list&lt;/p&gt;</span><br><span class="line">     &lt;ol&gt;</span><br><span class="line">         &lt;li v-for=&quot;item in list&quot;&gt;</span><br><span class="line">              &#123;&#123; item.name &#125;&#125;</span><br><span class="line">         &lt;/li&gt;</span><br><span class="line">     &lt;/ol&gt;</span><br><span class="line">     &lt;br&gt;</span><br><span class="line">     &lt;p&gt;遍历输出map key value-&lt;/p&gt;</span><br><span class="line">     &lt;ul&gt;</span><br><span class="line">         &lt;li v-for=&quot;value, key in object&quot;&gt;</span><br><span class="line">             &#123;&#123;key&#125;&#125; : &#123;&#123; value &#125;&#125;</span><br><span class="line">         &lt;/li&gt;</span><br><span class="line">     &lt;/ul&gt;</span><br><span class="line"> &lt;/div&gt;</span><br><span class="line"> &lt;script&gt;</span><br><span class="line">     var vm = new Vue(&#123;</span><br><span class="line">         el: &#x27;#vue-app&#x27;,</span><br><span class="line">         data:&#123;</span><br><span class="line">             list:[</span><br><span class="line">                 &#123;name: &#x27;张三&#x27;&#125;,</span><br><span class="line">                 &#123;name: &#x27;李四&#x27;&#125;,</span><br><span class="line">                 &#123;name: &#x27;王五&#x27;&#125;</span><br><span class="line">             ],</span><br><span class="line">             object: &#123;</span><br><span class="line">		title: &#x27;How to do lists in Vue&#x27;,</span><br><span class="line">		author: &#x27;Jane Doe&#x27;,</span><br><span class="line">		publishedAt: &#x27;2016-04-10&#x27;</span><br><span class="line">            &#125;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;)</span><br><span class="line">     //往数组里面添加元素，页面上响应式渲染</span><br><span class="line">     vm.list.push(&#123;name:&#x27;赵六&#x27;&#125;);</span><br><span class="line">  </span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p><img src="/vue-1/v-for.png" alt></p>
</li>
</ul>
<h3 id="34-处理用户输入"><a class="markdownIt-Anchor" href="#34-处理用户输入"></a> 3.4 处理用户输入</h3>
<ul>
<li>
<p>v-on: 事件监听器</p>
  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;div id=&quot;app&quot;&gt;</span><br><span class="line">    &lt;div id=&quot;example-1&quot;&gt;</span><br><span class="line">        &lt;!-- 单击事件：计算器加一 --&gt;</span><br><span class="line">        &lt;button v-on:click=&quot;counter += 1&quot;&gt; 数值 : &#123;&#123; counter &#125;&#125; &lt;/button&gt;&lt;br /&gt;</span><br><span class="line">  </span><br><span class="line">        &lt;!-- 双击事件 --&gt;</span><br><span class="line">        &lt;button v-on:dblclick=&quot;greet(&#x27;abc&#x27;, $event)&quot;&gt;Greet&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div id=&quot;example-2&quot;&gt;</span><br><span class="line">        &lt;p&gt;&#123;&#123; message &#125;&#125;&lt;/p&gt;</span><br><span class="line">        &lt;!-- 单击 --&gt;</span><br><span class="line">        &lt;button v-on:click=&quot;reverseMessage&quot;&gt;反转消息&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">    var vm = new Vue(&#123;</span><br><span class="line">        el: &quot;#app&quot;,</span><br><span class="line">        data: &#123;</span><br><span class="line">            counter: 0,</span><br><span class="line">            name: &quot;vue&quot;,</span><br><span class="line">            message: &#x27;hello world&#x27;</span><br><span class="line">        &#125;,</span><br><span class="line">        methods: &#123;</span><br><span class="line">            greet: function(str, e) &#123;</span><br><span class="line">                alert(str);</span><br><span class="line">            &#125;,</span><br><span class="line">            reverseMessage: function() &#123;</span><br><span class="line">                //更新了应用的状态，但没有触碰 DOM。所有的 DOM 操作都由 Vue 来处理，这样我们只需要关注逻辑层面即可</span><br><span class="line">                //this 表示vue实例对象，可以获取相关的数据信息</span><br><span class="line">                this.message = this.message.split(&#x27;&#x27;).reverse().join(&#x27;&#x27;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>v-model: 表单输入和应用状态之间的双向绑定</p>
  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;div id=&quot;app&quot;&gt;</span><br><span class="line">    &lt;div id=&quot;example-1&quot;&gt;</span><br><span class="line">        &lt;input v-model=&quot;message&quot; placeholder=&quot;edit me&quot;&gt;</span><br><span class="line">        &lt;p&gt;Message is: &#123;&#123; message &#125;&#125;&lt;/p&gt;</span><br><span class="line">        &lt;textarea v-model=&quot;message2&quot; placeholder=&quot;add multiple lines&quot;&gt;&lt;/textarea&gt;</span><br><span class="line">        &lt;p style=&quot;white-space: pre-line;&quot;&gt;&#123;&#123; message2 &#125;&#125;&lt;/p&gt;</span><br><span class="line">        &lt;br /&gt;</span><br><span class="line">        &lt;div style=&quot;margin-top:20px;&quot;&gt;</span><br><span class="line">            &lt;input type=&quot;checkbox&quot; id=&quot;jack&quot; value=&quot;Jack&quot; v-model=&quot;checkedNames&quot;&gt;</span><br><span class="line">            &lt;label for=&quot;jack&quot;&gt;Jack&lt;/label&gt;</span><br><span class="line">            &lt;input type=&quot;checkbox&quot; id=&quot;john&quot; value=&quot;John&quot; v-model=&quot;checkedNames&quot;&gt;</span><br><span class="line">            &lt;label for=&quot;john&quot;&gt;John&lt;/label&gt;</span><br><span class="line">            &lt;input type=&quot;checkbox&quot; id=&quot;mike&quot; value=&quot;Mike&quot; v-model=&quot;checkedNames&quot;&gt;</span><br><span class="line">            &lt;label for=&quot;mike&quot;&gt;Mike&lt;/label&gt;</span><br><span class="line">            &lt;br&gt;</span><br><span class="line">            &lt;span&gt;Checked names: &#123;&#123; checkedNames &#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;br&gt;</span><br><span class="line">        &lt;div style=&quot;margin-top:20px;&quot;&gt;</span><br><span class="line">            &lt;input type=&quot;radio&quot; id=&quot;one&quot; value=&quot;One&quot; v-model=&quot;picked&quot;&gt;</span><br><span class="line">            &lt;label for=&quot;one&quot;&gt;One&lt;/label&gt;</span><br><span class="line">            &lt;br&gt;</span><br><span class="line">            &lt;input type=&quot;radio&quot; id=&quot;two&quot; value=&quot;Two&quot; v-model=&quot;picked&quot;&gt;</span><br><span class="line">            &lt;label for=&quot;two&quot;&gt;Two&lt;/label&gt;</span><br><span class="line">            &lt;br&gt;</span><br><span class="line">            &lt;span&gt;Picked: &#123;&#123; picked &#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;button type=&quot;button&quot; @click=&quot;submit&quot;&gt;提交&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">    var vm = new Vue(&#123;</span><br><span class="line">        el: &quot;#app&quot;,</span><br><span class="line">        data: &#123;</span><br><span class="line">            //这里可以设置初始值，也可以设置为&#x27;&#x27; 空值</span><br><span class="line">            message: &quot;test&quot;,</span><br><span class="line">            message2: &quot;hi&quot;,</span><br><span class="line">            checkedNames: [&#x27;Jack&#x27;, &#x27;John&#x27;], //多选框，值是数组格式</span><br><span class="line">            picked: &quot;Two&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        methods: &#123;</span><br><span class="line">            submit: function() &#123;</span><br><span class="line">                //this代表的是vue实例对象，可以通过this获取表单数据，如下</span><br><span class="line">                var params = &#123;</span><br><span class="line">                    message: this.message,</span><br><span class="line">                    message2: this.message2,</span><br><span class="line">                    checkedNames: this.checkedNames,</span><br><span class="line">                    picked: this.picked</span><br><span class="line">                &#125;</span><br><span class="line">                console.log(params);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <categories>
        <category>vue</category>
      </categories>
      <tags>
        <tag>vue</tag>
      </tags>
  </entry>
  <entry>
    <title>基于Springboot导出数据库表结构文档</title>
    <url>/export-database-file/</url>
    <content><![CDATA[<p>在项目中经常会需要查询数据库所有的表以及表字段，然后可能还需要导出到Excel中，然后自己写了一个工具类，目前支持sqlserver、mysql、oracle、Postgre；如果有问题请留言！！！</p>
<h3 id="1-引入依赖包"><a class="markdownIt-Anchor" href="#1-引入依赖包"></a> 1. 引入依赖包</h3>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"> <span class="comment">&lt;!-- 请尽量用最新版本 --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.xiaoyuge5201<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>datasource-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-编写java代码"><a class="markdownIt-Anchor" href="#2-编写java代码"></a> 2. 编写Java代码</h3>
<ol>
<li>通过MyDataSourceProperties类所有本项目的数据库连接信息，导出当前连接库的数据库结构</li>
</ol>
<ul>
<li>
<p>数据库配置 yml</p>
  <figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/dbname?serverTimezone=GMT%2B8&amp;useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">xiaoyuge</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line">    <span class="attr">database:</span> <span class="string">dbname</span>    <span class="comment">##需要配置数据库名称</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>导出方法</p>
  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.github.xiaoyuge5201.config.MyDataSourceProperties;</span><br><span class="line"><span class="keyword">import</span> com.github.xiaoyuge5201.util.ExportDatabaseDocument;</span><br><span class="line"><span class="keyword">import</span> org.apache.catalina.servlet4preview.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/export&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    MyDataSourceProperties properties;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 注意：需要在yaml /yml 配置文件中配置spring.datasource.database 属性</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/index&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">index</span><span class="params">(HttpServletResponse response, HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">        ExportDatabaseDocument.export(response, request, properties); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ol start="2">
<li>自定义导出某个数据库的表结构信息 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/index&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">index</span><span class="params">(HttpServletResponse response, HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//手动传参</span></span><br><span class="line">    ExportDatabaseDocument.export(response, request, DatabaseDriverEnum.MYSQL.getDriver(), <span class="string">&quot;127.0.0.1:3306&quot;</span>, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;xiaoyuge&quot;</span>, <span class="string">&quot;dbname&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="3-导出文档"><a class="markdownIt-Anchor" href="#3-导出文档"></a> 3. 导出文档</h3>
<p>执行请求：localhost:8080/export/index 即可；导出的内容如下：<br>
<img src="/export-database-file/1.png" alt="导出的数据库文档"></p>
<p>包括数据库表名、描述以及各个字段的类型、长度、默认值、描述等。。。；</p>
<p>另外sheet的名称为表名(表中文名)+ 4位随机值，受限于excel的sheet；</p>
<h3 id="4-数据库操作类-datasourceclient"><a class="markdownIt-Anchor" href="#4-数据库操作类-datasourceclient"></a> 4. 数据库操作类 DataSourceClient</h3>
<ol>
<li>DataSourceClient类中根据MyDataSourceProperties操作数据库 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 查询所有的表结构信息</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> 表结构列表</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">findAllTables</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> QuerySqlUtil.findAllTables(properties.getDriverClassName(), properties.getUrl(), properties.getUsername(), properties.getPassword(), properties.getDatabase());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查詢數據庫表的字段信息</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> table 数据表</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 表字段列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;ColumnEntity&gt; <span class="title">queryTableFieldsEntity</span><span class="params">(String table)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> QuerySqlUtil.queryTableFieldsToColumnEntity(properties.getDriverClassName(), properties.getUrl(), properties.getUsername(), properties.getPassword(), properties.getDatabase(), table);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查詢數據庫表的字段信息</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> table 数据表</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 表字段列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">queryTableFields</span><span class="params">(String table)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> QuerySqlUtil.queryTableFields(properties.getDriverClassName(), properties.getUrl(), properties.getUsername(), properties.getPassword(), properties.getDatabase(), table);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询对应库下所有字段 信息</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 结果</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;ColumnEntity&gt; <span class="title">listColumnsByDatasourceParams</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> QuerySqlUtil.listColumnsByDatasourceParams(properties.getDriverClassName(), properties.getUrl(), properties.getUsername(), properties.getPassword(), properties.getDatabase());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 分页查询数据表数据</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> table  数据表</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> pageNo 页码</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> limit  页容量</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> columns 字段列表</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> Exception 异常信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 结果</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> JSONArray <span class="title">queryPageData</span><span class="params">(String table, List&lt;String&gt; columns, Integer pageNo, Integer limit)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> QuerySqlUtil.queryPageData(properties.getDriverClassName(), properties.getDatabase(), table, properties.getUrl(), properties.getUsername(), properties.getPassword(), columns, pageNo, limit);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 导出数据库设计文档</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> response 返回对象</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> request  请求对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">exportDatabaseDocument</span><span class="params">(HttpServletResponse response, HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">    ExportDatabaseDocument.export(response, request, properties.getDriverClassName(), properties.getUrl(), properties.getUsername(), properties.getPassword(), properties.getDatabase());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="5-数据库驱动枚举类-databasedriverenum"><a class="markdownIt-Anchor" href="#5-数据库驱动枚举类-databasedriverenum"></a> 5. 数据库驱动枚举类 DatabaseDriverEnum</h3>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 数驱动的常量</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> yugb</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">DatabaseDriverEnum</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * mysql数据库</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    MYSQL(<span class="number">1</span>, <span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>, <span class="string">&quot;mysql数据库&quot;</span>),</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Sql Server数据库</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    SQL_SERVER(<span class="number">2</span>, <span class="string">&quot;com.microsoft.sqlserver.jdbc.SQLServerDriver&quot;</span>, <span class="string">&quot;Sql Server数据库&quot;</span>),</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * oracle数据库</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ORACLE(<span class="number">3</span>, <span class="string">&quot;oracle.jdbc.driver.OracleDriver&quot;</span>, <span class="string">&quot;oracle数据库&quot;</span>),</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * postgre sql数据库</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    POSTGRE_SQL(<span class="number">4</span>, <span class="string">&quot;org.postgresql.Driver&quot;</span>, <span class="string">&quot;postgre sql数据库&quot;</span>),</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 达梦数据库</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    DM(<span class="number">5</span>, <span class="string">&quot;dm.jdbc.driver.DmDriver&quot;</span>, <span class="string">&quot;达梦数据库&quot;</span>);</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 数据库驱动类型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Integer type;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 数据库驱动连接</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String driver;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 名称</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> type;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getDriver</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> driver;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    DatabaseDriverEnum(Integer type, String driver, String name) &#123;</span><br><span class="line">        <span class="keyword">this</span>.type = type;</span><br><span class="line">        <span class="keyword">this</span>.driver = driver;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据数据库类型获取数据库驱动</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type 数据库类型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 驱动</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getValue</span><span class="params">(Integer type)</span> </span>&#123;</span><br><span class="line">        DatabaseDriverEnum[] enums = values();</span><br><span class="line">        <span class="keyword">for</span> (DatabaseDriverEnum driverEnum : enums) &#123;</span><br><span class="line">            <span class="keyword">if</span> (driverEnum.type.equals(type)) &#123;</span><br><span class="line">                <span class="keyword">return</span> driverEnum.getDriver();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>java8的lambda表达式语法</title>
    <url>/lambda/</url>
    <content><![CDATA[<p>记录一下用到的一些java8的lambda表达式语法</p>
<h3 id="1-list集合根据某个字段分组后求多个字段的和"><a class="markdownIt-Anchor" href="#1-list集合根据某个字段分组后求多个字段的和"></a> 1 list集合根据某个字段分组后求多个字段的和</h3>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> List&lt;SafeSystemVO&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;(<span class="number">16</span>);</span><br><span class="line"><span class="comment">//....省略添加元素的代码</span></span><br><span class="line"><span class="comment">//分组字段 driver_id</span></span><br><span class="line">list.stream().collect(Collectors.groupingBy(SafeSystemVO::getDriver_id)).values().stream().map(d -&gt; &#123;</span><br><span class="line">    SafeSystemVO vo = d.get(<span class="number">0</span>);</span><br><span class="line">    <span class="comment">//求和1</span></span><br><span class="line">    vo.setAg_total(d.stream().map(s -&gt; BigDecimal.valueOf(s.getAg_total())).reduce(BigDecimal.ZERO, BigDecimal::add).doubleValue());    </span><br><span class="line">    <span class="comment">// 求和2</span></span><br><span class="line">    vo.setScore(d.stream().map(s -&gt; BigDecimal.valueOf(s.getScore())).reduce(BigDecimal.ZERO, BigDecimal::add).doubleValue());  </span><br><span class="line">    vo.setLkj_score(d.stream().map(s -&gt; BigDecimal.valueOf(s.getLkj_score())).reduce(BigDecimal.ZERO, BigDecimal::add).doubleValue());  </span><br><span class="line">    vo.setTotalScore(d.stream().map(s -&gt; BigDecimal.valueOf(s.getTotalScore())).reduce(BigDecimal.ZERO, BigDecimal::add).doubleValue());    </span><br><span class="line">    <span class="keyword">return</span> vo;</span><br><span class="line">&#125;).collect(Collectors.toList());</span><br></pre></td></tr></table></figure>
<h3 id="2-list-根据某个字段分组后求单个字段的平均值并按照分组字段排序"><a class="markdownIt-Anchor" href="#2-list-根据某个字段分组后求单个字段的平均值并按照分组字段排序"></a> 2. list 根据某个字段分组后求单个字段的平均值，并按照分组字段排序</h3>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;SafeSystemVO&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;(<span class="number">16</span>);</span><br><span class="line"><span class="comment">//....省略添加元素的代码</span></span><br><span class="line">Map&lt;String, Double&gt; monthAvg = list1.stream().collect(Collectors.groupingBy(SafeSystemVO::getMonth, Collectors.averagingDouble(SafeSystemVO::getTotalScore)));</span><br><span class="line"><span class="comment">//  根据Map 对象的key排序</span></span><br><span class="line"><span class="comment">// 我的分组字段是日期，就用了下面的</span></span><br><span class="line">monthAvg.entrySet().stream().sorted((o1, o2) -&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Date d1 = DateUtils.convertStringToDate(o1.getKey(), DateUtils.FM2);</span><br><span class="line">        Date d2 = DateUtils.convertStringToDate(o2.getKey(), DateUtils.FM2);</span><br><span class="line">        <span class="keyword">assert</span> d1 != <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">return</span> d1.compareTo(d2);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;).collect(Collectors.toMap(Map.Entry::getKey, Map.Entry::getValue, (oldVal, newVal) -&gt; oldVal, LinkedHashMap::<span class="keyword">new</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">//根据Map 对象的value排序</span></span><br><span class="line"><span class="comment">//monthResult = workShopAvg.entrySet().stream().sorted((p1, p2) -&gt; p2.getValue().compareTo(p1.getValue())).collect(Collectors.toList());</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//方法一：</span></span><br><span class="line"><span class="comment">//list1.sort((o1, o2) -&gt; o1.getAge().compareTo(o2.getTotalScore())); //正序</span></span><br><span class="line"><span class="comment">//list1.sort((o1, o2) -&gt; o2.getAge().compareTo(o1.getTotalScore())); //倒序</span></span><br><span class="line"><span class="comment">//方法二</span></span><br><span class="line"><span class="comment">//list1.sort(Comparator.comparing(Person::getTotalScore)); // 正序</span></span><br><span class="line"><span class="comment">//list1.sort(Comparator.comparing(Person::getTotalScore).reversed()); // 倒序</span></span><br></pre></td></tr></table></figure>
<h3 id="3-list-根据字段分组求和后取-前后10名"><a class="markdownIt-Anchor" href="#3-list-根据字段分组求和后取-前后10名"></a> 3. list 根据字段分组求和后取 前/后10名</h3>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//list对象接上面的</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//根据driver_id分组，求平均值</span></span><br><span class="line">Map&lt;String, Double&gt; driverScores = list3.stream()</span><br><span class="line">        .collect(Collectors.groupingBy(SafeSystemVO::getDriver_id, Collectors.averagingDouble(SafeSystemVO::getTotalScore)));</span><br><span class="line"></span><br><span class="line"><span class="comment">//排序后获取后10 名， 前10名的话修改sorted逻辑为：sorted((p1, p2) -&gt; p2.getValue().compareTo(p1.getValue()))</span></span><br><span class="line">List&lt;Map.Entry&lt;String, Double&gt;&gt; driverScoresTop10 = driverScores.entrySet().stream().sorted((p1, p2) -&gt; p1.getValue().compareTo(p2.getValue())).limit(<span class="number">10</span>).collect(Collectors.toList());</span><br></pre></td></tr></table></figure>
<h3 id="4-其他"><a class="markdownIt-Anchor" href="#4-其他"></a> 4. 其他</h3>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//Id, name , age</span></span><br><span class="line">        Person p1 = <span class="keyword">new</span> Person(<span class="number">1</span>,<span class="string">&quot;麻子&quot;</span>, <span class="number">31</span>);</span><br><span class="line">        Person p2 = <span class="keyword">new</span> Person(<span class="number">2</span>,<span class="string">&quot;李四&quot;</span>, <span class="number">20</span>);</span><br><span class="line">        Person p3 = <span class="keyword">new</span> Person(<span class="number">3</span>,<span class="string">&quot;王五&quot;</span>, <span class="number">26</span>);</span><br><span class="line">        Person p4 = <span class="keyword">new</span> Person(<span class="number">3</span>,<span class="string">&quot;王五&quot;</span>, <span class="number">26</span>);</span><br><span class="line"></span><br><span class="line">        List&lt;Person&gt; personList = <span class="keyword">new</span> ArrayList&lt;Person&gt;();</span><br><span class="line">        personList.add(p1);</span><br><span class="line">        personList.add(p2);</span><br><span class="line">        personList.add(p3);</span><br><span class="line">        personList.add(p4);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//java8遍历</span></span><br><span class="line">        personList.forEach(p -&gt; System.out.println(p.getAge()));</span><br><span class="line">        <span class="comment">//按照person的 age进行排序</span></span><br><span class="line">        <span class="comment">//方法一</span></span><br><span class="line">        personList.sort((o1, o2) -&gt; o1.getAge().compareTo(o2.getAge())); <span class="comment">//正序</span></span><br><span class="line">        personList.sort((o1, o2) -&gt; o2.getAge().compareTo(o1.getAge())); <span class="comment">//倒序</span></span><br><span class="line">        <span class="comment">//方法二</span></span><br><span class="line">        personList.sort(Comparator.comparing(Person::getAge)); <span class="comment">// 正序</span></span><br><span class="line">        personList.sort(Comparator.comparing(Person::getAge).reversed()); <span class="comment">// 倒序</span></span><br><span class="line">        <span class="comment">//多个字段排序</span></span><br><span class="line">        personList.sort(Comparator.comparing(User::getId).thenComparing(Person::getAge));</span><br><span class="line">        <span class="comment">//注：若选择排序字段为null值，正序可personList.sort(Comparator.comparing(Person::getAge,Comparator.nullsFirst(Comparator.naturalOrder())))</span></span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;========================================&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取年龄最大的Person</span></span><br><span class="line">        Person maxAgePerson = personList.stream().max(Comparator.comparing(Person::getAge)).get();</span><br><span class="line">        System.out.println(maxAgePerson.getAge());</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;========================================&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取年龄最小的Person</span></span><br><span class="line">        Person minAgePerson = personList.stream().min(Comparator.comparing(Person::getAge)).get();</span><br><span class="line">        System.out.println(minAgePerson.getAge());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//过滤出年龄是20的person，想过滤出什么条件的均可以</span></span><br><span class="line">        List&lt;Person&gt; personList1 = personList.stream().filter(person -&gt; person.getAge() == <span class="number">20</span>).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//过滤-- 统计出年龄等于20的个数</span></span><br><span class="line">        <span class="keyword">long</span> count = personList.stream().filter(person -&gt; person.getAge() == <span class="number">20</span>).count();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//过滤出年龄大约20的人</span></span><br><span class="line">        List&lt;Person&gt; personList2 = personList.stream().filter(t -&gt; t.getAge().equals(<span class="number">20</span>)).collect(Collectors.toList());</span><br><span class="line">        <span class="comment">//得到年龄的平均值</span></span><br><span class="line">        <span class="keyword">double</span> asDouble = personList.stream().mapToInt(person -&gt; person.getAge()).average().getAsDouble();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//得到年龄的求和--基本类型</span></span><br><span class="line">        <span class="keyword">int</span> sum = personList.stream().mapToInt(person -&gt; person.getAge()).sum();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//得到年龄的求和--包装类型,其中，若bigDecimal对象为null，可filter()过滤掉空指针.</span></span><br><span class="line">        BigDecimal totalAge = personList.stream().map(User::getAge).reduce(BigDecimal.ZERO, BigDecimal::add);</span><br><span class="line"></span><br><span class="line">        （其中，若bigDecimal对象为<span class="keyword">null</span>，可filter()过滤掉空指针.）</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//去重</span></span><br><span class="line">        List&lt;Person&gt; personList3 = personList.stream().distinct().collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//list转map.</span></span><br><span class="line">        <span class="comment">//（其中，若集合对象key有重，可根据(k1,k2)-&gt;k1设置&lt;保留k1，舍弃k2&gt;.）</span></span><br><span class="line">        Map&lt;Long, Person&gt; personMap = personList.stream().collect(Collectors.toMap(User::getId, t -&gt; t,(k1,k2)-&gt;k1));</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>认识UML之类图</title>
    <url>/uml/</url>
    <content><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="抱歉，这个密码看着不太对，请再试试。" data-whm="抱歉，这个文章不能被纠正，不过您还是能看看解密后的内容。">
  <script id="hbeData" type="hbeData" data-hmacdigest="2199b1a48b792c39156665cad6d473b8fda1f976254747cc66c0bd26e7e34db0">1b693c4938223286468132b2f7068bf6bc59b85a9dbfbc2848400429591984f28b05c82cc99a6199c5227a1da1ad57f9ca046e0d82aec3c811dc4b1e9f47b97099d70d57c219ae767bae9458f6c0d0f99559f90670bb686250962098852953c0b28c675768a5b83de738dc70d7a0bb0f864c32e55a349519ef4cc624b2e31c18f74e17ad9b3c8b91ad0e16523ac48572f5116f07037f8016b50463811b85da822a6f83a3a10a8aed1e5b031960dddc187dfb94a51e44038c9aac21ced01ad1704957b06532dea8974b3a354fc086c099fb2fba9996f243902e83e9d0227d99af5bb50d6fdf8a005ed5b54cc24252cebbfa77379d2e3a2a5c328410d92968737dd2dc75f9cc16e1e73f80ec0402d724fb1e15c2a57689a023a30e391d9fc0dc0a006b1592cbda6edf5bff763b9097e87fd3dac0549dd26dfa16d30149a4893461edb3bf41255716882c0f06a5e34e954a75dd47bfa91cbe0c70ae1ebf5a8c0557410bdcd49fd03114570b83bbe42eb2bd12a1321cebb21b2fc70e5403ae6302d17acf3f11475129c667e7872cd32fbf94434e3ccea7fa5eb8bc515587e468d6cd022a573b40c61d117afffe58d670e62d3da2cee9e020e7e42695620dd961967e7bef1be25b1dbdf9c866443c006e222201e9282cf474a2bd9e85ab51357e2cf5b829a0a8105d8df25492d60bf8d4102dcca40e7bfbdd0d99dc7914242d1686cc2a8582e8715ddc2ee31f126b73cd99d8886decd7f70016e6908b3ac1cc2f096e728c1eba76151710e15125b4540262aab852d0918150090f375132d221caf4af9540f41b5df86b3f6c7d94c04476b06085ad970a38024b5aedba0c932e3286196ca678c9f9bf706e69cc74b9b75d62137d757a64bf2c411c75151ebfc0389897c3de7b9e764c1a802c75cb520bb5266315ce49afcacbefd9b18620e96ce4efb700e3393017e16e237e201866002359c801a59358f2a04c0c057240b4134e068d35e0b4b869a167c4ca96785041efb95c3892800ce5af2d01527eae26d547e45ca2df903b64f69a161cf5641f2598d9174e030cd43030eda339f24b85355f9a0b40152da905f7f6231c99f9b3617275a6dd6a92af44de36f4f7561e1f0cd67bc9ee73a11bb110b6069ef7d51466482dd017635c5b83c2c8f152211ec70d525f589bb894f5161adcbe1ea8664fe1918a1ef45dfeab9650948c393db01082cde52b68ac0dd6a61509e0e375aa8548b2901d8fb9950b15ecfa2460872b4d46b6be389217ef127a1a1c5a621814b7ab396a6838525d60e6d822679855c3210287cb8d3eedd7346e02fdad319c134c44a36655b4ece2b676c84ea0aaef0cdb2eaf60f2190412431a3df56ff9f1c4caf0e34cf5dd2a7bbf6a6b9108fd80aed9878eb36988cc636d8bbaed1c140c2b8c6f42bbe13c8574af28cf29afecc391288feb7a145a376222c3908f9355cd12ca6cd84713ebe9937c03e6bb81b6aa450884a2df2ee53064b62d3824f82d063401239ac409972b031db84ce3ae37fd23f02fe4d1b14df5f202d47eae0d898edf09d50c8b70e80e57f20349faa8795a11350d24eaf07bede0f563b0be27da166c4d86f5dfbe60d98fc37d8e9466ffcbed06d28511c9bdeec2cea56aea285b8ed681ded6be8e45353c2e13a32d4eb572bf046db06171eb83cd63fd8cb66b23bf476073338a951ec97cea0118ca8776e4072047551e89ab679f72c62e356d28ab5db477205114494cd5fa3ac25d39d392e11cd62cddb21ad6a351ceb54c3372de628bf8bbfdd463fd1dec0919289b8f729252123306fb2221d927f0467d54489986506731198e85b348ac28be2f47eaf8fc621af4c35b9d2f990d5ba196c4422f1e95c8bbf24994d1a9054dc1977791a3bc991a87b6d392aab8359d68948344fd16c0b848b3bd1105e520f850bb619d4df92a3703f651abf5f429df3b1882b761c1e4146afff15af89eefa6c8f2c1dfe41132351800006c37ba0af6f2d46aafa7a1f2ed7e51d9bf59b4e77165763d33eef1996a0b040bc30620df68a3415b93203b4c6ac075d1957f51c75a0213a65dde176b2b61520d0c9336dffb6c6905457064d6503af0fa848e72595e5114ba33c427a20560f833fbd01b927515ddb69a31bf99f1515e01c8d6de4ef9cfc0d9341b17a6e8dfa59a231f6e09ce15e6c5c28dac3e15724eb981ea0173fd375d389d49841923c6e1c4e36ed3a54d817854cfa19cb27dd7ce32a0fc1411497defd4ee6bf159b66e06eee45af20fe3598b38e089d16fc864f2569366ede3eb7e29fd1b414118384efbcca08d4382f5213321fe20eadbcc1680a1be55937782730b307cd9d6b5b09efb307e5bfb0e1dc4acf96176e3183822c7ef82b1fddfa97935f249fa86710f969ef3c90fe05e74e06ced9c9af05e0496a9a1da4310d8bb271205e1c8327569bf1b6123bc39a4e927a66bd71f7ea4665ff2065db165a8468dc4e5c3e3f9639e189049ebde51a9f37bf0cb34d55db15204299f79bfe04c68e594d5604ab343b181193cca84b21044a28aab27d9f0df7a71ac8f5d85b4d828a2a541250a12cb60ec75f7949948a2065987785c431759c42b24572a9d1e43a01e7406390d98edd7a7458832ae7c79c7eb25d960f44cade8d235d81f1086e3255c9471f385f0611abfb4317dad99525d30464c1309f1debd6523f7ad3dec0f3531d70247e8b6d4110275263c264f9193153d8ef95f924e7a91247a407c131a6a75b4ca1203055d6902a0279d650263786d6cc5389bd0df057b76afc98af75b12ea065c21b3a72c30a4859794ce1552200018a1d8c8d5a98c838080cb6a1fd50c4f82d1d9ac0ce9789d04ada4778ddd58ff7813f8c1dc0caab88ee3429ef56f28439d6cfa7b27e237030777f54b65f25bdfe680d9d59c6dbddad4f5956c406f22f403a25260df7f33960063dd6578c6499e413b8d36fd988d9c683f7595ef3e48aa7ce10cf88d7282647ab93153cd6d65cc2e0b62be9ca21bab701f7ccb5af6097b25b83144eb19c4d092b4c531eb2e6db8c068f385b881b1a91d34b94728f90d25e5c0e28ae9f5a4aa701663b687f5b349cb6414504b1cbc4b085454973f476bcaea4715d0636e8048980fc1ec1ab24ee37c15dfc612dec28afbea26a9deb246d2116ed5004bc116ff3979fdd0ed3f836d3b89105d75edfa30e876b5e23fb383029beeff45603816e5b8d6d9d4fadd2c860261a3c20ce6187051172096f81868c7b6b0f0fc70c8c2aa592657b35ad2f3ce463c0770a7966a0d39f985241ad48e83b4a8dcb23c20e4d3c1e895e48adb45e8936a9190d58662ab42497f6f79449f248d92f6c3701a2cae8e69c679a00d49a4d1ece62f65e96a64d85c87a31aa679daf2272dd64dfad0324b7fc127202c76e7a192a874af93e248131fecf24fdeff1737b25c34c02597a938d53ffa2af98b6cef7d98d8ba266f744eeb2965b14f3b8465b7de76e60aba612cadee065bf1d07ed797ea2654b4031205b3172b059f78cc97740afd21fa5fbd11ae40c4f8bc68ab19ebf8117478caf1b6b25d704d691a5deccc9d55471a2941f1920e9da49a880bffe18c2cdf152aa281f8f3f7e380e0d67853af39f8cb7edca3deb2363ce631bcdd7d921e915fda5ea24521c553c6e4e8daebc9e97b2363903c85aedf9c141389bdb53316317046d554bdc58f30f93c139aac5c5aa1f22433b774050f6b5d1eafaa3dba9b31fae6ded7eb90606aee791167d6e97f2b33bd8ef9e16e6981fcb5eb971b5dbf1992a2f38049354f7d31971f217ce507f5c1abbe2b4c6fb4a22774568ae378ef5fac2db9f3a31edb3ec3fb64715b9956cfdb11d521c0a67f0aa039e70a16ad6c864c299520e73425a1d421d0bc271eaf467b195233f45dc055395837a7ad613d85c32d85128298816e5dfb6831667f03805f4970041d8f5c3e1cc1988426bdabaa5c64d5520956b6089a09405ef2305401f4f9139f16c8ca7ae7ef36255a69d55a15103457422bd4e9f8fef73ff7bae593f6ec607f98333dd818c17adc3c0ce7ab1b73f03bf8db8680c36cbc37cc3af8c9fe47ede4456a41dc4201d00f3d8d854fec2d13c063d314401cf74bf3ad9b5efdc7e24dd3c9ea747076d36e354872a53078c4ca6d8b866cd84b305849baf8caae2b8ce0b226e002da9399f8215fcfc5003025dd76b7873a95722ce14f8c684a7273346bfd77eba1860903d7904b35624b15d70edbf6bf6f700b068d662bd1fbd92912758eb173f306005f4f855e7fd3eab702307e8068fef689f2c47321a454caa00efcbe8089e4dd67c6674ead242c5bc25a41cf82eee652e9d85978d279c5fea91d466ba4369a3cc5624f3ecdc24a60449e6f37c4354d145eca630cd7dcb35f4ea6396af69ecb8d73f8eebdc5725c92c998affef5d44ef950eb2f630560636a4b462e9d09dbe80a0bfe3dce6a3e53d9bf6e8f669344142daf5bec97c2d00c7ac327bb1ea056d7b36c6eeb659df291cb650ca6943d9ead7b7db18d22fd6c77d424d645324d9a60ff6dae871bc6140f7b4cbb33486420a929dd656698ed5206b0fc406464c93ddc558cb86af32c50402d07aa73ad5d322f8a3a3110cc15868dad66dfb62516fb66e904fb8172dc3e0743b6ac06c7b0668dfde623f605357f9095841b961a0f846232ee999d9558d609b6db1cabdf45f5bd642acb4ab009533bce8f12850a97e38411c224f7b43352755c4bc263b3a2ad268840b8d7ce031a3424196433686bfd59d91099dbe5c5c15baf29361ae5a276cf052d9b948986741d8114a440919c81d2eb2030d55b1724f2c67986b5947156cdbdfdd2d0c259943ebb5429c4b0737bf59cebe81014400d61f90b7bfcd1eac331c0599eda99a20f5eaa06102cf5fe29ccfcc90328a95040041d502d56b3d075eabc90d77495fe3688db711ed1bebf38fec117eac57f950fdb939e6ae889cab0513bf0fce8915214542bc983f48176657b0c98179c64b72bd85cf12b2e858bfce52667f9ba1b32ece1633c9ffc09cdf7ad79c64102a221cabae3f1721dc02d63679f317dd48e6229aeed043eec57e32787b1422dfcffa88c23a5132c149ad73dd7b0f7db6f5655800a1d3f18d78e71d8f8e8d9ef5930dd106258c0eda5ff46c6df5d4e77a62b7d5171bb1827a5fc319d4f4e1b80590ced367387d5b982b066277cad23c9dd1585462fb070e4ab4c6ba73d71cd15286aeab67094eac6a49c761d46cc7799f21d1da52ca6d43603b17e9dc247614b2f83bb6212fed72482c542d5b907b801446dbc5d7111a2ebc31df53e56f20b5c692c67b0a138b403d14d97d83f5b9effd3d9defbf5220390af87df6d41bc22dfbb953d062d6273123aa4d107a4825f2b60c6737b1bcbdbcf5d3c15b4bf82c70831fae7cd92f8b433228a194f6e6e952bdc7a0c93e8e59d06c6e9aae7347af632e2085012fd3191029829174a05ba60b8c172eff2532f821f34c191ae3d09e6e2191633224752450e55cd4c6efafd2ef92587c5d231e629397dcbded08a46f7636256c96976d8081da7cfa23e3f19530b698460a9f11a4f1b77262963dcafbab88882c6d6196f8044f3be4ddff11b9b9a4cc19a17a110ed767e7653d4a6279c8dedbca576a74630457d2a112bd4b13de3ddba0f4a434efffd175c7247873eb4b91a6e00dac8cd7f9af06ff5e5c3c4c37d7ea7aae09c04cd6bea87810ee2c46ce17aabc1af588e0d79fbe9e078c29cb20ba82c28ebcaa34886c2bbd2bfc791c9c8677c71a5fd5aa7945eb07661686374ff34732a959991692ca2764f9253e1c6f145eb6331df7cfa6965ad4ed4bc11b46707e8c30fd7b2ff9ec646698a704e513f0230a953eb5cfc2ec4d58a22bd124a76a9080762c7472035862b441073df2c14866584b63bb36321feaeb1ba7ce3ef2826177951c30a64a5855954d202984262296f6b05b91b40c82fe23b9d6fbadc67c3f739c71b20643fe997fc65e48257a82d7602194286534df8862aacf8dbcd8538474917306b630afe7d9d9e00507749653feb5aac29fe6c15305b6c65ec558aed0e9316979c3263513befab6d6498b7a9b3e76a3692b7403b0ac94d5985fc64879501ef14d41056dfceebee1e31dcb0e9602ea8ee114314b9fb10c215aea4afd6ed606cd9fa8b14a9c62adc0752c251c93d16fe6cd9c8841b4e160510ac6b560e3ad09e80c3ee7c92001d792c03c30d40c3963fde14f48484a5f7bae1f64a1b60d0fc580adba8ad912ecaddbf258e9991ed86f18274ffbbe7cc949b0da1f3969b47843ce6fb6303299477a175394b6bc99e82a5d70d1a384af494468872e42217ae870f1022d1284d4dfe1601089c3302cae33501b5dc2f8fcf645db64445875230be02326b32173d13f781cbcfb8453576be3aa681df8f5b64cf3cd44cec50d1a98f16eebfc414421f3897c4ae74ceea3026a70b80cea991984b11ef7a6f77837051194f3b9bcccfa36f73ebfdf415ea5ca41843ac8de9cd3eac913c768d0bd744a2f71821577d3e0c5c53b987e53e535b095f26c2f984266d2e488f6050eac9a8f76c601d11b3c021c1c429fce248f344c726dfa6440766fa57a4f824cc8a9081a0beece98830e87f1078373be1604d674eab35b07a945ba411c7bed336a1e0923058d085eaa54e8ef036a1b254568ce61e0f1ab5dc95fbf917379759c76bca0ac234b319d965fa0a244694ff8e971d2c2b32b1795b4582b6f010a8bef97d8b1326dc6be2032186f7e4067168b8b9868741935d5a63ec56d85b20e3e2f36a34c4e343579af99af892619776b17513e0a704fe92b92740345c247c937a0019d567b56a45ff8e63ad4dfc831584d1b40009f38260dbb8eb9961c44fd95b7fe501170749383b80bbf5fa700a2f3d1ad83a51a116123cf16934225b8a7abca5b324f3a6dd96c713c4a8e2b4f3b60d14bbce8fc96eaaae7aa835b2df5ad912c89e106d430760070720f3b94ad78333263e9bf8be039f8384111cf14d1b63eb050716157545ee3d36ff6175fa06b2e11e958ddb51a32d84ac0f59aed4a728ed469472fdd120b1451da77941365109c7f034ef2d0ccb5e6275f291b3b598a8c19e340df11c908ad6280d53ea0b4390d07987a78911e157e487f332bb1837f99dba16e2520b487e4cca542eab2f931811c44694da521a0bc2cd776d3fc339a9d2a19a21de271430014cfdefd0045136cf8930926417a694407e26540169b5a6f914423dc103c5029626b2f24c6e4eaf65655be0cff3f9376753b8b7bbc7fb29b0edd03555a74f7f1a388818452a1c0eb2bd7ff9da2e155030f8c2aa0d115e9254a75d379d5d760088c50197975fc7b0827d52f665dd9a28d8a724b5f25d88555c67797b5abbdccaf21c8544c3c28e1eca9c9c96f5047e9cba51f31e0501b4ff746c2eb23ceb4a23407f3215b8624bb1339dc86fcf31290db980eeee7f34846f6ccd2e2b9c8740604d451e883d97a34bf9e698248a4130a04ed5cd0ac9fe4f2adcce7ad3c73de7ef27311df84c1567dffffae8c413a102cd5d1b408c689db818809a2265dc0512e56ccb0db0e7c23bc0f900534d62bc70933bf9cf21bcb673aa5ad070589383fe782e91242ecb44bdf7ec08fc62ca5bc6b23de4ceb52960a46ba3bc47fd6187508fcde2df0c8587367db023249a5a7e5d911e48201e3fa916d778d36535094d62cf924cb19396530f4765eac9f61c2d92fd4499a1389f2202ef7e3a4a1a6b6cfa3de7251819359ccb886baf48bb23e6abd757c83b6de6914194c0f01d77fcc39de7fb998791507bcff22fc87636ba024a808bc17f7dee3dae520c23fe4fa3d68a22399b212d87a26166f47b835510bc5cd57f7b2ecfb443ea62fbc520995cd9524e5469f13f16a797e8b4718d4096f08585689c37a93643c354a1eb3be5e69c03b1fcfa4132a7c7b3636bba4238f04f9a7f0118ba81fca854f2a94b976742aef76946219dd7d19e903287462e18b5916c8c70eb0b775c3aebbefc5aad31fe67d9ab575eb1bd2ec427e3c118d3fb918acd6897216d4e07bc58b3342eb28c4b0d059f1f7c6feeeaa83d3171d481f1d996bc37abf7abdc81670c77494f2159a2c1861edf7e0f32003eadca072535002af5609bfeb557d24bbf33f569d993fdde14ff084c1d0ba14821a9e435d7da42306c499e7745e35ed68e441297f3d1be61c1dad14faa382d0e1a04c5c799404587e7aabfcca6f1192ce41964c3bdf56009c25c12ebd3a207a4e01a9f52ad4c2800f4b8af90ab202e9ddf3a739eaf10c97a0facbbab5112c178da25650820d822821938467305cf2b451a20c69eaab006ea6d5aa2e5b26d692d06e10fa8f194d75bbdbaab6a3e65c8d132be66f6d53304f279b903a00fda5a0a65d8416cc24fa86909360b614c9c246cecc78d9be53924768f476c2a9d52ceb5a1accddd58fc56269f814448c6123eacdbfc2578271c064e90a196a822854071d0be4b79e88fde33e967d1ec1b287365dddd2409313f35f85a77cbba1e4a08679710ea33044f0cecd95131d6711f26ca1676a0d1e92bb0568dab6ffaf1f2a4977b0de9720870c6de3ec97e49ca976419e1f37a85b4e89afe2f06ca565bd79d5aee7ddfb60abc15f9cf39c7e63e5e5b7291b7773726e4f25d8eb3f2e1570d825d40b902d4b763767984305ee2e9f6a4d5f2d4f486e3897e2e290ab069a5b3441c5e218a906fcb6401c070298889db2dad97676f2ebffaa794327d84a5f8e346e99e0075c7a138beccd80f7194f0384370f40adc70bf63c162331940de3d5c11774f1570929d03a111deb9bed3e8f3366d1c97cccbfed5e62176455120101cb7ca331aff59996625bbb943c76dee7cfb8fd31a88ff3c2efd1366e2f1d669df4f4a43fda50f595d4bef258536e70361a0e6dcf9de1e03b9ac5c4f2d9d322dbe2a6da55c23f9de0aa0852aa6bf355c5ab17c8a43b7271692327e1e56430152361ace632415abbca889b01f0d29908efa3d5a81b79cae60ddcf9be94e2ed5674ec915890fb7fc94b5d8ed407d24a1631463ce7ecc4e266ec942c9fa52e029375d8e5f9528949e15d926a7281ff27d1235e922f50ed649fc17913530349a8e3ce96cba19a1b4bb97e6c8f927a6965a9479ef193725f25eae18d9f142e748879b7c5e8f610caca6ed0d102d04282cd90705457c50484a9d5999b7ea069330d520353580c063bfc25f7c49c7e7c2bf5f30b0674f3352b03def8c8dbf5d711f47844cfd5cd6e536f01027d0869250af215951ced49be56ccd5c4a79fcc96418a0ee371c9c82080d2b267d19ba878d7dc0f7fb80b756a798e1fec06037d5ae8a39ccc4c3b11cbd593dc24d25206700d56adb0f589beef001681db08dd3237a6e1c679e350e6af2874a1e79c880a2ab0146b472bbebeefabb8ca88589b9d5fdeca53840b7fac4e77ce0c00e5ea925b1cced09b1e4aacf308a99c1b419a54ec98f1f4a6f9128a3acdded2ceb174f42edc7704f36da06c7010158a09aa3e1efcb2b54f2d264b50957dd289ba6a3fd99f4b95b9c8fd6ec6f135348009cd85c4ed7128f0727c745529e322755c211d971867176af47079ebdb37e7938bf52c417fab38203e05022e8e69a308f13d735c5583a96d56fce83097d5f94d162252a2c7f80b6c54e11b202bed7ddd6e04740653013b0cfc2c13411078f6de98fa2bbd6ffa242529a0fdb8f7e3fb10726f88fb9fff477ca37cdc3cedbea4b53b8c4de0cd5bbdc20166d0f0b12964eaee702be910a077fa5dbceeff0dcb71c7c1f238d8dcb2c27046fb6eb5a116ae886f79b27be81bbee715a358fe1e7d72f4acd3c25518c8f07c0438c84797233dfc6e989f8074be33356cd794e18038d443a074ee224958c9184502e567725ba7bd0b71eb62e0ce9cdb14fb49d9ca69b835f33f99b8793078331e31ebc20e0b513ce57942ddcee5141211ee4726d49d73e8607a178e2fc5af3434cfcef0d4c986fc88b58106581c6bd28930b6f617886f63be452db0681d4a9fa694956dc370668802b49660a00f8a12e0c4e053088c756cfe9b7da584b5bea6927bc154086818513fb4d1f49a02afa401087e86a157a94e447560c0a836f610bd290118381ca3bf609b9ef675614603ca03630bd8cf5e30130f4979bb9c236e5e232e3c3f13deae34eeb5ad557e316c4608d8ebfa98fd13aac47c8696cf16ea42201915921661b9665b1c5a82b6e631b4903827a9dbaa6b931d98681c601c7779916563001082e9dcd3d2d018b4eaf0910dc6776e0840903dff3a32691d2a8f828bb8b994d9f29616f8b65ac023e5956f95d4181e01f6bb273052545fa312ec1469a74907a545277ded9c5eb3d119074e8256177d06d25987a9d5b1e1ba5268511c64480f3e1e1b1905ea037fb137fec84b3637b2f3cd3f4e33d2b8c8ce43766292809d763dc0c19275d657dd2f865a1cf7447d03ad7621cf7e53eee40a0b382052407cb89fe19a2dccb1172b984aa702ba5a330d118a27052b6149e9b285560f829f9938ac781c771abb472670b35999c2be4a48e1e0db3780f41d19395e5dca78d045371b2ec3918e0e7cf89ed0cae17687c5cb0f436c52acc97c3153d1c10bfeab343997120e73af710ff94e93661c7368a037e971feb030d0de5cc65ee1d25510fc9b67ed3ff99d7ee7244e8df21d05c7a3ab2a8de40737107306531e9b8cd08708245d0208c7138f6d92989345943630aaea8f78abc0f5cbe799fc0406bf30d919821dc3a196a17a8663bab8c93f02ac32e01764ef22d2c560945f6a235bcf085495c0e222a08444f8f4f4264ee760a6472b11113dd316a7fbd918ebb197fe14da291e75fbfa7364ccdd4e5e494c8633ac29588f8f8944f028447f660c726c26a298fea5e56bc948548531d4e17095fbeeb4bfc847352b8f6d2a31b0450800bb9f306534ee4c1ff3f4ba246c74da70c3312b04ec84d13f8755257dd837c67785b2816bd979cbb041d2927b7c98d976dbd1a5787e58586e8e559116fb4b33ff53c364969f21d745481b35bd5a14763eae27735b6971c0ba185579f0e175c7a2598e98b898d0f5af9553b62102b9f5403a8ace85f54355dc1fd76c7482fb9582e063587d089bb8952cdb11169d992a7b1fb7c1348d4143ef56fca93a91a1e8c004b44f4e3b7e7a94893cae750fdd39420ff713c012bbd2983a18fed09697385116f18c59f05338adffe2fc9335894967f78416d1f1525f0b4fb07fa5259c1261aa3557e9b897068bc1f13440b55447aec61c7373d20b50fbe330e15911a365153b62254f544502fcef62dc9f7f92407c9a63907fb7ccc754090321cc8716a0688ffb3e07bed36e8befecfcc62ca5fe17948495b1ec0b41f3aa03490939da7b646b9e9a4b1db7d55e3dc742c862233c0a828f42a28474cdfaa55a790908db9c2e723ecc1b6bbed2229afa0d9ddaa97f5ba09963fa5abfcb29d58a55d20c326109d60abe1c17dc95174e9190abb30c5ae47047b4472b2d5cf85a1501bdd6402e1c8e8d3553e0489d4d554f046b42ef39c668c9847804248eede3db814af0957a47d0bb76b8b3270b798ff46830cf2a2e6467f30984b7edbd10e26f7983cd0336d6721fdc04cefb05d21ecd8c75be9c9118d198a7066b034c235cda15782197f6f84f6a29482b69e3513b0bec6152b525786836d665a1b731ec37904f444892ca8505948739e3412c6bb7c9a29f5152474553cd9edea7be3d2a098987060e5aad872a3b394e8529e85e79e9358ee6ee24ec68e64a9f1bbfcfbc49a124a0bbc225eef531138113b64673ad59771c6883c4ddbd16f8d2752b44e77a06b0425aac298263a2a25042db67bfc63706d7fb2d5708bf5a38c85343aedd7c9b81513e1d8f6524d976142d47f5b8e5ff31c43c80193e252a09065be5a2443fe7a6ab4a5ba62936c248b13bb1ce1de1b0d0b621c773f3610ff105475560b0cae9b20e78517e3f0b78204f21c745c15a46f56d19443b88afb8f94535bf25a3a87b1c6ce123b979b4d9f145700d90ac032822e174a86a6481b8d0d0147bacf23155b7652a8db6cac955cd42a66f9352c56abe3736762f995e0df0049a4791c744831ab67474b19541e2e2ef7b8a4bcd1019a58b5f6f2b13eb38464c5afeb42d519e73d0b2d80c59e9dee0a207a9f889a0aefd823625a9330c92711c516712a436649b4395d16e4d1db47d2dea60928887d47dd591c80562c2bcd65f72a1ed99d761650b6ab79ab19198cdf71a8c56269bca2211f21ba6154dfc25f5abfa152372398a4c6e901316a074ff5eddcd42b644ece05cb7db5a2fb8024ea50952b028a3fbbdf79f32cf5154f8f3cbdd87cbd8d056075dfe600ad29969004dfcb0bccd6dad9fae8bf55a005418a1c8bde2c6bda699886c0732291c08c3ae6841fbb16ce25905a1e5101cfaea86340009b59cf305a175e20062e90922bcc9128d33d8d1c9f84887646b1f69cf20a0aa51174dfb3fa8dca70b3feac5a68534b7ca924575bbe18f2cab2c185ee2e86c1bcb5b39807d39966d72c766b4a548582108b38d620cb59e25b7557b4783b9c4841f81c205be20f9d24cf07774893e9fef8c4c5e601fcefc1d0236f99bf2b714e1d1da656bf1148091b0e15fe47d9a8aa2c726f60f06ae6a75deea26de31087169b7a780e643ef5c83b1abf35319f5ab96ff2c90a40a0939c1279e40323c0f264719ec9fc910344bc971dfb831c4759cc290aad75cbd7c5f08ef1ee88d2c50dbc24f82251dca794d6027a51340c5b562a56b2374c1694a2015b0bb81eb4f4b76171af134f877a175364f3a180a0b68922fccb532b41c8d5eb4c6b62f6b6d635d6c5410ed0ddc89e835375bdad110e37b0d12e5511ac194371dd9fa21ce9055a6413dc26cec81780109346ce4a153cc8bbcdf0a6d33316b98d9fd7ec4645f01516e68388b22508d7329853b0a28cfb2981f70236142b25e44c14715aee56844bc628c035721106851919606a2b71f5bd266a1f2a6e3f23f6bab6685775a27533e56dc7786a078da6c930b038e16afe5df0ecf256e008439f102fff8fc2369afa19d81642fa62ce4a23f875f5b1986f25197186bbd756b75997f92fa2baa7fccf5b1923cabe8727e807a4c8ceb91a83daf1058cb47d291bd7fdd28a113bead84f636caac5cd47cabba7c4d215b40b60e496213248914607be86b75defdd1621b4099cd9ee97e3f4f7c8b916004ca64b877793cb2d21716db13499711bcc7c6b8754c7904f004fa51561e31280b2f64d422c328a0e4d49687e98e80eec5e845489caa71f69f325e394d07bf7c818769d1ed79b4f5501bd94218e8f0d1f479baeb3559e1d3891bfc0965dca078931f9ab89429cc7011b7c4c6b3e7be0f2b5b4b3bd8d81423cad5c1ec46e6d53ad2f77003ae1375dbc6ec4a0de0f73e2f907eeb6fd67dd129b39a317b425b374b8993f457082127875492896bfaf977301db172855ef0944f7afb1b8edf26b4693e2b366b46d5105529211f20a31cc9f43e6a6c201179698cc98a5862cb32ad6888331673f1bf6d8c65850944540c718fc946a2ebe3c3423fb7065593273557be4e355ccf4a652a1c990d4d6ab960b104a3811c3ba7ff5a972084076a02f7240876560f503382710cf40b8857b21c2ef0d4c3edbdb2930d7e29616c2f9700f5365f9ecbf91e06d426972b98108a5bcd1d4eb377c0bac141080f7327e2db466cc6c7b8d179e17b7efef5907a63fd875c0b4bc29aa53ac79798633da3997a0b4ba6e079ca2a5231f58aa669633fdd8d4e5be2b816303a76607ebb5f01a31aad873c56dbd4196b9c05ad7e72792633982d9805c34b7be22a5e1b263e6f927552f9c61ed49f173a793388fcf91bd37c9ba86d4eab8572bf30445d90113d251ff62aeff09bf664c5e3f7a631debd0391cbc08cdc7331302c04c80a9558d4995bb2985da404aa6fc132b7f55649e340f6d839bcddbe371ac6ddaae81759e02663ee1d24e3ff0939e4d93534732e5f51addd509944e2fa66c5c69b4d4d6df68a82df0b03c6bc604ee6fedff0de08294dbe2ccf7ebfdbb8204529567787603280d5c4a09b05d53de4f9b4efc9270b7856985ef2cd3584a4cab7e33968771ec238e7daaedd9b24117d368f19a78bb0c8873db8e6619900676ca5e2639cde2a5960c35a00a90b4742e9e26d8f8b5b5ea38b10967c8f0c68615a9153e86bbc1417f95ca2e3fe11bc463ea76d17214428a07a2b66278e8965bdda71bf0baa62201817fc220b7fba389251474e94056803b3e4d962d5f8db58f02303969800c74c32d71c1bd48ea56381c28a87b1607b90ff1b201d071cd1371598d38dddef4bd026767919881e9fe8733b8b8e6468a1733e020fcf5b45c7cebf25f09d5827cf2e6837d1644186c6598850cab5565ca9bd47f466ba2920e90761fd0cc5b4072ee1af0ad1a369fc742b1a71f18eff59d5e3b843c584c14dad8c3f448538efb3625d7835890b1e3b260773366c34db0d7dc688dedbc99b67cafc96a804ce4aaeefd284a84a8d2f39f6bc294850e890637776168f2cb346151d105ba442aa04f6853e1189d0ca1f9e51dece0f99891700e832425bc639a67773f83440acb48ec2ee4859082dd732f0f165a8894ecd1e156b11bcf01e12be98b82be8a85f43f939f693ee9e3970148eeac204501fd63727b7ba3541cfeedcb3dc0ee22fdc925230ffbe03baa8d256940b837c5cc3f4206ff77f03b7d3d469bfe514a2d6c1fae20be53896a98bba2758b62f9d468827d21995b953fd477ed9f7e12a9f6e9334397b7bc71fd89cf36343a32660a00424c58275fb2d6dcbf253cff852a886f79bdb6afd5b9a5071c90f49cb1892aff721dfcfd4118d1b7a68c2fbda2f243dddd78bfbcde1532a7e54961b5a9d1f3ab897da8860ac3f315821f8a3569bd1732464ee622768117b151dd54fe6c911f3ff479bf4cc963ebdb0f838b49632885ec28dfb0b267ba3601234005ad400a6e6ff6335f88becffb81f3008de4a03a2122123a51e4b94ba5c9dc080218d3993f2a733e19eeaa4c43e54816292cf6086bf6dbe4327cf4067d6bd769d06994739f84bd619df697e3835fff6efe57d68d71cb4b1072c548ab268b8ec6a4b85808b1d0cb3ee678166e83a24a1a09e7723442c8c937c6d96e5a1bcbd65dfa42618c7645a5eae0b70cfe7e2959e1947302bf26aa1e81739535a715fdfeb3972db353d4dffa2bb3d2cd9ea0ed0faafc0f29e8637613315f83d43f408aa2e24f46b4f89c91a70718be7a775cd99cf4f8f303162c226ac7f43efdaa81ab593f74a13c375a8c7a28e261e043cf54dca9734135f5a89770420870301dcf892e9d43ca2d6876776297890642576a893439446f1c2605173e14811e117a669466cb00613905f93412e97a681397495c6d0d0f15261bc19abdb739ed37c5dbed076f669456c44b14ab4f026344d1769749820e91c3bbcb7e7ad15f3be1b8ebf8e1203b3bc95b8daa529256960eae7474bc0cf4e7f53ce94e4fd530b5e323dfd9ad2f21258aca18b09de067215b90ad651daef503d1f9f73f1bcb95a6ba882679a8424d4a1978ecafd44553423b9fdef401c2dc8420b0360c4dd37c084dc14af2c23418f05a487f363c4bef5a3aa4c43f5a74b0d0f02b03404f82b3e638d69300c031344cc17ce2a9acf5c15f94de54f0999f173374efd098fbf52530264c64cd6ca0bb9a866e5e86f1c3131efd0609ed443d4554abf4adb4f0f4a57f0e1cfbe0c4e82e8d9cee4a960a1ed4838b05ed0487d8e9e568e4d545f62baef0a9a8e24ebdb1e6b14f3a5e3665a70ec3768fd8b3dc771cdff701815593a505b897b72b275cd444645ffc5161b968c7c2ca4b7eceffa089a51b91ffe6eccbddcca96ece3a04a56a0e9217e7ae4a58edbf5b6ee21d5292ac2081140d08e2f9150999976023ee5ba28b14a48348341c6b0d250fcc35bb2b643151d20075e82fa8c0949a7b12fffbeb0912dc7c781de619b7a9b2410c51e078e2b08e5127886dbdc3c346362b1ea4882550fef649ced32359bd4e7ccfa037635672f32f24ccccacba82202524342ebcea5e096e8e00557f5a8d7ef71744551cfd520c0a3103c9add1f9a8b82f8dd4c21a5c3c1c122ec33bb4bb60d9b9d7073a273a2235265d885303b0bf411a82122527ec8062eb4bcf8d5586bf7ea33a2ce3dcd8ea76eb984a7b7e0d744c79a6635e7d958f4d2a4f8cb23d64af39a9c58d4ae682221e1f7c11ede196428c228c0ee05444f4e813bd42cb27434f10f49eb82287be388023ec411f54a11940a4ddf38c981602adbf44a0a58f5b6b70ffe33afe0bce00d39faf746fd646a4f43783cd809cfa09511ba29e9edcb7134609c2fd96dd36afc1d9cefdbe074832d8fb5ffc76a0c271fd9bbb9f8907157d44eb2d0007c9d30a02c83ccb86d5c681008ebfe6201c0eed669dcefbf2bc6581b49886920765a6dd7f709eee42f30823562bda99779abd356ad63c1d5c5142bb7f72e2cadf033412974f31c41c0cc7309cd0e39a8725edf7d9b27902917e96ecd31be8716811cef646399d6cf0c49d40f696c331489a418078f2097e82c927d577ae2a00677c99e51ae7eb89a24349399f60788b1407bbae11445f7bb415c1a27cbc85a032d6a57a37a4fcfe064f931fe8aa966353d28e39dcd65f6e485c8db5aba3546930c8ba67dbc621f751e07daaca024600140e9bfd0dd8bde6dab273a222985cf0b5be4e52ad6a9f7b94bf1bce3ed8c52a0457a79c1c39cbb38fb4e0dd9a730e3936a5fb671b8de9791b944e02615c2fb3270ada67f60b190d18acea7b3c770687de79cf3dec2ef1fd2be809ea54a5c360d6e33969eae6aaea477b685b56b88710f2c2c9003d1cde388a93359b2c8de7ecf92b436ee919f6098961c6ea5d161958e5714b735347c50e250478d1c39a073d834937db855aa2a19c8d8f953f77a84a044ca701fda52c162dc4da03b78fbfcc39e264420fe0c54d9d6c61b409326ff735f7ba68bab6b4beb5581c2636f2048c1c11747adcf4f35478f94f820fb96f885f0ea5b717eaf3f520029a22f3385cb420d235a85dfb2bcd6a95c823c8b7b92e673e72007097b91024b56b990816d007ee5e5a049442ab31ac11692544a2249601ad41740c859c2832e73798953eb30e0b04fc0bfe35d5e183e31af5e23f9042c6dc4e71d33b0f368184633be31d936046bfe9bc6c61f1326b4a8fe30fb4a23faa3f9a3205b6aad49b1a5c8be24f68ac7fd420419c16e00872c986f3e85078c048d4e3fae33a55f434039484b1ac7de3348feee5d7a1f2c609a423b1a169003f3e2e624da2c476f39618f99f13cdf63d9724797c1670bf10cfe954c84ecbda03c1ed50bd50a7e57f44a1121dc99f3fa19c6645d9ca7e3d40e7cee2aa827fd3ec7c62b3f15c6e0885eaac9ea0cbc10c4a0973fc00336da9193692be0e67cd8b8e07331d12c90966809588b5931a894e781130f8990a5a076a35cf626d051492b7e378399f8a2558ab2a73570af00b669c6e8618c5404347aa720ba7b4af6f74c8734aad00daecee9ce3768fd3735321e339b2f9f3697e49967efc69041a1a45399b0f344d47b82686a4ba689f851bbfdd07c047112c1fa0561950dc21e4b0689143b68827815dd18693c27aa74295efd5810028fa6f15b7825322bd47427309be6c5e2ed169d515d994d91009a75afff0a5312f1a1777b780ddc1ac0ca95f8eb96402743a487c47a668023faeed4a293b556d5005b83d3df321484b7207496512d7f4df874a6824c564a214949e6978d4c989bf0fa2f6b1a0fa98e8cc3435b0eeb6c19d724fa762f41640e000d1105c4c7d1e19eec377536cfc67df7d802db4687b4d5a28ac56b786c7d0fb3b6e39b3b245aabcc08cbdfe463676b9a1334b101f6bcba5c794fcb769ed994f50646bba981de4fe6c1dfebf01f940080baaf0a3daeea8f6397ea395f1cc252f62220d1ac406ef74f0eb3010beced66f18f69e27a9e6cba6d37843486beb5a5900f46e04e32fe7aea979f1795d8a7c176bdb9dd874035719c696fae6b4e40aa50d2afbe5edf10dbf4deab1c9b237690595d82f85cb40b698fc9aae45bc4ac3491d7f061d25def5f5c4cdde72bd0a1b6ebbf32091fdd64712df4d1317bd183df536356d8ebd04f62fc20dfb7c60125c5f0bd0b680c2e1a9ccf95098945182567c0751ef60c068a91ac0624350ffb9cb938f1526b71f4b1707edf5eaf988649f7dedcd4e454d8a2bf4757bf3a940b79418f5b593add4f1e736a807083a6e50102f741eb85e43bdfd9389931f86308d55c427ab7cdc13f57c84a88335869d24d32bc65d0ee0cc926bb0a7b4b6e239a928f1d36733753b2ea636d65a5704510e30fcf009c822b40d09a3ea7b9a3645671064693e6a60ccb452e76eb196cfcb1deddac0e6adaea9fc364440bf17fb827b08bf545e5515ba44d381f862466b1a4043e9d176cc519bef13166bcc3d9d629d06b2734360565d0530cbad7f5a0336d97f27111918ab1c9887127315f67de6cec7fcfc060eaff6e3128a4d0ac4da249ae8831ceff98b5d0300ed0d61d0e61fde9c16e90e3776641d45961d72d95ccd4c31da95b73d2ba18d89040dce89e1e8561c22ef48139d3a0311ed96c3c2399e669a4bb81edafb816c820dc6cdae20ce05fda10a1026751c75d3caf368a757bf4c2c270e5f20871fad0ff6e3f342f3f682bd34471fa3b7ad7eea600fd3aa1af7612c4e8476fa6b89fbb4f7620ae23285c0d7614fff10950a490554a70f5f459851e9357bbf86fb4321f623ba942ebd160fc0dfed028e3ec45262a05db338e5dc517b3d74cecae6d13203b647ece804ca1d1e2b4dd713678e51d36e0e0db51b13fe9804da0b5820d715a7af9a123dda8bf279e1e7f04100f343eef0285c44b117a0e1dd857bcda272c343d1e1566dc00f472715047b648d906e3d64744bae9718d1cd037f53eebe4a6ed837440b70dee8909915641a97ce8707bda4019bdab84076b896f533214311776f4f621bee061d13c83bbadf14931b484e8912cda250f85d9d74f4d2df8267c392cb8d0e24941aa9e263317c2f37ab32a73b5b73f845e01159453d3c0818e020dda10cba56954df0a139f292b841c8f61839ec994505eb36c5b1a426db0b82f60a7f294f4e781f416b29d64f7f40540a28ba6fe79a4e4275b3be0469abb278c8fd2d59bad9f55c6e51219cbc2d4758faa351b5fac1342287ee48c0c515788835defca5be894d4979e1bcf59bf645907ab1b97979bb19e6587001f048af274c81dcbffad51943f6a0b1fe3cf8c0eda58767f4e5c9d0b2f38b638c4270f4fcc06e7ab81756c481906f32e6c096aa784837722eb09f0b22cb2724f66b71caf02272d57e0947ce510a46c741f0395f6e06f12e42bd1cf90c1a5834732a5fdc2ce6093ac7a7cbf2ca398701dbbbbebf05fa2ffe3223aeb63f166e840a68763493f651912dce6e1363950055de0cb302a2ff933f73340753a6ba87013559013d63a9f98cb1c6e292464f8df14e07ac0a6f36722d0e1aae5df34c2cf585f0271ba09c5cd1437523e7089bcb613bf83e3b41bfaf6be044cf1202f4864e19c48e3d52ad6edb8f8e6a9158a541c7c10044c43eb547122a8dfe9c4e1fca5f0b9eb57a3096c4f3ab677dec838d19316642f1dbeeaf3c7860fbfaebd99ad375ec6c2861bf9525c320cfbb2568d4bf5eb06b3ffddc1f36e4c27c96029956d3043b739000f5a60976ea61c4f66c96009903a73b35643be8fab1eee134b8d7847eb3c7b9da99b4e4130452ccef7d293734e782827c656fc16681190282</script>
  <div class="hbe hbe-content">
    <div class="hbe hbe-input hbe-input-xray">
      <input class="hbe hbe-input-field hbe-input-field-xray" type="password" id="hbePass">
      <label class="hbe hbe-input-label hbe-input-label-xray" for="hbePass">
        <span class="hbe hbe-input-label-content hbe-input-label-content-xray">您好，这里需要密码。</span>
      </label>
      <svg class="hbe hbe-graphic hbe-graphic-xray" width="300%" height="100%" viewBox="0 0 1200 60" preserveAspectRatio="none">
        <path d="M0,56.5c0,0,298.666,0,399.333,0C448.336,56.5,513.994,46,597,46c77.327,0,135,10.5,200.999,10.5c95.996,0,402.001,0,402.001,0"></path>
        <path d="M0,2.5c0,0,298.666,0,399.333,0C448.336,2.5,513.994,13,597,13c77.327,0,135-10.5,200.999-10.5c95.996,0,402.001,0,402.001,0"></path>
      </svg>
    </div>
  </div>
</div>
<script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      <categories>
        <category>架构师笔记</category>
      </categories>
      <tags>
        <tag>UML</tag>
      </tags>
  </entry>
  <entry>
    <title>mycat学习</title>
    <url>/mycat/</url>
    <content><![CDATA[<h1 id="mycat分库分表中间件"><a class="markdownIt-Anchor" href="#mycat分库分表中间件"></a> Mycat(分库分表中间件)</h1>
<h2 id="1-数据库优化策略"><a class="markdownIt-Anchor" href="#1-数据库优化策略"></a> 1. 数据库优化策略</h2>
<ol>
<li>重启：释放资源</li>
<li>SQL与索引</li>
<li>表与存储引擎（字段类型选择，长度设置，是否需要分表、分区）</li>
<li>数据库与应用架构（考虑使用缓存服务器，减轻是数据库压力；可以数据库分布式，读写分离，主从复制）</li>
<li>数据库与操作系统配置（修改mysql配置，使用单独服务器部署数据库）</li>
<li>硬件</li>
</ol>
<h2 id="2-数据库演化"><a class="markdownIt-Anchor" href="#2-数据库演化"></a> 2. 数据库演化</h2>
<p>根据业务需要、数据量变化，随之而来的数据库的变化</p>
<ol>
<li>
<p>数据库与应用部署在同一台服务器<br>
<img src="/mycat/image-20201104204430049.png" alt="mycat"></p>
</li>
<li>
<p>单体应用架构，单数据库（数据库服务器和应用服务器分离，但是业务系统越做越大）<br>
<img src="/mycat/image-20201104204624925.png" alt="mycat"></p>
</li>
<li>
<p>多应用单数据库（应用解耦）<br>
<img src="/mycat/image-20201104204933409.png" alt="mycat"></p>
</li>
<li>
<p>多应用 独立数据库<br>
<img src="/mycat/image-20201104205054233.png" alt="mycat"></p>
</li>
<li>
<p>但应用多数据库(分表)<br>
<img src="/mycat/image-20201104205319372.png" alt="mycat"></p>
</li>
</ol>
<h2 id="3-如何分库分表"><a class="markdownIt-Anchor" href="#3-如何分库分表"></a> 3. 如何分库分表</h2>
<p><img src="/mycat/image-20201104205653611.png" alt="mycat"></p>
<ul>
<li>
<p>垂直切分</p>
<ul>
<li>
<p>单库<br>
<img src="/mycat/image-20201104205756827.png" alt="mycat"></p>
</li>
<li>
<p>多库<br>
<img src="/mycat/image-20201104210008624.png" alt="mycat"></p>
</li>
</ul>
</li>
<li>
<p>水平切分</p>
<ul>
<li>
<p>按照月分表或者分成实时、历史表等<br>
<img src="/mycat/image-20201104210117373.png" alt="mycat"></p>
</li>
<li>
<p>分成多库<br>
<img src="/mycat/image-20201104210416994.png" alt="mycat"></p>
</li>
</ul>
</li>
</ul>
<h2 id="4-分库分表带来的问题"><a class="markdownIt-Anchor" href="#4-分库分表带来的问题"></a> 4. 分库分表带来的问题</h2>
<ol>
<li>
<p>跨库关联查询</p>
<ul>
<li>增加冗余字段（违反了第三范式：表中的所有数据元素不但要能唯一地被主关键字所标识,而且它们之间还必须相互独立,不存在其他的函数关系）</li>
<li>跨数据库的同步（canal、Mq（最好）、ETL、kettle、ogg）(在某个库中同步其他数据库中表的数据，避免跨库关联查询)</li>
<li>全局表(广播表)：比如行政区划表，所有的系统都是一样的；</li>
<li>API</li>
</ul>
</li>
<li>
<p>分布式事务</p>
<ul>
<li>Local</li>
</ul>
</li>
<li>
<p>排序、翻页、函数计算</p>
<ul>
<li></li>
</ul>
</li>
<li>
<p>全局主键</p>
<ul>
<li>雪花算法leaf</li>
<li>redis(int 类型可以设置incby)</li>
<li>ZookKeeper</li>
<li>uuid(数据过长， 影响索引存储)</li>
</ul>
</li>
<li>
<p>多数据源连接（动态数据源）<br>
<img src="/mycat/image-20201104213343204.png" alt="mycat"></p>
</li>
</ol>
<h2 id="5-mycat分库分表中间件"><a class="markdownIt-Anchor" href="#5-mycat分库分表中间件"></a> 5. Mycat分库分表中间件</h2>
<p><strong>官网地址</strong>：<a href="http://www.mycat.org.cn/">http://www.mycat.org.cn/</a></p>
<p>从阿里cobar升级而来，完全实现了mysql协议，可以当作一个mysql数据库来使用，通过JDBC支持其他数据库实现分库分表，解决了<strong>多表join、分布式事务、全局序列号、翻页查询、函数计算</strong>的问题</p>
<ul>
<li>一个彻底开源的，面向企业应用开发的大数据库集群</li>
<li>支持事务、ACID、可以替代MySQL的加强版数据库</li>
<li>一个可以视为MySQL集群的企业级数据库，用来替代昂贵的Oracle集群</li>
<li>一个融合内存缓存技术、NoSQL技术、HDFS大数据的新型SQL Server</li>
<li>结合传统数据库和新型分布式数据仓库的新一代企业级数据库产品</li>
<li>一个新颖的数据库中间件产品</li>
</ul>
<p>华为云的DDM其实也是根据mycat做的</p>
<h3 id="51-核心概念"><a class="markdownIt-Anchor" href="#51-核心概念"></a> 5.1 核心概念</h3>
<p><img src="/mycat/image-20201104215015366.png" alt="image-20201104215015366"></p>
<h3 id="52-mycat安装与配置"><a class="markdownIt-Anchor" href="#52-mycat安装与配置"></a> 5.2 Mycat安装与配置</h3>
<h4 id="521-mycat安装"><a class="markdownIt-Anchor" href="#521-mycat安装"></a> 5.2.1 Mycat安装</h4>
<p>从官网下载安装版本，解压到文件(官网建议安装在/usr/local/Mycat)后页面如下图所示：<br>
<img src="/mycat/image-20201127094703483.png" alt="image-20201127094703483"></p>
<p>目录解释如下：</p>
<ul>
<li>**bin：*<em>存放window版和linux版本除了提供封装成服务的版本之外，也提供了nowrap的shell脚本命令，方便选择和修改；Linux下运行:./mycat console， 首先要chmod + x</em>;(mycat支持的命令console、start、stop、restart、status、dump)</li>
<li>**conf：**server.xml是mycat服务器参数调整和用户授权的配置文件，schema.xml是逻辑库定义和表以及分片定义的配置文件，rule.xml是分片规则的配置文件，分片规则的具体一些参数信息单独存放为文件，也在这个目录下，配置文件修改，需要重启mycat或者通过9066端口reload</li>
<li>**lib:**主要存放mycat依赖的一些jar文件</li>
<li><strong>logs:<strong>日志存放在mycat.log中，每天一个文件，日志的配置是在conf/log4j.xml中，根据自己的需要，可以调整输出级别为debug，方便排查问题；注意Linux下部署安装mysql，默认不忽略，需要手动到/etc/my.cnf下配置</strong>lower_case_table_names=1</strong>使Linux环境下MySQL忽略表明大小写，否则使用mycat的时候会提示找不到表的错误</li>
</ul>
<h4 id="522-服务启动与配置"><a class="markdownIt-Anchor" href="#522-服务启动与配置"></a> 5.2.2 服务启动与配置</h4>
<p>Mycat在Linux中部署启动时，首先需要在Linux系统的环境变量中配置MYCAT_HOE,操作方式如下：</p>
<ol>
<li>
<p>vi /etc/profile，在系统环境变量文件中增加MYCAT_HOME=/usr/lib/tools/mycat<br>
<img src="/mycat/image-20201127103212598.png" alt="image-20201127103212598"></p>
</li>
<li>
<p>执行 source/etc/profile命令，使环境变量生效。如果是多台Linux系统中组件Mycat集群，那需要在mycat Server所在的服务器配置对其他ip和主机名的映射，配置方式如下：<br>
<img src="/mycat/image-20201127104159580.png" alt="image-20201127104159580"></p>
<p>经过以上两个步骤的配置，就可以到/usr/lib/tools/mycat/bin目录下执行./mycat start启动mycat服务；使用mycat status查看mycat的运行状态；如下图<br>
<img src="/mycat/image-20201128135953635.png" alt="image-20201128135953635"></p>
</li>
</ol>
<h5 id="5221-安装遇到的问题"><a class="markdownIt-Anchor" href="#5221-安装遇到的问题"></a> 5.2.2.1 安装遇到的问题</h5>
<ol>
<li>
<p>schema TESTDB refered by user root is not exist!<img src="/mycat/image-20201215152125176.png" alt="image-20201215152125176"></p>
<p>解决方式：</p>
 <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--在conf/server.xml文件中schemas中配置schema.xml文件中的schema的name值--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--user中的name为mycat服务的用户名--&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">user</span> <span class="attr">name</span>=<span class="string">&quot;root&quot;</span> <span class="attr">defaultAccount</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!--这个是mycat服务连接的密码--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span>123456<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;schemas&quot;</span>&gt;</span>xiaoyuge<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="523日志分析"><a class="markdownIt-Anchor" href="#523日志分析"></a> 5.2.3日志分析</h4>
<p>mycat的日志文件配置为MYCAT_HOME/conf/log4j.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">log4j</span>:configuration <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;log4j.dtd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">log4j:configuration</span> <span class="attr">xmlns:log4j</span>=<span class="string">&quot;http://jakarta.apache.org/log4j/&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;ConsoleAppender&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.apache.log4j.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">layout</span> <span class="attr">class</span>=<span class="string">&quot;org.apache.log4j.PatternLayout&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;ConversionPattern&quot;</span> <span class="attr">value</span>=<span class="string">&quot;%d&#123;MM-dd HH:mm:ss.SSS&#125; %5p [%t] (%F:%L) -%m%n&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;FILE&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.apache.log4j.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--日志文件存放的目录--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;file&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;MYCAT_HOME&#125;/logs/mycat.log&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;Append&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;MaxFileSize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;10000KB&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;MaxBackupIndex&quot;</span> <span class="attr">value</span>=<span class="string">&quot;10&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;encoding&quot;</span> <span class="attr">value</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">layout</span> <span class="attr">class</span>=<span class="string">&quot;org.apache.log4j.PatternLayout&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;ConversionPattern&quot;</span> <span class="attr">value</span>=<span class="string">&quot;%d&#123;MM/dd HH:mm:ss.SSS&#125; %5p [%t] (%F:%L) -%m%n&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">root</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--level是日志级别，生产环境下加以将级别调整为info/ware，如果是研究测试，碰到异常设置为debug--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">level</span> <span class="attr">value</span>=<span class="string">&quot;debug&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;ConsoleAppender&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">log4j:configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="5231-warpper日志"><a class="markdownIt-Anchor" href="#5231-warpper日志"></a> 5.2.3.1 warpper日志</h5>
<p>目前mycat的启动时经过warpper封装成启动脚本，所以日志也会有其相关的日志文件：${MYCAT_HOME}/logs/warapper.log， 在启动的时候如果系统环境配置错误或缺少配置时，导致mycat无法启动，可以通过查看wrapper.log查看具体错误原因。</p>
<ol>
<li>
<p>正常启动</p>
 <figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">STATUS | wrapper | <span class="number">2015</span>/<span class="number">04</span>/<span class="number">12</span> <span class="number">15</span>:<span class="number">05</span>:<span class="number">00</span> | --&gt; Wrapper Started as Daemon</span><br><span class="line">STATUS | wrapper | <span class="number">2015</span>/<span class="number">04</span>/<span class="number">12</span> <span class="number">15</span>:<span class="number">05</span>:<span class="number">00</span> | Launching a JVM...</span><br><span class="line">INFO | jvm <span class="number">1</span> | <span class="number">2015</span>/<span class="number">04</span>/<span class="number">12</span> <span class="number">15</span>:<span class="number">05</span>:<span class="number">01</span> | Wrapper (Version <span class="number">3</span><span class="variable">.2</span><span class="variable">.3</span>) http:<span class="comment">//wrapper.tanukisoftware.org</span></span><br><span class="line">INFO | jvm <span class="number">1</span> | <span class="number">2015</span>/<span class="number">04</span>/<span class="number">12</span> <span class="number">15</span>:<span class="number">05</span>:<span class="number">01</span> | Copyright <span class="number">1999</span>-<span class="number">2006</span> Tanuki Software, Inc. AllRights Reserved.</span><br><span class="line">INFO | jvm <span class="number">1</span> | <span class="number">2015</span>/<span class="number">04</span>/<span class="number">12</span> <span class="number">15</span>:<span class="number">05</span>:<span class="number">01</span> |</span><br><span class="line">INFO | jvm <span class="number">1</span> | <span class="number">2015</span>/<span class="number">04</span>/<span class="number">12</span> <span class="number">15</span>:<span class="number">05</span>:<span class="number">01</span> | log4j <span class="number">2015</span>-<span class="number">04</span>-<span class="number">12</span> <span class="number">15</span>:<span class="number">05</span>:<span class="number">01</span> [./conf/log4j<span class="variable">.xml</span>]load completed.</span><br><span class="line">INFO | jvm <span class="number">1</span> | <span class="number">2015</span>/<span class="number">04</span>/<span class="number">12</span> <span class="number">15</span>:<span class="number">05</span>:<span class="number">02</span> | MyCAT Server startup successfully. see logs in logs/mycat<span class="variable">.log</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>启动异常</p>
 <figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">STATUS | wrapper | <span class="number">2015</span>/<span class="number">02</span>/<span class="number">14</span> <span class="number">01</span>:<span class="number">43</span>:<span class="number">44</span> | --&gt; Wrapper Started as Daemon</span><br><span class="line">STATUS | wrapper | <span class="number">2015</span>/<span class="number">02</span>/<span class="number">14</span> <span class="number">01</span>:<span class="number">43</span>:<span class="number">44</span> | Launching a JVM...</span><br><span class="line">INFO | jvm <span class="number">1</span> | <span class="number">2015</span>/<span class="number">02</span>/<span class="number">14</span> <span class="number">01</span>:<span class="number">43</span>:<span class="number">45</span> | Error: Exception thrown by the agent : java<span class="variable">.rmi</span><span class="variable">.server</span><span class="variable">.ExportException</span>:</span><br><span class="line">Port already in <span class="keyword">use</span>: <span class="number">1984</span>; nested exception is:</span><br><span class="line">INFO | jvm <span class="number">1</span> | <span class="number">2015</span>/<span class="number">02</span>/<span class="number">14</span> <span class="number">01</span>:<span class="number">43</span>:<span class="number">45</span> | java<span class="variable">.net</span><span class="variable">.BindException</span>: Address already in <span class="keyword">use</span></span><br><span class="line">ERROR | wrapper | <span class="number">2015</span>/<span class="number">02</span>/<span class="number">14</span> <span class="number">01</span>:<span class="number">43</span>:<span class="number">45</span> | JVM exited <span class="keyword">while</span> loading the application.</span><br><span class="line">    </span><br><span class="line"># 日志显示异常原因为 java<span class="variable">.net</span><span class="variable">.BindException</span>: Address already in <span class="keyword">use</span>,也就是端口占用，很有可能是原有服</span><br><span class="line">务未停止，或者 Mycat 默认端口被其他程序占用，正常启动成功后会有 mycat<span class="variable">.log</span> 日志，如果服务未启动成功不会有对应的日志。 也可以去修改 conf 文件夹里的 wrapper<span class="variable">.conf</span> 里的 wrapper<span class="variable">.java</span><span class="variable">.additional</span><span class="variable">.7</span>=-Dcom<span class="variable">.sun</span><span class="variable">.management</span><span class="variable">.jmxremote</span><span class="variable">.port</span>=<span class="number">1984</span>，server<span class="variable">.xml</span> 的&lt;<span class="keyword">property</span> name=<span class="string">&quot;serverPort&quot;</span>&gt;<span class="number">8066</span>&lt;/<span class="keyword">property</span>&gt;和</span><br><span class="line">&lt;<span class="keyword">property</span> name=<span class="string">&quot;managerPort&quot;</span>&gt;<span class="number">9066</span>&lt;/<span class="keyword">property</span>&gt;，这方法适</span><br><span class="line">合一台机器上两个 mycat 或者 <span class="number">1984</span>,<span class="number">8066</span>,<span class="number">9066</span> 端口被其它应用占用的情况</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h5 id="5232-mycat日志"><a class="markdownIt-Anchor" href="#5232-mycat日志"></a> 5.2.3.2 mycat日志</h5>
<h4 id="524-mycat防火墙设置"><a class="markdownIt-Anchor" href="#524-mycat防火墙设置"></a> 5.2.4 mycat防火墙设置</h4>
<p>白名单和SQL黑名单说明：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--在 server.xml 中配置：--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">firewall</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!--ip 白名单列表，可以配置多个--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">whitehost</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--ip 白名单 用户对应的可以访问的 ip 地址--&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">host</span> <span class="attr">user</span>=<span class="string">&quot;mycat&quot;</span> <span class="attr">host</span>=<span class="string">&quot;127.0.0.1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">host</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">whitehost</span>&gt;</span></span><br><span class="line">     &lt;!-是否开启检查黑名单列表--&gt;</span><br><span class="line">    <span class="tag">&lt;<span class="name">blacklist</span> <span class="attr">check</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--黑名单允许的 权限 后面为默认--&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;selelctAllow&quot;</span>&gt;</span>false<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">blacklist</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">firewall</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>黑名单配置拦截明细如下：</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">配置项</th>
<th style="text-align:center">缺省值</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">rollbackAllow</td>
<td style="text-align:center">true</td>
<td style="text-align:center">是否允许执行 roll back 操作,如果把 selectIntoAllow、deleteAllow、updateAllow、insertAllow、mergeAllow 都设置为 false，这就是一个只读数据源了。</td>
</tr>
<tr>
<td style="text-align:center">selectAllow</td>
<td style="text-align:center">true</td>
<td style="text-align:center">是否运行执行SELECT语句</td>
</tr>
<tr>
<td style="text-align:center">selectAllColumnAllow</td>
<td style="text-align:center">true</td>
<td style="text-align:center">是否允许执行 SELECT * FROM T 这样的语句。如果设置为 false，不允许执行 select * from t，但 select * from (select id, name from t) a。这个选项是防御程序通过调用 select *获得数据表的结构信息</td>
</tr>
<tr>
<td style="text-align:center">selectIntoAllow</td>
<td style="text-align:center">true</td>
<td style="text-align:center">SELECT 查询中是否允许 INTO 字句</td>
</tr>
<tr>
<td style="text-align:center">deleteAllow</td>
<td style="text-align:center">true</td>
<td style="text-align:center">是否允许执行 DELETE 语句</td>
</tr>
<tr>
<td style="text-align:center">updateAllow</td>
<td style="text-align:center">true</td>
<td style="text-align:center">是否允许执行 UPDATE 语句</td>
</tr>
<tr>
<td style="text-align:center">insertAllow</td>
<td style="text-align:center">true</td>
<td style="text-align:center">是否允许执行 INSERT 语句</td>
</tr>
<tr>
<td style="text-align:center">replaceAllow</td>
<td style="text-align:center">true</td>
<td style="text-align:center">是否允许执行 REPLACE 语句</td>
</tr>
<tr>
<td style="text-align:center">mergeAllow</td>
<td style="text-align:center">true</td>
<td style="text-align:center">是否允许执行 MERGE 语句，这个只在 Oracle 中有用</td>
</tr>
<tr>
<td style="text-align:center">callAllow</td>
<td style="text-align:center">true</td>
<td style="text-align:center">是否允许通过 jdbc 的 call 语法调用存储过程</td>
</tr>
<tr>
<td style="text-align:center">setAllow</td>
<td style="text-align:center">true</td>
<td style="text-align:center">是否允许使用 SET 语法</td>
</tr>
<tr>
<td style="text-align:center">truncateAllow</td>
<td style="text-align:center">true</td>
<td style="text-align:center">truncate 语句是危险，缺省打开，若需要自行关闭</td>
</tr>
<tr>
<td style="text-align:center">createTableAllow</td>
<td style="text-align:center">true</td>
<td style="text-align:center">是否允许创建表</td>
</tr>
<tr>
<td style="text-align:center">alterTableAllow</td>
<td style="text-align:center">true</td>
<td style="text-align:center">是否允许执行 Alter Table 语句</td>
</tr>
<tr>
<td style="text-align:center">dropTableAllow</td>
<td style="text-align:center">true</td>
<td style="text-align:center">是否允许修改表</td>
</tr>
<tr>
<td style="text-align:center">commentAllow</td>
<td style="text-align:center">false</td>
<td style="text-align:center">是否允许语句中存在注释，Oracle 的用户不用担心，Wall 能够识别 hints和注释的区别</td>
</tr>
<tr>
<td style="text-align:center">noneBaseStatementAllow</td>
<td style="text-align:center">false</td>
<td style="text-align:center">是否允许非以上基本语句的其他语句，缺省关闭，通过这个选项 就能够屏蔽 DDL。</td>
</tr>
<tr>
<td style="text-align:center">multiStatementAllow</td>
<td style="text-align:center">false</td>
<td style="text-align:center">是否允许一次执行多条语句，缺省关闭</td>
</tr>
<tr>
<td style="text-align:center">useAllow</td>
<td style="text-align:center">true</td>
<td style="text-align:center">是否允许执行 mysql 的 use 语句，缺省打开</td>
</tr>
<tr>
<td style="text-align:center">describeAllow</td>
<td style="text-align:center">true</td>
<td style="text-align:center">是否允许执行 mysql 的 describe 语句，缺省打开</td>
</tr>
<tr>
<td style="text-align:center">showAllow</td>
<td style="text-align:center">true</td>
<td style="text-align:center">是否允许执行 mysql 的 show 语句，缺省打开</td>
</tr>
<tr>
<td style="text-align:center">commitAllow</td>
<td style="text-align:center">true</td>
<td style="text-align:center">是否允许执行 commit 操作</td>
</tr>
</tbody>
</table>
<p><strong>拦截配置=-永真条件：</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">配置项</th>
<th style="text-align:center">缺省值</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">selectWhereAlwayTrueCheck</td>
<td style="text-align:center">true</td>
<td style="text-align:center">检查 SELECT 语句的 WHERE 子句是否是一个永真条件</td>
</tr>
<tr>
<td style="text-align:center">selectHavingAlwayTrueCheck</td>
<td style="text-align:center">true</td>
<td style="text-align:center">检查 SELECT 语句的 HAVING 子句是否是一个永真条件</td>
</tr>
<tr>
<td style="text-align:center">deleteWhereAlwayTrueCheck</td>
<td style="text-align:center">true</td>
<td style="text-align:center">检查 DELETE 语句的 WHERE 子句是否是一个永真条件</td>
</tr>
<tr>
<td style="text-align:center">deleteWhereNoneCheck</td>
<td style="text-align:center">false</td>
<td style="text-align:center">检查 DELETE 语句是否无 where 条件，这是有风险的，但不是 SQL 注入类型的风险</td>
</tr>
<tr>
<td style="text-align:center">updateWhereAlayTrueCheck</td>
<td style="text-align:center">true</td>
<td style="text-align:center">检查 UPDATE 语句的 WHERE 子句是否是一个永真条件</td>
</tr>
<tr>
<td style="text-align:center">updateWhereNoneCheck</td>
<td style="text-align:center">false</td>
<td style="text-align:center">检查 UPDATE 语句是否无 where 条件，这是有风险的，但不是SQL 注入类型的风险</td>
</tr>
<tr>
<td style="text-align:center">conditionAndAlwayTrueAllow</td>
<td style="text-align:center">false</td>
<td style="text-align:center">检查查询条件(WHERE/HAVING 子句)中是否包含 AND 永真条件</td>
</tr>
<tr>
<td style="text-align:center">conditionAndAlwayFalseAllow</td>
<td style="text-align:center">false</td>
<td style="text-align:center">检查查询条件(WHERE/HAVING 子句)中是否包含 AND 永假条件</td>
</tr>
<tr>
<td style="text-align:center">conditionLikeTrueAllow</td>
<td style="text-align:center">true</td>
<td style="text-align:center">检查查询条件(WHERE/HAVING 子句)中是否包含 LIKE 永真条件</td>
</tr>
</tbody>
</table>
<p><strong>其他拦截配置：</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">配置项</th>
<th style="text-align:left">缺省值</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">selectIntoOutfileAllow</td>
<td style="text-align:left">false</td>
<td style="text-align:center">SELECT … INTO OUTFILE 是否允许，这个是 mysql 注入攻击的常见手段，缺省是禁止的</td>
</tr>
<tr>
<td style="text-align:center">selectUnionCheck</td>
<td style="text-align:left">true</td>
<td style="text-align:center">检测 SELECT UNION</td>
</tr>
<tr>
<td style="text-align:center">selectMinusCheck</td>
<td style="text-align:left">true</td>
<td style="text-align:center">检测 SELECT MINUS</td>
</tr>
<tr>
<td style="text-align:center">selectExceptCheck</td>
<td style="text-align:left">true</td>
<td style="text-align:center">检测 SELECT EXCEPT</td>
</tr>
<tr>
<td style="text-align:center">selectIntersectCheck</td>
<td style="text-align:left">true</td>
<td style="text-align:center">检测 SELECT INTERSECT</td>
</tr>
<tr>
<td style="text-align:center">mustParameterized</td>
<td style="text-align:left">false</td>
<td style="text-align:center">是否必须参数化，如果为 True，则不允许类似 WHERE ID = 1 这种不参数化的 SQL</td>
</tr>
<tr>
<td style="text-align:center">strictSyntaxCheck</td>
<td style="text-align:left">true</td>
<td style="text-align:center">是否进行严格的语法检测，Druid SQL Parser 在某些场景不能覆盖所有的，SQL 语法，出现解析 SQL 出错，可以临时把这个选项设置为 false，同时把 SQL 反馈给 Druid 的开发者</td>
</tr>
<tr>
<td style="text-align:center">conditionOpXorAllow</td>
<td style="text-align:left">false</td>
<td style="text-align:center">查询条件中是否允许有 XOR 条件。XOR 不常用，很难判断永真或者永假，缺省不允许。</td>
</tr>
<tr>
<td style="text-align:center">conditionOpBitwseAllow</td>
<td style="text-align:left">true</td>
<td style="text-align:center">查询条件中是否允许有&quot;&amp;&quot;、&quot;~&quot;、&quot;</td>
</tr>
<tr>
<td style="text-align:center">conditionDoubleConstAllow</td>
<td style="text-align:left">false</td>
<td style="text-align:center">查询条件中是否允许连续两个常量运算表达式</td>
</tr>
<tr>
<td style="text-align:center">minusAllow</td>
<td style="text-align:left">true</td>
<td style="text-align:center">是否允许 SELECT * FROM A MINUS SELECT * FROM B 这样的语句</td>
</tr>
<tr>
<td style="text-align:center">intersectAllow</td>
<td style="text-align:left">true</td>
<td style="text-align:center">是否允许 SELECT * FROM A INTERSECT SELECT * FROM B 这样的语句</td>
</tr>
<tr>
<td style="text-align:center">constArithmeticAllow</td>
<td style="text-align:left">true</td>
<td style="text-align:center">拦截常量运算的条件，比如说 WHERE FID = 3 - 1，其中&quot;3 - 1&quot;是常量运算表达式。</td>
</tr>
<tr>
<td style="text-align:center">limitZeroAllow</td>
<td style="text-align:left">false</td>
<td style="text-align:center">是否允许 limit 0 这样的语句</td>
</tr>
</tbody>
</table>
<p><strong>禁用对象检测配置：</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">配置项</th>
<th style="text-align:center">缺省值</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">tableCheck</td>
<td style="text-align:center">true</td>
<td style="text-align:center">检测是否使用了禁用的表</td>
</tr>
<tr>
<td style="text-align:center">schemaCheck</td>
<td style="text-align:center">true</td>
<td style="text-align:center">检测是否使用了禁用的 Schema</td>
</tr>
<tr>
<td style="text-align:center">functionCheck</td>
<td style="text-align:center">true</td>
<td style="text-align:center">检测是否使用了禁用的函数</td>
</tr>
<tr>
<td style="text-align:center">objectCheck</td>
<td style="text-align:center">true</td>
<td style="text-align:center">检测是否使用了“禁用对对象”</td>
</tr>
<tr>
<td style="text-align:center">variantCheck</td>
<td style="text-align:center">true</td>
<td style="text-align:center">检测是否使用了“禁用的变量”</td>
</tr>
<tr>
<td style="text-align:center">readOnlyTables</td>
<td style="text-align:center">空</td>
<td style="text-align:center">指定的表只读，不能够在 SELECT INTO、DELETE、UPDATE、INSERT、MERGE 中作为&quot;被修改表&quot;出现</td>
</tr>
</tbody>
</table>
<h4 id="525-mycat配置文件"><a class="markdownIt-Anchor" href="#525-mycat配置文件"></a> 5.2.5 mycat配置文件</h4>
<h5 id="5251-schemaxml配置"><a class="markdownIt-Anchor" href="#5251-schemaxml配置"></a> 5.2.5.1 schema.xml配置</h5>
<p>schema.xml作为mycat中重要的配置文件之一，管理者mycat的逻辑库、表、分片规则、DataNode以及DataSource。</p>
<h5 id="5252-scheme标签"><a class="markdownIt-Anchor" href="#5252-scheme标签"></a> 5.2.5.2 scheme标签</h5>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">schema</span> <span class="attr">name</span>=<span class="string">&quot;TESTDB&quot;</span> <span class="attr">checkSQLschema</span>=<span class="string">&quot;false&quot;</span> <span class="attr">sqlMaxLimit</span>=<span class="string">&quot;100&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">schema</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>schema标签用于定义mycat实例中的逻辑库，mycat可以由多个逻辑库，每个逻辑库都有自己的相关配置，可以使用schema标签来划分这些不同的逻辑库。如果不配置schema标签，所有的表配置，会属于同一个默认的逻辑库。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--逻辑库TESTDB--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">schema</span> <span class="attr">name</span>=<span class="string">&quot;TESTDB&quot;</span> <span class="attr">checkSQLschema</span>=<span class="string">&quot;false&quot;</span> <span class="attr">sqlMaxLimit</span>=<span class="string">&quot;100&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">&quot;travelrecord&quot;</span> <span class="attr">dataNode</span>=<span class="string">&quot;dn1,dn2,dn3&quot;</span> <span class="attr">rule</span>=<span class="string">&quot;auto-sharding-long&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">schema</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--USERDB--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">schema</span> <span class="attr">name</span>=<span class="string">&quot;USERDB&quot;</span> <span class="attr">checkSQLschema</span>=<span class="string">&quot;false&quot;</span> <span class="attr">sqlMaxLimit</span>=<span class="string">&quot;100&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">&quot;company&quot;</span> <span class="attr">dataNode</span>=<span class="string">&quot;dn10,dn11,dn12&quot;</span> <span class="attr">rule</span>=<span class="string">&quot;auto-sharding-long&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">schema</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">	逻辑库的概念和MySQL数据库中的database概念相同，我们在查询这两个不同的逻辑库中表的时候需要切换到该逻辑库下才可以查询到所需要的表</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br></pre></td></tr></table></figure>
<p>在server.xml中可以配置不同的用户能够使用的schema</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">user</span> <span class="attr">name</span>=<span class="string">&quot;root&quot;</span> <span class="attr">defaultAccount</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span>root<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;schemas&quot;</span>&gt;</span>TESTDB<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;defaultSchema&quot;</span>&gt;</span>TESTDB<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--No MyCAT Database selected 错误前会尝试使用该schema作为schema，不设置则为null,报错 --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 表级 DML 权限设置 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        &lt;privileges check=&quot;false&quot;&gt;</span></span><br><span class="line"><span class="comment">                &lt;schema name=&quot;TESTDB&quot; dml=&quot;0110&quot; &gt;</span></span><br><span class="line"><span class="comment">                        &lt;table name=&quot;tb01&quot; dml=&quot;0000&quot;&gt;&lt;/table&gt;</span></span><br><span class="line"><span class="comment">                        &lt;table name=&quot;tb02&quot; dml=&quot;1111&quot;&gt;&lt;/table&gt;</span></span><br><span class="line"><span class="comment">                &lt;/schema&gt;</span></span><br><span class="line"><span class="comment">        &lt;/privileges&gt;</span></span><br><span class="line"><span class="comment">         --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">user</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span>user<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;schemas&quot;</span>&gt;</span>TESTDB<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;readOnly&quot;</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;defaultSchema&quot;</span>&gt;</span>TESTDB<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="/mycat/image-20201129110838590.png" alt></p>
<p>schema标签的相关属性：</p>
<table>
<thead>
<tr>
<th style="text-align:center">属性名</th>
<th style="text-align:center">值</th>
<th style="text-align:center">数量限制</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">dataNode</td>
<td style="text-align:center">任意string</td>
<td style="text-align:center">（0…1）</td>
</tr>
<tr>
<td style="text-align:center">checkSQLschema</td>
<td style="text-align:center">Boolean</td>
<td style="text-align:center">（1）</td>
</tr>
<tr>
<td style="text-align:center">sqlMaxLimit</td>
<td style="text-align:center">Integer</td>
<td style="text-align:center">（1）</td>
</tr>
</tbody>
</table>
<h6 id="52521-datanode"><a class="markdownIt-Anchor" href="#52521-datanode"></a> 5.2.5.2.1  dataNode</h6>
<p>该属性用于绑定逻辑库到某个具体的database上，1.3版本如果配置了dataNode,则不可以配置分片表，1.4可以配置默认分片，只需要配置需要分片的表即可，具体配置如下：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--1.3版本配置--&gt;</span><span class="tag">&lt;<span class="name">schema</span> <span class="attr">name</span>=<span class="string">&quot;USERDB&quot;</span> <span class="attr">checkSQLschema</span>=<span class="string">&quot;false&quot;</span> <span class="attr">sqlMaxLimit</span>=<span class="string">&quot;100&quot;</span> <span class="attr">dataNode</span>=<span class="string">&quot;dn1&quot;</span>&gt;</span>&lt;!—里面不能配置任何表--&gt;<span class="tag">&lt;/<span class="name">schema</span>&gt;</span><span class="comment">&lt;!--1.4版本配置--&gt;</span><span class="tag">&lt;<span class="name">schema</span> <span class="attr">name</span>=<span class="string">&quot;USERDB&quot;</span> <span class="attr">checkSQLschema</span>=<span class="string">&quot;false&quot;</span> <span class="attr">sqlMaxLimit</span>=<span class="string">&quot;100&quot;</span> <span class="attr">dataNode</span>=<span class="string">&quot;dn2&quot;</span>&gt;</span>&lt;!—配置需要分片的表--&gt;	<span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">“tuser”</span> <span class="attr">dataNode</span>=<span class="string">”dn1”/</span>&gt;</span><span class="tag">&lt;/<span class="name">schema</span>&gt;</span><span class="comment">&lt;!-- 	那么现在tuser就绑定到dn1所配置的具体database上，可以直接访问这个database，没有配置的表则会走默认的节点dn2，这里注意没有配置在分片里面的表工具查看无法显示，但是可以正常使用。--&gt;</span></span><br></pre></td></tr></table></figure>
<h6 id="52522-checksqlschema"><a class="markdownIt-Anchor" href="#52522-checksqlschema"></a> 5.2.5.2.2 checkSQLschema</h6>
<p>当改制设置为true时，我们执行“SELECT * FROM TESTDB.travelrecord；”则mycat会把语句修改为“SELECT * FROM travelrecord;”即把表示schema的字符去掉，避免发送到后端数据库执行报ERROR 1146：Table ‘testdb.travelrecord’ doest’t exist.不过，即使设置该值为 true ，如果语句所带的是并非是 schema 指定的名字，例如：<strong>select * from db1.travelrecord;</strong> 那么 MyCat 并不会删除 db1 这个字段，如果没有定义该库的话则会报错，所以在提供 SQL语句的最好是不带这个字段。</p>
<h6 id="52523-sqlmaxlimit"><a class="markdownIt-Anchor" href="#52523-sqlmaxlimit"></a> 5.2.5.2.3 sqlMaxLimit</h6>
<p>当该值设置为某个数值时。每条执行的 SQL 语句，如果没有加上 limit 语句，MyCat 也会自动的加上所对应的值。例如设置值为 100，执行**select * from TESTDB.travelrecord;<strong>的效果为和执行</strong>select * from TESTDB.travelrecord limit 100;**相同。</p>
<p>设置该值的话，MyCat 默认会把查询到的信息全部都展示出来，造成过多的输出。所以，在正常使用中，还是建议加上一个值，用于减少过多的数据返回。</p>
<p>当然 SQL 语句中也显式的指定 limit 的大小，不受该属性的约束。</p>
<p>需要注意的是，如果运行的 schema 为非拆分库的，那么该属性不会生效。需要手动添加 limit 语句。</p>
<h3 id="52-分配规则"><a class="markdownIt-Anchor" href="#52-分配规则"></a> 5.2 分配规则</h3>
<p><img src="/mycat/image-20201104222632963.png" alt="image-20201104222632963"><br>
<img src="/mycat/image-20201104221336437.png" alt="image-20201104221336437"></p>
<ul>
<li>
<p>范围分片：根据某个字设置auto-sharding-long，如果这个primaryKey超出了范围会报错</p>
</li>
<li>
<p>取模分片：</p>
</li>
<li>
<p>ER分片（将父子表有关联的数据放在一个data-node里面）</p>
<p><img src="/mycat/image-20201104221659540.png" alt="image-20201104221659540"></p>
</li>
<li>
<p>全局表：所有dataNode存储相同的数据，查询的时候是随机查询某个表 type=global，查询的时候随机从某个datanode获取</p>
</li>
<li>
<p>非分片表：只在某个dataNode上存储,指定一个dataNode并且不写分片规则</p>
</li>
<li>
<p>单库分表：有个bug在实际数据库中必须要创建mycat中一摸一样的数据表，而且truncat的时候要现在dataNode先删除，才能删除的掉mycat的数据</p>
</li>
</ul>
<h3 id="53-全局id"><a class="markdownIt-Anchor" href="#53-全局id"></a> 5.3 全局ID</h3>
<p><img src="/mycat/image-20201104223246735.png" alt="image-20201104223246735"></p>
<ul>
<li>文件方式—0</li>
<li>数据库方式—1</li>
<li>本地时间戳----2</li>
<li>ZK方式----3</li>
</ul>
<h2 id="6-mycat分片策略详解"><a class="markdownIt-Anchor" href="#6-mycat分片策略详解"></a> 6. Mycat分片策略详解</h2>
<p>连续分片与离散分片</p>
<p><img src="/mycat/image-20201107201442912.png" alt="image-20201107201442912"></p>
<p><strong>连续分片</strong>：</p>
<ul>
<li>范围分片</li>
<li>日期/事件</li>
</ul>
<p>缺点：</p>
<ul>
<li>存在数据热点的可能性</li>
<li>并发访问能力受限于单一或少量DataNode（访问集中），并不能分摊数据库访问的压力</li>
</ul>
<p><strong>离散</strong>：</p>
<ul>
<li>
<p>取模（partioncount 的总数必须和分片总数相同）</p>
</li>
<li>
<p>枚举</p>
</li>
<li>
<p>一致性哈希(qs-murmur)</p>
</li>
<li>
<p>固定分片哈希</p>
<ul>
<li>
<p>partitionCount: 2, 1表示有三个分片必须和节点数量一致，否则会报错，前面两个一样长</p>
</li>
<li>
<p>partitionLength: 256, 512表示长度为256和512</p>
</li>
<li>
<p>综合在一起就是前面2个分片长度为256， 最后一个为512，结果如下图所示（注意partitionCount和partitionLength的数量一定要一致）</p>
</li>
<li>
<p><img src="/mycat/image-20201219103201836.png" alt="image-20201219103201836"></p>
<p><img src="/mycat/image-20201219102742172.png" alt="image-20201219102742172"></p>
</li>
</ul>
</li>
<li>
<p>取模范围(sharting-by-pattern)：先取模PartitionByPattern后分片</p>
</li>
<li>
<p>范围取模: PartitionByRangeMod(partition-rane-mod.txt)</p>
<ul>
<li>
<pre class="highlight"><code class="txt">0-2000=1		#范围在2000以内的在第一个节点（取模的结果还是本身）
2001-4000=2		#范围在2001到4000以内的再模2，结果为0在第一个节点，结果为1在第三个节点
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">-   其他</span><br><span class="line"></span><br><span class="line">优点：</span><br><span class="line"></span><br><span class="line">-   并发访问能力增强（负载到不同的节点）</span><br><span class="line">-   范围条件查询性能提升（并行计算）</span><br><span class="line"></span><br><span class="line">缺点：</span><br><span class="line"></span><br><span class="line">-   数据扩容比较困难，设计到数据迁移问题</span><br><span class="line">-   数据库连接消耗比较多</span><br><span class="line"></span><br><span class="line">分片策略的选择：</span><br><span class="line"></span><br><span class="line">1） 确定分片表</span><br><span class="line"></span><br><span class="line">2） 找出分片键</span><br><span class="line"></span><br><span class="line">3） 考虑容量、增速、业务用户</span><br><span class="line"></span><br><span class="line">如果在查询语句中没有携带分片建，那么mycat会将sql发布到所有的节点上</span><br><span class="line"></span><br><span class="line">## 7. Mycat扩缩容</span><br><span class="line"></span><br><span class="line">### 7.1 在线不停机扩缩容（双写）</span><br><span class="line"></span><br><span class="line">![image-20201107205855474](./mycat/image-20201107205855474.png)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 7.2 离线扩缩容</span><br><span class="line"></span><br><span class="line">#### 7.2.1Mysql Dump</span><br><span class="line"></span><br><span class="line">```shell</span><br><span class="line">mysqldump -uroot -p123456 -h127.0.0.1 -p3306 -c -t --skip-extended-insert 数据库名称 &gt; mysql.11.11.sql</span><br></pre></td></tr></table></figure>

</code></pre>
</li>
</ul>
</li>
</ul>
<h4 id="722-mycat自带工具"><a class="markdownIt-Anchor" href="#722-mycat自带工具"></a> 7.2.2 Mycat自带工具</h4>
<ol>
<li>mycat所在环境安装mysql客户端程序</li>
<li>mycat的lib目录下添加mysql的jdbc驱动包（mysql-connector-java-5.7.1.jar）</li>
<li>对扩容缩容的表所有节点数据进行备份</li>
<li>复制schema.xml、rule.xml并重命名为newSchema.xml、newRule.xml</li>
<li>修改newSchema.xml和newRule.xml配置文件为扩容缩容后的参数</li>
<li>在conf/migrateTable.properties配置文件中配置分片库和分片表如：imall=table_test1</li>
<li>dataMigrate.sh配置mysqldump路径</li>
<li>停止mycat服务</li>
<li>执行bin/dataMigrate.sh脚本（不能用openjdk）</li>
<li>替换schema.xml、rule.xml</li>
</ol>
<p><strong>注意事项：</strong></p>
<ul>
<li>保证分片表迁移数据前后路由规则一致（取模–&gt;取模）</li>
<li>保证分片表歉意数据前后分片字段一致</li>
<li>全局表将被忽略</li>
<li>不要将非分片表配置到migrateTables.properties文件中</li>
<li>暂时只支持分片表使用Mysql作为数据源的扩容缩容</li>
</ul>
<h2 id="8-mycat读写分离"><a class="markdownIt-Anchor" href="#8-mycat读写分离"></a> 8. Mycat读写分离</h2>
<h3 id="81-主从复制"><a class="markdownIt-Anchor" href="#81-主从复制"></a> 8.1 主从复制</h3>
<ol>
<li>数据备份回复</li>
<li>负载均衡（读写分离）</li>
<li>高可用HA</li>
</ol>
<h3 id="82-主从复制形式"><a class="markdownIt-Anchor" href="#82-主从复制形式"></a> 8.2 主从复制形式;</h3>
<p><img src="/mycat/image-20201107212552852.png" alt="image-20201107212552852"></p>
<h4 id="binlogbinary-log-二进制日志"><a class="markdownIt-Anchor" href="#binlogbinary-log-二进制日志"></a> binlog(Binary log 二进制日志)</h4>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">--查看binglog: SHOW binlog events in &#x27;mysql-bin.000001&#x27;</span></span><br><span class="line"><span class="comment">--show variables like &#x27;max_blog_max&#x27;</span></span><br></pre></td></tr></table></figure>
<h4 id="binlog配置"><a class="markdownIt-Anchor" href="#binlog配置"></a> binlog配置</h4>
<ul>
<li>STATEMENT: 记录每一天修改数据的sql语句（减少日志量，节约IO）</li>
<li>ROW: 记录哪条数据被修改了，修改成什么样子了（5.7以后默认）</li>
<li>MIXED: 结合两种方式，一般语句用STATEMENT,函数之类的使用ROW</li>
</ul>
<p><strong>binlog</strong>格式（mysql-bin.00001等）</p>
<p><strong>查看binlog</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> binlog events <span class="keyword">in</span> <span class="string">&#x27;mysql-bin.00001&#x27;</span>;</span><br></pre></td></tr></table></figure>
<h3 id="主从复制原理"><a class="markdownIt-Anchor" href="#主从复制原理"></a> 主从复制原理</h3>
<p>SQL Thread是单线程的， 这也是所有的主从复制延迟的原因，那么relay log接受master节点的sql语句主要是用于缓冲</p>
<p><img src="/mycat/image-20201107213638624.png" alt="image-20201107213638624"></p>
<h3 id="mycat读写分离配置"><a class="markdownIt-Anchor" href="#mycat读写分离配置"></a> mycat读写分离配置</h3>
<p><img src="/mycat/image-20201107213859155.png" alt="image-20201107213859155"></p>
<h3 id="85-mycat注解hint"><a class="markdownIt-Anchor" href="#85-mycat注解hint"></a> 8.5 Mycat注解（hint）</h3>
<p>注解用法：</p>
<figure class="highlight tex"><table><tr><td class="code"><pre><span class="line">/*!mycat:sql=注解sql语句*/真正执行的SQL</span><br><span class="line"></span><br><span class="line">比如说在mycat上创建表无法创建成功，可以使用注解</span><br><span class="line">/*!mycat:sql=select * from table<span class="built_in">_</span>1 where id = 1*/create table test2(id int);</span><br><span class="line">主要注解sql可以确认mycat可以路由到子结点上，就可以执行后面的真正执行的sql语句</span><br></pre></td></tr></table></figure>
<p>注解用途：</p>
<ul>
<li>跨库关联查询</li>
<li>DDL或存储过程</li>
<li>自定义分片</li>
<li>读写分离</li>
</ul>
<h3 id="分布式事务"><a class="markdownIt-Anchor" href="#分布式事务"></a> 分布式事务</h3>
<p>基于XA协议的两阶段提交</p>
<p><img src="/mycat/image-20201107215437139.png" alt="image-20201107215437139"></p>
<h4 id="xa角色"><a class="markdownIt-Anchor" href="#xa角色"></a> XA角色</h4>
<p><img src="/mycat/image-20201107215605251.png" alt="image-20201107215605251"></p>
<h4 id="xa实现"><a class="markdownIt-Anchor" href="#xa实现"></a> XA实现</h4>
<p><img src="/mycat/image-20201107220049532.png" alt="image-20201107220049532"></p>
<h2 id="9-mycat核心流程"><a class="markdownIt-Anchor" href="#9-mycat核心流程"></a> 9. Mycat核心流程</h2>
<h3 id="91-架构图"><a class="markdownIt-Anchor" href="#91-架构图"></a> 9.1 架构图</h3>
<p><img src="/mycat/image-20201220170713526.png" alt="image-20201220170713526"></p>
<h3 id="92-启动流程"><a class="markdownIt-Anchor" href="#92-启动流程"></a> 9.2 启动流程</h3>
<ol>
<li>MycatServer启动，解析配置文件，包括服务器、分片规则等</li>
<li>创建工作线程，建立前端连接和后端连接</li>
</ol>
<h3 id="93-执行sql流程"><a class="markdownIt-Anchor" href="#93-执行sql流程"></a> 9.3 执行SQL流程</h3>
<ol>
<li>前端连接接收mysql命令</li>
<li>解析MySQL，mycat用的是Druid的DruidParser</li>
<li>获取路由</li>
<li>改写MySQL，例如两个条件在两个节点上，则变成两条单独的sql</li>
<li>与后端数据库建立连接</li>
<li>发送sql语句到MySQL执行</li>
<li>获取返回结果</li>
<li>处理返回结果，例如排序、计算等等</li>
<li>返回给客户端</li>
</ol>
<h2 id="mycat高可用"><a class="markdownIt-Anchor" href="#mycat高可用"></a> Mycat高可用</h2>
<p><img src="/mycat/image-20201220172406074.png" alt="image-20201220172406074"></p>
]]></content>
      <categories>
        <category>中间件</category>
      </categories>
      <tags>
        <tag>mycat</tag>
      </tags>
  </entry>
  <entry>
    <title>Java线程的生命周期状态</title>
    <url>/thread-status/</url>
    <content><![CDATA[<h2 id="1-java线程分类"><a class="markdownIt-Anchor" href="#1-java线程分类"></a> 1. Java线程分类</h2>
<p>在Java中线程分别对应不同的状态，从创建线程的 NEW 到销毁时的 TERMINATED状态， 我们从Thread类中的内部枚举类State中可以看到线程的6种状态；</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">State</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Thread state for a thread which has not yet started.</span></span><br><span class="line"><span class="comment">     * 尚未启动的线程的线程状态</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    NEW,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Thread state for a runnable thread.  A thread in the runnable state is executing in the Java virtual machine but it may</span></span><br><span class="line"><span class="comment">     * be waiting for other resources from the operating system such as processor.</span></span><br><span class="line"><span class="comment">     * 可运行线程的线程状态。处于可运行状态的线程正在Java虚拟机中执行，但它可能正在等待来自操作系统的其他资源，例如处理器。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    RUNNABLE,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Thread state for a thread blocked waiting for a monitor lock. A thread in the blocked state is waiting for a monitor lock to enter a synchronized block/method or reenter a synchronized block/method after calling Object.wait() .</span></span><br><span class="line"><span class="comment">     * 等待监视器锁定的被阻止线程的线程状态。处于阻塞状态的线程正在等待监视器锁进入同步块/方法，或在调用对象后重新进入同步块/方法。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    BLOCKED,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Thread state for a waiting thread. A thread is in the waiting state due to calling one of the following methods:</span></span><br><span class="line"><span class="comment">     * 1.Object.wait() with no timeout </span></span><br><span class="line"><span class="comment">     * 2.Thread.join() with no timeout </span></span><br><span class="line"><span class="comment">     * 3.LockSupport.park()</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * A thread in the waiting state is waiting for another thread to perform a particular action.</span></span><br><span class="line"><span class="comment">     * For example, a thread that has called Object.wait() on an object is waiting for another thread to call</span></span><br><span class="line"><span class="comment">     * Object.notify or Object.notifyAll() on that object. A thread that has called Thread.join()</span></span><br><span class="line"><span class="comment">     * is waiting for a specified thread to terminate.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    WAITING,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Thread state for a waiting thread with a specified waiting time. A thread is in the timed waiting state due to calling one of</span></span><br><span class="line"><span class="comment">     * the following methods with a specified positive waiting time:</span></span><br><span class="line"><span class="comment">     * 1.Thread.sleep()</span></span><br><span class="line"><span class="comment">     * 2.Object.wait() with timeout</span></span><br><span class="line"><span class="comment">     * 3.Thread.join() with timeout</span></span><br><span class="line"><span class="comment">     * 4.LockSupport.parkNanos()</span></span><br><span class="line"><span class="comment">     * 5.LockSupport.parkUntil()</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    TIMED_WAITING,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Thread state for a terminated thread. The thread has completed execution.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    TERMINATED;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="11-状态1-new"><a class="markdownIt-Anchor" href="#11-状态1-new"></a> 1.1 状态1： NEW</h3>
<p>当线程被创建出来还没有被调用 start()时候的状态</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">官方描述：Thread state for a thread which has not yet started.</span><br></pre></td></tr></table></figure>
<p>示例代码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadStateTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Thread thread = <span class="keyword">new</span> Thread(<span class="string">&quot;thread1&quot;</span>);</span><br><span class="line">        System.out.println(thread.getState());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//输出： NEW</span></span><br></pre></td></tr></table></figure>
<h3 id="12-状态2-runnable"><a class="markdownIt-Anchor" href="#12-状态2-runnable"></a> 1.2 状态2： RUNNABLE</h3>
<p>当线程被调用start()，且处于等待操作系统分配资源（如CPU）、等待IO连接、正在运行状态，即表示Running状态和Ready状态。<br>
注：调用了start()不一定会立即改变状态，还有一些准备工作，这个时候线程状态是不确定的。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">官方描述：</span><br><span class="line">Thread state for a runnable thread.  A thread in the runnable state is executing in the Java virtual machine but it may</span><br><span class="line">be waiting for other resources from the operating system such as processor.</span><br></pre></td></tr></table></figure>
<p>示例代码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadStateTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Thread thread = <span class="keyword">new</span> Thread(<span class="string">&quot;thread1&quot;</span>);</span><br><span class="line">        thread.start();</span><br><span class="line">        System.out.println(thread.getState());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//输出： RUNNABLE</span></span><br></pre></td></tr></table></figure>
<h3 id="13-状态3-blocked"><a class="markdownIt-Anchor" href="#13-状态3-blocked"></a> 1.3 状态3： BLOCKED</h3>
<p>等待监视器锁而被阻塞的线程的状态。当进入synchronized块/方法 或者在调用wait()被唤醒/超时之后重新进入synchronized块/方法，但是锁被其他线程占有，这个时候被操作系统挂起，状态为<strong>阻塞状态 BLOCKED</strong>。</p>
<p><strong>阻塞状态的线程，即使调用interrupt()方法也不会改变其状态</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">官方描述：</span><br><span class="line">Thread state for a thread blocked waiting for a monitor lock. </span><br><span class="line">A thread in the blocked state is waiting for a monitor lock to enter a synchronized block/method or reenter a synchronized block/method after calling Object.wait() .</span><br><span class="line">译文：等待监视器锁定的被阻止线程的线程状态。处于阻塞状态的线程正在等待监视器锁进入同步块/方法，或在调用对象后重新进入同步块/方法。</span><br></pre></td></tr></table></figure>
<p>阻塞(BLOCKED)：阻塞状态是指线程因为某种原因放弃了cpu 使用权，也即让出了cpu timeslice，暂时停止运行。直到线程进入可运行(runnable)状态，才有机会再次获得cpu timeslice 转到运行(running)状态。阻塞的情况分三种：</p>
<ul>
<li>等待阻塞：运行(running)的线程执行o.wait()方法，JVM会把该线程放入等待队列(waitting queue)中。</li>
<li>同步阻塞：运行(running)的线程在获取对象的同步锁时，若该同步锁被别的线程占用，则JVM会把该线程放入锁池(lock pool)中。</li>
<li>其他阻塞：运行(running)的线程执行Thread.sleep(long ms)或t.join()方法，或者发出了I/O请求时，JVM会把该线程置为阻塞状态。当sleep()状态超时、join()等待线程终止或者超时、或者I/O处理完毕时，线程重新转入可运行(runnable)状态。</li>
</ul>
<p>示例代码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BlockedState</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> String lock = <span class="string">&quot;锁&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        Thread thread1 = <span class="keyword">new</span> Thread(<span class="string">&quot;thread1&quot;</span>) &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">                    <span class="comment">//死循环导致thread1一直持有lock对象锁</span></span><br><span class="line">                    <span class="keyword">while</span> (<span class="keyword">true</span>) ;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        thread1.start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//休眠1秒，让thread1先启动</span></span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        Thread thread2 = <span class="keyword">new</span> Thread(<span class="string">&quot;thread2&quot;</span>) &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">synchronized</span> (lock) &#123; <span class="comment">//@1</span></span><br><span class="line">                    System.out.println(<span class="string">&quot;thread2&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        thread2.start();</span><br><span class="line">        System.out.println(<span class="string">&quot;thread1.state:&quot;</span> + thread1.getState());</span><br><span class="line">        System.out.println(<span class="string">&quot;thread2.state:&quot;</span> + thread2.getState());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//while (true) 死循环导致thread1持有lock对象锁一直没有释放，而thread2也想获取lock对象锁，但是锁一直被thread1持有着，导致thread2被阻塞在@1处，</span></span><br><span class="line">        <span class="comment">//此时thread2就处于BLOCKED状态</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//输出： thread1.state:RUNNABLE</span></span><br><span class="line"><span class="comment">//      thread2.state:BLOCKED</span></span><br></pre></td></tr></table></figure>
<p>查看2个线程的堆栈信息，包括：线程状态、线程目前执行到哪段代码等</p>
<ol>
<li>
<p>jps命令查看需要打印线程栈的进程号</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">jps</span><br></pre></td></tr></table></figure>
<p><img src="/thread-status/02.png" alt></p>
</li>
<li>
<p>jstack命令生成java虚拟机当前时刻的线程快照</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">jstack 46622  #找到BlockedState线程的</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">&quot;thread2&quot; #13 prio=5 os_prio=31 tid=0x00007f81c387e800 nid=0xa703 waiting for monitor entry [0x000070000bbbd000]</span><br><span class="line">   java.lang.Thread.State: BLOCKED (on object monitor)</span><br><span class="line">      at org.example.thread.BlockedState$2.run(BlockedState.java:26)</span><br><span class="line">         - waiting to lock &lt;0x0000000715916c40&gt; (a java.lang.String)</span><br><span class="line"></span><br><span class="line">&quot;thread1&quot; #11 prio=5 os_prio=31 tid=0x00007f81b3d9b800 nid=0x5503 runnable [0x000070000b9b7000]</span><br><span class="line">   java.lang.Thread.State: RUNNABLE</span><br><span class="line">      at org.example.thread.BlockedState$1.run(BlockedState.java:14)</span><br><span class="line">          - locked &lt;0x0000000715916c40&gt; (a java.lang.String)</span><br></pre></td></tr></table></figure>
<p>输出内容释义：</p>
<ul>
<li>thread1：线程名称</li>
<li>#11：当前线程ID，从 main线程开始，JVM 根据线程创建的顺序为线程编号</li>
<li>prio：是 priority 优先级的缩写，表明了当前线程的优先级，取值范围【1～10】，默认为 5，在虚拟机进行线程调度的时候会参考该优先级为线程分配计算资源，数值越小优先级越高，一般不设置直接使用默认的优先级。</li>
<li>os_prio：线程对应系统的优先级</li>
<li>nid： 本地线程编号， NativeID的缩写，对应JVM虚拟机中线程映射在操作系统中的线程编号，可以通过 top 命令查看进程对应的线程情况进行相关映射</li>
</ul>
</li>
</ol>
<h3 id="14-状态4-waiting"><a class="markdownIt-Anchor" href="#14-状态4-waiting"></a> 1.4 状态4： WAITING</h3>
<p>无条件等待，当线程调用wait()/join()/LockSupport.park()不加超时时间的方法之后所处的状态，如果没有被唤醒或等待的线程没有结束，那么将一直等待，当前状态的线程不会被分配CPU资源和持有锁。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">官方描述：</span><br><span class="line"></span><br><span class="line">Thread state for a waiting thread. A thread is in the waiting state due to calling one of the following methods:</span><br><span class="line">1.Object.wait with no timeout </span><br><span class="line">2.Thread.join with no timeout </span><br><span class="line">3.LockSupport.park</span><br><span class="line"></span><br><span class="line">A thread in the waiting state is waiting for another thread to perform a particular action.</span><br><span class="line">For example, a thread that has called Object.wait() on an object is waiting for another thread to call</span><br><span class="line">Object.notify or Object.notifyAll() on that object. A thread that has called Thread.join()</span><br><span class="line">is waiting for a specified thread to terminate.</span><br></pre></td></tr></table></figure>
<h4 id="方式一objectwait"><a class="markdownIt-Anchor" href="#方式一objectwait"></a> 方式一：Object.wait()</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WaitingState</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        Thread thread1 = <span class="keyword">new</span> Thread(<span class="string">&quot;thread1&quot;</span>)&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">synchronized</span> (WaitingState.class)&#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        WaitingState.class.wait();</span><br><span class="line">                    &#125;<span class="keyword">catch</span> (InterruptedException e)&#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        thread1.start();</span><br><span class="line">        <span class="comment">//模拟休眠1秒，让thread1运行到wait方法处</span></span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;thread.state:&quot;</span>+thread1.getState());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//输出： thread1.state:WAITING</span></span><br></pre></td></tr></table></figure>
<p>打印线程thread1堆栈信息</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">&quot;thread1&quot; #11 prio=5 os_prio=31 tid=0x00007fc57b877800 nid=0x5503 in Object.wait() [0x0000700011529000]</span><br><span class="line">   java.lang.Thread.State: WAITING (on object monitor)</span><br><span class="line">	  at java.lang.Object.wait(Native Method)</span><br><span class="line">	    - waiting on &lt;0x0000000715916c40&gt; (a java.lang.Class for org.example.thread.WaitingState)</span><br><span class="line">	  at java.lang.Object.wait(Object.java:502)</span><br><span class="line">	  at org.example.thread.WaitingState$1.run(WaitingState.java:12)</span><br><span class="line">	    - locked &lt;0x0000000715916c40&gt; (a java.lang.Class for org.example.thread.WaitingState)</span><br></pre></td></tr></table></figure>
<h4 id="方式二threadjoin"><a class="markdownIt-Anchor" href="#方式二threadjoin"></a> 方式二：Thread.join()</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WaitingState</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        Thread thread1 = <span class="keyword">new</span> Thread(<span class="string">&quot;thread1&quot;</span>)&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">               <span class="keyword">while</span> (<span class="keyword">true</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        thread1.start();</span><br><span class="line">        <span class="comment">//join方法会让当前主线程等待thread1结束</span></span><br><span class="line">        thread1.join();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的代码导致主线程处于WAITING状态，下面是主线程堆栈信息，第二行显示主线程处于WAITING状态，第五行表示因为调用了Thread.join导致线程WAITING</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">&quot;main&quot; #1 prio=5 os_prio=31 tid=0x00007fea7b01b800 nid=0xe03 in Object.wait() [0x0000700008b43000]</span><br><span class="line">   java.lang.Thread.State: WAITING (on object monitor)</span><br><span class="line">	at java.lang.Object.wait(Native Method)</span><br><span class="line">	  - waiting on &lt;0x000000071591c4c8&gt; (a org.example.thread.WaitingState$1)</span><br><span class="line">	at java.lang.Thread.join(Thread.java:1252)</span><br><span class="line">	  - locked &lt;0x000000071591c4c8&gt; (a org.example.thread.WaitingState$1)</span><br><span class="line">	at java.lang.Thread.join(Thread.java:1326)</span><br><span class="line">	at org.example.thread.WaitingState.main(WaitingState.java:17)</span><br></pre></td></tr></table></figure>
<h4 id="方式三locksupportpark"><a class="markdownIt-Anchor" href="#方式三locksupportpark"></a> 方式三：LockSupport.park()</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WaitingState</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        Thread thread1 = <span class="keyword">new</span> Thread(<span class="string">&quot;thread1&quot;</span>)&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                LockSupport.park();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        thread1.start();</span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;thread.state:&quot;</span>+thread1.getState());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//输出： thread.state:WAITING</span></span><br></pre></td></tr></table></figure>
<p>打印线程thread1的堆栈信息如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">&quot;thread1&quot; #11 prio=5 os_prio=31 tid=0x00007f7baf82d000 nid=0x5503 waiting on condition [0x000070000b2b9000]</span><br><span class="line">   java.lang.Thread.State: WAITING (parking)</span><br><span class="line">	at sun.misc.Unsafe.park(Native Method)</span><br><span class="line">	at java.util.concurrent.locks.LockSupport.park(LockSupport.java:304)</span><br><span class="line">	at org.example.thread.WaitingState$1.run(WaitingState.java:11)</span><br></pre></td></tr></table></figure>
<h3 id="15-状态5-timed_waiting"><a class="markdownIt-Anchor" href="#15-状态5-timed_waiting"></a> 1.5 状态5： TIMED_WAITING</h3>
<p>有条件的等待，区别于上面的WAITING(无条件等待)，当线程调用以下方法之后所处的状态，在指定的时间没有被唤醒或者等待线程没有结束，会被系统自动唤醒，正常退出。</p>
<ul>
<li>sleep(睡眠时间)</li>
<li>wait(等待时间)</li>
<li>join(等待时间)</li>
<li>LockSupport.parkNanos(等待时间)</li>
<li>LockSupport.parkUntil(等待时间)</li>
</ul>
<p>TIMED_WAITING： 有期限的等待</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">官方描述：</span><br><span class="line">Thread state for a waiting thread with a specified waiting time. </span><br><span class="line">A thread is in the timed waiting state due to calling one of the following methods with a specified positive waiting time:</span><br><span class="line">1.Thread.sleep</span><br><span class="line">2.Object.wait with timeout</span><br><span class="line">3.Thread.join with timeout</span><br><span class="line">4.LockSupport.parkNanos</span><br><span class="line">5.LockSupport.parkUntil</span><br></pre></td></tr></table></figure>
<h4 id="方式一threadsleepseconds"><a class="markdownIt-Anchor" href="#方式一threadsleepseconds"></a> 方式一：Thread.sleep(seconds)</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TimeWaitingState</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        Thread thread1 = <span class="keyword">new</span> Thread(<span class="string">&quot;thread1&quot;</span>) &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">//休眠500秒 = 500000毫秒</span></span><br><span class="line">                    Thread.sleep(<span class="number">500</span> * <span class="number">1000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        thread1.start();</span><br><span class="line">        <span class="comment">//模拟休眠1秒，让thread1运行到sleep方法处</span></span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;thread1.state:&quot;</span> + thread1.getState());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//输出： thread1.state:TIMED_WAITING</span></span><br></pre></td></tr></table></figure>
<p>打印线程thread1的堆栈信息，可以看出是线程sleep方法(第三行)导致线程等待</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">&quot;thread1&quot; #11 prio=5 os_prio=31 tid=0x00007fddf71ae800 nid=0x5503 waiting on condition [0x000070000b11c000]</span><br><span class="line">   java.lang.Thread.State: TIMED_WAITING (sleeping)</span><br><span class="line">	at java.lang.Thread.sleep(Native Method)</span><br><span class="line">	at org.example.thread.TimeWaitingState$1.run(TimeWaitingState.java:12)</span><br></pre></td></tr></table></figure>
<h4 id="方式二objectwaitseconds"><a class="markdownIt-Anchor" href="#方式二objectwaitseconds"></a> 方式二：Object.wait(seconds)</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TimeWaitingState</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        Thread thread1 = <span class="keyword">new</span> Thread(<span class="string">&quot;thread1&quot;</span>) &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">synchronized</span> (TimeWaitingState.class) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        TimeWaitingState.class.wait(<span class="number">500</span> * <span class="number">100</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        thread1.start();</span><br><span class="line">        <span class="comment">//模拟休眠1秒，让thread1运行到sleep方法处</span></span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;thread1.state:&quot;</span> + thread1.getState());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//输出； thread1.state:TIMED_WAITING</span></span><br></pre></td></tr></table></figure>
<p>打印线程 thread1 堆栈信息，从堆栈信息第三行中可以看出是线程 wait 方法导致线程等待的</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">&quot;thread1&quot; #11 prio=5 os_prio=31 tid=0x00007f80a0129800 nid=0x5503 in Object.wait() [0x000070000856b000]</span><br><span class="line">   java.lang.Thread.State: TIMED_WAITING (on object monitor)</span><br><span class="line">	at java.lang.Object.wait(Native Method)</span><br><span class="line">	- waiting on &lt;0x0000000715916d28&gt; (a java.lang.Class for org.example.thread.TimeWaitingState)</span><br><span class="line">	at org.example.thread.TimeWaitingState$1.run(TimeWaitingState.java:12)</span><br><span class="line">	- locked &lt;0x0000000715916d28&gt; (a java.lang.Class for org.example.thread.TimeWaitingState)</span><br></pre></td></tr></table></figure>
<h4 id="方式三threadjoinseconds"><a class="markdownIt-Anchor" href="#方式三threadjoinseconds"></a> 方式三：Thread.join(seconds)</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TimeWaitingState</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        Thread thread1 = <span class="keyword">new</span> Thread(<span class="string">&quot;thread1&quot;</span>) &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">while</span>(<span class="keyword">true</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        thread1.start();</span><br><span class="line">        <span class="comment">//Thread.join 会让当前主线程等待thread1结束，需要等待500s</span></span><br><span class="line">        thread1.join(<span class="number">500</span> * <span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Thread.join 会让当前主线程等待thread1结束，所以我们查看主线程堆栈信息:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">&quot;main&quot; #1 prio=5 os_prio=31 tid=0x00007fa6d7009000 nid=0xd03 in Object.wait() [0x000070000feb9000]</span><br><span class="line">   java.lang.Thread.State: TIMED_WAITING (on object monitor)</span><br><span class="line">	at java.lang.Object.wait(Native Method)</span><br><span class="line">	- waiting on &lt;0x000000071591c138&gt; (a org.example.thread.TimeWaitingState$1)</span><br><span class="line">	at java.lang.Thread.join(Thread.java:1260)</span><br><span class="line">	- locked &lt;0x000000071591c138&gt; (a org.example.thread.TimeWaitingState$1)</span><br><span class="line">	at org.example.thread.TimeWaitingState.main(TimeWaitingState.java:14)</span><br></pre></td></tr></table></figure>
<h4 id="方式四locksupportparknanosseconds"><a class="markdownIt-Anchor" href="#方式四locksupportparknanosseconds"></a> 方式四：LockSupport.parkNanos(seconds)</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TimeWaitingState</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        Thread thread1 = <span class="keyword">new</span> Thread(<span class="string">&quot;thread1&quot;</span>) &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="comment">//等待500秒</span></span><br><span class="line">                LockSupport.parkNanos(TimeUnit.SECONDS.toNanos(<span class="number">500</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        thread1.start();</span><br><span class="line">        <span class="comment">//模拟休眠1秒，让thread1运行到parkNanos方法处</span></span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;thread1.state:&quot;</span> + thread1.getState());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//输出： thread1.state:TIMED_WAITING</span></span><br></pre></td></tr></table></figure>
<p>线程 thread1 堆栈信息</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">&quot;thread1&quot; #11 prio=5 os_prio=31 tid=0x00007fb71b07a000 nid=0x5503 waiting on condition [0x0000700001da8000]</span><br><span class="line">   java.lang.Thread.State: TIMED_WAITING (parking)</span><br><span class="line">	at sun.misc.Unsafe.park(Native Method)</span><br><span class="line">	at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:338)</span><br><span class="line">	at org.example.thread.TimeWaitingState$1.run(TimeWaitingState.java:12)</span><br></pre></td></tr></table></figure>
<h4 id="方式五locksupportparkuntilseconds"><a class="markdownIt-Anchor" href="#方式五locksupportparkuntilseconds"></a> 方式五：LockSupport.parkUntil(seconds)</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TimeWaitingState</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        Thread thread1 = <span class="keyword">new</span> Thread(<span class="string">&quot;thread1&quot;</span>) &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="comment">//等待500秒</span></span><br><span class="line">                LockSupport.parkUntil(System.currentTimeMillis() + TimeUnit.SECONDS.toMillis(<span class="number">500</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        thread1.start();</span><br><span class="line">        <span class="comment">//模拟休眠1秒，让thread1运行到parkNanos方法处</span></span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;thread1.state:&quot;</span> + thread1.getState());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//输出： thread1.state:TIMED_WAITING</span></span><br></pre></td></tr></table></figure>
<p>线程 thread1 堆栈信息</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">&quot;thread1&quot; #11 prio=5 os_prio=31 tid=0x00007ff41d076000 nid=0x5503 waiting on condition [0x00007000094df000]</span><br><span class="line">   java.lang.Thread.State: TIMED_WAITING (parking)</span><br><span class="line">	at sun.misc.Unsafe.park(Native Method)</span><br><span class="line">	at java.util.concurrent.locks.LockSupport.parkUntil(LockSupport.java:372)</span><br><span class="line">	at org.example.thread.TimeWaitingState$1.run(TimeWaitingState.java:12)</span><br></pre></td></tr></table></figure>
<h3 id="16-状态6-terminated"><a class="markdownIt-Anchor" href="#16-状态6-terminated"></a> 1.6 状态6： TERMINATED</h3>
<p>执行完了 run()方法。其实这只是 Java 语言级别的一种状态，在操作系统内部可能已经注销了相应的线程，或者将它复用给其他需要使用线程的请求，而在 Java 语言级别只是通过 Java 代码看到的线程状态而已</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">官方描述：</span><br><span class="line">Thread state for a terminated thread. The thread has completed execution.</span><br></pre></td></tr></table></figure>
<p>示例代码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TerminatedState</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        Thread thread1 = <span class="keyword">new</span> Thread(<span class="string">&quot;thread1&quot;</span>) &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                System.out.println(Thread.currentThread());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        thread1.start();</span><br><span class="line">        <span class="comment">//休眠1秒，等待thread1执行完毕</span></span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;thread1 state:&quot;</span> + thread1.getState());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//输出：Thread[thread1,5,main]</span></span><br><span class="line"><span class="comment">//     thread1 state:TERMINATED</span></span><br></pre></td></tr></table></figure>
<h2 id="2状态转化"><a class="markdownIt-Anchor" href="#2状态转化"></a> 2.状态转化</h2>
<p><img src="/thread-status/03.png" alt="线程的状态"><br>
<img src="/thread-status/01.jpg" alt="线程的状态"></p>
]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>thread</tag>
      </tags>
  </entry>
  <entry>
    <title>vue学习</title>
    <url>/vue/</url>
    <content><![CDATA[<p>Object.freeze()，这会阻止修改现有的 property，也意味着响应系统无法再追踪变化。</p>
<h3 id="1-export"><a class="markdownIt-Anchor" href="#1-export"></a> 1. export</h3>
<hr>
<p>用于规定模块的对外接口，export输出变量和方法、类</p>
<ul>
<li>
<p>变量</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// profile.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">var</span> firstName = <span class="string">&#x27;Michael&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">var</span> lastName = <span class="string">&#x27;Jackson&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">var</span> year = <span class="number">1958</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//简写--优先使用</span></span><br><span class="line"><span class="keyword">export</span> &#123;firstName, lastName, year&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>方法</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//如果想为输入的变量重新命名， 可以使用AS 关键字重新命名</span></span><br><span class="line"><span class="keyword">import</span> &#123; buildMenus <span class="keyword">as</span> buildMenus&#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/menu&#x27;</span>;</span><br><span class="line"><span class="comment">//import命令接受一对大括号，里面指定要从其他模块导入的变量名。大括号里面的变量名，必须与被导入模块（profile.js）对外接口的名称相同</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="2-export-default"><a class="markdownIt-Anchor" href="#2-export-default"></a> 2. export default</h3>
<p>为模块指定默认输出， 使用import命令的时候，用户需要知道所要加载的变量名和函数名，否则无法加载；了解模块有哪些方法和属性比较麻烦，使用export default命令，为模块指定默认输出</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// export-default.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;foo&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面代码是一个模块文件export-default.js。默认输出1个函数；</p>
<p>与export命令的区别：其他模块加载该模块是，import命令可以为该匿名函数指定任意名字</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// import-default.js</span></span><br><span class="line"><span class="keyword">import</span> customName <span class="keyword">from</span> <span class="string">&#x27;./export-default&#x27;</span>;</span><br><span class="line">customName(); <span class="comment">// &#x27;foo&#x27;</span></span><br></pre></td></tr></table></figure>
<p>上面代码的<code>import</code>命令，可以用任意名称指向<code>export-default.js</code>输出的方法，这时就不需要知道原模块输出的函数名。需要注意的是，这时<code>import</code>命令后面，不使用大括号。</p>
<p>本质上，<code>export default</code>就是输出一个叫做<code>default</code>的变量或方法，然后系统允许你为它取任意名字。所以，下面的写法是有效的。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// modules.js</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x * y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> &#123;add <span class="keyword">as</span> <span class="keyword">default</span>&#125;;</span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line"><span class="comment">// export default add;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="keyword">default</span> <span class="keyword">as</span> foo &#125; <span class="keyword">from</span> <span class="string">&#x27;modules&#x27;</span>;</span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line"><span class="comment">// import foo from &#x27;modules&#x27;;</span></span><br></pre></td></tr></table></figure>
<p>正是因为<code>export default</code>命令其实只是输出一个叫做<code>default</code>的变量，所以它后面不能跟变量声明语句。</p>
<p><strong>总结：</strong></p>
<ul>
<li>
<p>export命令对外接口是有名称的且<code>import</code>命令从模块导入的变量名与被导入模块对外接口的名称相同，而export default命令对外输出的变量名可以是任意的，这时<code>import</code>命令后面，不使用大括号。</p>
</li>
<li>
<p><code>export default</code>命令用于指定模块的默认输出。显然，一个模块只能有一个默认输出，因此<code>export default</code>命令只能使用一次。所以，import命令后面才不用加大括号，因为只可能唯一对应<code>export default</code>命令。</p>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//menu.js</span></span><br><span class="line"><span class="comment">//get请求获取所有的菜单信息</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">buildMenus</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> request(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;api/menus/build&#x27;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//post 请求保存数据</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> request(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;api/menus&#x27;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">    data</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//delete 请求删除数据</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">del</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> request(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;api/menus/&#x27;</span> + id,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;delete&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//put请求修改数据</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">edit</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> request(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;api/menus&#x27;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;put&#x27;</span>,</span><br><span class="line">    data</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//app.vue</span></span><br><span class="line"><span class="keyword">import</span> &#123; buildMenus &#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/menu&#x27;</span>;</span><br></pre></td></tr></table></figure>
<h3 id="3-const-var-let"><a class="markdownIt-Anchor" href="#3-const-var-let"></a> 3. Const、var、let</h3>
<p>ES5 中作用域有：全局作用域、函数作用域。没有块作用域的概念。</p>
<p>ES6 中新增了块级作用域。块作用域由 { } 包括，if语句和 for语句里面的{ }也属于块作用域</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(a); <span class="comment">// 1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(a); <span class="comment">// 1</span></span><br><span class="line"><span class="comment">// 通过var定义的变量可以跨块作用域访问到。</span></span><br><span class="line"></span><br><span class="line">(<span class="function"><span class="keyword">function</span> <span class="title">A</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> b = <span class="number">2</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(b); <span class="comment">// 2</span></span><br><span class="line">&#125;)();</span><br><span class="line"><span class="comment">// console.log(b); // 报错，</span></span><br><span class="line"><span class="comment">// 可见，通过var定义的变量不能跨函数作用域访问到</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> c = <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(c); <span class="comment">// 3</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i ++) &#123;</span><br><span class="line">  <span class="keyword">var</span> d = <span class="number">5</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(i); <span class="comment">// 4   (循环结束i已经是4，所以此处i为4)</span></span><br><span class="line"><span class="built_in">console</span>.log(d); <span class="comment">// 5</span></span><br><span class="line"><span class="comment">// if语句和for语句中用var定义的变量可以在外面访问到，</span></span><br><span class="line"><span class="comment">// 可见，if语句和for语句属于块作用域，不属于函数作用域</span></span><br></pre></td></tr></table></figure>
<p>三者的区别：</p>
<ol>
<li>var定义的变量，没有块的概念，可以跨块访问, 不能跨函数访问。</li>
<li>let定义的变量，只能在块作用域里访问，不能跨块访问，也不能跨函数访问。</li>
<li>const用来定义常量，使用时必须初始化(即必须赋值)，只能在块作用域里访问，而且不能修改。</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 块作用域</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">let</span> b = <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">const</span> c = <span class="number">3</span>;</span><br><span class="line">  <span class="comment">// c = 4; // 报错</span></span><br><span class="line">  <span class="keyword">var</span> aa;</span><br><span class="line">  <span class="keyword">let</span> bb;</span><br><span class="line">  <span class="comment">// const cc; // 报错</span></span><br><span class="line">  <span class="built_in">console</span>.log(a); <span class="comment">// 1</span></span><br><span class="line">  <span class="built_in">console</span>.log(b); <span class="comment">// 2</span></span><br><span class="line">  <span class="built_in">console</span>.log(c); <span class="comment">// 3</span></span><br><span class="line">  <span class="built_in">console</span>.log(aa); <span class="comment">// undefined</span></span><br><span class="line">  <span class="built_in">console</span>.log(bb); <span class="comment">// undefined</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(a); <span class="comment">// 1</span></span><br><span class="line"><span class="comment">// console.log(b); // 报错</span></span><br><span class="line"><span class="comment">// console.log(c); // 报错</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数作用域</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span> <span class="title">A</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> d = <span class="number">5</span>;</span><br><span class="line">  <span class="keyword">let</span> e = <span class="number">6</span>;</span><br><span class="line">  <span class="keyword">const</span> f = <span class="number">7</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(d); <span class="comment">// 5</span></span><br><span class="line">  <span class="built_in">console</span>.log(e); <span class="comment">// 6  </span></span><br><span class="line">  <span class="built_in">console</span>.log(f); <span class="comment">// 7 </span></span><br><span class="line">&#125;)();</span><br><span class="line"><span class="comment">// console.log(d); // 报错</span></span><br><span class="line"><span class="comment">// console.log(e); // 报错</span></span><br><span class="line"><span class="comment">// console.log(f); // 报错</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>注意：<strong>const定义的对象属性是否可以改变</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> person = &#123;</span><br><span class="line">  <span class="attr">name</span> : <span class="string">&#x27;jiuke&#x27;</span>,</span><br><span class="line">  <span class="attr">sex</span> : <span class="string">&#x27;男&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">person.name = <span class="string">&#x27;test&#x27;</span></span><br><span class="line"><span class="built_in">console</span>.log(person.name)<span class="comment">//person对象的name属性确实被修改了</span></span><br></pre></td></tr></table></figure>
<p>因为对象是引用类型的，person中保存的仅是对象的指针，这就意味着，const仅保证指针不发生改变，修改对象的属性不会改变对象的指针，所以是被允许的。也就是说const定义的引用类型只要指针不发生改变，其他的不论如何改变都是允许的。</p>
<p>然后我们试着修改一下指针，让person指向一个新对象，果然报错</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> person = &#123;</span><br><span class="line">   <span class="attr">name</span> : <span class="string">&#x27;jiuke&#x27;</span>,</span><br><span class="line">   <span class="attr">sex</span> : <span class="string">&#x27;男&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">person = &#123;</span><br><span class="line">   <span class="attr">name</span> : <span class="string">&#x27;test&#x27;</span>,</span><br><span class="line">   <span class="attr">sex</span> : <span class="string">&#x27;男&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//报错</span></span><br></pre></td></tr></table></figure>
<h3 id="4-promise"><a class="markdownIt-Anchor" href="#4-promise"></a> 4. promise</h3>
<p>promise用途：异步编程的一种解决方案。</p>
<p>优点：比传统的解决方案——回调函数和事件——更合理和更强大。</p>
<p>三种状态：<code>pending</code>（进行中）、<code>fulfilled</code>（已成功）和<code>rejected</code>（已失败）。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//基本用法：</span></span><br><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    resolve(value);<span class="comment">//表示异步操作成功</span></span><br><span class="line">    reject(error);<span class="comment">//表示异步操作失败</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//promise常用的几个方法</span></span><br><span class="line"><span class="comment">//1. 异步状态为成功时调用第一个函数，为失败时调用第二个函数。then方法的第二个参数可选。</span></span><br><span class="line">promise.then(<span class="function"><span class="params">value</span> =&gt;</span> &#123;&#125;,<span class="function"><span class="params">error</span> =&gt;</span> &#123;&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//2. 异步状态为失败时调用。</span></span><br><span class="line">promise.catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123;&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//3. promise异步状态为失败时或then方法中抛出错误都会执行catch方法。</span></span><br><span class="line">promise.then(<span class="function"><span class="params">value</span> =&gt;</span> &#123;&#125;,<span class="function"><span class="params">error</span> =&gt;</span> &#123;&#125;).catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123;&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//4. 不管状态如何都会执行的操作。</span></span><br><span class="line">promise.finally(<span class="function">() =&gt;</span> &#123;&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="5-生命周期"><a class="markdownIt-Anchor" href="#5-生命周期"></a> 5. 生命周期</h3>
<img src="https://cn.vuejs.org/images/lifecycle.png" alt="img" style="zoom:50%;">
<h3 id="6-模版语法"><a class="markdownIt-Anchor" href="#6-模版语法"></a> 6. 模版语法</h3>
<h4 id="v-once"><a class="markdownIt-Anchor" href="#v-once"></a> v-once</h4>
<p>执行一次性插值，当数据变化的时候，该内容不会更新；可能会影响该节点其他的数据绑定</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">v-once</span>&gt;</span>这个将不会改变: &#123;&#123; msg &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="v-html"><a class="markdownIt-Anchor" href="#v-html"></a> v-html</h4>
<p>双大括号会将数据解释为普通文本，而非 HTML 代码。为了输出真正的 HTML，你需要使用v-html;</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">var rawHtml = &quot;<span class="tag">&lt;<span class="name">span</span>&gt;</span>这是个使用v-htmls<span class="tag">&lt;/<span class="name">span</span>&gt;</span>&quot;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Using mustaches: &#123;&#123; rawHtml &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Using v-html directive: <span class="tag">&lt;<span class="name">span</span> <span class="attr">v-html</span>=<span class="string">&quot;rawHtml&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="attribute"><a class="markdownIt-Anchor" href="#attribute"></a> <a href="https://cn.vuejs.org/v2/guide/syntax.html#Attribute">Attribute</a></h4>
<p>Mustache ({}) 语法不能作用在 HTML attribute 上，遇到这种情况应该使用 <a href="https://cn.vuejs.org/v2/api/#v-bind"><code>v-bind</code> 指令</a>：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-bind:id</span>=<span class="string">&quot;dynamicId&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//isButtonDisabled 的值是 null、undefined 或 false，则 disabled attribute 甚至不会被包含在渲染出来的 <span class="tag">&lt;<span class="name">button</span>&gt;</span> 元素中</span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">v-bind:disabled</span>=<span class="string">&quot;isButtonDisabled&quot;</span>&gt;</span>Button<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="三元表达式"><a class="markdownIt-Anchor" href="#三元表达式"></a> 三元表达式</h4>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&#123;&#123; number + 1 &#125;&#125;</span><br><span class="line"></span><br><span class="line">&#123;&#123; ok ? &#x27;YES&#x27; : &#x27;NO&#x27; &#125;&#125;</span><br><span class="line"></span><br><span class="line">&#123;&#123; message.split(&#x27;&#x27;).reverse().join(&#x27;&#x27;) &#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-bind:id</span>=<span class="string">&quot;&#x27;list-&#x27; + id&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">//这些表达式会在所属 Vue 实例的数据作用域下作为 JavaScript 被解析。有个限制就是，每个绑定都只能包含单个表达式，所以下面的例子都不会生效。</span><br><span class="line"><span class="comment">&lt;!-- 这是语句，不是表达式 --&gt;</span></span><br><span class="line">&#123;&#123; var a = 1 &#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 流控制也不会生效，请使用三元表达式 --&gt;</span></span><br><span class="line">&#123;&#123; if (ok) &#123; return message &#125; &#125;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="7-指令directives"><a class="markdownIt-Anchor" href="#7-指令directives"></a> 7. 指令Directives</h3>
<p>指令 (Directives) 是带有 <code>v-</code> 前缀的特殊 attribute。指令 attribute 的值预期是<strong>单个 JavaScript 表达式</strong> (<code>v-for</code> 是例外情况，稍后我们再讨论)。指令的职责是，当表达式的值改变时，将其产生的连带影响，响应式地作用于 DOM。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">//v-if 指令将根据表达式 seen 的值的真假来插入/移除 <span class="tag">&lt;<span class="name">p</span>&gt;</span> 元素。</span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">v-if</span>=<span class="string">&quot;seen&quot;</span>&gt;</span>现在你看到我了<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="参数"><a class="markdownIt-Anchor" href="#参数"></a> 参数</h4>
<p>一些指令能够接收一个“参数”，在指令名称之后以冒号表示。例如，<code>v-bind</code> 指令可以用于响应式地更新 HTML attribute</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">//href 是参数，告知 v-bind 指令将该元素的 href attribute 与表达式 url 的值绑定</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">v-bind:href</span>=<span class="string">&quot;url&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">v-on:click</span>=<span class="string">&quot;doSomething&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="动态参数"><a class="markdownIt-Anchor" href="#动态参数"></a> 动态参数</h4>
<p>2.6.0 开始，可以用方括号括起来的 JavaScript 表达式作为一个指令的参数</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">v-bind:</span>[<span class="attr">attributeName</span>] = <span class="string">&quot;url&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">	这里的attributeName会被作为一个javascript表达式进行动态赋值，求得的值会作为最终的参数来使用</span></span><br><span class="line"><span class="comment">如果VUE实例有一个data. property. attributeName， 其值为href， 那么绑定将等价于v-bind:href</span></span><br><span class="line"><span class="comment">---&gt;</span></span><br></pre></td></tr></table></figure>
<p>绑定处理函数：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">v-on:</span>[<span class="attr">eventName</span>]=<span class="string">&quot;dosomething&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>对动态参数的值的约束</p>
<p>动态参数预期会求出一个字符串，异常情况下值为 <code>null</code>。这个特殊的 <code>null</code> 值可以被显性地用于移除绑定。任何其它非字符串类型的值都将会触发一个警告。</p>
</li>
<li>
<p>对动态参数表达式的约束</p>
<p>动态参数表达式有一些语法约束，因为某些字符，如空格和引号，放在 HTML attribute 名里是无效的。例如：</p>
</li>
</ul>
<h4 id="修饰符"><a class="markdownIt-Anchor" href="#修饰符"></a> 修饰符</h4>
<p>修饰符（modifier）是以半角句号<code>.</code> 指明的特殊后缀，用于指出一个指令应该以特殊方式绑定；例如<code>.prevent</code>修饰符告诉v-on指令对触发的事件调用event.preventDefault();</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">v-on:submit.prevent</span> = <span class="string">&quot;onSubmit&quot;</span>&gt;</span></span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="缩写"><a class="markdownIt-Anchor" href="#缩写"></a> 缩写</h4>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 完整语法 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">v-bind:href</span>=<span class="string">&quot;url&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 缩写 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">:href</span>=<span class="string">&quot;url&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 动态参数的缩写 (2.6.0+) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">:</span>[<span class="attr">key</span>]=<span class="string">&quot;url&quot;</span>&gt;</span> ... <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 完整语法 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">v-on:click</span>=<span class="string">&quot;doSomething&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 缩写 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> @<span class="attr">click</span>=<span class="string">&quot;doSomething&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 动态参数的缩写 (2.6.0+) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> @[<span class="attr">event</span>]=<span class="string">&quot;doSomething&quot;</span>&gt;</span> ... <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>:</code> 与 <code>@</code> 对于 attribute 名来说都是合法字符，在所有支持 Vue 的浏览器都能被正确地解析。而且，它们不会出现在最终渲染的标记中。</p>
<h3 id="8-计算属性"><a class="markdownIt-Anchor" href="#8-计算属性"></a> 8. 计算属性</h3>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;example&quot;</span>&gt;</span></span><br><span class="line">  &#123;&#123; message.split(&#x27;&#x27;).reverse().join(&#x27;&#x27;) &#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这里是想要显示变量 <code>message</code> 的翻转字符串。当你想要在模板中的多处包含此翻转字符串时，就会更加难以处理。</p>
<p>所以，对于任何复杂逻辑，你都应当使用<strong>计算属性</strong></p>
<p>例如：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;example&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>Original message: &quot;&#123;&#123; message &#125;&#125;&quot;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>Computed reversed message: &quot;&#123;&#123; reversedMessage &#125;&#125;&quot;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> vm = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  <span class="attr">el</span>: <span class="string">&#x27;#example&#x27;</span>,</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;Hello&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">computed</span>: &#123;</span><br><span class="line">    <span class="comment">// 计算属性的 getter</span></span><br><span class="line">    <span class="attr">reversedMessage</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// `this` 指向 vm 实例</span></span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.message.split(<span class="string">&#x27;&#x27;</span>).reverse().join(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//页面显示：</span></span><br><span class="line"><span class="comment">//Original message: &quot;Hello&quot;</span></span><br><span class="line"><span class="comment">//Computed reversed message: &quot;olleH&quot;</span></span><br></pre></td></tr></table></figure>
<p>声明了一个计算属性<code>reversedMessage</code>；我们提供的函数将用作property <code>vm.reversedMessage</code>的getter函数</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(vm.reversedMessage) <span class="comment">// olleH</span></span><br><span class="line">vm.message = <span class="string">&#x27;Goodbye&#x27;</span></span><br><span class="line"><span class="built_in">console</span>.log(vm.reversedMessage) <span class="comment">// =&gt; &#x27;eybdooG&#x27;</span></span><br></pre></td></tr></table></figure>
<p>你可以打开浏览器的控制台，自行修改例子中的 vm。<code>vm.reversedMessage</code> 的值始终取决于 <code>vm.message</code> 的值。</p>
<p>你可以像绑定普通 property 一样在模板中绑定计算属性。Vue 知道 <code>vm.reversedMessage</code> 依赖于 <code>vm.message</code>，因此当 <code>vm.message</code> 发生改变时，所有依赖 <code>vm.reversedMessage</code> 的绑定也会更新。以声明的方式创建了这种依赖关系：计算属性的 getter 函数是没有副作用 (side effect) 的。</p>
<h4 id="计算属性-vs-方法"><a class="markdownIt-Anchor" href="#计算属性-vs-方法"></a> 计算属性 VS 方法</h4>
<p>使用表达式中调用方法同样可以达到上面的结果</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Reversed message: &quot;&#123;&#123; reversedMessage() &#125;&#125;&quot;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 在组件中</span></span><br><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">  <span class="attr">reversedMessage</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.message.split(<span class="string">&#x27;&#x27;</span>).reverse().join(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们可以将同一函数定义为一个方法而不是一个计算属性。两种方式的最终结果确实是完全相同的。然而，不同的是<strong>计算属性是基于它们的响应式依赖进行缓存的</strong>。只在相关响应式依赖发生改变时它们才会重新求值。这就意味着只要 <code>message</code> 还没有发生改变，多次访问 <code>reversedMessage</code> 计算属性会立即返回之前的计算结果，而不必再次执行函数。</p>
<p>这也同样意味着下面的计算属性将不再更新，因为 <code>Date.now()</code> 不是响应式依赖：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">computed: &#123;</span><br><span class="line">  now: function () &#123;</span><br><span class="line">    return Date.now()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>相比之下，每当触发重新渲染时，调用方法将<strong>总会</strong>再次执行函数。</p>
<p>我们为什么需要缓存？假设我们有一个性能开销比较大的计算属性 <strong>A</strong>，它需要遍历一个巨大的数组并做大量的计算。然后我们可能有其他的计算属性依赖于 <strong>A</strong>。如果没有缓存，我们将不可避免的多次执行 <strong>A</strong> 的 getter！如果你不希望有缓存，请用方法来替代。</p>
<h4 id="计算属性-vs-侦听属性"><a class="markdownIt-Anchor" href="#计算属性-vs-侦听属性"></a> 计算属性 VS 侦听属性</h4>
<p>侦听属性：vue提供了一种更通用的方式来观察和响应vue实例上的数据变动；当有一些数据需要随着其他数据变动而变动时；很容易滥用watch;<strong>通常更好的做法是使用计算属性而不是命令式的watch回调</strong>；</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;demo&quot;</span>&gt;</span>&#123;&#123; fullName &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> vm = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  <span class="attr">el</span>: <span class="string">&#x27;#demo&#x27;</span>,</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">firstName</span>: <span class="string">&#x27;Foo&#x27;</span>,</span><br><span class="line">    <span class="attr">lastName</span>: <span class="string">&#x27;Bar&#x27;</span>,</span><br><span class="line">    <span class="attr">fullName</span>: <span class="string">&#x27;Foo Bar&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//侦听属性watch </span></span><br><span class="line">  <span class="attr">watch</span>: &#123;</span><br><span class="line">    <span class="attr">firstName</span>: <span class="function"><span class="keyword">function</span> (<span class="params">val</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">this</span>.fullName = val + <span class="string">&#x27; &#x27;</span> + <span class="built_in">this</span>.lastName</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">lastName</span>: <span class="function"><span class="keyword">function</span> (<span class="params">val</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">this</span>.fullName = <span class="built_in">this</span>.firstName + <span class="string">&#x27; &#x27;</span> + val</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//计算属性</span></span><br><span class="line">  <span class="attr">computed</span>: &#123;</span><br><span class="line">    <span class="attr">fullName</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.firstName + <span class="string">&#x27; &#x27;</span> + <span class="built_in">this</span>.lastName</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="计算属性的setter"><a class="markdownIt-Anchor" href="#计算属性的setter"></a> 计算属性的setter</h4>
<p>计算属性默认只有getter，自己可以提供一个setter</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">computed: &#123;</span><br><span class="line">  <span class="attr">fullName</span>: &#123;</span><br><span class="line">    <span class="comment">// getter</span></span><br><span class="line">    <span class="attr">get</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.firstName + <span class="string">&#x27; &#x27;</span> + <span class="built_in">this</span>.lastName</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// setter</span></span><br><span class="line">    <span class="attr">set</span>: <span class="function"><span class="keyword">function</span> (<span class="params">newValue</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> names = newValue.split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">      <span class="built_in">this</span>.firstName = names[<span class="number">0</span>]</span><br><span class="line">      <span class="built_in">this</span>.lastName = names[names.length - <span class="number">1</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在再运行 <code>vm.fullName = 'John Doe'</code> 时，setter 会被调用，<code>vm.firstName</code> 和 <code>vm.lastName</code> 也会相应地被更新。</p>
<h3 id="9-侦听器"><a class="markdownIt-Anchor" href="#9-侦听器"></a> 9. 侦听器</h3>
<p>当需要在数据变化时执行异步或开销较大的操作时，watch是最有用的；同时也可以自定义侦听器；</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;watch-example&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">    Ask a yes/no question:</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model</span>=<span class="string">&quot;question&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; answer &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;!-- 因为 AJAX 库和通用工具的生态已经相当丰富，Vue 核心代码没有重复 --&gt;</span><br><span class="line">&lt;!-- 提供这些功能以保持精简。这也可以让你自由选择自己更熟悉的工具。 --&gt;</span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/axios@0.12.0/dist/axios.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/lodash@4.13.1/lodash.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span></span><br><span class="line"><span class="javascript"><span class="xml"><span class="keyword">var</span> watchExampleVM = <span class="keyword">new</span> Vue(&#123;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">  <span class="attr">el</span>: <span class="string">&#x27;#watch-example&#x27;</span>,</span></span></span><br><span class="line"><span class="javascript"><span class="xml">  <span class="attr">data</span>: &#123;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">    <span class="attr">question</span>: <span class="string">&#x27;&#x27;</span>,</span></span></span><br><span class="line"><span class="javascript"><span class="xml">    <span class="attr">answer</span>: <span class="string">&#x27;I cannot give you an answer until you ask a question!&#x27;</span></span></span></span><br><span class="line"><span class="javascript"><span class="xml">  &#125;,</span></span></span><br><span class="line"><span class="javascript"><span class="xml">  <span class="attr">watch</span>: &#123;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">    <span class="comment">// 如果 `question` 发生改变，这个函数就会运行</span></span></span></span><br><span class="line"><span class="javascript"><span class="xml">    <span class="attr">question</span>: <span class="function"><span class="keyword">function</span> (<span class="params">newQuestion, oldQuestion</span>) </span>&#123;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">      <span class="built_in">this</span>.answer = <span class="string">&#x27;Waiting for you to stop typing...&#x27;</span></span></span></span><br><span class="line"><span class="javascript"><span class="xml">      <span class="built_in">this</span>.debouncedGetAnswer()</span></span></span><br><span class="line"><span class="javascript"><span class="xml">    &#125;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">  &#125;,</span></span></span><br><span class="line"><span class="javascript"><span class="xml">  <span class="attr">created</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">    <span class="comment">// `_.debounce` 是一个通过 Lodash 限制操作频率的函数。</span></span></span></span><br><span class="line"><span class="javascript"><span class="xml">    <span class="comment">// 在这个例子中，我们希望限制访问 yesno.wtf/api 的频率</span></span></span></span><br><span class="line"><span class="javascript"><span class="xml">    <span class="comment">// AJAX 请求直到用户输入完毕才会发出。想要了解更多关于</span></span></span></span><br><span class="line"><span class="javascript"><span class="xml">    <span class="comment">// `_.debounce` 函数 (及其近亲 `_.throttle`) 的知识，</span></span></span></span><br><span class="line"><span class="javascript"><span class="xml">    <span class="comment">// 请参考：https://lodash.com/docs#debounce</span></span></span></span><br><span class="line"><span class="javascript"><span class="xml">    <span class="built_in">this</span>.debouncedGetAnswer = _.debounce(<span class="built_in">this</span>.getAnswer, <span class="number">500</span>)</span></span></span><br><span class="line"><span class="javascript"><span class="xml">  &#125;,</span></span></span><br><span class="line"><span class="javascript"><span class="xml">  <span class="attr">methods</span>: &#123;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">    <span class="attr">getAnswer</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">      <span class="keyword">if</span> (<span class="built_in">this</span>.question.indexOf(<span class="string">&#x27;?&#x27;</span>) === -<span class="number">1</span>) &#123;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">        <span class="built_in">this</span>.answer = <span class="string">&#x27;Questions usually contain a question mark. ;-)&#x27;</span></span></span></span><br><span class="line"><span class="javascript"><span class="xml">        <span class="keyword">return</span></span></span></span><br><span class="line"><span class="javascript"><span class="xml">      &#125;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">      <span class="built_in">this</span>.answer = <span class="string">&#x27;Thinking...&#x27;</span></span></span></span><br><span class="line"><span class="javascript"><span class="xml">      <span class="keyword">var</span> vm = <span class="built_in">this</span></span></span></span><br><span class="line"><span class="javascript"><span class="xml">      axios.get(<span class="string">&#x27;https://yesno.wtf/api&#x27;</span>)</span></span></span><br><span class="line"><span class="javascript"><span class="xml">        .then(<span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">          vm.answer = _.capitalize(response.data.answer)</span></span></span><br><span class="line"><span class="javascript"><span class="xml">        &#125;)</span></span></span><br><span class="line"><span class="javascript"><span class="xml">        <span class="comment">//异常捕获</span></span></span></span><br><span class="line"><span class="javascript"><span class="xml">        .catch(<span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">          vm.answer = <span class="string">&#x27;Error! Could not reach the API. &#x27;</span> + error</span></span></span><br><span class="line"><span class="javascript"><span class="xml">        &#125;)</span></span></span><br><span class="line"><span class="javascript"><span class="xml">    &#125;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">  &#125;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">&#125;)</span></span></span><br><span class="line"><span class="javascript"><span class="xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>使用 <code>watch</code> 选项允许我们执行异步操作 (访问一个 API)，限制我们执行该操作的频率，并在我们得到最终结果前，设置中间状态。这些都是计算属性无法做到的</p>
<h3 id="10-class与style绑定"><a class="markdownIt-Anchor" href="#10-class与style绑定"></a> 10. class与style绑定</h3>
<p>将 <code>v-bind</code> 用于 <code>class</code> 和 <code>style</code> 时，Vue.js 做了专门的增强。表达式结果的类型除了字符串之外，还可以是对象或数组</p>
<h4 id="101-绑定html-class"><a class="markdownIt-Anchor" href="#101-绑定html-class"></a> 10.1 绑定html class</h4>
<h5 id="1011对象语法"><a class="markdownIt-Anchor" href="#1011对象语法"></a> 10.1.1对象语法</h5>
<p>方式一：内联</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span></span></span><br><span class="line"><span class="tag">  <span class="attr">class</span>=<span class="string">&quot;static&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-bind:class</span>=<span class="string">&quot;&#123; active: isActive, &#x27;text-danger&#x27;: hasError &#125;&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">//data</span><br><span class="line">data: &#123;</span><br><span class="line">  isActive: true,</span><br><span class="line">  hasError: false</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>方式二：绑定的数据对象不必内联定义在模板里</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-bind:class</span>=<span class="string">&quot;classObject&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">//vue data</span><br><span class="line">data: &#123;</span><br><span class="line">  classObject: &#123;</span><br><span class="line">    active: true,</span><br><span class="line">    &#x27;text-danger&#x27;: false</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>方式三：绑定一个返回对象的计算属性（常用）</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-bind:class</span>=<span class="string">&quot;classObject&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">//vue data</span><br><span class="line">data: &#123;</span><br><span class="line">  isActive: true,</span><br><span class="line">  error: null</span><br><span class="line">&#125;,</span><br><span class="line">computed: &#123;</span><br><span class="line">  classObject: function () &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      active: this.isActive &amp;&amp; !this.error,</span><br><span class="line">      &#x27;text-danger&#x27;: this.error &amp;&amp; this.error.type === &#x27;fatal&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="1012-数组语法"><a class="markdownIt-Anchor" href="#1012-数组语法"></a> 10.1.2 数组语法</h5>
]]></content>
      <categories>
        <category>架构师笔记</category>
      </categories>
      <tags>
        <tag>vue</tag>
      </tags>
  </entry>
  <entry>
    <title>常见的接口测试工具</title>
    <url>/swagger/</url>
    <content><![CDATA[<h2 id="1-swagger"><a class="markdownIt-Anchor" href="#1-swagger"></a> 1. Swagger</h2>
<p>Swagger 是一个规范且完整的框架，用于生成、描述、调用和可视化 RESTful 风格的 Web 服务。<br>
Swagger 的目标是对 REST API 定义一个标准且和语言无关的接口，可以让人和计算机拥有无须访问源码、文档或网络流量监测就可以发现和理解服务的能力。</p>
<p>静态的swagger跟不上频繁变更的代码，容易出现以下问题</p>
<ul>
<li>
<p>“为什么改了这个没告诉我”</p>
</li>
<li>
<p>“实际功能和文档上说的不一样啊”</p>
</li>
</ul>
<p>这样会带来的问题是：</p>
<ol>
<li>Swagger，postman，MockJS只能完成软件研发流程中某个环节的功能，造成完成接口设计，文档编写，调试，测试验证等工作需要使用好几个工具；</li>
<li>更麻烦的是这些工具数据格式不互通，无法互相导入，造成用Swagger定义和编写完成接口后，在Postman，MockJS，Jmeter等工具还要再去手动填写一遍才能开始工作，增加了无意义的工作量。</li>
<li>沟通成本总是被忽略不计，但实际上不仅占据了很大时间，各种沟通不及时、沟通不到位还非常让人心累。</li>
<li>老板的需求来得急，老板的需求变得快，各种代码修改和变更难以及时通知和同步到团队成员手中。</li>
</ol>
<h2 id="2-常见的可视化restful风格的服务"><a class="markdownIt-Anchor" href="#2-常见的可视化restful风格的服务"></a> 2. 常见的可视化RestFul风格的服务</h2>
<ul>
<li>springfox-swagger2</li>
<li>springdoc</li>
<li>Apifox（接口测试工具，非集成在项目中postman加强升级版）</li>
</ul>
<h2 id="3-各个工具的使用以及风格"><a class="markdownIt-Anchor" href="#3-各个工具的使用以及风格"></a> 3. 各个工具的使用以及风格</h2>
<p>使用Springboot项目分别集成各个组件，看下具体的实现效果；</p>
<h3 id="31-springfox-swagger2"><a class="markdownIt-Anchor" href="#31-springfox-swagger2"></a> 3.1 springfox-swagger2</h3>
<ol>
<li>
<p>引入依赖</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;io.springfox&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;springfox-swagger2&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">2.10</span><span class="number">.5</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">     &lt;groupId&gt;io.springfox&lt;/groupId&gt;</span><br><span class="line">     &lt;artifactId&gt;springfox-swagger-ui&lt;/artifactId&gt;</span><br><span class="line">     &lt;version&gt;<span class="number">2.9</span><span class="number">.2</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">     &lt;groupId&gt;com.github.xiaoymin&lt;/groupId&gt;</span><br><span class="line">     &lt;artifactId&gt;knife4j-spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">     &lt;version&gt;<span class="number">2.0</span><span class="number">.8</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>编写配置类</p>
<ul>
<li>
<p>SwaggerConfiguration类</p>
  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableSwagger2WebMvc</span></span><br><span class="line"><span class="meta">@EnableKnife4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SwaggerConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;spring.application.name&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String applicationName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(value = &quot;defaultApi&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Docket <span class="title">defaultApi2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//设置处理请求的包，我的controller类都在com.yugb.controller中</span></span><br><span class="line">        Predicate&lt;RequestHandler&gt; apiPackage = RequestHandlerSelectors.basePackage(<span class="string">&quot;com.yugb.controller&quot;</span>);</span><br><span class="line"></span><br><span class="line">        Docket docket = <span class="keyword">new</span> Docket(DocumentationType.SWAGGER_2)</span><br><span class="line">                .apiInfo(<span class="keyword">new</span> ApiInfoBuilder()</span><br><span class="line">                        .version(<span class="string">&quot;1.0&quot;</span>)</span><br><span class="line">                        .contact(<span class="keyword">new</span> Contact(<span class="string">&quot;xiaoyuge&quot;</span>,<span class="string">&quot;123&quot;</span>, <span class="string">&quot;12342qq.com&quot;</span>))</span><br><span class="line">                        .title(applicationName + <span class="string">&quot; 文档中心&quot;</span>)</span><br><span class="line">                        .description(<span class="string">&quot;&lt;div style=&#x27;font-size:15px;&#x27;&gt;&quot;</span> + applicationName + <span class="string">&quot; RESTful APIs&lt;/div&gt;&quot;</span>)</span><br><span class="line">                        .build())</span><br><span class="line">                <span class="comment">//分组名称</span></span><br><span class="line">                .groupName(<span class="string">&quot;2.X版本&quot;</span>)</span><br><span class="line">                .select()</span><br><span class="line">                <span class="comment">//这里指定Controller扫描包路径</span></span><br><span class="line">                .apis(apiPackage)</span><br><span class="line">                .paths(PathSelectors.any())</span><br><span class="line">                .build();</span><br><span class="line">        <span class="keyword">return</span> docket;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>SwaggerWebMvcConfigurer 类</p>
  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SwaggerWebMvcConfigurer</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;doc.html&quot;</span>).addResourceLocations(<span class="string">&quot;classpath:/META-INF/resources/&quot;</span>);</span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/webjars/**&quot;</span>).addResourceLocations(<span class="string">&quot;classpath:/META-INF/resources/webjars/&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li>
<p>添加注解</p>
<p>我们接口文档的直接描述主要就是在Controller这一层，比如这个接口的功能，参数的名称，返回值的名称等。这些值我们都需要在Controller上通过给方法上，请求参数和返回参数上添加对应的注解，swagger才能帮我们生成相应的接口文档。</p>
<ul>
<li><strong>JavaBean</strong>: @ApiModel注解和 @@ApiModelProperty 注解定义了实体的名称和字段的名称  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ApiModel(&quot;创建Swagger响应结果&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SwaggerResVO</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;姓名&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;性别&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer gender;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;啥啥&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String what;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<ul>
<li><strong>controller</strong>: @Api注解和 @ApiOperation注解分别标注了接口组名和接口的名称 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/swagger&quot;)</span></span><br><span class="line"><span class="meta">@Api(value = &quot;用户接口&quot;, tags = &#123;&quot;用户接口&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SwaggerController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;新增用户&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;save&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">save</span><span class="params">(<span class="meta">@RequestBody</span> SwaggerReqVO req)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@GetMapping(&quot;getById&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;根据条件查询用户&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SwaggerResVO <span class="title">getById</span><span class="params">(<span class="meta">@RequestBody</span> SwaggerResVO req)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SwaggerResVO();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ol start="3">
<li>
<p>启动项目</p>
<p>访问 <a href="http://localhost:8080/doc.html">http://localhost:8080/doc.html</a> 查看springfox-swagger2的文档中心<br>
<img src="/swagger/1.png" alt="springfox-swagger2"></p>
<p>查看GET请求的界面<br>
<img src="/swagger/2.png" alt="springfox-swagger2"><br>
<img src="/swagger/3.png" alt="springfox-swagger2"></p>
</li>
<li>
<p>优缺点</p>
<ul>
<li>
<p>优点：界面美观，集成方便，不同类型的接口按照controller分组，<strong>可以导出所有的接口文档！！！！！</strong></p>
</li>
<li>
<p>缺点：暂时没有遇到</p>
</li>
</ul>
</li>
</ol>
<h3 id="32-springdoc"><a class="markdownIt-Anchor" href="#32-springdoc"></a> 3.2 springdoc</h3>
<ol>
<li>
<p>引入依赖</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">     &lt;groupId&gt;org.springdoc&lt;/groupId&gt;</span><br><span class="line">     &lt;artifactId&gt;springdoc-openapi-ui&lt;/artifactId&gt;</span><br><span class="line">     &lt;version&gt;<span class="number">1.5</span><span class="number">.8</span>&lt;/version&gt;</span><br><span class="line"> &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line"> &lt;dependency&gt;</span><br><span class="line">     &lt;groupId&gt;org.springdoc&lt;/groupId&gt;</span><br><span class="line">     &lt;artifactId&gt;springdoc-openapi-webmvc-core&lt;/artifactId&gt;</span><br><span class="line">     &lt;version&gt;<span class="number">1.5</span><span class="number">.8</span>&lt;/version&gt;</span><br><span class="line"> &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>配置yml /yaml /properties</p>
 <figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">springdoc:</span></span><br><span class="line">  <span class="attr">api-docs:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">groups:</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/api-docs</span></span><br><span class="line">  <span class="attr">cache:</span></span><br><span class="line">    <span class="attr">disabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">swagger-ui:</span></span><br><span class="line">    <span class="attr">groups-order:</span> <span class="string">asc</span></span><br><span class="line">    <span class="comment"># 自定义的文档界面访问路径。默认访问路径是/swagger-ui.html</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/springdoc/docs.html</span></span><br><span class="line">  <span class="comment"># 布尔值。实现OpenApi规范的打印。</span></span><br><span class="line">  <span class="attr">writer-with-default-pretty-printer:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>编写配置类</p>
<ul>
<li>
<p>SpringdocOpenapiConfiguration</p>
  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringdocOpenapiConfiguration</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> SwaggerProperties swaggerProperties;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SpringdocOpenapiConfiguration</span><span class="params">(SwaggerProperties swaggerProperties)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.swaggerProperties = swaggerProperties;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> OpenAPI <span class="title">springDocOpenAPI</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//配置认证、请求头参数</span></span><br><span class="line">        Components components = <span class="keyword">new</span> Components();</span><br><span class="line"><span class="comment">//        Map&lt;String, Object&gt; myHeader2extensions = new HashMap&lt;&gt;(2);</span></span><br><span class="line"><span class="comment">//        myHeader2extensions.put(&quot;name&quot;, &quot;myHeader2&quot;);</span></span><br><span class="line"><span class="comment">//        components</span></span><br><span class="line"><span class="comment">//                .addSecuritySchemes(&quot;bearer-key&quot;, new SecurityScheme().type(SecurityScheme.Type.HTTP).scheme(&quot;bearer&quot;).bearerFormat(&quot;JWT&quot;))</span></span><br><span class="line"><span class="comment">//                .addSecuritySchemes(&quot;basicScheme&quot;, new SecurityScheme().type(SecurityScheme.Type.HTTP).scheme(&quot;basic&quot;))</span></span><br><span class="line"><span class="comment">//                .addHeaders(&quot;myHeader2&quot;, new Header().description(&quot;myHeader2 header&quot;).schema(new StringSchema()).extensions(myHeader2extensions))</span></span><br><span class="line"><span class="comment">//                .addParameters(&quot;myGlobalHeader&quot;, new HeaderParameter().required(true).name(&quot;My-Global-Header&quot;).description(&quot;My Global Header&quot;).schema(new StringSchema()).required(false))</span></span><br><span class="line"><span class="comment">//        ;</span></span><br><span class="line">      </span><br><span class="line">        <span class="comment">// 接口调试路径</span></span><br><span class="line">        Server tryServer = <span class="keyword">new</span> Server();</span><br><span class="line">        tryServer.setUrl(swaggerProperties.getTryHost());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> OpenAPI()</span><br><span class="line">                .components(components)</span><br><span class="line">                .servers(Collections.singletonList(tryServer))</span><br><span class="line">                .info(<span class="keyword">new</span> Info()</span><br><span class="line">                        .title(swaggerProperties.getApplicationName() + <span class="string">&quot; Api Doc&quot;</span>)</span><br><span class="line">                        .description(swaggerProperties.getApplicationDescription())</span><br><span class="line">                        .version(<span class="string">&quot;Application Version: &quot;</span> + swaggerProperties.getApplicationVersion() + <span class="string">&quot;\n Spring Boot Version: &quot;</span> + SpringBootVersion.getVersion())</span><br><span class="line">                        .license(<span class="keyword">new</span> License().name(<span class="string">&quot;Apache 2.0&quot;</span>).url(<span class="string">&quot;https://www.apache.org/licenses/LICENSE-2.0.html&quot;</span>))</span><br><span class="line">                )</span><br><span class="line">                .externalDocs(<span class="keyword">new</span> ExternalDocumentation()</span><br><span class="line">                        .description(<span class="string">&quot;SpringDoc Full Documentation&quot;</span>)</span><br><span class="line">                        .url(<span class="string">&quot;https://springdoc.org/&quot;</span>)</span><br><span class="line">                );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加全局的请求头参数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="comment">//    @Bean</span></span><br><span class="line"><span class="comment">//    public OpenApiCustomiser customerGlobalHeaderOpenApiCustomiser() &#123;</span></span><br><span class="line"><span class="comment">//        return openApi -&gt; openApi.getPaths().values().stream().flatMap(pathItem -&gt; pathItem.readOperations().stream())</span></span><br><span class="line"><span class="comment">//                .forEach(operation -&gt; &#123;</span></span><br><span class="line"><span class="comment">//                    operation.addParametersItem(new HeaderParameter().$ref(&quot;#/components/parameters/myGlobalHeader&quot;));</span></span><br><span class="line"><span class="comment">//                &#125;);</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通用拦截器排除设置，所有拦截器都会自动加springdoc-opapi相关的资源排除信息，不用在应用程序自身拦截器定义的地方去添加，算是良心解耦实现。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Field registrationsField = FieldUtils.getField(InterceptorRegistry.class, <span class="string">&quot;registrations&quot;</span>, <span class="keyword">true</span>);</span><br><span class="line">            List&lt;InterceptorRegistration&gt; registrations = (List&lt;InterceptorRegistration&gt;) ReflectionUtils.getField(registrationsField, registry);</span><br><span class="line">            <span class="keyword">if</span> (registrations != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">for</span> (InterceptorRegistration interceptorRegistration : registrations) &#123;</span><br><span class="line">                    interceptorRegistration.excludePathPatterns(<span class="string">&quot;/springdoc**/**&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 服务器支持跨域</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addCorsMappings</span><span class="params">(CorsRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addMapping(<span class="string">&quot;/**&quot;</span>)</span><br><span class="line">                .allowedOrigins(<span class="string">&quot;*&quot;</span>)</span><br><span class="line">                .allowedMethods(<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>, <span class="string">&quot;OPTIONS&quot;</span>)</span><br><span class="line">                .allowedHeaders(<span class="string">&quot;*&quot;</span>)</span><br><span class="line">                .exposedHeaders(<span class="string">&quot;Access-Control-Allow-Headers&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;Access-Control-Allow-Methods&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;Access-Control-Allow-Origin&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;Access-Control-Max-Age&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;X-Frame-Options&quot;</span>)</span><br><span class="line">                .allowCredentials(<span class="keyword">false</span>)</span><br><span class="line">                .maxAge(<span class="number">3600</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>SwaggerProperties</p>
  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(&quot;swagger&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SwaggerProperties</span> </span>&#123;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 项目应用名</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">private</span> String applicationName;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 项目版本信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String applicationVersion;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 项目描述信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String applicationDescription;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 接口调试地址</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String tryHost;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>编写接口方法</p>
<ul>
<li>在controller上添加@Tag注解</li>
<li>在接口方法上添加@Operation 注解</li>
<li>在接口参数添加@Parameter 或@Parameters 注解</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Tags(&#123;</span></span><br><span class="line"><span class="meta">  @Tag(name = &quot;ExpirationWarningController&quot;, description = &quot;设备寿命到期预警&quot;),</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExpirationWarningController</span> </span>&#123;</span><br><span class="line">    <span class="comment">//需要使用@Operation竹节</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/getOne/&#123;id&#125;/&#123;type&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;按ID查询&quot;, description = &quot;按ID查询&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseResult <span class="title">getOne</span><span class="params">(<span class="meta">@Parameter(description = &quot;主键ID&quot;)</span> <span class="meta">@PathVariable</span> Integer id,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="meta">@Parameter(description = &quot;类型&quot;)</span> <span class="meta">@PathVariable</span> String type)</span> </span>&#123;</span><br><span class="line">   </span><br><span class="line">        <span class="keyword">return</span> ResponseResult.success(expirationWarningVO);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/save&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;保存&quot;, description = &quot;保存&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseResult <span class="title">save</span><span class="params">(<span class="meta">@RequestBody</span> ExpirationWarning expirationWarning)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>在springboot启动类上加上以下配置</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@OpenAPIDefinition(</span></span><br><span class="line"><span class="meta">    info = @Info(</span></span><br><span class="line"><span class="meta">        title = &quot;测试springdoc&quot;,</span></span><br><span class="line"><span class="meta">        version = &quot;1.0&quot;</span></span><br><span class="line"><span class="meta">    ),</span></span><br><span class="line"><span class="meta">    externalDocs = @ExternalDocumentation(description = &quot;swagger-api参考文档&quot;,</span></span><br><span class="line"><span class="meta">        url = &quot;https://github.com/swagger-api/swagger-core/wiki/Swagger-2.X---Annotations&quot;</span></span><br><span class="line"><span class="meta">    ),</span></span><br><span class="line"><span class="meta">    servers = &#123;</span></span><br><span class="line"><span class="meta">        @Server(</span></span><br><span class="line"><span class="meta">            url = &quot;http://localhost:8123/app&quot;,</span></span><br><span class="line"><span class="meta">            description = &quot;本地地址&quot;</span></span><br><span class="line"><span class="meta">        ),</span></span><br><span class="line"><span class="meta">        @Server(</span></span><br><span class="line"><span class="meta">            url = &quot;http://www.xiaoyuge.vip/app&quot;,</span></span><br><span class="line"><span class="meta">            description = &quot;公网测试环境&quot;</span></span><br><span class="line"><span class="meta">        )</span></span><br><span class="line"><span class="meta">    &#125;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResolutionApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(ResolutionApplication.class, args);</span><br><span class="line">        logger.info(<span class="string">&quot;============= Start Success =============&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li>
<p>启动项目</p>
<p>访问 <a href="http://localhost:8123/app/springdoc/swagger-ui/index.html">http://localhost:8123/app/springdoc/swagger-ui/index.html</a> 查看springdox的文档中心<br>
<img src="/swagger/4.png" alt="springdoc"><br>
<img src="/swagger/5.png" alt="springdoc"></p>
</li>
<li>
<p>优缺点</p>
<ul>
<li>
<p>优点：不好说</p>
</li>
<li>
<p>缺点：界面没有按照每个controller分组，不直观！；</p>
</li>
</ul>
</li>
</ol>
<h3 id="33-apifox"><a class="markdownIt-Anchor" href="#33-apifox"></a> 3.3 Apifox</h3>
<p>一款研发全流程，接口全周期的生产力工具，这款软件真正完成了数据流的打通，在一个软件上就能实现<strong>接口设计–接口文档–接口调试–接口修改–接口mock–接口测试–接口自动化–接口迭代</strong>的工作流闭环；</p>
<h4 id="331-apifox上的协作流程"><a class="markdownIt-Anchor" href="#331-apifox上的协作流程"></a> 3.3.1 Apifox上的协作流程</h4>
<ol>
<li>后端在Apifox可视化接口设计界面上定义好项目各个接口及对应参数同时编写接口文档说明</li>
<li>前后端一起评审，修改完善接口并在同一界面顺手更新接口文档</li>
<li>后端使用接口调试功能调试接口</li>
<li>前端使用零配置高仿真mock功能对前端页面进行调试，无需手写mock规则</li>
<li>后端使用代码生成功能直接生成接口代码</li>
<li>测试在接口管理页面一键生成接口参数测试用例,并依据业务场景生成自动化测试用例，一键运行接口用例并生成接口测试报告并分享给相关人员。</li>
<li>前后端 都开发完，前端从Mock 数据切换到正式数据，进行联调，由于使用同一个接口数据源，且遵循了接口规范，联调顺利</li>
<li>由于bug修复或需求变更，接口发生了变化，后端修改提交后，前端和测试实时同步到了修改后的数据</li>
<li>项目经理通过权限设置给研发,产品,测试,外部合作人员分配编辑,只读等各种操作权限，维护了项目安全</li>
<li>项目经理通过各个接口的状态开发中,测试中,已发布来跟进项目的进度情况，把控项目风险。</li>
</ol>
<h4 id="332-apifox做的增速提效优化"><a class="markdownIt-Anchor" href="#332-apifox做的增速提效优化"></a> 3.3.2 Apifox做的增速提效优化</h4>
<ul>
<li>
<p>接口设计：从代码生成界面到可视化接口设计界面</p>
<p>Apifox 接口文档遵循 OpenApi 3.0 (原 Swagger)、JSON Schema 规范，可生成在线文档；零学习成本即可编写出符合RESTful风格的接口文档，新人上手快；所见即所得，不易出错<br>
<img src="/swagger/6.png" alt="Apifox"><br>
<img src="/swagger/7.png" alt="Apifox"></p>
</li>
<li>
<p>文档维护：从接口与文档分离到接口与文档合并</p>
<p>Apifox的接口设计界面提供了Markdown格式的文档说明区，修改完接口就如同commit代码时添加变更说明般<br>
<img src="/swagger/8.png" alt="Apifox"></p>
</li>
<li>
<p>数据复用：从各自为政到定义一次、多次复用</p>
<ul>
<li>
<p>接口数据复用：Swagger，Postman，MockJS，Jmeter等软件彼此之间数据不互通，数据格式不一致，接口导入非常耗时麻烦。<br>
而Apifox能身兼多职，包揽上述软件功能，在Apifox中定义一次接口，能被后端直接用来调试，前端直接用来mock界面，测试直接执行接口自动化。</p>
</li>
<li>
<p>数据模型复用：可复用的数据结构，定义接口返回数据结构及请求参数数据结构（仅 JSON 和 XML 模式）时可直接引用。</p>
</li>
</ul>
</li>
<li>
<p>同步更新，高效沟通:从沟通滞后到数据变更即时同步</p>
<p>Apifox为此提供了同步功能，一旦接口数据有更新发生，就会即时同步更新并通知到项目内所有成员。</p>
</li>
<li>
<p>Apihub</p>
<p>内置企业微信开放API，抖音开放API等第三方接口开放项目，接口可以直接在Apifox中调试，不需要到处找接口文档和手工填写接口</p>
</li>
</ul>
<h4 id="333-下载地址"><a class="markdownIt-Anchor" href="#333-下载地址"></a> 3.3.3 下载地址</h4>
<p>官网地址： <a href="http://www.apifox.cn/?utm_medium=WCSA&amp;utm_source=xxzsq">http://www.apifox.cn/?utm_medium=WCSA&amp;utm_source=xxzsq</a></p>
]]></content>
      <categories>
        <category>swagger</category>
      </categories>
      <tags>
        <tag>swagger</tag>
      </tags>
  </entry>
  <entry>
    <title>分库分表之 ShardingSphere-JDBC</title>
    <url>/sharding-jdbc/</url>
    <content><![CDATA[<h2 id="1-动态数据源解决方案"><a class="markdownIt-Anchor" href="#1-动态数据源解决方案"></a> 1. 动态数据源解决方案</h2>
<p>随着业务数据量逐渐增大，带来存储的瓶颈以及查询瓶颈，我们可以将数据存放到多个数据服务中，以达到减轻数据库压力，缩短数据库操作时间；<br>
目前关于动态数据源的解决方案大致包含以下5种，今天主要是学习一下Sharding-jdbc；<br>
<img src="/sharding-jdbc/0.png" alt></p>
<p>关于Mycat请查看 <a href="https://xiaoyuge.work/mycat/">mycat学习</a> 这篇博客。</p>
<h2 id="2-shardingsphere简介"><a class="markdownIt-Anchor" href="#2-shardingsphere简介"></a> 2. ShardingSphere简介</h2>
<ol>
<li>2018年5月，<code>sharding-jdbc</code>更名为<code>ShardingSphere</code></li>
<li>2018年11月，<code>Sharding-sphere</code>正式进入Apache基金会孵化器</li>
<li>2020年4月，从Apache孵化器毕业，成为Apache顶级项目<code>Apache ShardingSphere</code></li>
</ol>
<p><code>ShardingSphere</code>目前的定位已远超过人们熟知的<code>分库分表</code>的功能了，其拥有自己的⼀套开源的分布式数据库中间件解决⽅案组成的⽣态圈（<strong>ShardingSphere-JDBC</strong>、<strong>ShardingSphere-Proxy</strong>，<strong>ShardingSphere-sidecar</strong>（计划中））<br>
他们均提供标准化的数据分片、分布式事务和数据库治理功能，可适用于如Java同构、异构语言、容器、云原生等各种多样化的应用场景</p>
<p>官网地址：<a href="https://shardingsphere.apache.org/document/current/cn/overview/">https://shardingsphere.apache.org/document/current/cn/overview/</a></p>
<h3 id="21-apache-shardingsphere"><a class="markdownIt-Anchor" href="#21-apache-shardingsphere"></a> 2.1 Apache ShardingSphere</h3>
<ol>
<li>官方定义：<code>Apache ShardingSphere</code> 是一套开源的分布式数据库增强计算引擎，其通过可插拔架构构建基于数据库之上的生态系统，实现包括数据分片、弹性伸缩、加密脱敏等功能为代表的增强能力</li>
<li>定位Apache ShardingSphere 产品定位为<code>Database Plus</code>，旨在构建异构数据库上层的标准和生态。 它关注如何充分合理地利用数据库的计算和存储能力，而并非实现一个全新的数据库<br>
<img src="/sharding-jdbc/1.png" alt></li>
</ol>
<h3 id="22-shardingsphere-jdbc"><a class="markdownIt-Anchor" href="#22-shardingsphere-jdbc"></a> 2.2 ShardingSphere-JDBC</h3>
<p>定位于轻量级Java框架，在Java的jdbc层提供的额外服务， <code>ShardingSphere-jdbc</code>的主要功能在客户端尽心数据分片和读写分离，通过sharding-jdbc,应用可以使用jdbc访问已经读写分离的多个数据源，而不用关心数据库数量和数据的分布；</p>
<p><em>可以理解为增强版JDBC驱动，完全兼容JDBC和各种ORM框架</em></p>
<ol>
<li>使用于任何给予Java的ORM框架，如：<code>JPA</code>、<code>hibernate</code>、<code>mybatis</code>、<code>Spring JDBC Template</code>或直接使用JDBC</li>
<li>基于任何第三方的数据库连接池，如：<code>DBCP</code>、<code>C3P0</code>、<code>BoneCP</code>、<code>Druid</code>、<code>HikariCP</code>等</li>
<li>支持任意实现JDBC规范的数据库，如<code>Mysql</code>、<code>Oracle</code>、<code>SQLServer</code>、<code>PostgreSQL</code><br>
<img src="/sharding-jdbc/2.png" alt></li>
</ol>
<p>源码：<a href="https://github.com/apache/shardingsphere/tree/master/shardingsphere-jdbc">https://github.com/apache/shardingsphere/tree/master/shardingsphere-jdbc</a></p>
<h3 id="23-shardingsphere-proxy"><a class="markdownIt-Anchor" href="#23-shardingsphere-proxy"></a> 2.3 ShardingSphere-Proxy</h3>
<p>定位为透明化的数据库代理端，提供封装了数据库二进制协议的服务端版本，用于完成对异构语言的支持。 目前提供 MySQL 和 PostgreSQL（兼容 openGauss 等基于 PostgreSQL 的数据库）版本，它可以使用任何兼容 MySQL/PostgreSQL 协议的访问客户端（如：MySQL Command Client, MySQL Workbench, Navicat 等）操作数据，对 DBA 更加友好</p>
<ol>
<li>向应用程序完全透明，可直接当做 MySQL/PostgreSQL 使用；</li>
<li>适用于任何兼容 MySQL/PostgreSQL 协议的的客户端。</li>
</ol>
<p><img src="/sharding-jdbc/3.png" alt></p>
<p>源码：<a href="https://github.com/apache/shardingsphere/tree/master/shardingsphere-proxy">https://github.com/apache/shardingsphere/tree/master/shardingsphere-proxy</a></p>
<h3 id="24-shardingsphere-sidecartodo"><a class="markdownIt-Anchor" href="#24-shardingsphere-sidecartodo"></a> 2.4 ShardingSphere-sidecar（TODO）</h3>
<p>定位为 Kubernetes 的云原生数据库代理，以 Sidecar 的形式代理所有对数据库的访问。 通过无中心、零侵入的方案提供与数据库交互的啮合层，即 Database Mesh，又可称数据库网格。<br>
<img src="/sharding-jdbc/4.png" alt></p>
<h2 id="3-分片的核心概念"><a class="markdownIt-Anchor" href="#3-分片的核心概念"></a> 3. 分片的核心概念</h2>
<ol>
<li>
<p>主要概念<br>
由原来的一个数据库(表)拆分为真实存在的三个数据库(表)<br>
<img src="/sharding-jdbc/5.png" alt><br>
逻辑表会在 SQL 解析和路由时被替换成真实的表名，分片键就是拆分的逻辑；sharding-jdbc可以选择多个分片键；</p>
</li>
<li>
<p>动态表</p>
<p>表名会变化，比如订单表，按照月份进行分表<br>
<img src="/sharding-jdbc/6.png" alt></p>
</li>
<li>
<p>绑定表</p>
<p>与Mycat的ER表对应，存在关联关系的两张表，他们的分片规则必须相同<br>
<img src="/sharding-jdbc/7.png" alt></p>
</li>
<li>
<p>广播表</p>
<p>与Mycat的全局表对应，所有节点的数据内容一致<br>
<img src="/sharding-jdbc/8.png" alt></p>
</li>
</ol>
<h2 id="4-sharding-jdbc-demo演示"><a class="markdownIt-Anchor" href="#4-sharding-jdbc-demo演示"></a> 4. Sharding-JDBC Demo演示</h2>
<p><code>Apache ShardingSphere-JDBC</code> 可以通过 <strong>Java</strong>，<strong>YAML</strong>，<strong>Spring 命名空间</strong> 和 <strong>Spring Boot Starter</strong> 这 4 种方式进行配置，开发者可根据场景选择适合的配置方式。</p>
<p>目前仅支持<code>Java</code>语言且java JRE 8或更高版本</p>
<p>下面使用SSM框架来集成<code>shardingsphere-jdbc</code>，操作数据库，由于资源有限，在一个数据库<code>instance</code>里面创建两个数据库db0、db1来模拟分库分表；</p>
<ol>
<li>
<p>创建数据库<code>db0</code>,<code>db1</code>，以及创建下面的数据表</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 用户表</span></span><br><span class="line"> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `user_info` (</span><br><span class="line">     `user_id` <span class="type">bigint</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">     `user_name` <span class="type">varchar</span>(<span class="number">45</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">     `account` <span class="type">varchar</span>(<span class="number">45</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">     `password` <span class="type">varchar</span>(<span class="number">45</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">     <span class="keyword">PRIMARY</span> KEY (`user_id`)</span><br><span class="line"> ) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4;</span><br><span class="line"> </span><br><span class="line"> <span class="comment">-- 订单表</span></span><br><span class="line"> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `t_order` (</span><br><span class="line">     `order_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">     `user_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">     <span class="keyword">PRIMARY</span> KEY (`order_id`)</span><br><span class="line"> ) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4;</span><br><span class="line"> </span><br><span class="line"><span class="comment">-- 订单明细表</span></span><br><span class="line"> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `t_order_item` (</span><br><span class="line">     `item_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">     `order_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">     `user_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">     <span class="keyword">PRIMARY</span> KEY (`item_id`)</span><br><span class="line"> ) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4;</span><br><span class="line"> </span><br><span class="line"> <span class="comment">-- 参数配置表</span></span><br><span class="line"> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `t_config` (</span><br><span class="line">     `config_id` <span class="type">int</span>(<span class="number">16</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">     `para_name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">     `para_value` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">     `para_desc` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">     <span class="keyword">PRIMARY</span> KEY (`config_id`)</span><br><span class="line"> ) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4;</span><br><span class="line"> </span><br><span class="line"> <span class="keyword">truncate</span> <span class="keyword">table</span> user_info;</span><br><span class="line"> <span class="keyword">truncate</span> <span class="keyword">table</span> t_order;</span><br><span class="line"> <span class="keyword">truncate</span> <span class="keyword">table</span> t_order_item;</span><br><span class="line"> <span class="keyword">truncate</span> <span class="keyword">table</span> t_config;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><span id="index1">创建项目并引入依赖</span></p>
 <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"> <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.shardingsphere/shardingsphere-jdbc-core --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shardingsphere<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shardingsphere-jdbc-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shardingsphere<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sharding-jdbc-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>使用<code>mybatisPlus</code>逆向工程生成<code>entity</code>、<code>mapper</code>、<code>service</code>等相关代码，这里就不贴业务代码了。</p>
</li>
<li>
<p>编辑<code>application.yml</code></p>
 <figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mapper/*.xml</span></span><br><span class="line">  <span class="attr">config-location:</span> <span class="string">classpath:mybatis-config.xml</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">shardingsphere:</span></span><br><span class="line">    <span class="attr">props:</span></span><br><span class="line">      <span class="attr">sql:</span></span><br><span class="line">        <span class="attr">show:</span> <span class="literal">true</span>    <span class="comment">#打印sql语句</span></span><br><span class="line">    <span class="attr">datasource:</span>     <span class="comment">#数据源配置</span></span><br><span class="line">      <span class="attr">names:</span> <span class="string">db0,db1</span></span><br><span class="line">      <span class="attr">db0:</span>    <span class="comment">#数据源1</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">        <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">        <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/db1?serverTimezone=UTC&amp;useSSL=false&amp;useUnicode=true&amp;characterEncoding=UTF-8</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">password:</span> <span class="string">xiaoyuge</span></span><br><span class="line">      <span class="attr">db1:</span>   <span class="comment">#数据源2</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">        <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">        <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/db1?serverTimezone=UTC&amp;useSSL=false&amp;useUnicode=true&amp;characterEncoding=UTF-8</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">password:</span> <span class="string">xiaoyuge</span></span><br><span class="line">    <span class="attr">sharding:</span>     <span class="comment">#分片</span></span><br><span class="line">      <span class="attr">default-database-strategy:</span>    <span class="comment">#数据库分片策略</span></span><br><span class="line">        <span class="attr">inline:</span></span><br><span class="line">          <span class="attr">sharding-column:</span> <span class="string">user_id</span>    <span class="comment">#分片键</span></span><br><span class="line">          <span class="attr">algorithm-expression:</span> <span class="string">db$&#123;user_id</span> <span class="string">%</span> <span class="number">2</span><span class="string">&#125;</span>    <span class="comment">#分片算法</span></span><br><span class="line">      <span class="attr">tables:</span>     <span class="comment">#表分片策略</span></span><br><span class="line">        <span class="attr">user_info:</span></span><br><span class="line">          <span class="attr">actual-data-nodes:</span> <span class="string">db$-&gt;&#123;0..1&#125;.user_info</span>      <span class="comment">#真实存储数据的节点，可以使用行内表达式,$-&gt;&#123;&#125; 是标准语法</span></span><br><span class="line">          <span class="attr">databaseStrategy:</span></span><br><span class="line">            <span class="attr">inline:</span></span><br><span class="line">              <span class="attr">shardingColumn:</span> <span class="string">user_id</span></span><br><span class="line">              <span class="attr">algorithm-expression:</span> <span class="string">db$&#123;user_id</span> <span class="string">%</span> <span class="number">2</span><span class="string">&#125;</span>  <span class="comment">#分片算法</span></span><br><span class="line">          <span class="attr">key-generator:</span></span><br><span class="line">            <span class="attr">column:</span> <span class="string">user_id</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">SNOWFLAKE</span>     <span class="comment">#主键策略：SNOWFLAKE 、 UUID，如果设置了主键策略，那么插入的时候就不用指定主键的值</span></span><br><span class="line">        <span class="attr">t_order:</span></span><br><span class="line">          <span class="attr">databaseStrategy:</span></span><br><span class="line">            <span class="attr">inline:</span></span><br><span class="line">              <span class="attr">shardingColumn:</span> <span class="string">order_id</span></span><br><span class="line">              <span class="attr">algorithm-expression:</span> <span class="string">db$&#123;order_id</span> <span class="string">%</span> <span class="number">2</span><span class="string">&#125;</span> <span class="comment">#分片算法</span></span><br><span class="line">          <span class="attr">actual-data-nodes:</span> <span class="string">db$-&gt;&#123;0..1&#125;.t_order</span></span><br><span class="line">        <span class="attr">t_order_item:</span></span><br><span class="line">          <span class="attr">databaseStrategy:</span></span><br><span class="line">            <span class="attr">inline:</span></span><br><span class="line">              <span class="attr">shardingColumn:</span> <span class="string">order_id</span></span><br><span class="line">              <span class="attr">algorithm-expression:</span> <span class="string">db$&#123;order_id</span> <span class="string">%</span> <span class="number">2</span><span class="string">&#125;</span>   <span class="comment">#分片算法</span></span><br><span class="line">          <span class="attr">actual-data-nodes:</span> <span class="string">db$-&gt;&#123;0..1&#125;.t_order_item</span></span><br><span class="line">      <span class="string">binding-tables[0]:</span> <span class="string">t_order,t_order_item</span>    <span class="comment">#绑定表配置</span></span><br><span class="line">      <span class="attr">broadcast-tables:</span> <span class="string">t_config</span>      <span class="comment">#广播表配置</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>测试简单分库user_info</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.ygb.entity.UserInfo;</span><br><span class="line"><span class="keyword">import</span> com.ygb.service.UserService;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.annotation.MapperScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="meta">@MapperScan(basePackages = &quot;com.ygb.mapper&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserShardingTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//随机生成100条数据,插入到数据库中</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">100</span>; i++) &#123;</span><br><span class="line">            UserInfo userInfo = <span class="keyword">new</span> UserInfo();</span><br><span class="line">            userInfo.setAccount(<span class="string">&quot;account&quot;</span> + i);</span><br><span class="line">            userInfo.setPassword(<span class="string">&quot;password&quot;</span> + i);</span><br><span class="line">            userInfo.setUserName(<span class="string">&quot;name&quot;</span> + i);</span><br><span class="line">            userInfo.setUserId(i);</span><br><span class="line">            userService.insert(userInfo);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">select</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        UserInfo userInfo1 = userService.getUserInfoByUserId(<span class="number">1L</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;------userInfo1:&quot;</span> + userInfo1);</span><br><span class="line"></span><br><span class="line">        UserInfo userInfo2 = userService.getUserInfoByUserId(<span class="number">2L</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;------userInfo2:&quot;</span> + userInfo2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>
<p>执行 <code>insert</code>方法后，结果如下图所示:<br>
<img src="/sharding-jdbc/9.png" alt></p>
<p>根据上面<code>yaml</code>配置<code>user_info</code>表按照分片键(<code>sharding-column</code>)<code>user_id</code>取模分片到不同数据库;<code>user_id</code> % 2 为偶数落下<code>db0</code>, 奇数落在<code>db1</code></p>
</li>
<li>
<p>执行 <code>select</code> 方法，查询user_id为1 的数据，可以看到逻辑sql语句以及真实的sql语句路由到哪个节点上。<br>
<img src="/sharding-jdbc/10.png" alt><br>
同理，查询user_id 为 2 的数据，根据表的分库规则，user_id % 2 == 0数据落在db0节点上；</p>
</li>
</ol>
</li>
<li>
<p>测试绑定表t_order,t_order_item</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">100</span>; i++) &#123;</span><br><span class="line">        <span class="comment">//订单表</span></span><br><span class="line">        Order order = <span class="keyword">new</span> Order();</span><br><span class="line">        order.setOrderId(i);</span><br><span class="line">        order.setUserId(i);</span><br><span class="line">        orderService.insert(order);</span><br><span class="line">        <span class="comment">//订单明细表</span></span><br><span class="line">        OrderItem orderItem = <span class="keyword">new</span> OrderItem();</span><br><span class="line">        orderItem.setItemId(i);</span><br><span class="line">        orderItem.setOrderId(i);</span><br><span class="line">        orderItem.setUserId(i);</span><br><span class="line">        orderItemService.insert(orderItem);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行<code>insert</code>方法后，数据库表结果如下图所示：<br>
<img src="/sharding-jdbc/11.png" alt><br>
<code>t_order</code>表和<code>t_order_item</code> 使用相同的分片规则<code>db$&#123;order_id % 2&#125;</code>,相同的<code>order_id</code>分布在同一个节点上；</p>
</li>
<li>
<p>测试广播表t_config</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) &#123;</span><br><span class="line">        Config config = <span class="keyword">new</span> Config();</span><br><span class="line">        config.setConfigId(i);</span><br><span class="line">        config.setParaName(<span class="string">&quot;name&quot;</span>+i);</span><br><span class="line">        config.setParaValue(<span class="string">&quot;value&quot;</span>+i);</span><br><span class="line">        config.setParaDesc(<span class="string">&quot;desc&quot;</span>+i);</span><br><span class="line">        configService.insert(config);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行<code>insert</code>方法后，查看执行日志，可以看到它向<code>db0</code>、<code>db1</code>两个节点分别发送了插入语句；<br>
<img src="/sharding-jdbc/12.png" alt><br>
<img src="/sharding-jdbc/13.png" alt></p>
</li>
</ol>
<h2 id="5-shardingsphere分库分表原理剖析"><a class="markdownIt-Anchor" href="#5-shardingsphere分库分表原理剖析"></a> 5. ShardingSphere分库分表原理剖析</h2>
<p>基于上面的测试代码来分析ShardingSphere分库分表原理；</p>
<h3 id="51-shardingsphere-jdbc工作流程"><a class="markdownIt-Anchor" href="#51-shardingsphere-jdbc工作流程"></a> 5.1 ShardingSphere-JDBC工作流程</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SQL 解析(解析引擎) =&gt; 执行器优化 =&gt; SQL 路由(路由引擎) =&gt; SQL 改写(改写引擎) =&gt; SQL 执行(执行引擎) =&gt; 结果归并(归并引擎)</span><br></pre></td></tr></table></figure>
<ol>
<li>
<p>SQL解析</p>
<p><code>SQL</code> 解析主要是词法和语法的解析。目前常见的 <code>SQL</code> 解析器主要有<code>fdb</code>，<code>jsqlparser</code> 和 <code>Druid</code>。<code>Sharding-JDBC1.4.x</code>之前的版本使用<code>Druid</code>作为<code>SQL</code>解析器。从 1.5.x 版本 开始，<code>Sharding-JDBC</code>采用完全自研的<code>SQL</code>解析引擎</p>
</li>
<li>
<p>SQL 路由<br>
<img src="/sharding-jdbc/21.png" alt><br>
SQL 路由是根据分片规则配置以及解析上下文中的分片条件，将 SQL 定位至真正的 数据源。它又分为直接路由、标准路由和笛卡尔积路由</p>
<ul>
<li>
<p>直接路由: 使用 Hint 方式。</p>
</li>
<li>
<p>标准路由：Binding 表是指使用同样的分片键和分片规则的一组表，也就是说任何情况下， Binding 表的分片结果应与主表一致。例如：order 表和 order_item 表，都根据 order_id 分片，结果应是 order_1 与 order_item_1 成对出现。这样的关联查询和单表查询复杂度 和性能相当。如果分片条件不是等于，而是 BETWEEN 或 IN，则路由结果不一定落入单 库（表），因此一条逻辑 SQL 最终可能拆分为多条 SQL 语句。</p>
</li>
<li>
<p>笛卡尔积路由：笛卡尔积查询最为复杂，因为无法根据 Binding 关系定位分片规则的一致性，所以 非 Binding 表的关联查询需要拆解为笛卡尔积组合执行。查询性能较低，而且数据库连 接数较高，需谨慎使用。</p>
</li>
</ul>
</li>
<li>
<p>SQL改写</p>
<p>将逻辑表名称改成真实表名称，优化分页查询等</p>
</li>
<li>
<p>SQL执行</p>
<p>因为可能链接到多个真实数据源， Sharding -JDBC 将采用多线程并发执行 SQL</p>
</li>
<li>
<p>SQL归并</p>
<p>如数据的组装、分页、排序等等。</p>
</li>
</ol>
<p>下面我跟着源码学习一下完整的执行过程。</p>
<h3 id="52-配置加载过程"><a class="markdownIt-Anchor" href="#52-配置加载过程"></a> 5.2 配置加载过程</h3>
<p>首先由于我们引入sharding-jdbc-spring-boot-starter依赖，在依赖包中可以看到shardingSphere支持springboot,那么它肯定会有一个类似于SpringBoot自动装配类 <code>SpringBootConfiguration</code>这样的配置类；</p>
<p>查看一下源码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Spring boot starter configuration.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;org.apache.shardingsphere.spring.boot.converter&quot;)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(&#123;</span></span><br><span class="line"><span class="meta">        SpringBootShardingRuleConfigurationProperties.class,</span></span><br><span class="line"><span class="meta">        SpringBootMasterSlaveRuleConfigurationProperties.class, SpringBootEncryptRuleConfigurationProperties.class,</span></span><br><span class="line"><span class="meta">        SpringBootPropertiesConfigurationProperties.class, SpringBootShadowRuleConfigurationProperties.class&#125;)</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(prefix = &quot;spring.shardingsphere&quot;, name = &quot;enabled&quot;, havingValue = &quot;true&quot;, matchIfMissing = true)</span></span><br><span class="line"><span class="meta">@AutoConfigureBefore(DataSourceAutoConfiguration.class)</span> </span><br><span class="line"><span class="comment">//@AutoConfigureBefore自动装配在DataSourceAutoConfiguration装配类之前完成，也就是说Shardingsphere创建得数据源就是全局得数据源，项目只要涉及到对数据库得任何操作都会经过ShardingDataSource得这一层处理</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringBootConfiguration</span> <span class="keyword">implements</span> <span class="title">EnvironmentAware</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//将之前配置得规则映射到此配置文件中，为创建数据源得过程提供配置信息</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> SpringBootShardingRuleConfigurationProperties shardingRule;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> SpringBootMasterSlaveRuleConfigurationProperties masterSlaveRule;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> SpringBootEncryptRuleConfigurationProperties encryptRule;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> SpringBootShadowRuleConfigurationProperties shadowRule;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> SpringBootPropertiesConfigurationProperties props;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//对象存放得是配置得所有数据源映射信息，为后面获取数据库连接以及数据分片提供基础能力</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, DataSource&gt; dataSourceMap = <span class="keyword">new</span> LinkedHashMap&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String jndiName = <span class="string">&quot;jndi-name&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 上面的测试代码基于分片的 策略配置，所以只有 ShardingRuleCondition 才满足装配条件。</span></span><br><span class="line"><span class="comment">     * ShardingDataSourceFactory工厂类来创建 ShardingDataSource数据源，</span></span><br><span class="line"><span class="comment">     * Get sharding data source bean.</span></span><br><span class="line"><span class="comment">     * 条件注入不同的数据源</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> data source bean</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> SQLException SQL exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Conditional(ShardingRuleCondition.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">shardingDataSource</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="comment">//配置转换过程，</span></span><br><span class="line">        <span class="keyword">return</span> ShardingDataSourceFactory.createDataSource(dataSourceMap, <span class="keyword">new</span> ShardingRuleConfigurationYamlSwapper().swap(shardingRule), props.getProps());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Get master-slave data source bean.</span></span><br><span class="line"><span class="comment">     * 条件注入不同的数据源</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> data source bean</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> SQLException SQL exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Conditional(MasterSlaveRuleCondition.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">masterSlaveDataSource</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> MasterSlaveDataSourceFactory.createDataSource(dataSourceMap, <span class="keyword">new</span> MasterSlaveRuleConfigurationYamlSwapper().swap(masterSlaveRule), props.getProps());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Get encrypt data source bean.</span></span><br><span class="line"><span class="comment">     *条件注入不同的数据源</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> data source bean</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> SQLException SQL exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Conditional(EncryptRuleCondition.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">encryptDataSource</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> EncryptDataSourceFactory.createDataSource(dataSourceMap.values().iterator().next(), <span class="keyword">new</span> EncryptRuleConfigurationYamlSwapper().swap(encryptRule), props.getProps());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Get shadow data source bean.</span></span><br><span class="line"><span class="comment">     * 条件注入不同的数据源</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> data source bean</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> SQLException SQL exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Conditional(ShadowRuleCondition.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">shadowDataSource</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ShadowDataSourceFactory.createDataSource(dataSourceMap, <span class="keyword">new</span> ShadowRuleConfigurationYamlSwapper().swap(shadowRule), props.getProps());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Create sharding transaction type scanner</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> sharding transaction type scanner</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ShardingTransactionTypeScanner <span class="title">shardingTransactionTypeScanner</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ShardingTransactionTypeScanner();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">setEnvironment</span><span class="params">(<span class="keyword">final</span> Environment environment)</span> </span>&#123;</span><br><span class="line">        String prefix = <span class="string">&quot;spring.shardingsphere.datasource.&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (String each : getDataSourceNames(environment, prefix)) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">//遍历环境变量，将数据源保存到 dataSourceMap</span></span><br><span class="line">                dataSourceMap.put(each, getDataSource(environment, prefix, each));</span><br><span class="line">            &#125; <span class="keyword">catch</span> (<span class="keyword">final</span> ReflectiveOperationException ex) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ShardingSphereException(<span class="string">&quot;Can&#x27;t find datasource type!&quot;</span>, ex);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (<span class="keyword">final</span> NamingException namingEx) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ShardingSphereException(<span class="string">&quot;Can&#x27;t find JNDI datasource!&quot;</span>, namingEx);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//----------------------------省略------------------------------</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>
<p><code>ShardingDataSourceFactory</code>工厂类创建ShardingDataSource数据源</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShardingDataSource</span> <span class="keyword">extends</span> <span class="title">AbstractDataSourceAdapter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ShardingRuntimeContext runtimeContext;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="comment">//初始化路由装饰器（路由引擎，SPI方式）</span></span><br><span class="line">        NewInstanceServiceLoader.register(RouteDecorator.class);</span><br><span class="line">        <span class="comment">//创建SQL改写上下文装饰器（改写引擎，SPI方式）</span></span><br><span class="line">        NewInstanceServiceLoader.register(SQLRewriteContextDecorator.class);</span><br><span class="line">        <span class="comment">// 创建结果处理引擎（归并引擎，用于对查询结果合并处理，同上）</span></span><br><span class="line">        NewInstanceServiceLoader.register(ResultProcessEngine.class);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ShardingDataSource</span><span class="params">(Map&lt;String, DataSource&gt; dataSourceMap, ShardingRule shardingRule, Properties props)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(dataSourceMap);</span><br><span class="line">        <span class="keyword">this</span>.checkDataSourceType(dataSourceMap);</span><br><span class="line">        <span class="comment">//创建运行时上下文（全局分片运行时上下文，用于保存分片所需得相关配置）</span></span><br><span class="line">        <span class="keyword">this</span>.runtimeContext = <span class="keyword">new</span> ShardingRuntimeContext(dataSourceMap, shardingRule, props, <span class="keyword">this</span>.getDatabaseType());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//----------------------------省略------------------------------</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ShardingRule配置规则解析类<br>
配置转换过程。会将分表规则、分库规则、分表算法、分库算法等都解析到对应得 ShardingRuleConfiguration 通用分片配置类中</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ShardingRuleConfiguration <span class="title">swap</span><span class="params">(YamlShardingRuleConfiguration yamlConfiguration)</span> </span>&#123;</span><br><span class="line">   ShardingRuleConfiguration result = <span class="keyword">new</span> ShardingRuleConfiguration();</span><br><span class="line">   Iterator var3 = yamlConfiguration.getTables().entrySet().iterator();</span><br><span class="line">    </span><br><span class="line">   <span class="keyword">while</span>(var3.hasNext()) &#123;</span><br><span class="line">       <span class="comment">//将我们配置得分库、分表策略、分库算法、分表算法解析到TableRuleConfiguration中，每一张表都会对应一个配置类</span></span><br><span class="line">       Entry&lt;String, YamlTableRuleConfiguration&gt; entry = (Entry)var3.next();</span><br><span class="line">       YamlTableRuleConfiguration tableRuleConfig = (YamlTableRuleConfiguration)entry.getValue();</span><br><span class="line">       tableRuleConfig.setLogicTable((String)entry.getKey());</span><br><span class="line">       result.getTableRuleConfigs().add(<span class="keyword">this</span>.tableRuleConfigurationYamlSwapper.swap(tableRuleConfig));</span><br><span class="line">   &#125;</span><br><span class="line">    </span><br><span class="line">   result.setDefaultDataSourceName(yamlConfiguration.getDefaultDataSourceName());</span><br><span class="line">   <span class="comment">//绑定表</span></span><br><span class="line">   result.getBindingTableGroups().addAll(yamlConfiguration.getBindingTables());</span><br><span class="line">   <span class="comment">//广播表</span></span><br><span class="line">   result.getBroadcastTables().addAll(yamlConfiguration.getBroadcastTables());</span><br><span class="line">   <span class="keyword">if</span> (<span class="keyword">null</span> != yamlConfiguration.getDefaultDatabaseStrategy()) &#123;</span><br><span class="line">       result.setDefaultDatabaseShardingStrategyConfig(<span class="keyword">this</span>.shardingStrategyConfigurationYamlSwapper.swap(yamlConfiguration.getDefaultDatabaseStrategy()));</span><br><span class="line">   &#125;</span><br><span class="line">    </span><br><span class="line">   <span class="keyword">if</span> (<span class="keyword">null</span> != yamlConfiguration.getDefaultTableStrategy()) &#123;</span><br><span class="line">       result.setDefaultTableShardingStrategyConfig(<span class="keyword">this</span>.shardingStrategyConfigurationYamlSwapper.swap(yamlConfiguration.getDefaultTableStrategy()));</span><br><span class="line">   &#125;</span><br><span class="line">    </span><br><span class="line">   <span class="keyword">if</span> (<span class="keyword">null</span> != yamlConfiguration.getDefaultKeyGenerator()) &#123;</span><br><span class="line">       result.setDefaultKeyGeneratorConfig(<span class="keyword">this</span>.keyGeneratorConfigurationYamlSwapper.swap(yamlConfiguration.getDefaultKeyGenerator()));</span><br><span class="line">   &#125;</span><br><span class="line">    </span><br><span class="line">   Collection&lt;MasterSlaveRuleConfiguration&gt; masterSlaveRuleConfigs = <span class="keyword">new</span> LinkedList();</span><br><span class="line">   Iterator var9 = yamlConfiguration.getMasterSlaveRules().entrySet().iterator();</span><br><span class="line">    </span><br><span class="line">   <span class="keyword">while</span>(var9.hasNext()) &#123;</span><br><span class="line">       Entry&lt;String, YamlMasterSlaveRuleConfiguration&gt; entry = (Entry)var9.next();</span><br><span class="line">       YamlMasterSlaveRuleConfiguration each = (YamlMasterSlaveRuleConfiguration)entry.getValue();</span><br><span class="line">       each.setName((String)entry.getKey());</span><br><span class="line">       masterSlaveRuleConfigs.add(<span class="keyword">this</span>.masterSlaveRuleConfigurationYamlSwapper.swap((YamlMasterSlaveRuleConfiguration)entry.getValue()));</span><br><span class="line">   &#125;</span><br><span class="line">    </span><br><span class="line">   result.setMasterSlaveRuleConfigs(masterSlaveRuleConfigs);</span><br><span class="line">   <span class="keyword">if</span> (<span class="keyword">null</span> != yamlConfiguration.getEncryptRule()) &#123;</span><br><span class="line">       result.setEncryptRuleConfig(<span class="keyword">this</span>.encryptRuleConfigurationYamlSwapper.swap(yamlConfiguration.getEncryptRule()));</span><br><span class="line">   &#125;</span><br><span class="line">    </span><br><span class="line">   <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line">SpringBootConfiguration -&gt; ShardingDataSourceFactory -&gt; ShardingRule -&gt; ShardingDataSource -&gt; ShardingRuntimeContext</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="53-分片运行时上下文创建过程"><a class="markdownIt-Anchor" href="#53-分片运行时上下文创建过程"></a> 5.3 分片运行时上下文创建过程</h3>
<p>创建数据源的时候会在构造器中将运行时上下文<code>ShardingRuntimeContext</code>一同创建出来，ShardingRuntimeContext得构造器如下图</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ShardingRuntimeContext</span> <span class="keyword">extends</span> <span class="title">MultipleDataSourcesRuntimeContext</span>&lt;<span class="title">ShardingRule</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CachedDatabaseMetaData cachedDatabaseMetaData;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ShardingTransactionManagerEngine shardingTransactionManagerEngine;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ShardingRuntimeContext</span><span class="params">(Map&lt;String, DataSource&gt; dataSourceMap, ShardingRule shardingRule, Properties props, DatabaseType databaseType)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(dataSourceMap, shardingRule, props, databaseType);</span><br><span class="line">        <span class="keyword">this</span>.cachedDatabaseMetaData = <span class="keyword">this</span>.createCachedDatabaseMetaData(dataSourceMap);</span><br><span class="line">        <span class="keyword">this</span>.shardingTransactionManagerEngine = <span class="keyword">new</span> ShardingTransactionManagerEngine();</span><br><span class="line">        <span class="keyword">this</span>.shardingTransactionManagerEngine.init(databaseType, dataSourceMap);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//----------------- 省略------------</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>类关系图如下：<br>
<img src="/sharding-jdbc/14.png" alt><br>
发现运行时上下文进行了抽象，分片运行时上下文继承了<code>MultipleDataSourcesRuntimeContext</code> 多数据源运行时上下文，而多数据源运行时上下文又继承了 <code>AbstractRuntimeContext</code> 抽象上下文。而创建 <code>ShardingRuntimeContext</code> 分片运行时上下文得时候会同时将分片规则保存在抽象类中</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractRuntimeContext</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">BaseRule</span>&gt; <span class="keyword">implements</span> <span class="title">RuntimeContext</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> T rule;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ConfigurationProperties properties;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> DatabaseType databaseType;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ExecutorEngine executorEngine;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> SQLParserEngine sqlParserEngine;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="title">AbstractRuntimeContext</span><span class="params">(T rule, Properties props, DatabaseType databaseType)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.rule = rule;   <span class="comment">//1. 缓存整个分片规则，为后续的分片操作提供依据</span></span><br><span class="line">        <span class="keyword">this</span>.properties = <span class="keyword">new</span> ConfigurationProperties(<span class="keyword">null</span> == props ? <span class="keyword">new</span> Properties() : props);</span><br><span class="line">        <span class="keyword">this</span>.databaseType = databaseType;   <span class="comment">//2. 缓存数据库类型，用于后续执行的时候加载对应的数据库元数据</span></span><br><span class="line">        <span class="comment">//3.创建执行引擎，根据当前执行连接是否持有事物来决定是否异步执行，根据配置的executor.size 参数决定创建多少个线程的线程池，默认不配置得话，使用 cachepool，配置了就使用固定线程数得线程池</span></span><br><span class="line">        <span class="keyword">this</span>.executorEngine = <span class="keyword">new</span> ExecutorEngine((Integer)<span class="keyword">this</span>.properties.getValue(ConfigurationPropertyKey.EXECUTOR_SIZE));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//解析引擎，用于解析SQL为抽象语法树，解析过程分为词法解析和语法解析。从3.0之后解析会全面替换为 ANTLR</span></span><br><span class="line">        <span class="keyword">this</span>.sqlParserEngine = SQLParserEngineFactory.getSQLParserEngine(DatabaseTypes.getTrunkDatabaseTypeName(databaseType));</span><br><span class="line">        ConfigurationLogger.log(rule.getRuleConfiguration());</span><br><span class="line">        ConfigurationLogger.log(props);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//----------------- 省略------------</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ShardingRuntimeContext-&gt; MultipleDataSourcesRuntimeContext -&gt; AbstractRuntimeContext-&gt; ExecutorEngine-&gt; SQLParserEngine</span><br></pre></td></tr></table></figure>
<h3 id="54-分片处理过程"><a class="markdownIt-Anchor" href="#54-分片处理过程"></a> 5.4 分片处理过程</h3>
<p>由于测试代码使用的是<code>Mybatis</code>层，这里只是对<code>Mybatis</code>处理流程进行分析。</p>
<p>当一个查询<code>sql</code>执行时，首先经过Mybatis层</p>
<ol>
<li>
<p>调用<code>org.apache.ibatis.executor.BaseExecutor # queryFromDatabase</code>方法</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> &lt;E&gt; <span class="function">List&lt;E&gt; <span class="title">queryFromDatabase</span><span class="params">(MappedStatement ms, Object parameter, RowBounds rowBounds, ResultHandler resultHandler, CacheKey key, BoundSql boundSql)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.localCache.putObject(key, ExecutionPlaceholder.EXECUTION_PLACEHOLDER);</span><br><span class="line">    List list;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        list = <span class="keyword">this</span>.doQuery(ms, parameter, rowBounds, resultHandler, boundSql);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.localCache.removeObject(key);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.localCache.putObject(key, list);</span><br><span class="line">    <span class="keyword">if</span> (ms.getStatementType() == StatementType.CALLABLE) &#123;</span><br><span class="line">        <span class="keyword">this</span>.localOutputParameterCache.putObject(key, parameter);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>通过模板抽象方法<code>org.apache.ibatis.executor.BaseExecutor#doQuery</code>查找具体实现（如果没有特殊配置，此处是SimpleExecutor）,并且将查询结果放入一级缓存中。</p>
  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="keyword">public</span> &lt;E&gt; <span class="function">List&lt;E&gt; <span class="title">doQuery</span><span class="params">(MappedStatement ms, Object parameter, RowBounds rowBounds, ResultHandler resultHandler, BoundSql boundSql)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">    Statement stmt = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    List var9;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Configuration configuration = ms.getConfiguration();</span><br><span class="line">        StatementHandler handler = configuration.newStatementHandler(<span class="keyword">this</span>.wrapper, ms, parameter, rowBounds, resultHandler, boundSql);</span><br><span class="line">        stmt = <span class="keyword">this</span>.prepareStatement(handler, ms.getStatementLog());</span><br><span class="line">        var9 = handler.query(stmt, resultHandler);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.closeStatement(stmt);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> var9;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>在<code>org.apache.ibatis.executor.SimpleExecutor#doQuery</code>方法中会创建一个<code>Statement</code>，而此实例就是<code>ShardingPreparedStatement</code><br>
<img src="/sharding-jdbc/16.png" alt></p>
</li>
<li>
<p>经过Mybatis预编译SQL处理器，然后在<code>org.apache.ibatis.executor.statement.PreparedStatementHandler#query</code>方法中执行了<code>PreparedStatement</code>的<code>execute</code>方法</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;E&gt; <span class="function">List&lt;E&gt; <span class="title">query</span><span class="params">(Statement statement, ResultHandler resultHandler)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">    PreparedStatement ps = (PreparedStatement)statement;</span><br><span class="line">    ps.execute();</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.resultSetHandler.handleResultSets(ps);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><span id="initPreparedStatementExecutor">在前面知道此处</span>的<code>PreparedStatement</code>是<code>ShardingPreparedStatement</code>，所以这里调用的是<code>ShardingPreparedStatement</code>的<code>execute</code>方法</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">    <span class="keyword">boolean</span> var1;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//1. 首先清理本地 PreparedStatementExecutor 中缓存的sql相关信息（创建执行单元的时候会将sql相关信息缓存到本地）</span></span><br><span class="line">        <span class="keyword">this</span>.clearPrevious();</span><br><span class="line">        <span class="comment">//2. ② 然后执行prepare方法，此方法中有两个很关键的操作：</span></span><br><span class="line">        <span class="keyword">this</span>.prepare();</span><br><span class="line">        <span class="keyword">this</span>.initPreparedStatementExecutor();</span><br><span class="line">        var1 = <span class="keyword">this</span>.preparedStatementExecutor.execute();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.clearBatch();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> var1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/sharding-jdbc/17.png" alt></p>
<ol>
<li>
<p><code>this.prepare()</code>执行路由策略和SQL改写策略（这两步是分片的核心，另外也都是可供使用者扩展的）</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ExecutionContext <span class="title">prepare</span><span class="params">(String sql, List&lt;Object&gt; parameters)</span> </span>&#123;</span><br><span class="line">    List&lt;Object&gt; clonedParameters = <span class="keyword">this</span>.cloneParameters(parameters);</span><br><span class="line">    RouteContext routeContext = <span class="keyword">this</span>.executeRoute(sql, clonedParameters);</span><br><span class="line">    ExecutionContext result = <span class="keyword">new</span> ExecutionContext(routeContext.getSqlStatementContext());</span><br><span class="line">    result.getExecutionUnits().addAll(<span class="keyword">this</span>.executeRewrite(sql, clonedParameters, routeContext));</span><br><span class="line">    <span class="keyword">if</span> ((Boolean)<span class="keyword">this</span>.properties.getValue(ConfigurationPropertyKey.SQL_SHOW)) &#123;</span><br><span class="line">        SQLLogger.logSQL(sql, (Boolean)<span class="keyword">this</span>.properties.getValue(ConfigurationPropertyKey.SQL_SIMPLE), result.getSqlStatementContext(), result.getExecutionUnits());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><code>org.apache.shardingsphere.underlying.pluggble.prepare.BasePrepareEngine#executeRoute</code>方法，注册路由装饰器。</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> RouteContext <span class="title">executeRoute</span><span class="params">(String sql, List&lt;Object&gt; clonedParameters)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.registerRouteDecorator();</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.route(<span class="keyword">this</span>.router, sql, clonedParameters);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>获取已经注册的<code>RouteDecorator</code>类实例，过滤掉泛型是BaseRule类型的（ShardingRule是其子类，所以重新的时候覆写 getType方法时，一定要是BaseRule类型的）</li>
<li>实例化路由装饰器</li>
<li>调用模板方法 route，最终会调用到<code>DataNodeRouter</code>的 <code>executeRoute</code> 方法  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">private</span> RouteContext <span class="title">executeRoute</span><span class="params">(String sql, List&lt;Object&gt; parameters, <span class="keyword">boolean</span> useCache)</span> </span>&#123;</span><br><span class="line">     <span class="comment">//1. 解析引擎： 通过 SQLParserEngine 解析SQL（并且此处默认是会将解析后的语句缓存起来，也就证实了前面会什么会先清理缓存），然后通过调用parse0方法解析SQL并缓存</span></span><br><span class="line">     RouteContext result = <span class="keyword">this</span>.createRouteContext(sql, parameters, useCache);</span><br><span class="line"></span><br><span class="line">     Entry entry;</span><br><span class="line">     <span class="comment">//2. 循环执行注册了的路由装饰器</span></span><br><span class="line">     <span class="keyword">for</span>(Iterator var5 = <span class="keyword">this</span>.decorators.entrySet().iterator();</span><br><span class="line">          var5.hasNext(); result = ((RouteDecorator)entry.getValue()).decorate(result, <span class="keyword">this</span>.metaData, (BaseRule)entry.getKey(), <span class="keyword">this</span>.properties)) &#123;</span><br><span class="line">         entry = (Entry)var5.next();</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
</li>
<li>
<p>然后开始分片路由装饰器<code>org.apache.shardingsphere.sharding.route.engine.ShardingRouteDecorator#decorate</code><br>
<img src="/sharding-jdbc/18.png" alt><br>
① 获取分片条件：根据不同的语句创建不同的 条件解析引擎来构造分片条件（获取的分片条件用于在执行路由判断时决定使用哪种分片策略）<br>
② 通过工厂创建出 ShardingRouteEngine 实例，一般情况下 会创建出来 ShardingStandardRoutingEngine（没有配置什么骚操作的情况下），然后调用 标准路由执行引擎的 路由方法</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">public</span> RouteResult <span class="title">route</span><span class="params">(ShardingRule shardingRule)</span> </span>&#123;</span><br><span class="line">     <span class="keyword">if</span> (<span class="keyword">this</span>.isDMLForModify(<span class="keyword">this</span>.sqlStatementContext) &amp;&amp; <span class="number">1</span> != ((TableAvailable)<span class="keyword">this</span>.sqlStatementContext).getAllTables().size()) &#123;</span><br><span class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> ShardingSphereException(<span class="string">&quot;Cannot support Multiple-Table for &#x27;%s&#x27;.&quot;</span>, <span class="keyword">new</span> Object[]&#123;<span class="keyword">this</span>.sqlStatementContext.getSqlStatement()&#125;);</span><br><span class="line">     &#125; <span class="keyword">else</span> &#123;                </span><br><span class="line">         <span class="comment">//根据路由节点生成路由结果 RouteResult</span></span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">this</span>.generateRouteResult(<span class="keyword">this</span>.getDataNodes(shardingRule, shardingRule.getTableRule(<span class="keyword">this</span>.logicTableName)));</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 获取数据节点：此处获取的就是真实的SQL路由情况（比如：ds0.table_0），</span></span><br><span class="line"><span class="comment">  * 首先判断是否使用直接路由(强制路由)，若使用则走强制路由的分片算法去计算分片；然后再判断是否根据分片条件去路由，</span></span><br><span class="line"><span class="comment">  * 若有的话，则根据配置的分片算法（内联）根据分片值计算出来具体分到哪个库哪张表；若都没有的话，则直接走混合路由的处理逻辑</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="function"><span class="keyword">private</span> Collection&lt;DataNode&gt; <span class="title">getDataNodes</span><span class="params">(ShardingRule shardingRule, TableRule tableRule)</span> </span>&#123;</span><br><span class="line">     <span class="keyword">if</span> (<span class="keyword">this</span>.isRoutingByHint(shardingRule, tableRule)) &#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">this</span>.routeByHint(shardingRule, tableRule);</span><br><span class="line">     &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">this</span>.isRoutingByShardingConditions(shardingRule, tableRule) ? <span class="keyword">this</span>.routeByShardingConditions(shardingRule, tableRule) : <span class="keyword">this</span>.routeByMixedConditions(shardingRule, tableRule);</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>找到了路由节点</p>
</li>
<li>
<p><a href="#initPreparedStatementExecutor">前面一直在讲prepare方法</a> 回到<code>ShardingPreparedStatement#execute</code>方法中，调用<code>initPreparedStatementExecutor()</code> 初始化<code>PreparedStatementExecutor</code>实例 并将解析出来的执行上下文中的相关SQL语句组设置到缓存中,然后调用执行器的执行方法</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//此处会获取到需要执行的SQL集合，主要是通过maxConnectionsSizePerQuery每次执行时最大连接数来判断sql执行单元应该分成几组，maxConnectionsSizePerQuery的值默认是1。则表示，</span></span><br><span class="line"><span class="comment">// 如果真实的sql有10条，那么每组拆分10条，总共拆分成1组，</span></span><br><span class="line"><span class="comment">// 此时会判断 maxConnectionsSizePerQuery 是否大于10，小于的话则会选择当前批次执行的是连接限制模式（只允许占用一个库的一个连接），相反则是内存限制模式，不会限制创建的连接数</span></span><br><span class="line"> <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initPreparedStatementExecutor</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">     <span class="keyword">this</span>.preparedStatementExecutor.init(<span class="keyword">this</span>.executionContext);</span><br><span class="line">     <span class="keyword">this</span>.setParametersForStatements();</span><br><span class="line">     <span class="keyword">this</span>.replayMethodForStatements();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><a href="#initPreparedStatementExecutor">ShardingPreparedStatement#executeQuery方法中</a>最后调用执行器的执行方法<code>this.preparedStatementExecutor.execute()</code></p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">    <span class="comment">//1. 获取sql执行回调类（真正操作数据库）</span></span><br><span class="line">    <span class="keyword">boolean</span> isExceptionThrown = ExecutorExceptionHandler.isExceptionThrown();</span><br><span class="line">    <span class="comment">//2. 调用 executeCallback方法，此方法继承自父类AbstractStatementExecutor</span></span><br><span class="line">    SQLExecuteCallback&lt;Boolean&gt; executeCallback = SQLExecuteCallbackFactory.getPreparedSQLExecuteCallback(<span class="keyword">this</span>.getDatabaseType(), isExceptionThrown);</span><br><span class="line">    List&lt;Boolean&gt; result = <span class="keyword">this</span>.executeCallback(executeCallback);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span> != result &amp;&amp; !result.isEmpty() &amp;&amp; <span class="keyword">null</span> != result.get(<span class="number">0</span>) ? (Boolean)result.get(<span class="number">0</span>) : <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>进入父类<code>org.apache.shardingsphere.shardingjdbc.executor.AbstractStatementExecutor#executeCallback</code>，SQL执行模板<code>SQLExecuteTemplate</code>类通过委派其成员<code>ExecutorEngine</code>执行引擎来执行真正的操作</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">final</span> &lt;T&gt; <span class="function">List&lt;T&gt; <span class="title">executeCallback</span><span class="params">(SQLExecuteCallback&lt;T&gt; executeCallback)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">    List&lt;T&gt; result = <span class="keyword">this</span>.sqlExecuteTemplate.execute(<span class="keyword">this</span>.inputGroups, executeCallback);</span><br><span class="line">    <span class="keyword">this</span>.refreshMetaDataIfNeeded(<span class="keyword">this</span>.connection.getRuntimeContext(), <span class="keyword">this</span>.sqlStatementContext);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行引擎对拆分的SQL执行单元执行处理，如图：<br>
<img src="/sharding-jdbc/21.png" alt><br>
① 并发执行（是否是并发执行通过 是否持有事务来判断的，例如 本地事务但是你修改为非自动提交事务，那么此时就是持有事务状态，则此时就是同步执行语句）</p>
<p>② 迭代出SQL执行组的第一个，其余的SQL异步执行</p>
<p>③ 同步执行第一个SQL执行组（方便与后面的执行组进行合并起来）</p>
<p>④ 通过其内置的线程池来异步执行SQL</p>
<p>此时一条查询语句到这里就执行完了，接下来我们接着分析对查询结果进行处理的操作</p>
</li>
<li>
<p>回到Mybatis中，最后对查询的结果集进行处理( resultSetHandler.<E> handleResultSets(ps)，此处是org.apache.ibatis.executor.resultset.DefaultResultSetHandler结果集处理器 ),如下：</E></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Object&gt; <span class="title">handleResultSets</span><span class="params">(Statement stmt)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">    ErrorContext.instance().activity(<span class="string">&quot;handling results&quot;</span>).object(<span class="keyword">this</span>.mappedStatement.getId());</span><br><span class="line">    List&lt;Object&gt; multipleResults = <span class="keyword">new</span> ArrayList();</span><br><span class="line">    <span class="keyword">int</span> resultSetCount = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//1. 首先调用getFirstResultSet去获取第一个结果集，此处的 Statement 实例是 ShardingPreparedStatement</span></span><br><span class="line">    ResultSetWrapper rsw = <span class="keyword">this</span>.getFirstResultSet(stmt);</span><br><span class="line">    List&lt;ResultMap&gt; resultMaps = <span class="keyword">this</span>.mappedStatement.getResultMaps();</span><br><span class="line">    <span class="keyword">int</span> resultMapCount = resultMaps.size();</span><br><span class="line">    <span class="keyword">this</span>.validateResultMapsCount(rsw, resultMapCount);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(rsw != <span class="keyword">null</span> &amp;&amp; resultMapCount &gt; resultSetCount) &#123;</span><br><span class="line">        ResultMap resultMap = (ResultMap)resultMaps.get(resultSetCount);</span><br><span class="line">        <span class="keyword">this</span>.handleResultSet(rsw, resultMap, multipleResults, (ResultMapping)<span class="keyword">null</span>);</span><br><span class="line">        rsw = <span class="keyword">this</span>.getNextResultSet(stmt);</span><br><span class="line">        <span class="keyword">this</span>.cleanUpAfterHandlingResultSet();</span><br><span class="line">        ++resultSetCount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    String[] resultSets = <span class="keyword">this</span>.mappedStatement.getResultSets();</span><br><span class="line">    <span class="keyword">if</span> (resultSets != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">while</span>(rsw != <span class="keyword">null</span> &amp;&amp; resultSetCount &lt; resultSets.length) &#123;</span><br><span class="line">            ResultMapping parentMapping = (ResultMapping)<span class="keyword">this</span>.nextResultMaps.get(resultSets[resultSetCount]);</span><br><span class="line">            <span class="keyword">if</span> (parentMapping != <span class="keyword">null</span>) &#123;</span><br><span class="line">                String nestedResultMapId = parentMapping.getNestedResultMapId();</span><br><span class="line">                ResultMap resultMap = <span class="keyword">this</span>.configuration.getResultMap(nestedResultMapId);</span><br><span class="line">                <span class="keyword">this</span>.handleResultSet(rsw, resultMap, (List)<span class="keyword">null</span>, parentMapping);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            rsw = <span class="keyword">this</span>.getNextResultSet(stmt);</span><br><span class="line">            <span class="keyword">this</span>.cleanUpAfterHandlingResultSet();</span><br><span class="line">            ++resultSetCount;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.collapseSingleResultList(multipleResults);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//这里的Statement ShardingPreparedStatement</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> ResultSetWrapper <span class="title">getFirstResultSet</span><span class="params">(Statement stmt)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">    ResultSet rs = stmt.getResultSet();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(rs == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (stmt.getMoreResults()) &#123;</span><br><span class="line">            rs = stmt.getResultSet();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (stmt.getUpdateCount() == -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> rs != <span class="keyword">null</span> ? <span class="keyword">new</span> ResultSetWrapper(rs, <span class="keyword">this</span>.configuration) : <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>调用了<code>getResultSet()</code>方法；</p>
</li>
<li>
<p>进入到<code>org.apache.shardingsphere.shardingjdbc.jdbc.core.statement.ShardingPreparedStatement# getResultSet</code><br>
将查询返回的结果集进行合并处理，Shardingsphere 的归并引擎功能上划分：遍历归并、排序归并（SQL中存在ORDER BY语句）、分组归并（SQL中有GroupBy子句）、聚合归并（含有聚合函数）、分页归并（含有Limit关键字）</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ResultSet <span class="title">getResultSet</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">null</span> != <span class="keyword">this</span>.currentResultSet) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.currentResultSet;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.executionContext.getSqlStatementContext() <span class="keyword">instanceof</span> SelectStatementContext || <span class="keyword">this</span>.executionContext.getSqlStatementContext().getSqlStatement() <span class="keyword">instanceof</span> DALStatement) &#123;</span><br><span class="line">            List&lt;ResultSet&gt; resultSets = <span class="keyword">this</span>.getResultSets();          <span class="comment">// ① </span></span><br><span class="line">            MergedResult mergedResult = <span class="keyword">this</span>.mergeQuery(<span class="keyword">this</span>.getQueryResults(resultSets));      <span class="comment">// ② </span></span><br><span class="line">            <span class="keyword">this</span>.currentResultSet = <span class="keyword">new</span> ShardingResultSet(resultSets, mergedResult, <span class="keyword">this</span>, <span class="keyword">this</span>.executionContext);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.currentResultSet;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>① 获取所有Statement对应的结果集，此处是拿到真正数据源所对应的Statement实例，比如：我现在的数据源是 HikariDateSource，那么拿到的就是 HikariProxyPreparedStatement</p>
<p>② 执行合并逻辑：首先将结果集封装成流式查询结果对象StreamQueryResult，接着创建合并引擎<code>org.apache.shardingsphere.underlying.pluggble.merge.MergeEngine#merge</code>，然后调用合并引擎的合并方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> MergedResult <span class="title">merge</span><span class="params">(List&lt;QueryResult&gt; queryResults, SQLStatementContext sqlStatementContext)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.registerMergeDecorator();  <span class="comment">// ③ </span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.merger.process(queryResults, sqlStatementContext);  <span class="comment">// ④ </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>③ 实例化合并引擎处理器ResultProcessEngine</p>
<p>④ 调用MergeEntry的 process 方法，委派来进行合并逻辑。<br>
<img src="/sharding-jdbc/24.png" alt><br>
⑤ ⑥ 中，判断若是<code>ResultMergerEngine</code>类型的合并引擎，则调用其merge方法执行真正的合并逻辑<br>
<img src="/sharding-jdbc/25.png" alt><br>
显然满足类型判断，则此处会调用ShardingResultMergerEngine#newInstance 方法来实例化真正用于合并数据流的引擎</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ResultMerger <span class="title">newInstance</span><span class="params">(DatabaseType databaseType, ShardingRule shardingRule, ConfigurationProperties properties, SQLStatementContext sqlStatementContext)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (sqlStatementContext <span class="keyword">instanceof</span> SelectStatementContext) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ShardingDQLResultMerger(databaseType);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (ResultMerger)(sqlStatementContext.getSqlStatement() <span class="keyword">instanceof</span> DALStatement ? <span class="keyword">new</span> ShardingDALResultMerger(shardingRule) : <span class="keyword">new</span> TransparentResultMerger());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>显然此处是查询语句，那么最终用于合并的引擎就是 ShardingDQLResultMerger，然后执行其merge方法<br>
<img src="/sharding-jdbc/26.png" alt><br>
⑦ 中判断sql中包含哪些关键字，然后创建对应的合并结果，如果条件都不满足，那么默认会使用 遍历流式归并方式合并数据。假设 我们此处SQL中带有 order by关键字，那么创建得合并结果对象就是OrderByStreamMergedResult<br>
⑧ 对创建出来的排序合并结果进行装饰操作（就是判断有没有别的关键字，例如：Limit，如果有就会创建LimitDecoratorMergedResult 装饰器对象，在之前的排序合并基础上又多一个 Limit功能），再回到 ShardingPreparedStatement中，会创建一个 ShardingResultSet对象设置到当前的成员变量currentResultSet中，并返回。 此时如果是批量的场景，返回的结果集中实际上已经包含了所有的结果集（前面存放在OrderByStreamMergedResult的 orderByValuesQueue 队列中）</p>
<p>排序归并流程：<br>
<img src="/sharding-jdbc/27.png" alt><br>
调用合并结果的 next方法时会执行如图<br>
<img src="/sharding-jdbc/28.png" alt><br>
最后流程又回到Mybatis 结果集处理上了，将结果返回给请求调用方</p>
</li>
</ol>
<h2 id="6-分片策略"><a class="markdownIt-Anchor" href="#6-分片策略"></a> 6. 分片策略</h2>
<p><strong>策略包括了算法，算法是策略的一个属性。</strong></p>
<p>Sharding-JDBC 中的分片策略有两个维度：分库（数据源分片）策略和分表策略；（mycat只支持要么分库或者要么分表）</p>
<p>跟 Mycat 不一样，Sharding-JDBC 没有提供内置的分片算法，而是通过实现接口<code>ShardingStrategy</code>， 让开发者自行实现，这样可以根据业务实际情况灵活地实现分片。</p>
<h3 id="61-行表达式分片策略-inlineshardingstrategy"><a class="markdownIt-Anchor" href="#61-行表达式分片策略-inlineshardingstrategy"></a> 6.1 行表达式分片策略 InlineShardingStrategy</h3>
<ul>
<li>算法：行内表达式 $-&gt;{}</li>
<li>文档路径：<a href="https://shardingsphere.apache.org/document/current/cn/features/sharding/concept/inline-expression/">https://shardingsphere.apache.org/document/current/cn/features/sharding/concept/inline-expression/</a></li>
</ul>
<p>只支持单分片键，提供对<code>=</code>和<code>IN</code> 操作的支持。行内表达式的配置比较简单。</p>
<p>例如：</p>
<ul>
<li>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mi>b</mi><mi>e</mi><mi>g</mi><mi>i</mi><mi>n</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi>e</mi><mi>n</mi><mi>d</mi></mrow><mi mathvariant="normal">表</mi><mi mathvariant="normal">示</mi><mi mathvariant="normal">范</mi><mi mathvariant="normal">围</mi><mi mathvariant="normal">区</mi><mi mathvariant="normal">间</mi><mi mathvariant="normal">，</mi><mi mathvariant="normal">如</mi><mi mathvariant="normal">：</mi><mi>d</mi><mi>b</mi></mrow><annotation encoding="application/x-tex">{begin..end}   表示范围区间，如：db</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord">.</span><span class="mord">.</span><span class="mord mathdefault">e</span><span class="mord mathdefault">n</span><span class="mord mathdefault">d</span></span><span class="mord cjk_fallback">表</span><span class="mord cjk_fallback">示</span><span class="mord cjk_fallback">范</span><span class="mord cjk_fallback">围</span><span class="mord cjk_fallback">区</span><span class="mord cjk_fallback">间</span><span class="mord cjk_fallback">，</span><span class="mord cjk_fallback">如</span><span class="mord cjk_fallback">：</span><span class="mord mathdefault">d</span><span class="mord mathdefault">b</span></span></span></span>-&gt;{0…1}表示db0, db1</p>
</li>
<li>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mo stretchy="false">[</mo><mi>u</mi><mi>n</mi><mi>i</mi><mi>t</mi><mn>1</mn><mo separator="true">,</mo><mi>u</mi><mi>n</mi><mi>i</mi><mi>t</mi><mn>2</mn><mo separator="true">,</mo><mi>u</mi><mi>n</mi><mi>i</mi><msub><mi>t</mi><mi>x</mi></msub><mo stretchy="false">]</mo></mrow><mi mathvariant="normal">表</mi><mi mathvariant="normal">示</mi><mi mathvariant="normal">枚</mi><mi mathvariant="normal">举</mi><mi mathvariant="normal">值</mi><mi mathvariant="normal">，</mi><mi mathvariant="normal">如</mi><mi mathvariant="normal">：</mi></mrow><annotation encoding="application/x-tex">{[unit1, unit2, unit_x]}   表示枚举值，如 ：</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mopen">[</span><span class="mord mathdefault">u</span><span class="mord mathdefault">n</span><span class="mord mathdefault">i</span><span class="mord mathdefault">t</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">u</span><span class="mord mathdefault">n</span><span class="mord mathdefault">i</span><span class="mord mathdefault">t</span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">u</span><span class="mord mathdefault">n</span><span class="mord mathdefault">i</span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">]</span></span><span class="mord cjk_fallback">表</span><span class="mord cjk_fallback">示</span><span class="mord cjk_fallback">枚</span><span class="mord cjk_fallback">举</span><span class="mord cjk_fallback">值</span><span class="mord cjk_fallback">，</span><span class="mord cjk_fallback">如</span><span class="mord cjk_fallback">：</span></span></span></span>{[‘db0’, ‘db1’]}</p>
</li>
<li>
<p>t_user_$-&gt;{u_id % 8} 表示 t_user 表根据 u_id 模 8，而分成 8 张表，表名称为 t_user_0 到 t_user_7。</p>
</li>
</ul>
<p>行表达式中如果出现连续多个<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow><mi mathvariant="normal">或</mi></mrow><annotation encoding="application/x-tex">{ expression }或</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="mord mathdefault">x</span><span class="mord mathdefault">p</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mord mathdefault">s</span><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span></span><span class="mord cjk_fallback">或</span></span></span></span>-&gt;{ expression }表达式，整个表达式最终的结果将会根据每个子表达式的结果进行笛卡尔组合。 例如，以下行表达式： <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mrow><msup><mo stretchy="false">[</mo><mo mathvariant="normal">′</mo></msup><mi>d</mi><mi>b</mi><msup><mn>1</mn><mo mathvariant="normal">′</mo></msup><msup><mo separator="true">,</mo><mo mathvariant="normal">′</mo></msup><mi>d</mi><mi>b</mi><msup><mn>2</mn><mo mathvariant="normal">′</mo></msup><mo stretchy="false">]</mo></mrow><mi>t</mi></msub><mi>a</mi><mi>b</mi><mi>l</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">{[&#x27;db1&#x27;, &#x27;db2&#x27;]}_table</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0515919999999999em;vertical-align:-0.29969999999999997em;"></span><span class="mord"><span class="mord"><span class="mopen"><span class="mopen">[</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord mathdefault">d</span><span class="mord mathdefault">b</span><span class="mord"><span class="mord">1</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mpunct"><span class="mpunct">,</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">d</span><span class="mord mathdefault">b</span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose">]</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.13085599999999997em;"><span style="top:-2.4003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.29969999999999997em;"><span></span></span></span></span></span></span><span class="mord mathdefault">a</span><span class="mord mathdefault">b</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">e</span></span></span></span>{1…3} 最终会解析为： db1_table1, db1_table2, db1_table3, db2_table1, db2_table2, db2_table3</p>
<h3 id="62-标准分片策略-standardshardingstrategy"><a class="markdownIt-Anchor" href="#62-标准分片策略-standardshardingstrategy"></a> 6.2 标准分片策略 StandardShardingStrategy</h3>
<p>标准分片策略只支持但分片键，提供了两个分片算法，分别对应了<code>IN</code>、<code>BETWEEN</code> 和 <code>=</code>；如果要是用标准分片策略，必须要实现<code>PreciseShardingAlgorithm</code>,用来处理<code>=</code>和<code>IN</code>的分片<br>
<code>RangeShardingAlgorithm</code>是可选的，如果没有实现，SQL语句会发送到所有节点上执行。</p>
<ul>
<li>算法：范围分片<code>RangeShardingAlgorithm</code> 和 精确分片<code>PreciseShardingAlgorithm</code>两种算法</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义分库策略</span></span><br><span class="line"><span class="comment"> * 数据库分库的策略，根据分片键，返回数据库名称</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DBShardAlgo</span> <span class="keyword">implements</span> <span class="title">PreciseShardingAlgorithm</span>&lt;<span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">doSharding</span><span class="params">(Collection&lt;String&gt; collection, PreciseShardingValue&lt;Long&gt; preciseShardingValue)</span> </span>&#123;</span><br><span class="line">        String db_name=<span class="string">&quot;ds&quot;</span>;</span><br><span class="line">        Long num= preciseShardingValue.getValue()%<span class="number">2</span>;</span><br><span class="line">        db_name=db_name + num;</span><br><span class="line">        System.out.println(<span class="string">&quot;----------------db_name:&quot;</span> + db_name);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (String each : collection) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ds:&quot;</span> + each);</span><br><span class="line">            <span class="keyword">if</span> (each.equals(db_name)) &#123;</span><br><span class="line">                <span class="keyword">return</span> each;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义分表策略</span></span><br><span class="line"><span class="comment"> * 等值查询使用的分片算法，包括in</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TblPreShardAlgo</span> <span class="keyword">implements</span> <span class="title">PreciseShardingAlgorithm</span>&lt;<span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">doSharding</span><span class="params">(Collection&lt;String&gt; availableTargetNames, PreciseShardingValue&lt;Long&gt; shardingColumn)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 不分表</span></span><br><span class="line">        System.out.println(<span class="string">&quot;-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-availableTargetNames:&quot;</span> + availableTargetNames);</span><br><span class="line">        <span class="keyword">for</span> (String tbname : availableTargetNames) &#123;</span><br><span class="line">            <span class="comment">//如果这里要分表可以根据  shardingColumn.getValue() % 2</span></span><br><span class="line">            <span class="comment">//也可以根据月份分表，user_info_202201这种，只需要在这里拼接表名即可</span></span><br><span class="line">            System.out.println(shardingColumn.getValue() % <span class="number">2</span>+<span class="string">&quot;-------&quot;</span>+ tbname);</span><br><span class="line">            <span class="keyword">return</span> tbname;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>那么在配置文件中只需要指定分配规则</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment">##为了缩减篇幅，这里改成properties的格式</span></span><br><span class="line"><span class="meta">spring.shardingsphere.sharding.tables.t_order.databaseStrategy.standard.shardingColumn</span>=<span class="string">order_id</span></span><br><span class="line"><span class="meta">spring.shardingsphere.sharding.tables.t_order.databaseStrategy.standard.precise-algorithm-class-name</span>=<span class="string">com.ygb.config.TblPreShardAlgo</span></span><br></pre></td></tr></table></figure>
<p><img src="/sharding-jdbc/19.png" alt></p>
<p>范围分片：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 范围查询所使用的分片算法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TblRangeShardAlgo</span> <span class="keyword">implements</span> <span class="title">RangeShardingAlgorithm</span>&lt;<span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Collection&lt;String&gt; <span class="title">doSharding</span><span class="params">(Collection&lt;String&gt; availableTargetNames, RangeShardingValue&lt;Long&gt; rangeShardingValue)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;范围-*-*-*-*-*-*-*-*-*-*-*---------------&quot;</span>+availableTargetNames);</span><br><span class="line">        System.out.println(<span class="string">&quot;范围-*-*-*-*-*-*-*-*-*-*-*---------------&quot;</span>+rangeShardingValue);</span><br><span class="line">        Collection&lt;String&gt; collect = <span class="keyword">new</span> LinkedHashSet&lt;&gt;();</span><br><span class="line">        Range&lt;Long&gt; valueRange = rangeShardingValue.getValueRange();</span><br><span class="line">        <span class="keyword">for</span> (Long i = valueRange.lowerEndpoint(); i &lt;= valueRange.upperEndpoint(); i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (String each : availableTargetNames) &#123;</span><br><span class="line">                <span class="keyword">if</span> (each.endsWith(i % availableTargetNames.size() + <span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">                    collect.add(each);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> collect;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>查看数据库<code>db0</code>、<code>db1</code>，可以看到只有<code>db0</code>有数据；</p>
<h3 id="63-复合分片策略-complexshardingstrategy"><a class="markdownIt-Anchor" href="#63-复合分片策略-complexshardingstrategy"></a> 6.3 复合分片策略 ComplexShardingStrategy</h3>
<p>复合分片策略支持多分片键</p>
<ul>
<li>算法：ComplexKeysShardingAlgorithm</li>
<li>场景：根据日期和ID两个字段分片，每个月3张表，先根据日期，然后在根据ID取模分片</li>
</ul>
<h3 id="64-hint分片策略-hintshardingstrategy"><a class="markdownIt-Anchor" href="#64-hint分片策略-hintshardingstrategy"></a> 6.4 Hint分片策略 HintShardingStrategy</h3>
<p>通过 Hint 而非 SQL 解析的方式分片的策略</p>
<ul>
<li>算法：HintShardingAlgorithm</li>
</ul>
<h3 id="65-不分片策略-noneshardingstrategy"><a class="markdownIt-Anchor" href="#65-不分片策略-noneshardingstrategy"></a> 6.5 不分片策略 NoneShardingStrategy</h3>
<p>只在一个节点存储</p>
<ul>
<li>算法：无</li>
</ul>
<p><img src="/sharding-jdbc/20.png" alt></p>
<h2 id="与mycat对比"><a class="markdownIt-Anchor" href="#与mycat对比"></a> 与Mycat对比</h2>
<table>
<thead>
<tr>
<th style="text-align:left"></th>
<th style="text-align:center">ShardingSphere-JDBC</th>
<th style="text-align:center">Mycat</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">工作层面</td>
<td style="text-align:center">JDBC协议</td>
<td style="text-align:center">Mysql协议/JDBC协议</td>
</tr>
<tr>
<td style="text-align:left">运行方式</td>
<td style="text-align:center">Jar包，客户端</td>
<td style="text-align:center">独立服务，服务端</td>
</tr>
<tr>
<td style="text-align:left">开发方式</td>
<td style="text-align:center">代码/配置改动</td>
<td style="text-align:center">连接地址修改（数据源）</td>
</tr>
<tr>
<td style="text-align:left">运维方式</td>
<td style="text-align:center">无</td>
<td style="text-align:center">管理独立服务，运维成本高</td>
</tr>
<tr>
<td style="text-align:left">性能</td>
<td style="text-align:center">多线程并发操作，性能高</td>
<td style="text-align:center">独立服务+网络开销，存在性能损失风险</td>
</tr>
<tr>
<td style="text-align:left">功能范围</td>
<td style="text-align:center">协议层面</td>
<td style="text-align:center">包括分布式事务、数据迁移等</td>
</tr>
<tr>
<td style="text-align:left">适用操作</td>
<td style="text-align:center">OLTP</td>
<td style="text-align:center">OLTP+OLAP</td>
</tr>
<tr>
<td style="text-align:left">支持数据库</td>
<td style="text-align:center">基于JDBC协议的数据库</td>
<td style="text-align:center">MySQL 和其他支持 JDBC 协议的数据库</td>
</tr>
<tr>
<td style="text-align:left">支持语言</td>
<td style="text-align:center">Java</td>
<td style="text-align:center">支持 JDBC 协议的语言</td>
</tr>
</tbody>
</table>
<p>从易用性和功能完善的角度来说，<code>Mycat</code> 似乎比 <code>Sharding-JDBC</code> 要好，因为有现成 的分片规则，也提供了4种<code>ID</code>生成方式，通过注解可以支持高级功能，比如跨库关联查询。</p>
<p>建议：小型项目可以用 <code>Sharding-JDBC</code>。大型项目，可以用 <code>Mycat</code>。</p>
]]></content>
      <categories>
        <category>ShardingSphere-jdbc</category>
      </categories>
      <tags>
        <tag>分布式</tag>
      </tags>
  </entry>
</search>
